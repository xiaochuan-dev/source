{"version":3,"file":"lightweight-charts.development.mjs","sources":["../src/api/options/series-options-defaults.ts","../src/renderers/draw-line.ts","../src/helpers/assertions.ts","../src/helpers/color.ts","../src/helpers/delegate.ts","../src/helpers/strict-type-checks.ts","../src/helpers/make-font.ts","../src/renderers/price-axis-renderer-options-provider.ts","../src/renderers/composite-renderer.ts","../src/renderers/bitmap-coordinates-pane-renderer.ts","../src/renderers/marks-renderer.ts","../src/views/pane/crosshair-marks-pane-view.ts","../src/renderers/crosshair-renderer.ts","../src/views/pane/crosshair-pane-view.ts","../src/helpers/canvas-helpers.ts","../src/renderers/price-axis-view-renderer.ts","../src/views/price-axis/price-axis-view.ts","../src/views/price-axis/crosshair-price-axis-view.ts","../src/renderers/time-axis-view-renderer.ts","../src/views/time-axis/crosshair-time-axis-view.ts","../src/model/data-source.ts","../src/model/crosshair.ts","../src/model/default-price-scale.ts","../src/model/invalidate-mask.ts","../src/formatters/price-formatter.ts","../src/formatters/percentage-formatter.ts","../src/formatters/volume-formatter.ts","../src/renderers/walk-line.ts","../src/renderers/area-renderer-base.ts","../src/helpers/mathex.ts","../src/renderers/gradient-style-cache.ts","../src/renderers/area-renderer.ts","../src/renderers/draw-series-point-markers.ts","../src/renderers/line-renderer-base.ts","../src/renderers/line-renderer.ts","../src/helpers/algorithms.ts","../src/model/time-data.ts","../src/views/pane/series-pane-view-base.ts","../src/views/pane/line-pane-view-base.ts","../src/views/pane/area-pane-view.ts","../src/renderers/optimal-bar-width.ts","../src/renderers/bars-renderer.ts","../src/views/pane/bars-pane-view-base.ts","../src/views/pane/bars-pane-view.ts","../src/renderers/baseline-renderer-area.ts","../src/renderers/baseline-renderer-line.ts","../src/views/pane/baseline-pane-view.ts","../src/renderers/candlesticks-renderer.ts","../src/views/pane/candlesticks-pane-view.ts","../src/views/pane/custom-pane-view.ts","../src/renderers/histogram-renderer.ts","../src/views/pane/histogram-pane-view.ts","../src/views/pane/line-pane-view.ts","../src/model/text-width-cache.ts","../src/views/pane/pane-price-axis-view.ts","../src/renderers/horizontal-line-renderer.ts","../src/views/pane/series-horizontal-line-pane-view.ts","../src/views/pane/series-horizontal-base-line-pane-view.ts","../src/renderers/series-last-price-animation-renderer.ts","../src/views/pane/series-last-price-animation-pane-view.ts","../src/renderers/series-markers-utils.ts","../src/renderers/series-markers-square.ts","../src/renderers/series-markers-arrow.ts","../src/renderers/series-markers-circle.ts","../src/renderers/series-markers-text.ts","../src/renderers/series-markers-renderer.ts","../src/views/pane/series-markers-pane-view.ts","../src/views/pane/series-price-line-pane-view.ts","../src/views/price-axis/series-price-axis-view.ts","../src/model/price-range-impl.ts","../src/model/autoscale-info-impl.ts","../src/views/pane/custom-price-line-pane-view.ts","../src/views/price-axis/custom-price-line-price-axis-view.ts","../src/model/custom-price-line.ts","../src/model/price-data-source.ts","../src/model/series-bar-colorer.ts","../src/model/plot-list.ts","../src/model/series-data.ts","../src/model/series-primitive-wrapper.ts","../src/model/series.ts","../src/model/magnet.ts","../src/renderers/grid-renderer.ts","../src/views/pane/grid-pane-view.ts","../src/model/grid.ts","../src/model/price-scale-conversions.ts","../src/model/price-tick-span-calculator.ts","../src/model/price-tick-mark-builder.ts","../src/model/sort-sources.ts","../src/model/price-scale.ts","../src/model/pane.ts","../src/model/formatted-labels-cache.ts","../src/model/range-impl.ts","../src/model/tick-marks.ts","../src/model/time-scale-visible-range.ts","../src/model/time-scale.ts","../src/renderers/media-coordinates-pane-renderer.ts","../src/renderers/watermark-renderer.ts","../src/views/pane/watermark-pane-view.ts","../src/model/watermark.ts","../src/model/chart-model.ts","../src/model/series-options.ts","../src/model/layout-options.ts","../src/model/horz-scale-behavior-time/types.ts","../src/formatters/format-date.ts","../src/formatters/date-formatter.ts","../src/formatters/time-formatter.ts","../src/formatters/date-time-formatter.ts","../src/model/horz-scale-behavior-time/default-tick-mark-formatter.ts","../src/model/horz-scale-behavior-time/time-scale-point-weight-generator.ts","../src/model/horz-scale-behavior-time/horz-scale-behavior-time.ts","../src/helpers/is-running-on-client-side.ts","../src/helpers/browsers.ts","../src/helpers/logger.ts","../src/gui/internal-layout-sizes-hints.ts","../src/model/kinetic-animation.ts","../src/gui/canvas-utils.ts","../src/gui/draw-functions.ts","../src/helpers/events.ts","../src/gui/mouse-event-handler.ts","../src/gui/pane-hit-test.ts","../src/gui/price-axis-widget.ts","../src/gui/pane-widget.ts","../src/gui/price-axis-stub.ts","../src/gui/time-axis-widget.ts","../src/gui/chart-widget.ts","../src/model/data-consumer.ts","../src/model/get-series-plot-row-creator.ts","../src/model/data-layer.ts","../src/api/get-series-data-creator.ts","../src/api/options/crosshair-options-defaults.ts","../src/api/options/grid-options-defaults.ts","../src/api/options/layout-options-defaults.ts","../src/api/options/price-scale-options-defaults.ts","../src/api/options/time-scale-options-defaults.ts","../src/api/options/watermark-options-defaults.ts","../src/api/options/chart-options-defaults.ts","../src/api/price-scale-api.ts","../src/model/data-validators.ts","../src/model/series-markers.ts","../src/api/options/price-line-options-defaults.ts","../src/api/price-line-api.ts","../src/api/series-api.ts","../src/api/time-scale-api.ts","../src/api/chart-api.ts","../src/api/create-chart.ts","../src/index.ts"],"sourcesContent":["import {\n\tAreaStyleOptions,\n\tBarStyleOptions,\n\tBaselineStyleOptions,\n\tCandlestickStyleOptions,\n\tCustomStyleOptions,\n\tHistogramStyleOptions,\n\tLastPriceAnimationMode,\n\tLineStyleOptions,\n\tPriceLineSource,\n\tSeriesOptionsCommon,\n} from '../../model/series-options';\nimport { LineStyle, LineType } from '../../renderers/draw-line';\n\nexport const candlestickStyleDefaults: CandlestickStyleOptions = {\n\tupColor: '#26a69a',\n\tdownColor: '#ef5350',\n\twickVisible: true,\n\tborderVisible: true,\n\tborderColor: '#378658',\n\tborderUpColor: '#26a69a',\n\tborderDownColor: '#ef5350',\n\twickColor: '#737375',\n\twickUpColor: '#26a69a',\n\twickDownColor: '#ef5350',\n};\n\nexport const barStyleDefaults: BarStyleOptions = {\n\tupColor: '#26a69a',\n\tdownColor: '#ef5350',\n\topenVisible: true,\n\tthinBars: true,\n};\n\nexport const lineStyleDefaults: LineStyleOptions = {\n\tcolor: '#2196f3',\n\tlineStyle: LineStyle.Solid,\n\tlineWidth: 3,\n\tlineType: LineType.Simple,\n\tlineVisible: true,\n\tcrosshairMarkerVisible: true,\n\tcrosshairMarkerRadius: 4,\n\tcrosshairMarkerBorderColor: '',\n\tcrosshairMarkerBorderWidth: 2,\n\tcrosshairMarkerBackgroundColor: '',\n\tlastPriceAnimation: LastPriceAnimationMode.Disabled,\n\tpointMarkersVisible: false,\n};\n\nexport const areaStyleDefaults: AreaStyleOptions = {\n\ttopColor: 'rgba( 46, 220, 135, 0.4)',\n\tbottomColor: 'rgba( 40, 221, 100, 0)',\n\tinvertFilledArea: false,\n\tlineColor: '#33D778',\n\tlineStyle: LineStyle.Solid,\n\tlineWidth: 3,\n\tlineType: LineType.Simple,\n\tlineVisible: true,\n\tcrosshairMarkerVisible: true,\n\tcrosshairMarkerRadius: 4,\n\tcrosshairMarkerBorderColor: '',\n\tcrosshairMarkerBorderWidth: 2,\n\tcrosshairMarkerBackgroundColor: '',\n\tlastPriceAnimation: LastPriceAnimationMode.Disabled,\n\tpointMarkersVisible: false,\n};\n\nexport const baselineStyleDefaults: BaselineStyleOptions = {\n\tbaseValue: {\n\t\ttype: 'price',\n\t\tprice: 0,\n\t},\n\n\ttopFillColor1: 'rgba(38, 166, 154, 0.28)',\n\ttopFillColor2: 'rgba(38, 166, 154, 0.05)',\n\ttopLineColor: 'rgba(38, 166, 154, 1)',\n\n\tbottomFillColor1: 'rgba(239, 83, 80, 0.05)',\n\tbottomFillColor2: 'rgba(239, 83, 80, 0.28)',\n\tbottomLineColor: 'rgba(239, 83, 80, 1)',\n\n\tlineWidth: 3,\n\tlineStyle: LineStyle.Solid,\n\tlineType: LineType.Simple,\n\tlineVisible: true,\n\n\tcrosshairMarkerVisible: true,\n\tcrosshairMarkerRadius: 4,\n\tcrosshairMarkerBorderColor: '',\n\tcrosshairMarkerBorderWidth: 2,\n\tcrosshairMarkerBackgroundColor: '',\n\n\tlastPriceAnimation: LastPriceAnimationMode.Disabled,\n\tpointMarkersVisible: false,\n};\n\nexport const histogramStyleDefaults: HistogramStyleOptions = {\n\tcolor: '#26a69a',\n\tbase: 0,\n};\n\nexport const customStyleDefaults: CustomStyleOptions = {\n\tcolor: '#2196f3',\n};\n\nexport const seriesOptionsDefaults: SeriesOptionsCommon = {\n\ttitle: '',\n\tvisible: true,\n\tlastValueVisible: true,\n\tpriceLineVisible: true,\n\tpriceLineSource: PriceLineSource.LastBar,\n\tpriceLineWidth: 1,\n\tpriceLineColor: '',\n\tpriceLineStyle: LineStyle.Dashed,\n\tbaseLineVisible: true,\n\tbaseLineWidth: 1,\n\tbaseLineColor: '#B2B5BE',\n\tbaseLineStyle: LineStyle.Solid,\n\tpriceFormat: {\n\t\ttype: 'price',\n\t\tprecision: 2,\n\t\tminMove: 0.01,\n\t},\n};\n","import { Coordinate } from '../model/coordinate';\n\n/**\n * Represents the width of a line.\n */\nexport type LineWidth = 1 | 2 | 3 | 4;\n\n/**\n * Represents the possible line types.\n */\nexport const enum LineType {\n\t/**\n\t * A line.\n\t */\n\tSimple,\n\t/**\n\t * A stepped line.\n\t */\n\tWithSteps,\n\t/**\n\t * A curved line.\n\t */\n\tCurved,\n}\n\n/**\n * A point on a line.\n */\nexport interface LinePoint {\n\t/**\n\t * The point's x coordinate.\n\t */\n\tx: Coordinate;\n\t/**\n\t * The point's y coordinate.\n\t */\n\ty: Coordinate;\n}\n\n/**\n * Represents the possible line styles.\n */\nexport const enum LineStyle {\n\t/**\n\t * A solid line.\n\t */\n\tSolid = 0,\n\t/**\n\t * A dotted line.\n\t */\n\tDotted = 1,\n\t/**\n\t * A dashed line.\n\t */\n\tDashed = 2,\n\t/**\n\t * A dashed line with bigger dashes.\n\t */\n\tLargeDashed = 3,\n\t/**\n\t * A dotted line with more space between dots.\n\t */\n\tSparseDotted = 4,\n}\n\nexport function setLineStyle(ctx: CanvasRenderingContext2D, style: LineStyle): void {\n\tconst dashPatterns = {\n\t\t[LineStyle.Solid]: [],\n\t\t[LineStyle.Dotted]: [ctx.lineWidth, ctx.lineWidth],\n\t\t[LineStyle.Dashed]: [2 * ctx.lineWidth, 2 * ctx.lineWidth],\n\t\t[LineStyle.LargeDashed]: [6 * ctx.lineWidth, 6 * ctx.lineWidth],\n\t\t[LineStyle.SparseDotted]: [ctx.lineWidth, 4 * ctx.lineWidth],\n\t};\n\n\tconst dashPattern = dashPatterns[style];\n\tctx.setLineDash(dashPattern);\n}\n\nexport function drawHorizontalLine(ctx: CanvasRenderingContext2D, y: number, left: number, right: number): void {\n\tctx.beginPath();\n\tconst correction = (ctx.lineWidth % 2) ? 0.5 : 0;\n\tctx.moveTo(left, y + correction);\n\tctx.lineTo(right, y + correction);\n\tctx.stroke();\n}\n\nexport function drawVerticalLine(ctx: CanvasRenderingContext2D, x: number, top: number, bottom: number): void {\n\tctx.beginPath();\n\tconst correction = (ctx.lineWidth % 2) ? 0.5 : 0;\n\tctx.moveTo(x + correction, top);\n\tctx.lineTo(x + correction, bottom);\n\tctx.stroke();\n}\n\nexport function strokeInPixel(ctx: CanvasRenderingContext2D, drawFunction: () => void): void {\n\tctx.save();\n\tif (ctx.lineWidth % 2) {\n\t\tctx.translate(0.5, 0.5);\n\t}\n\tdrawFunction();\n\tctx.restore();\n}\n","/**\n * Checks an assertion. Throws if the assertion is failed.\n *\n * @param condition - Result of the assertion evaluation\n * @param message - Text to include in the exception message\n */\nexport function assert(condition: boolean, message?: string): asserts condition {\n\tif (!condition) {\n\t\tthrow new Error('Assertion failed' + (message ? ': ' + message : ''));\n\t}\n}\n\n/**\n * Ensures that value is defined.\n * Throws if the value is undefined, returns the original value otherwise.\n *\n * @param value - The value, or undefined.\n * @returns The passed value, if it is not undefined\n */\nexport function ensureDefined(value: undefined): never;\nexport function ensureDefined<T>(value: T | undefined): T;\nexport function ensureDefined<T>(value: T | undefined): T {\n\tif (value === undefined) {\n\t\tthrow new Error('Value is undefined');\n\t}\n\n\treturn value;\n}\n\n/**\n * Ensures that value is not null.\n * Throws if the value is null, returns the original value otherwise.\n *\n * @param value - The value, or null.\n * @returns The passed value, if it is not null\n */\nexport function ensureNotNull(value: null): never;\nexport function ensureNotNull<T>(value: T | null): T;\nexport function ensureNotNull<T>(value: T | null): T {\n\tif (value === null) {\n\t\tthrow new Error('Value is null');\n\t}\n\n\treturn value;\n}\n\n/**\n * Ensures that value is defined and not null.\n * Throws if the value is undefined or null, returns the original value otherwise.\n *\n * @param value - The value, or undefined, or null.\n * @returns The passed value, if it is not undefined and not null\n */\nexport function ensure(value: undefined | null): never;\nexport function ensure<T>(value: T | undefined | null): T;\nexport function ensure<T>(value: T | undefined | null): T {\n\treturn ensureNotNull(ensureDefined(value));\n}\n\n/**\n * Compile time check for never\n */\nexport function ensureNever(value: never): void {}\n","import { Nominal } from './nominal';\n\n/**\n * Red component of the RGB color value\n * The valid values are integers in range [0, 255]\n */\ntype RedComponent = Nominal<number, 'RedComponent'>;\n\n/**\n * Green component of the RGB color value\n * The valid values are integers in range [0, 255]\n */\ntype GreenComponent = Nominal<number, 'GreenComponent'>;\n\n/**\n * Blue component of the RGB color value\n * The valid values are integers in range [0, 255]\n */\ntype BlueComponent = Nominal<number, 'BlueComponent'>;\n\n/**\n * Alpha component of the RGBA color value\n * The valid values are integers in range [0, 1]\n */\ntype AlphaComponent = Nominal<number, 'AlphaComponent'>;\n\ntype Rgba = [RedComponent, GreenComponent, BlueComponent, AlphaComponent];\n\n/**\n * Note this object should be explicitly marked as public so that dts-bundle-generator does not mangle the property names.\n *\n * @public\n * @see https://developer.mozilla.org/en-US/docs/Web/CSS/color_value\n */\nconst namedColorRgbHexStrings: Record<string, string> = {\n\t// The order of properties in this Record is not important for the internal logic.\n\t// It's just GZIPped better when props follows this order.\n\t// Please add new colors to the end of the record.\n\n\tkhaki: '#f0e68c',\n\tazure: '#f0ffff',\n\taliceblue: '#f0f8ff',\n\tghostwhite: '#f8f8ff',\n\tgold: '#ffd700',\n\tgoldenrod: '#daa520',\n\tgainsboro: '#dcdcdc',\n\tgray: '#808080',\n\tgreen: '#008000',\n\thoneydew: '#f0fff0',\n\tfloralwhite: '#fffaf0',\n\tlightblue: '#add8e6',\n\tlightcoral: '#f08080',\n\tlemonchiffon: '#fffacd',\n\thotpink: '#ff69b4',\n\tlightyellow: '#ffffe0',\n\tgreenyellow: '#adff2f',\n\tlightgoldenrodyellow: '#fafad2',\n\tlimegreen: '#32cd32',\n\tlinen: '#faf0e6',\n\tlightcyan: '#e0ffff',\n\tmagenta: '#f0f',\n\tmaroon: '#800000',\n\tolive: '#808000',\n\torange: '#ffa500',\n\toldlace: '#fdf5e6',\n\tmediumblue: '#0000cd',\n\ttransparent: '#0000',\n\tlime: '#0f0',\n\tlightpink: '#ffb6c1',\n\tmistyrose: '#ffe4e1',\n\tmoccasin: '#ffe4b5',\n\tmidnightblue: '#191970',\n\torchid: '#da70d6',\n\tmediumorchid: '#ba55d3',\n\tmediumturquoise: '#48d1cc',\n\torangered: '#ff4500',\n\troyalblue: '#4169e1',\n\tpowderblue: '#b0e0e6',\n\tred: '#f00',\n\tcoral: '#ff7f50',\n\tturquoise: '#40e0d0',\n\twhite: '#fff',\n\twhitesmoke: '#f5f5f5',\n\twheat: '#f5deb3',\n\tteal: '#008080',\n\tsteelblue: '#4682b4',\n\tbisque: '#ffe4c4',\n\taquamarine: '#7fffd4',\n\taqua: '#0ff',\n\tsienna: '#a0522d',\n\tsilver: '#c0c0c0',\n\tspringgreen: '#00ff7f',\n\tantiquewhite: '#faebd7',\n\tburlywood: '#deb887',\n\tbrown: '#a52a2a',\n\tbeige: '#f5f5dc',\n\tchocolate: '#d2691e',\n\tchartreuse: '#7fff00',\n\tcornflowerblue: '#6495ed',\n\tcornsilk: '#fff8dc',\n\tcrimson: '#dc143c',\n\tcadetblue: '#5f9ea0',\n\ttomato: '#ff6347',\n\tfuchsia: '#f0f',\n\tblue: '#00f',\n\tsalmon: '#fa8072',\n\tblanchedalmond: '#ffebcd',\n\tslateblue: '#6a5acd',\n\tslategray: '#708090',\n\tthistle: '#d8bfd8',\n\ttan: '#d2b48c',\n\tcyan: '#0ff',\n\tdarkblue: '#00008b',\n\tdarkcyan: '#008b8b',\n\tdarkgoldenrod: '#b8860b',\n\tdarkgray: '#a9a9a9',\n\tblueviolet: '#8a2be2',\n\tblack: '#000',\n\tdarkmagenta: '#8b008b',\n\tdarkslateblue: '#483d8b',\n\tdarkkhaki: '#bdb76b',\n\tdarkorchid: '#9932cc',\n\tdarkorange: '#ff8c00',\n\tdarkgreen: '#006400',\n\tdarkred: '#8b0000',\n\tdodgerblue: '#1e90ff',\n\tdarkslategray: '#2f4f4f',\n\tdimgray: '#696969',\n\tdeepskyblue: '#00bfff',\n\tfirebrick: '#b22222',\n\tforestgreen: '#228b22',\n\tindigo: '#4b0082',\n\tivory: '#fffff0',\n\tlavenderblush: '#fff0f5',\n\tfeldspar: '#d19275',\n\tindianred: '#cd5c5c',\n\tlightgreen: '#90ee90',\n\tlightgrey: '#d3d3d3',\n\tlightskyblue: '#87cefa',\n\tlightslategray: '#789',\n\tlightslateblue: '#8470ff',\n\tsnow: '#fffafa',\n\tlightseagreen: '#20b2aa',\n\tlightsalmon: '#ffa07a',\n\tdarksalmon: '#e9967a',\n\tdarkviolet: '#9400d3',\n\tmediumpurple: '#9370d8',\n\tmediumaquamarine: '#66cdaa',\n\tskyblue: '#87ceeb',\n\tlavender: '#e6e6fa',\n\tlightsteelblue: '#b0c4de',\n\tmediumvioletred: '#c71585',\n\tmintcream: '#f5fffa',\n\tnavajowhite: '#ffdead',\n\tnavy: '#000080',\n\tolivedrab: '#6b8e23',\n\tpalevioletred: '#d87093',\n\tvioletred: '#d02090',\n\tyellow: '#ff0',\n\tyellowgreen: '#9acd32',\n\tlawngreen: '#7cfc00',\n\tpink: '#ffc0cb',\n\tpaleturquoise: '#afeeee',\n\tpalegoldenrod: '#eee8aa',\n\tdarkolivegreen: '#556b2f',\n\tdarkseagreen: '#8fbc8f',\n\tdarkturquoise: '#00ced1',\n\tpeachpuff: '#ffdab9',\n\tdeeppink: '#ff1493',\n\tviolet: '#ee82ee',\n\tpalegreen: '#98fb98',\n\tmediumseagreen: '#3cb371',\n\tperu: '#cd853f',\n\tsaddlebrown: '#8b4513',\n\tsandybrown: '#f4a460',\n\trosybrown: '#bc8f8f',\n\tpurple: '#800080',\n\tseagreen: '#2e8b57',\n\tseashell: '#fff5ee',\n\tpapayawhip: '#ffefd5',\n\tmediumslateblue: '#7b68ee',\n\tplum: '#dda0dd',\n\tmediumspringgreen: '#00fa9a',\n};\n\nfunction normalizeRgbComponent<T extends RedComponent | GreenComponent | BlueComponent>(component: number): T {\n\tif (component < 0) {\n\t\treturn 0 as T;\n\t}\n\tif (component > 255) {\n\t\treturn 255 as T;\n\t}\n\t// NaN values are treated as 0\n\treturn (Math.round(component) || 0) as T;\n}\n\nfunction normalizeAlphaComponent(component: AlphaComponent): AlphaComponent {\n\tif (component <= 0 || component > 1) {\n\t\treturn Math.min(Math.max(component, 0), 1) as AlphaComponent;\n\t}\n\t// limit the precision of all numbers to at most 4 digits in fractional part\n\treturn Math.round(component * 10000) / 10000 as AlphaComponent;\n}\n\n/**\n * @example\n * #fb0\n * @example\n * #f0f\n * @example\n * #f0fa\n */\nconst shortHexRe = /^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i;\n\n/**\n * @example\n * #00ff00\n * @example\n * #336699\n * @example\n * #336699FA\n */\nconst hexRe = /^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;\n\n/**\n * @example\n * rgb(123, 234, 45)\n * @example\n * rgb(255,234,245)\n */\nconst rgbRe = /^rgb\\(\\s*(-?\\d{1,10})\\s*,\\s*(-?\\d{1,10})\\s*,\\s*(-?\\d{1,10})\\s*\\)$/;\n\n/**\n * @example\n * rgba(123, 234, 45, 1)\n * @example\n * rgba(255,234,245,0.1)\n */\n\nconst rgbaRe = /^rgba\\(\\s*(-?\\d{1,10})\\s*,\\s*(-?\\d{1,10})\\s*,\\s*(-?\\d{1,10})\\s*,\\s*(-?\\d*\\.?\\d+)\\s*\\)$/;\nfunction colorStringToRgba(colorString: string): Rgba {\n\tcolorString = colorString.toLowerCase();\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tif (colorString in namedColorRgbHexStrings) {\n\t\tcolorString = namedColorRgbHexStrings[colorString];\n\t}\n\n\t{\n\t\tconst matches = rgbaRe.exec(colorString) || rgbRe.exec(colorString);\n\t\tif (matches) {\n\t\t\treturn [\n\t\t\t\tnormalizeRgbComponent<RedComponent>(parseInt(matches[1], 10)),\n\t\t\t\tnormalizeRgbComponent<GreenComponent>(parseInt(matches[2], 10)),\n\t\t\t\tnormalizeRgbComponent<BlueComponent>(parseInt(matches[3], 10)),\n\t\t\t\tnormalizeAlphaComponent((matches.length < 5 ? 1 : parseFloat(matches[4])) as AlphaComponent),\n\t\t\t];\n\t\t}\n\t}\n\n\t{\n\t\tconst matches = hexRe.exec(colorString);\n\t\tif (matches) {\n\t\t\treturn [\n\t\t\t\tnormalizeRgbComponent<RedComponent>(parseInt(matches[1], 16)),\n\t\t\t\tnormalizeRgbComponent<GreenComponent>(parseInt(matches[2], 16)),\n\t\t\t\tnormalizeRgbComponent<BlueComponent>(parseInt(matches[3], 16)),\n\t\t\t\t1 as AlphaComponent,\n\t\t\t];\n\t\t}\n\t}\n\n\t{\n\t\tconst matches = shortHexRe.exec(colorString);\n\t\tif (matches) {\n\t\t\treturn [\n\t\t\t\tnormalizeRgbComponent<RedComponent>(parseInt(matches[1], 16) * 0x11),\n\t\t\t\tnormalizeRgbComponent<GreenComponent>(parseInt(matches[2], 16) * 0x11),\n\t\t\t\tnormalizeRgbComponent<BlueComponent>(parseInt(matches[3], 16) * 0x11),\n\t\t\t\t1 as AlphaComponent,\n\t\t\t];\n\t\t}\n\t}\n\n\tthrow new Error(`Cannot parse color: ${colorString}`);\n}\n\nfunction rgbaToGrayscale(rgbValue: Rgba): number {\n\t// Originally, the NTSC RGB to YUV formula\n\t// perfected by @eugene-korobko's black magic\n\tconst redComponentGrayscaleWeight = 0.199;\n\tconst greenComponentGrayscaleWeight = 0.687;\n\tconst blueComponentGrayscaleWeight = 0.114;\n\n\treturn (\n\t\tredComponentGrayscaleWeight * rgbValue[0] +\n\t\tgreenComponentGrayscaleWeight * rgbValue[1] +\n\t\tblueComponentGrayscaleWeight * rgbValue[2]\n\t);\n}\n\nexport function applyAlpha(color: string, alpha: number): string {\n\t// special case optimization\n\tif (color === 'transparent') {\n\t\treturn color;\n\t}\n\n\tconst originRgba = colorStringToRgba(color);\n\tconst originAlpha = originRgba[3];\n\treturn `rgba(${originRgba[0]}, ${originRgba[1]}, ${originRgba[2]}, ${alpha * originAlpha})`;\n}\n\nexport interface ContrastColors {\n\tforeground: string;\n\tbackground: string;\n}\n\nexport function generateContrastColors(backgroundColor: string): ContrastColors {\n\tconst rgb = colorStringToRgba(backgroundColor);\n\n\treturn {\n\t\tbackground: `rgb(${rgb[0]}, ${rgb[1]}, ${rgb[2]})`,\n\t\tforeground: rgbaToGrayscale(rgb) > 160 ? 'black' : 'white',\n\t};\n}\n\nexport function gradientColorAtPercent(topColor: string, bottomColor: string, percent: number): string {\n\tconst [topR, topG, topB, topA] = colorStringToRgba(topColor);\n\tconst [bottomR, bottomG, bottomB, bottomA] = colorStringToRgba(bottomColor);\n\n\tconst resultRgba: Rgba = [\n\t\tnormalizeRgbComponent(topR + percent * (bottomR - topR) as RedComponent),\n\t\tnormalizeRgbComponent(topG + percent * (bottomG - topG) as GreenComponent),\n\t\tnormalizeRgbComponent(topB + percent * (bottomB - topB) as BlueComponent),\n\t\tnormalizeAlphaComponent(topA + percent * (bottomA - topA) as AlphaComponent),\n\t];\n\n\treturn `rgba(${resultRgba[0]}, ${resultRgba[1]}, ${resultRgba[2]}, ${resultRgba[3]})`;\n}\n","import { Callback, ISubscription } from './isubscription';\n\ninterface Listener<T1, T2, T3> {\n\tcallback: Callback<T1, T2, T3>;\n\tlinkedObject?: unknown;\n\tsingleshot: boolean;\n}\n\nexport class Delegate<T1 = void, T2 = void, T3 = void> implements ISubscription<T1, T2, T3> {\n\tprivate _listeners: Listener<T1, T2, T3>[] = [];\n\n\tpublic subscribe(callback: Callback<T1, T2, T3>, linkedObject?: unknown, singleshot?: boolean): void {\n\t\tconst listener: Listener<T1, T2, T3> = {\n\t\t\tcallback,\n\t\t\tlinkedObject,\n\t\t\tsingleshot: singleshot === true,\n\t\t};\n\t\tthis._listeners.push(listener);\n\t}\n\n\tpublic unsubscribe(callback: Callback<T1, T2, T3>): void {\n\t\tconst index = this._listeners.findIndex((listener: Listener<T1, T2, T3>) => callback === listener.callback);\n\t\tif (index > -1) {\n\t\t\tthis._listeners.splice(index, 1);\n\t\t}\n\t}\n\n\tpublic unsubscribeAll(linkedObject: unknown): void {\n\t\tthis._listeners = this._listeners.filter((listener: Listener<T1, T2, T3>) => listener.linkedObject !== linkedObject);\n\t}\n\n\tpublic fire(param1: T1, param2: T2, param3: T3): void {\n\t\tconst listenersSnapshot = [...this._listeners];\n\t\tthis._listeners = this._listeners.filter((listener: Listener<T1, T2, T3>) => !listener.singleshot);\n\t\tlistenersSnapshot.forEach((listener: Listener<T1, T2, T3>) => listener.callback(param1, param2, param3));\n\t}\n\n\tpublic hasListeners(): boolean {\n\t\treturn this._listeners.length > 0;\n\t}\n\n\tpublic destroy(): void {\n\t\tthis._listeners = [];\n\t}\n}\n","/**\n * Represents a type `T` where every property is optional.\n */\nexport type DeepPartial<T> = {\n\t[P in keyof T]?: T[P] extends (infer U)[]\n\t\t? DeepPartial<U>[]\n\t\t: T[P] extends readonly (infer X)[]\n\t\t\t? readonly DeepPartial<X>[]\n\t\t\t: DeepPartial<T[P]>\n};\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function merge(dst: Record<string, any>, ...sources: Record<string, any>[]): Record<string, any> {\n\tfor (const src of sources) {\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tfor (const i in src) {\n\t\t\tif (src[i] === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ('object' !== typeof src[i] || dst[i] === undefined || Array.isArray(src[i])) {\n\t\t\t\tdst[i] = src[i];\n\t\t\t} else {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n\t\t\t\tmerge(dst[i], src[i]);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn dst;\n}\n\nexport function isNumber(value: unknown): value is number {\n\treturn (typeof value === 'number') && (isFinite(value));\n}\n\nexport function isInteger(value: unknown): boolean {\n\treturn (typeof value === 'number') && ((value % 1) === 0);\n}\n\nexport function isString(value: unknown): value is string {\n\treturn typeof value === 'string';\n}\n\nexport function isBoolean(value: unknown): value is boolean {\n\treturn typeof value === 'boolean';\n}\n\nexport function clone<T>(object: T): T {\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tconst o = object as any;\n\tif (!o || 'object' !== typeof o) {\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-return\n\t\treturn o;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tlet c: any;\n\n\tif (Array.isArray(o)) {\n\t\tc = [];\n\t} else {\n\t\tc = {};\n\t}\n\n\tlet p;\n\tlet v;\n\t// eslint-disable-next-line no-restricted-syntax\n\tfor (p in o) {\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-call,no-prototype-builtins\n\t\tif (o.hasOwnProperty(p)) {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\t\t\tv = o[p];\n\t\t\tif (v && 'object' === typeof v) {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\t\t\t\tc[p] = clone(v);\n\t\t\t} else {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n\t\t\t\tc[p] = v;\n\t\t\t}\n\t\t}\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-unsafe-return\n\treturn c;\n}\n\nexport function notNull<T>(t: T | null): t is T {\n\treturn t !== null;\n}\n\nexport function undefinedIfNull<T>(t: T | null): T | undefined {\n\treturn (t === null) ? undefined : t;\n}\n","/**\n * Default font family.\n * Must be used to generate font string when font is not specified.\n */\nexport const defaultFontFamily = `-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif`;\n\n/**\n * Generates a font string, which can be used to set in canvas' font property.\n * If no family provided, {@link defaultFontFamily} will be used.\n *\n * @param size - Font size in pixels.\n * @param family - Optional font family.\n * @param style - Optional font style.\n * @returns The font string.\n */\nexport function makeFont(size: number, family?: string, style?: string): string {\n\tif (style !== undefined) {\n\t\tstyle = `${style} `;\n\t} else {\n\t\tstyle = '';\n\t}\n\n\tif (family === undefined) {\n\t\tfamily = defaultFontFamily;\n\t}\n\n\treturn `${style}${size}px ${family}`;\n}\n","import { makeFont } from '../helpers/make-font';\n\nimport { IChartModelBase } from '../model/chart-model';\n\nimport { PriceAxisViewRendererOptions } from './iprice-axis-view-renderer';\n\nconst enum RendererConstants {\n\tBorderSize = 1,\n\tTickLength = 5,\n}\n\nexport class PriceAxisRendererOptionsProvider {\n\tprivate readonly _chartModel: IChartModelBase;\n\n\tprivate readonly _rendererOptions: PriceAxisViewRendererOptions = {\n\t\tborderSize: RendererConstants.BorderSize,\n\t\ttickLength: RendererConstants.TickLength,\n\t\tfontSize: NaN,\n\t\tfont: '',\n\t\tfontFamily: '',\n\t\tcolor: '',\n\t\tpaneBackgroundColor: '',\n\t\tpaddingBottom: 0,\n\t\tpaddingInner: 0,\n\t\tpaddingOuter: 0,\n\t\tpaddingTop: 0,\n\t\tbaselineOffset: 0,\n\t};\n\n\tpublic constructor(chartModel: IChartModelBase) {\n\t\tthis._chartModel = chartModel;\n\t}\n\n\tpublic options(): Readonly<PriceAxisViewRendererOptions> {\n\t\tconst rendererOptions = this._rendererOptions;\n\n\t\tconst currentFontSize = this._fontSize();\n\t\tconst currentFontFamily = this._fontFamily();\n\n\t\tif (rendererOptions.fontSize !== currentFontSize || rendererOptions.fontFamily !== currentFontFamily) {\n\t\t\trendererOptions.fontSize = currentFontSize;\n\t\t\trendererOptions.fontFamily = currentFontFamily;\n\t\t\trendererOptions.font = makeFont(currentFontSize, currentFontFamily);\n\t\t\trendererOptions.paddingTop = 2.5 / 12 * currentFontSize; // 2.5 px for 12px font\n\t\t\trendererOptions.paddingBottom = rendererOptions.paddingTop;\n\t\t\trendererOptions.paddingInner = currentFontSize / 12 * rendererOptions.tickLength;\n\t\t\trendererOptions.paddingOuter = currentFontSize / 12 * rendererOptions.tickLength;\n\t\t\trendererOptions.baselineOffset = 0;\n\t\t}\n\n\t\trendererOptions.color = this._textColor();\n\t\trendererOptions.paneBackgroundColor = this._paneBackgroundColor();\n\n\t\treturn this._rendererOptions;\n\t}\n\n\tprivate _textColor(): string {\n\t\treturn this._chartModel.options().layout.textColor;\n\t}\n\n\tprivate _paneBackgroundColor(): string {\n\t\treturn this._chartModel.backgroundTopColor();\n\t}\n\n\tprivate _fontSize(): number {\n\t\treturn this._chartModel.options().layout.fontSize;\n\t}\n\n\tprivate _fontFamily(): string {\n\t\treturn this._chartModel.options().layout.fontFamily;\n\t}\n}\n","import { CanvasRenderingTarget2D } from 'fancy-canvas';\n\nimport { IPaneRenderer } from './ipane-renderer';\n\nexport class CompositeRenderer implements IPaneRenderer {\n\tprivate _renderers: readonly IPaneRenderer[] = [];\n\n\tpublic setRenderers(renderers: readonly IPaneRenderer[]): void {\n\t\tthis._renderers = renderers;\n\t}\n\n\tpublic draw(target: CanvasRenderingTarget2D, isHovered: boolean, hitTestData?: unknown): void {\n\t\tthis._renderers.forEach((r: IPaneRenderer) => {\n\t\t\tr.draw(target, isHovered, hitTestData);\n\t\t});\n\t}\n}\n","import { BitmapCoordinatesRenderingScope, CanvasRenderingTarget2D } from 'fancy-canvas';\n\nimport { IPaneRenderer } from './ipane-renderer';\n\nexport abstract class BitmapCoordinatesPaneRenderer implements IPaneRenderer {\n\tpublic draw(target: CanvasRenderingTarget2D, isHovered: boolean, hitTestData?: unknown): void {\n\t\ttarget.useBitmapCoordinateSpace(\n\t\t\t(scope: BitmapCoordinatesRenderingScope) => this._drawImpl(scope, isHovered, hitTestData)\n\t\t);\n\t}\n\n\t// public drawBackground(target: CanvasRenderingTarget2D, isHovered: boolean, hitTestData?: unknown): void {\n\t// \ttarget.useBitmapCoordinateSpace(\n\t// \t\t(scope: BitmapCoordinatesRenderingScope) => this._drawBackgroundImpl(scope, isHovered, hitTestData)\n\t// \t);\n\t// }\n\n\tprotected abstract _drawImpl(renderingScope: BitmapCoordinatesRenderingScope, isHovered: boolean, hitTestData?: unknown): void;\n\n\t// protected _drawBackgroundImpl(renderingScope: BitmapCoordsRenderingScope, isHovered: boolean, hitTestData?: unknown): void {}\n}\n","import { BitmapCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { SeriesItemsIndexesRange } from '../model/time-data';\n\nimport { BitmapCoordinatesPaneRenderer } from './bitmap-coordinates-pane-renderer';\nimport { LineItemBase } from './line-renderer-base';\n\nexport interface MarksRendererData {\n\titems: LineItemBase[];\n\tlineColor: string;\n\tlineWidth: number;\n\tbackColor: string;\n\tradius: number;\n\tvisibleRange: SeriesItemsIndexesRange | null;\n}\n\nexport class PaneRendererMarks extends BitmapCoordinatesPaneRenderer {\n\tprotected _data: MarksRendererData | null = null;\n\n\tpublic setData(data: MarksRendererData): void {\n\t\tthis._data = data;\n\t}\n\n\tprotected _drawImpl({ context: ctx, horizontalPixelRatio, verticalPixelRatio }: BitmapCoordinatesRenderingScope): void {\n\t\tif (this._data === null || this._data.visibleRange === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst visibleRange = this._data.visibleRange;\n\t\tconst data = this._data;\n\n\t\tconst tickWidth = Math.max(1, Math.floor(horizontalPixelRatio));\n\t\tconst correction = (tickWidth % 2) / 2;\n\n\t\tconst draw = (radiusMedia: number) => {\n\t\t\tctx.beginPath();\n\n\t\t\tfor (let i = visibleRange.to - 1; i >= visibleRange.from; --i) {\n\t\t\t\tconst point = data.items[i];\n\t\t\t\tconst centerX = Math.round(point.x * horizontalPixelRatio) + correction; // correct x coordinate only\n\t\t\t\tconst centerY = point.y * verticalPixelRatio;\n\t\t\t\tconst radius = radiusMedia * verticalPixelRatio + correction;\n\t\t\t\tctx.moveTo(centerX, centerY);\n\t\t\t\tctx.arc(centerX, centerY, radius, 0, Math.PI * 2);\n\t\t\t}\n\n\t\t\tctx.fill();\n\t\t};\n\n\t\tif (data.lineWidth > 0) {\n\t\t\tctx.fillStyle = data.backColor;\n\t\t\tdraw(data.radius + data.lineWidth);\n\t\t}\n\n\t\tctx.fillStyle = data.lineColor;\n\t\tdraw(data.radius);\n\t}\n}\n","import { ensureNotNull } from '../../helpers/assertions';\n\nimport { BarPrice } from '../../model/bar';\nimport { IChartModelBase } from '../../model/chart-model';\nimport { Coordinate } from '../../model/coordinate';\nimport { Crosshair, CrosshairMode } from '../../model/crosshair';\nimport { ISeries } from '../../model/series';\nimport { SeriesType } from '../../model/series-options';\nimport { SeriesItemsIndexesRange, TimePointIndex } from '../../model/time-data';\nimport { CompositeRenderer } from '../../renderers/composite-renderer';\nimport { IPaneRenderer } from '../../renderers/ipane-renderer';\nimport { MarksRendererData, PaneRendererMarks } from '../../renderers/marks-renderer';\n\nimport { IUpdatablePaneView, UpdateType } from './iupdatable-pane-view';\n\nfunction createEmptyMarkerData(): MarksRendererData {\n\treturn {\n\t\titems: [{\n\t\t\tx: 0 as Coordinate,\n\t\t\ty: 0 as Coordinate,\n\t\t\ttime: 0 as TimePointIndex,\n\t\t\tprice: 0 as BarPrice,\n\t\t}],\n\t\tlineColor: '',\n\t\tbackColor: '',\n\t\tradius: 0,\n\t\tlineWidth: 0,\n\t\tvisibleRange: null,\n\t};\n}\n\nconst rangeForSinglePoint: SeriesItemsIndexesRange = { from: 0, to: 1 };\n\nexport class CrosshairMarksPaneView implements IUpdatablePaneView {\n\tprivate readonly _chartModel: IChartModelBase;\n\tprivate readonly _crosshair: Crosshair;\n\tprivate readonly _compositeRenderer: CompositeRenderer = new CompositeRenderer();\n\tprivate _markersRenderers: PaneRendererMarks[] = [];\n\tprivate _markersData: MarksRendererData[] = [];\n\tprivate _invalidated: boolean = true;\n\n\tpublic constructor(chartModel: IChartModelBase, crosshair: Crosshair) {\n\t\tthis._chartModel = chartModel;\n\t\tthis._crosshair = crosshair;\n\t\tthis._compositeRenderer.setRenderers(this._markersRenderers);\n\t}\n\n\tpublic update(updateType?: UpdateType): void {\n\t\tconst serieses = this._chartModel.serieses();\n\t\tif (serieses.length !== this._markersRenderers.length) {\n\t\t\tthis._markersData = serieses.map(createEmptyMarkerData);\n\t\t\tthis._markersRenderers = this._markersData.map((data: MarksRendererData) => {\n\t\t\t\tconst res = new PaneRendererMarks();\n\t\t\t\tres.setData(data);\n\t\t\t\treturn res;\n\t\t\t});\n\t\t\tthis._compositeRenderer.setRenderers(this._markersRenderers);\n\t\t}\n\n\t\tthis._invalidated = true;\n\t}\n\n\tpublic renderer(): IPaneRenderer | null {\n\t\tif (this._invalidated) {\n\t\t\tthis._updateImpl();\n\t\t\tthis._invalidated = false;\n\t\t}\n\n\t\treturn this._compositeRenderer;\n\t}\n\n\tprivate _updateImpl(): void {\n\t\tconst forceHidden = this._crosshair.options().mode === CrosshairMode.Hidden;\n\n\t\tconst serieses = this._chartModel.serieses();\n\t\tconst timePointIndex = this._crosshair.appliedIndex();\n\t\tconst timeScale = this._chartModel.timeScale();\n\n\t\tserieses.forEach((s: ISeries<SeriesType>, index: number) => {\n\t\t\tconst data = this._markersData[index];\n\t\t\tconst seriesData = s.markerDataAtIndex(timePointIndex);\n\n\t\t\tif (forceHidden || seriesData === null || !s.visible()) {\n\t\t\t\tdata.visibleRange = null;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst firstValue = ensureNotNull(s.firstValue());\n\t\t\tdata.lineColor = seriesData.backgroundColor;\n\t\t\tdata.radius = seriesData.radius;\n\t\t\tdata.lineWidth = seriesData.borderWidth;\n\t\t\tdata.items[0].price = seriesData.price;\n\t\t\tdata.items[0].y = s.priceScale().priceToCoordinate(seriesData.price, firstValue.value);\n\t\t\tdata.backColor = seriesData.borderColor ?? this._chartModel.backgroundColorAtYPercentFromTop(data.items[0].y / s.priceScale().height());\n\t\t\tdata.items[0].time = timePointIndex;\n\t\t\tdata.items[0].x = timeScale.indexToCoordinate(timePointIndex);\n\t\t\tdata.visibleRange = rangeForSinglePoint;\n\t\t});\n\t}\n}\n","import { BitmapCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { BitmapCoordinatesPaneRenderer } from './bitmap-coordinates-pane-renderer';\nimport { drawHorizontalLine, drawVerticalLine, LineStyle, LineWidth, setLineStyle } from './draw-line';\n\nexport interface CrosshairLineStyle {\n\tlineStyle: LineStyle;\n\tlineWidth: LineWidth;\n\tcolor: string;\n\tvisible: boolean;\n}\n\nexport interface CrosshairRendererData {\n\tvertLine: CrosshairLineStyle;\n\thorzLine: CrosshairLineStyle;\n\tx: number;\n\ty: number;\n}\n\nexport class CrosshairRenderer extends BitmapCoordinatesPaneRenderer {\n\tprivate readonly _data: CrosshairRendererData | null;\n\n\tpublic constructor(data: CrosshairRendererData | null) {\n\t\tsuper();\n\t\tthis._data = data;\n\t}\n\n\tprotected override _drawImpl({ context: ctx, bitmapSize, horizontalPixelRatio, verticalPixelRatio }: BitmapCoordinatesRenderingScope): void {\n\t\tif (this._data === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst vertLinesVisible = this._data.vertLine.visible;\n\t\tconst horzLinesVisible = this._data.horzLine.visible;\n\n\t\tif (!vertLinesVisible && !horzLinesVisible) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst x = Math.round(this._data.x * horizontalPixelRatio);\n\t\tconst y = Math.round(this._data.y * verticalPixelRatio);\n\n\t\tctx.lineCap = 'butt';\n\n\t\tif (vertLinesVisible && x >= 0) {\n\t\t\tctx.lineWidth = Math.floor(this._data.vertLine.lineWidth * horizontalPixelRatio);\n\t\t\tctx.strokeStyle = this._data.vertLine.color;\n\t\t\tctx.fillStyle = this._data.vertLine.color;\n\t\t\tsetLineStyle(ctx, this._data.vertLine.lineStyle);\n\t\t\tdrawVerticalLine(ctx, x, 0, bitmapSize.height);\n\t\t}\n\n\t\tif (horzLinesVisible && y >= 0) {\n\t\t\tctx.lineWidth = Math.floor(this._data.horzLine.lineWidth * verticalPixelRatio);\n\t\t\tctx.strokeStyle = this._data.horzLine.color;\n\t\t\tctx.fillStyle = this._data.horzLine.color;\n\t\t\tsetLineStyle(ctx, this._data.horzLine.lineStyle);\n\t\t\tdrawHorizontalLine(ctx, y, 0, bitmapSize.width);\n\t\t}\n\t}\n}\n","import { ensureNotNull } from '../../helpers/assertions';\n\nimport { Crosshair, CrosshairMode } from '../../model/crosshair';\nimport { CrosshairRenderer, CrosshairRendererData } from '../../renderers/crosshair-renderer';\nimport { IPaneRenderer } from '../../renderers/ipane-renderer';\n\nimport { IPaneView } from './ipane-view';\n\nexport class CrosshairPaneView implements IPaneView {\n\tprivate _invalidated: boolean = true;\n\tprivate readonly _source: Crosshair;\n\tprivate readonly _rendererData: CrosshairRendererData = {\n\t\tvertLine: {\n\t\t\tlineWidth: 1,\n\t\t\tlineStyle: 0,\n\t\t\tcolor: '',\n\t\t\tvisible: false,\n\t\t},\n\t\thorzLine: {\n\t\t\tlineWidth: 1,\n\t\t\tlineStyle: 0,\n\t\t\tcolor: '',\n\t\t\tvisible: false,\n\t\t},\n\t\tx: 0,\n\t\ty: 0,\n\t};\n\tprivate _renderer: CrosshairRenderer = new CrosshairRenderer(this._rendererData);\n\n\tpublic constructor(source: Crosshair) {\n\t\tthis._source = source;\n\t}\n\n\tpublic update(): void {\n\t\tthis._invalidated = true;\n\t}\n\n\tpublic renderer(): IPaneRenderer {\n\t\tif (this._invalidated) {\n\t\t\tthis._updateImpl();\n\t\t\tthis._invalidated = false;\n\t\t}\n\n\t\treturn this._renderer;\n\t}\n\n\tprivate _updateImpl(): void {\n\t\tconst visible = this._source.visible();\n\t\tconst pane = ensureNotNull(this._source.pane());\n\t\tconst crosshairOptions = pane.model().options().crosshair;\n\n\t\tconst data = this._rendererData;\n\n\t\tif (crosshairOptions.mode === CrosshairMode.Hidden) {\n\t\t\tdata.horzLine.visible = false;\n\t\t\tdata.vertLine.visible = false;\n\t\t\treturn;\n\t\t}\n\n\t\tdata.horzLine.visible = visible && this._source.horzLineVisible(pane);\n\t\tdata.vertLine.visible = visible && this._source.vertLineVisible();\n\n\t\tdata.horzLine.lineWidth = crosshairOptions.horzLine.width;\n\t\tdata.horzLine.lineStyle = crosshairOptions.horzLine.style;\n\t\tdata.horzLine.color = crosshairOptions.horzLine.color;\n\n\t\tdata.vertLine.lineWidth = crosshairOptions.vertLine.width;\n\t\tdata.vertLine.lineStyle = crosshairOptions.vertLine.style;\n\t\tdata.vertLine.color = crosshairOptions.vertLine.color;\n\n\t\tdata.x = this._source.appliedX();\n\t\tdata.y = this._source.appliedY();\n\t}\n}\n","/**\n * Fills rectangle's inner border (so, all the filled area is limited by the [x, x + width]*[y, y + height] region)\n * ```\n * (x, y)\n * O***********************|*****\n * |        border         |  ^\n * |   *****************   |  |\n * |   |               |   |  |\n * | b |               | b |  h\n * | o |               | o |  e\n * | r |               | r |  i\n * | d |               | d |  g\n * | e |               | e |  h\n * | r |               | r |  t\n * |   |               |   |  |\n * |   *****************   |  |\n * |        border         |  v\n * |***********************|*****\n * |                       |\n * |<------- width ------->|\n * ```\n *\n * @param ctx - Context to draw on\n * @param x - Left side of the target rectangle\n * @param y - Top side of the target rectangle\n * @param width - Width of the target rectangle\n * @param height - Height of the target rectangle\n * @param borderWidth - Width of border to fill, must be less than width and height of the target rectangle\n */\nexport function fillRectInnerBorder(ctx: CanvasRenderingContext2D, x: number, y: number, width: number, height: number, borderWidth: number): void {\n\t// horizontal (top and bottom) edges\n\tctx.fillRect(x + borderWidth, y, width - borderWidth * 2, borderWidth);\n\tctx.fillRect(x + borderWidth, y + height - borderWidth, width - borderWidth * 2, borderWidth);\n\t// vertical (left and right) edges\n\tctx.fillRect(x, y, borderWidth, height);\n\tctx.fillRect(x + width - borderWidth, y, borderWidth, height);\n}\n\nexport function clearRect(ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number, clearColor: string): void {\n\tctx.save();\n\tctx.globalCompositeOperation = 'copy';\n\tctx.fillStyle = clearColor;\n\tctx.fillRect(x, y, w, h);\n\tctx.restore();\n}\n\nexport type LeftTopRightTopRightBottomLeftBottomRadii = [number, number, number, number];\n\nfunction changeBorderRadius(borderRadius: LeftTopRightTopRightBottomLeftBottomRadii, offset: number): typeof borderRadius {\n\treturn borderRadius.map((x: number) => x === 0 ? x : x + offset) as typeof borderRadius;\n}\n\nexport function drawRoundRect(\n\t// eslint:disable-next-line:max-params\n\tctx: CanvasRenderingContext2D,\n\tx: number,\n\ty: number,\n\tw: number,\n\th: number,\n\tradii: LeftTopRightTopRightBottomLeftBottomRadii\n): void {\n\t/**\n\t * As of May 2023, all of the major browsers now support ctx.roundRect() so we should\n\t * be able to switch to the native version soon.\n\t */\n\tctx.beginPath();\n\tif (ctx.roundRect) {\n\t\tctx.roundRect(x, y, w, h, radii);\n\t\treturn;\n\t}\n\t/*\n\t * Deprecate the rest in v5.\n\t */\n\tctx.lineTo(x + w - radii[1], y);\n\tif (radii[1] !== 0) {\n\t\tctx.arcTo(x + w, y, x + w, y + radii[1], radii[1]);\n\t}\n\n\tctx.lineTo(x + w, y + h - radii[2]);\n\tif (radii[2] !== 0) {\n\t\tctx.arcTo(x + w, y + h, x + w - radii[2], y + h, radii[2]);\n\t}\n\n\tctx.lineTo(x + radii[3], y + h);\n\tif (radii[3] !== 0) {\n\t\tctx.arcTo(x, y + h, x, y + h - radii[3], radii[3]);\n\t}\n\n\tctx.lineTo(x, y + radii[0]);\n\tif (radii[0] !== 0) {\n\t\tctx.arcTo(x, y, x + radii[0], y, radii[0]);\n\t}\n}\n\n/**\n * Draws a rounded rect with a border.\n *\n * This function assumes that the colors will be solid, without\n * any alpha. (This allows us to fix a rendering artefact.)\n *\n * @param outerBorderRadius - The radius of the border (outer edge)\n */\n// eslint-disable-next-line max-params\nexport function drawRoundRectWithBorder(\n\tctx: CanvasRenderingContext2D,\n\tleft: number,\n\ttop: number,\n\twidth: number,\n\theight: number,\n\tbackgroundColor: string,\n\tborderWidth: number = 0,\n\touterBorderRadius: LeftTopRightTopRightBottomLeftBottomRadii = [0, 0, 0, 0],\n\tborderColor: string = ''\n): void {\n\tctx.save();\n\n\tif (!borderWidth || !borderColor || borderColor === backgroundColor) {\n\t\tdrawRoundRect(ctx, left, top, width, height, outerBorderRadius);\n\t\tctx.fillStyle = backgroundColor;\n\t\tctx.fill();\n\t\tctx.restore();\n\t\treturn;\n\t}\n\n\tconst halfBorderWidth = borderWidth / 2;\n\tconst radii = changeBorderRadius(outerBorderRadius, - halfBorderWidth);\n\n\tdrawRoundRect(ctx, left + halfBorderWidth, top + halfBorderWidth, width - borderWidth, height - borderWidth, radii);\n\n\tif (backgroundColor !== 'transparent') {\n\t\tctx.fillStyle = backgroundColor;\n\t\tctx.fill();\n\t}\n\n\tif (borderColor !== 'transparent') {\n\t\tctx.lineWidth = borderWidth;\n\t\tctx.strokeStyle = borderColor;\n\t\tctx.closePath();\n\t\tctx.stroke();\n\t}\n\n\tctx.restore();\n}\n\n// eslint-disable-next-line max-params\nexport function clearRectWithGradient(ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number, topColor: string, bottomColor: string): void {\n\tctx.save();\n\n\tctx.globalCompositeOperation = 'copy';\n\tconst gradient = ctx.createLinearGradient(0, 0, 0, h);\n\tgradient.addColorStop(0, topColor);\n\tgradient.addColorStop(1, bottomColor);\n\tctx.fillStyle = gradient;\n\tctx.fillRect(x, y, w, h);\n\n\tctx.restore();\n}\n","import { BitmapCoordinatesRenderingScope, CanvasRenderingTarget2D, MediaCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { drawRoundRectWithBorder } from '../helpers/canvas-helpers';\n\nimport { TextWidthCache } from '../model/text-width-cache';\n\nimport {\n\tIPriceAxisViewRenderer,\n\tPriceAxisViewRendererCommonData,\n\tPriceAxisViewRendererData,\n\tPriceAxisViewRendererOptions,\n} from './iprice-axis-view-renderer';\n\ninterface Geometry {\n\talignRight: boolean;\n\n\t// bitmap coordinate space geometry\n\tbitmap: {\n\t\tyTop: number;\n\t\tyMid: number;\n\t\tyBottom: number;\n\t\ttotalWidth: number;\n\t\ttotalHeight: number;\n\t\tradius: number;\n\t\thorzBorder: number;\n\t\txOutside: number;\n\t\txInside: number;\n\t\txTick: number;\n\t\ttickHeight: number;\n\t\tright: number;\n\t};\n\n\t// media coordinate space geometry\n\tmedia: {\n\t\tyTop: number;\n\t\tyBottom: number;\n\t\txText: number;\n\t\ttextMidCorrection: number;\n\t};\n}\n\nexport class PriceAxisViewRenderer implements IPriceAxisViewRenderer {\n\tprivate _data!: PriceAxisViewRendererData;\n\tprivate _commonData!: PriceAxisViewRendererCommonData;\n\n\tpublic constructor(data: PriceAxisViewRendererData, commonData: PriceAxisViewRendererCommonData) {\n\t\tthis.setData(data, commonData);\n\t}\n\n\tpublic setData(data: PriceAxisViewRendererData, commonData: PriceAxisViewRendererCommonData): void {\n\t\tthis._data = data;\n\t\tthis._commonData = commonData;\n\t}\n\n\tpublic height(rendererOptions: PriceAxisViewRendererOptions, useSecondLine: boolean): number {\n\t\tif (!this._data.visible) {\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn rendererOptions.fontSize + rendererOptions.paddingTop + rendererOptions.paddingBottom;\n\t}\n\n\tpublic draw(\n\t\ttarget: CanvasRenderingTarget2D,\n\t\trendererOptions: PriceAxisViewRendererOptions,\n\t\ttextWidthCache: TextWidthCache,\n\t\talign: 'left' | 'right'\n\t): void {\n\t\tif (!this._data.visible || this._data.text.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst textColor = this._data.color;\n\t\tconst backgroundColor = this._commonData.background;\n\n\t\tconst geometry = target.useBitmapCoordinateSpace((scope: BitmapCoordinatesRenderingScope) => {\n\t\t\tconst ctx = scope.context;\n\t\t\tctx.font = rendererOptions.font;\n\t\t\tconst geom = this._calculateGeometry(scope, rendererOptions, textWidthCache, align);\n\t\t\tconst gb = geom.bitmap;\n\n\t\t\tconst drawLabelBody = (labelBackgroundColor: string, labelBorderColor?: string): void => {\n\t\t\t\t/*\n\t\t\t\t labelBackgroundColor (and labelBorderColor) will always be a solid color (no alpha) [see generateContrastColors in color.ts].\n\t\t\t\t Therefore we can draw the rounded label using simplified code (drawRoundRectWithBorder) that doesn't need to ensure the background and the border don't overlap.\n\t\t\t\t*/\n\t\t\t\tif (geom.alignRight) {\n\t\t\t\t\tdrawRoundRectWithBorder(\n\t\t\t\t\t\tctx,\n\t\t\t\t\t\tgb.xOutside,\n\t\t\t\t\t\tgb.yTop,\n\t\t\t\t\t\tgb.totalWidth,\n\t\t\t\t\t\tgb.totalHeight,\n\t\t\t\t\t\tlabelBackgroundColor,\n\t\t\t\t\t\tgb.horzBorder,\n\t\t\t\t\t\t[gb.radius, 0, 0, gb.radius],\n\t\t\t\t\t\tlabelBorderColor\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tdrawRoundRectWithBorder(\n\t\t\t\t\t\tctx,\n\t\t\t\t\t\tgb.xInside,\n\t\t\t\t\t\tgb.yTop,\n\t\t\t\t\t\tgb.totalWidth,\n\t\t\t\t\t\tgb.totalHeight,\n\t\t\t\t\t\tlabelBackgroundColor,\n\t\t\t\t\t\tgb.horzBorder,\n\t\t\t\t\t\t[0, gb.radius, gb.radius, 0],\n\t\t\t\t\t\tlabelBorderColor\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// draw border\n\t\t\t// draw label background\n\t\t\tdrawLabelBody(backgroundColor, 'transparent');\n\t\t\t// draw tick\n\t\t\tif (this._data.tickVisible) {\n\t\t\t\tctx.fillStyle = textColor;\n\t\t\t\tctx.fillRect(gb.xInside, gb.yMid, gb.xTick - gb.xInside, gb.tickHeight);\n\t\t\t}\n\t\t\t// draw label border above the tick\n\t\t\tdrawLabelBody('transparent', backgroundColor);\n\n\t\t\t// draw separator\n\t\t\tif (this._data.borderVisible) {\n\t\t\t\tctx.fillStyle = rendererOptions.paneBackgroundColor;\n\t\t\t\tctx.fillRect(\n\t\t\t\t\tgeom.alignRight ? gb.right - gb.horzBorder : 0,\n\t\t\t\t\tgb.yTop,\n\t\t\t\t\tgb.horzBorder,\n\t\t\t\t\tgb.yBottom - gb.yTop\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn geom;\n\t\t});\n\n\t\ttarget.useMediaCoordinateSpace(({ context: ctx }: MediaCoordinatesRenderingScope) => {\n\t\t\tconst gm = geometry.media;\n\t\t\tctx.font = rendererOptions.font;\n\t\t\tctx.textAlign = geometry.alignRight ? 'right' : 'left';\n\t\t\tctx.textBaseline = 'middle';\n\t\t\tctx.fillStyle = textColor;\n\t\t\tctx.fillText(this._data.text, gm.xText, (gm.yTop + gm.yBottom) / 2 + gm.textMidCorrection);\n\t\t});\n\t}\n\n\tprivate _calculateGeometry(\n\t\tscope: BitmapCoordinatesRenderingScope,\n\t\trendererOptions: PriceAxisViewRendererOptions,\n\t\ttextWidthCache: TextWidthCache,\n\t\talign: 'left' | 'right'\n\t): Geometry {\n\t\tconst { context: ctx, bitmapSize, mediaSize, horizontalPixelRatio, verticalPixelRatio } = scope;\n\t\tconst tickSize = (this._data.tickVisible || !this._data.moveTextToInvisibleTick) ? rendererOptions.tickLength : 0;\n\t\tconst horzBorder = this._data.separatorVisible ? rendererOptions.borderSize : 0;\n\t\tconst paddingTop = rendererOptions.paddingTop + this._commonData.additionalPaddingTop;\n\t\tconst paddingBottom = rendererOptions.paddingBottom + this._commonData.additionalPaddingBottom;\n\t\tconst paddingInner = rendererOptions.paddingInner;\n\t\tconst paddingOuter = rendererOptions.paddingOuter;\n\t\tconst text = this._data.text;\n\t\tconst actualTextHeight = rendererOptions.fontSize;\n\t\tconst textMidCorrection = textWidthCache.yMidCorrection(ctx, text);\n\n\t\tconst textWidth = Math.ceil(textWidthCache.measureText(ctx, text));\n\n\t\tconst totalHeight = actualTextHeight + paddingTop + paddingBottom;\n\n\t\tconst totalWidth = rendererOptions.borderSize + paddingInner + paddingOuter + textWidth + tickSize;\n\n\t\tconst tickHeightBitmap = Math.max(1, Math.floor(verticalPixelRatio));\n\t\tlet totalHeightBitmap = Math.round(totalHeight * verticalPixelRatio);\n\t\tif (totalHeightBitmap % 2 !== tickHeightBitmap % 2) {\n\t\t\ttotalHeightBitmap += 1;\n\t\t}\n\t\tconst horzBorderBitmap = horzBorder > 0 ? Math.max(1, Math.floor(horzBorder * horizontalPixelRatio)) : 0;\n\t\tconst totalWidthBitmap = Math.round(totalWidth * horizontalPixelRatio);\n\t\t// tick overlaps scale border\n\t\tconst tickSizeBitmap = Math.round(tickSize * horizontalPixelRatio);\n\n\t\tconst yMid = this._commonData.fixedCoordinate ?? this._commonData.coordinate;\n\t\tconst yMidBitmap = Math.round(yMid * verticalPixelRatio) - Math.floor(verticalPixelRatio * 0.5);\n\t\tconst yTopBitmap = Math.floor(yMidBitmap + tickHeightBitmap / 2 - totalHeightBitmap / 2);\n\t\tconst yBottomBitmap = yTopBitmap + totalHeightBitmap;\n\n\t\tconst alignRight = align === 'right';\n\n\t\tconst xInside = alignRight ? mediaSize.width - horzBorder : horzBorder;\n\t\tconst xInsideBitmap = alignRight ? bitmapSize.width - horzBorderBitmap : horzBorderBitmap;\n\n\t\tlet xOutsideBitmap: number;\n\t\tlet xTickBitmap: number;\n\t\tlet xText: number;\n\n\t\tif (alignRight) {\n\t\t\t// 2               1\n\t\t\t//\n\t\t\t//              6  5\n\t\t\t//\n\t\t\t// 3               4\n\t\t\txOutsideBitmap = xInsideBitmap - totalWidthBitmap;\n\t\t\txTickBitmap = xInsideBitmap - tickSizeBitmap;\n\t\t\txText = xInside - tickSize - paddingInner - horzBorder;\n\t\t} else {\n\t\t\t// 1               2\n\t\t\t//\n\t\t\t// 6  5\n\t\t\t//\n\t\t\t// 4               3\n\t\t\txOutsideBitmap = xInsideBitmap + totalWidthBitmap;\n\t\t\txTickBitmap = xInsideBitmap + tickSizeBitmap;\n\t\t\txText = xInside + tickSize + paddingInner;\n\t\t}\n\n\t\treturn {\n\t\t\talignRight,\n\t\t\tbitmap: {\n\t\t\t\tyTop: yTopBitmap,\n\t\t\t\tyMid: yMidBitmap,\n\t\t\t\tyBottom: yBottomBitmap,\n\t\t\t\ttotalWidth: totalWidthBitmap,\n\t\t\t\ttotalHeight: totalHeightBitmap,\n\t\t\t\t// TODO: it is better to have different horizontal and vertical radii\n\t\t\t\tradius: 2 * horizontalPixelRatio,\n\t\t\t\thorzBorder: horzBorderBitmap,\n\t\t\t\txOutside: xOutsideBitmap,\n\t\t\t\txInside: xInsideBitmap,\n\t\t\t\txTick: xTickBitmap,\n\t\t\t\ttickHeight: tickHeightBitmap,\n\t\t\t\tright: bitmapSize.width,\n\t\t\t},\n\t\t\tmedia: {\n\t\t\t\tyTop: yTopBitmap / verticalPixelRatio,\n\t\t\t\tyBottom: yBottomBitmap / verticalPixelRatio,\n\t\t\t\txText,\n\t\t\t\ttextMidCorrection,\n\t\t\t},\n\t\t};\n\t}\n}\n","import { PriceScale } from '../../model/price-scale';\nimport {\n\tIPriceAxisViewRenderer,\n\tIPriceAxisViewRendererConstructor,\n\tPriceAxisViewRendererCommonData,\n\tPriceAxisViewRendererData,\n\tPriceAxisViewRendererOptions,\n} from '../../renderers/iprice-axis-view-renderer';\nimport { PriceAxisViewRenderer } from '../../renderers/price-axis-view-renderer';\n\nimport { IPriceAxisView } from './iprice-axis-view';\n\nexport abstract class PriceAxisView implements IPriceAxisView {\n\tprivate readonly _commonRendererData: PriceAxisViewRendererCommonData = {\n\t\tcoordinate: 0,\n\t\tbackground: '#000',\n\t\tadditionalPaddingBottom: 0,\n\t\tadditionalPaddingTop: 0,\n\t};\n\n\tprivate readonly _axisRendererData: PriceAxisViewRendererData = {\n\t\ttext: '',\n\t\tvisible: false,\n\t\ttickVisible: true,\n\t\tmoveTextToInvisibleTick: false,\n\t\tborderColor: '',\n\t\tcolor: '#FFF',\n\t\tborderVisible: false,\n\t\tseparatorVisible: false,\n\t};\n\n\tprivate readonly _paneRendererData: PriceAxisViewRendererData = {\n\t\ttext: '',\n\t\tvisible: false,\n\t\ttickVisible: false,\n\t\tmoveTextToInvisibleTick: true,\n\t\tborderColor: '',\n\t\tcolor: '#FFF',\n\t\tborderVisible: true,\n\t\tseparatorVisible: true,\n\t};\n\n\tprivate readonly _axisRenderer: IPriceAxisViewRenderer;\n\tprivate readonly _paneRenderer: IPriceAxisViewRenderer;\n\tprivate _invalidated: boolean = true;\n\n\tpublic constructor(ctor?: IPriceAxisViewRendererConstructor) {\n\t\tthis._axisRenderer = new (ctor || PriceAxisViewRenderer)(this._axisRendererData, this._commonRendererData);\n\t\tthis._paneRenderer = new (ctor || PriceAxisViewRenderer)(this._paneRendererData, this._commonRendererData);\n\t}\n\n\tpublic text(): string {\n\t\tthis._updateRendererDataIfNeeded();\n\t\treturn this._axisRendererData.text;\n\t}\n\n\tpublic coordinate(): number {\n\t\tthis._updateRendererDataIfNeeded();\n\t\treturn this._commonRendererData.coordinate;\n\t}\n\n\tpublic update(): void {\n\t\tthis._invalidated = true;\n\t}\n\n\tpublic height(rendererOptions: PriceAxisViewRendererOptions, useSecondLine: boolean = false): number {\n\t\treturn Math.max(\n\t\t\tthis._axisRenderer.height(rendererOptions, useSecondLine),\n\t\t\tthis._paneRenderer.height(rendererOptions, useSecondLine)\n\t\t);\n\t}\n\n\tpublic getFixedCoordinate(): number {\n\t\treturn this._commonRendererData.fixedCoordinate || 0;\n\t}\n\n\tpublic setFixedCoordinate(value: number): void {\n\t\tthis._commonRendererData.fixedCoordinate = value;\n\t}\n\n\tpublic isVisible(): boolean {\n\t\tthis._updateRendererDataIfNeeded();\n\t\treturn this._axisRendererData.visible || this._paneRendererData.visible;\n\t}\n\n\tpublic isAxisLabelVisible(): boolean {\n\t\tthis._updateRendererDataIfNeeded();\n\t\treturn this._axisRendererData.visible;\n\t}\n\n\tpublic renderer(priceScale: PriceScale): IPriceAxisViewRenderer {\n\t\tthis._updateRendererDataIfNeeded();\n\n\t\t// force update tickVisible state from price scale options\n\t\t// because we don't have and we can't have price axis in other methods\n\t\t// (like paneRenderer or any other who call _updateRendererDataIfNeeded)\n\t\tthis._axisRendererData.tickVisible = this._axisRendererData.tickVisible && priceScale.options().ticksVisible;\n\t\tthis._paneRendererData.tickVisible = this._paneRendererData.tickVisible && priceScale.options().ticksVisible;\n\n\t\tthis._axisRenderer.setData(this._axisRendererData, this._commonRendererData);\n\t\tthis._paneRenderer.setData(this._paneRendererData, this._commonRendererData);\n\n\t\treturn this._axisRenderer;\n\t}\n\n\tpublic paneRenderer(): IPriceAxisViewRenderer {\n\t\tthis._updateRendererDataIfNeeded();\n\t\tthis._axisRenderer.setData(this._axisRendererData, this._commonRendererData);\n\t\tthis._paneRenderer.setData(this._paneRendererData, this._commonRendererData);\n\n\t\treturn this._paneRenderer;\n\t}\n\n\tprotected abstract _updateRendererData(\n\t\taxisRendererData: PriceAxisViewRendererData,\n\t\tpaneRendererData: PriceAxisViewRendererData,\n\t\tcommonData: PriceAxisViewRendererCommonData\n\t): void;\n\n\tprivate _updateRendererDataIfNeeded(): void {\n\t\tif (this._invalidated) {\n\t\t\tthis._axisRendererData.tickVisible = true;\n\t\t\tthis._paneRendererData.tickVisible = false;\n\t\t\tthis._updateRendererData(this._axisRendererData, this._paneRendererData, this._commonRendererData);\n\t\t}\n\t}\n}\n","import { generateContrastColors } from '../../helpers/color';\n\nimport { Crosshair, CrosshairMode, CrosshairPriceAndCoordinate } from '../../model/crosshair';\nimport { PriceScale } from '../../model/price-scale';\nimport { PriceAxisViewRendererCommonData, PriceAxisViewRendererData } from '../../renderers/iprice-axis-view-renderer';\n\nimport { PriceAxisView } from './price-axis-view';\n\nexport type CrosshairPriceAxisViewValueProvider = (priceScale: PriceScale) => CrosshairPriceAndCoordinate;\n\nexport class CrosshairPriceAxisView extends PriceAxisView {\n\tprivate _source: Crosshair;\n\tprivate readonly _priceScale: PriceScale;\n\tprivate readonly _valueProvider: CrosshairPriceAxisViewValueProvider;\n\n\tpublic constructor(source: Crosshair, priceScale: PriceScale, valueProvider: CrosshairPriceAxisViewValueProvider) {\n\t\tsuper();\n\t\tthis._source = source;\n\t\tthis._priceScale = priceScale;\n\t\tthis._valueProvider = valueProvider;\n\t}\n\n\tprotected _updateRendererData(\n\t\taxisRendererData: PriceAxisViewRendererData,\n\t\tpaneRendererData: PriceAxisViewRendererData,\n\t\tcommonRendererData: PriceAxisViewRendererCommonData\n\t): void {\n\t\taxisRendererData.visible = false;\n\t\tif (this._source.options().mode === CrosshairMode.Hidden) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst options = this._source.options().horzLine;\n\t\tif (!options.labelVisible) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst firstValue = this._priceScale.firstValue();\n\t\tif (!this._source.visible() || this._priceScale.isEmpty() || (firstValue === null)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst colors = generateContrastColors(options.labelBackgroundColor);\n\t\tcommonRendererData.background = colors.background;\n\t\taxisRendererData.color = colors.foreground;\n\n\t\tconst additionalPadding = 2 / 12 * this._priceScale.fontSize();\n\n\t\tcommonRendererData.additionalPaddingTop = additionalPadding;\n\t\tcommonRendererData.additionalPaddingBottom = additionalPadding;\n\n\t\tconst value = this._valueProvider(this._priceScale);\n\t\tcommonRendererData.coordinate = value.coordinate;\n\t\taxisRendererData.text = this._priceScale.formatPrice(value.price, firstValue);\n\t\taxisRendererData.visible = true;\n\t}\n}\n","import { BitmapCoordinatesRenderingScope, CanvasRenderingTarget2D, MediaCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { ensureNotNull } from '../helpers/assertions';\n\nimport { ITimeAxisViewRenderer, TimeAxisViewRendererOptions } from './itime-axis-view-renderer';\n\nexport interface TimeAxisViewRendererData {\n\twidth: number;\n\ttext: string;\n\tcoordinate: number;\n\tcolor: string;\n\tbackground: string;\n\tvisible: boolean;\n\ttickVisible: boolean;\n}\n\nconst optimizationReplacementRe = /[1-9]/g;\n\nconst radius = 2;\n\nexport class TimeAxisViewRenderer implements ITimeAxisViewRenderer {\n\tprivate _data: TimeAxisViewRendererData | null;\n\n\tpublic constructor() {\n\t\tthis._data = null;\n\t}\n\n\tpublic setData(data: TimeAxisViewRendererData): void {\n\t\tthis._data = data;\n\t}\n\n\tpublic draw(target: CanvasRenderingTarget2D, rendererOptions: TimeAxisViewRendererOptions): void {\n\t\tif (this._data === null || this._data.visible === false || this._data.text.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst textWidth = target.useMediaCoordinateSpace(({ context: ctx }: MediaCoordinatesRenderingScope) => {\n\t\t\tctx.font = rendererOptions.font;\n\t\t\treturn Math.round(rendererOptions.widthCache.measureText(ctx, ensureNotNull(this._data).text, optimizationReplacementRe));\n\t\t});\n\t\tif (textWidth <= 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst horzMargin = rendererOptions.paddingHorizontal;\n\t\tconst labelWidth = textWidth + 2 * horzMargin;\n\t\tconst labelWidthHalf = labelWidth / 2;\n\t\tconst timeScaleWidth = this._data.width;\n\t\tlet coordinate = this._data.coordinate;\n\t\tlet x1 = Math.floor(coordinate - labelWidthHalf) + 0.5;\n\n\t\tif (x1 < 0) {\n\t\t\tcoordinate = coordinate + Math.abs(0 - x1);\n\t\t\tx1 = Math.floor(coordinate - labelWidthHalf) + 0.5;\n\t\t} else if (x1 + labelWidth > timeScaleWidth) {\n\t\t\tcoordinate = coordinate - Math.abs(timeScaleWidth - (x1 + labelWidth));\n\t\t\tx1 = Math.floor(coordinate - labelWidthHalf) + 0.5;\n\t\t}\n\n\t\tconst x2 = x1 + labelWidth;\n\n\t\tconst y1 = 0;\n\t\tconst y2 = Math.ceil(\n\t\t\ty1 +\n\t\t\trendererOptions.borderSize +\n\t\t\trendererOptions.tickLength +\n\t\t\trendererOptions.paddingTop +\n\t\t\trendererOptions.fontSize +\n\t\t\trendererOptions.paddingBottom\n\t\t);\n\n\t\ttarget.useBitmapCoordinateSpace(({ context: ctx, horizontalPixelRatio, verticalPixelRatio }: BitmapCoordinatesRenderingScope) => {\n\t\t\tconst data = ensureNotNull(this._data);\n\n\t\t\tctx.fillStyle = data.background;\n\n\t\t\tconst x1scaled = Math.round(x1 * horizontalPixelRatio);\n\t\t\tconst y1scaled = Math.round(y1 * verticalPixelRatio);\n\t\t\tconst x2scaled = Math.round(x2 * horizontalPixelRatio);\n\t\t\tconst y2scaled = Math.round(y2 * verticalPixelRatio);\n\t\t\tconst radiusScaled = Math.round(radius * horizontalPixelRatio);\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(x1scaled, y1scaled);\n\t\t\tctx.lineTo(x1scaled, y2scaled - radiusScaled);\n\t\t\tctx.arcTo(x1scaled, y2scaled, x1scaled + radiusScaled, y2scaled, radiusScaled);\n\t\t\tctx.lineTo(x2scaled - radiusScaled, y2scaled);\n\t\t\tctx.arcTo(x2scaled, y2scaled, x2scaled, y2scaled - radiusScaled, radiusScaled);\n\t\t\tctx.lineTo(x2scaled, y1scaled);\n\t\t\tctx.fill();\n\n\t\t\tif (data.tickVisible) {\n\t\t\t\tconst tickX = Math.round(data.coordinate * horizontalPixelRatio);\n\t\t\t\tconst tickTop = y1scaled;\n\t\t\t\tconst tickBottom = Math.round((tickTop + rendererOptions.tickLength) * verticalPixelRatio);\n\n\t\t\t\tctx.fillStyle = data.color;\n\t\t\t\tconst tickWidth = Math.max(1, Math.floor(horizontalPixelRatio));\n\t\t\t\tconst tickOffset = Math.floor(horizontalPixelRatio * 0.5);\n\t\t\t\tctx.fillRect(tickX - tickOffset, tickTop, tickWidth, tickBottom - tickTop);\n\t\t\t}\n\t\t});\n\n\t\ttarget.useMediaCoordinateSpace(({ context: ctx }: MediaCoordinatesRenderingScope) => {\n\t\t\tconst data = ensureNotNull(this._data);\n\n\t\t\tconst yText =\n\t\t\t\ty1 +\n\t\t\t\trendererOptions.borderSize +\n\t\t\t\trendererOptions.tickLength +\n\t\t\t\trendererOptions.paddingTop +\n\t\t\t\trendererOptions.fontSize / 2;\n\n\t\t\tctx.font = rendererOptions.font;\n\t\t\tctx.textAlign = 'left';\n\t\t\tctx.textBaseline = 'middle';\n\t\t\tctx.fillStyle = data.color;\n\n\t\t\tconst textYCorrection = rendererOptions.widthCache.yMidCorrection(ctx, 'Apr0');\n\n\t\t\tctx.translate(x1 + horzMargin, yText + textYCorrection);\n\t\t\tctx.fillText(data.text, 0, 0);\n\t\t});\n\t}\n}\n","import { ensureNotNull } from '../../helpers/assertions';\nimport { generateContrastColors } from '../../helpers/color';\n\nimport { IChartModelBase } from '../../model/chart-model';\nimport { Crosshair, CrosshairMode, TimeAndCoordinateProvider } from '../../model/crosshair';\nimport { TimeAxisViewRenderer, TimeAxisViewRendererData } from '../../renderers/time-axis-view-renderer';\n\nimport { ITimeAxisView } from './itime-axis-view';\n\nexport class CrosshairTimeAxisView implements ITimeAxisView {\n\tprivate _invalidated: boolean = true;\n\tprivate readonly _crosshair: Crosshair;\n\tprivate readonly _model: IChartModelBase;\n\tprivate readonly _valueProvider: TimeAndCoordinateProvider;\n\tprivate readonly _renderer: TimeAxisViewRenderer = new TimeAxisViewRenderer();\n\tprivate readonly _rendererData: TimeAxisViewRendererData = {\n\t\tvisible: false,\n\t\tbackground: '#4c525e',\n\t\tcolor: 'white',\n\t\ttext: '',\n\t\twidth: 0,\n\t\tcoordinate: NaN,\n\t\ttickVisible: true,\n\t};\n\n\tpublic constructor(crosshair: Crosshair, model: IChartModelBase, valueProvider: TimeAndCoordinateProvider) {\n\t\tthis._crosshair = crosshair;\n\t\tthis._model = model;\n\t\tthis._valueProvider = valueProvider;\n\t}\n\n\tpublic update(): void {\n\t\tthis._invalidated = true;\n\t}\n\n\tpublic renderer(): TimeAxisViewRenderer {\n\t\tif (this._invalidated) {\n\t\t\tthis._updateImpl();\n\t\t\tthis._invalidated = false;\n\t\t}\n\n\t\tthis._renderer.setData(this._rendererData);\n\n\t\treturn this._renderer;\n\t}\n\n\tprivate _updateImpl(): void {\n\t\tconst data = this._rendererData;\n\t\tdata.visible = false;\n\n\t\tif (this._crosshair.options().mode === CrosshairMode.Hidden) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst options = this._crosshair.options().vertLine;\n\n\t\tif (!options.labelVisible) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeScale = this._model.timeScale();\n\t\tif (timeScale.isEmpty()) {\n\t\t\treturn;\n\t\t}\n\n\t\tdata.width = timeScale.width();\n\n\t\tconst value = this._valueProvider();\n\t\tif (value === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tdata.coordinate = value.coordinate;\n\t\tconst currentTime = timeScale.indexToTimeScalePoint(this._crosshair.appliedIndex());\n\t\tdata.text = timeScale.formatDateTime(ensureNotNull(currentTime));\n\t\tdata.visible = true;\n\n\t\tconst colors = generateContrastColors(options.labelBackgroundColor);\n\t\tdata.background = colors.background;\n\t\tdata.color = colors.foreground;\n\t\tdata.tickVisible = timeScale.options().ticksVisible;\n\t}\n}\n","import { IPaneView } from '../views/pane/ipane-view';\nimport { IPriceAxisView } from '../views/price-axis/iprice-axis-view';\nimport { ITimeAxisView } from '../views/time-axis/itime-axis-view';\n\nimport { IDataSource } from './idata-source';\nimport { Pane } from './pane';\nimport { PriceScale } from './price-scale';\n\nexport abstract class DataSource implements IDataSource {\n\tprotected _priceScale: PriceScale | null = null;\n\n\tprivate _zorder: number = 0;\n\n\tpublic zorder(): number {\n\t\treturn this._zorder;\n\t}\n\n\tpublic setZorder(zorder: number): void {\n\t\tthis._zorder = zorder;\n\t}\n\n\tpublic priceScale(): PriceScale | null {\n\t\treturn this._priceScale;\n\t}\n\n\tpublic setPriceScale(priceScale: PriceScale | null): void {\n\t\tthis._priceScale = priceScale;\n\t}\n\n\tpublic abstract priceAxisViews(pane?: Pane, priceScale?: PriceScale): readonly IPriceAxisView[];\n\tpublic abstract paneViews(pane?: Pane): readonly IPaneView[];\n\n\tpublic labelPaneViews(pane?: Pane): readonly IPaneView[] {\n\t\treturn [];\n\t}\n\n\tpublic timeAxisViews(): readonly ITimeAxisView[] {\n\t\treturn [];\n\t}\n\n\tpublic visible(): boolean {\n\t\treturn true;\n\t}\n\n\tpublic abstract updateAllViews(): void;\n}\n","import { ensureNotNull } from '../helpers/assertions';\nimport { notNull } from '../helpers/strict-type-checks';\n\nimport { LineStyle, LineWidth } from '../renderers/draw-line';\nimport { CrosshairMarksPaneView } from '../views/pane/crosshair-marks-pane-view';\nimport { CrosshairPaneView } from '../views/pane/crosshair-pane-view';\nimport { IPaneView } from '../views/pane/ipane-view';\nimport { CrosshairPriceAxisView } from '../views/price-axis/crosshair-price-axis-view';\nimport { IPriceAxisView } from '../views/price-axis/iprice-axis-view';\nimport { PriceAxisView } from '../views/price-axis/price-axis-view';\nimport { CrosshairTimeAxisView } from '../views/time-axis/crosshair-time-axis-view';\nimport { ITimeAxisView } from '../views/time-axis/itime-axis-view';\n\nimport { BarPrice } from './bar';\nimport { IChartModelBase } from './chart-model';\nimport { Coordinate } from './coordinate';\nimport { DataSource } from './data-source';\nimport { InternalHorzScaleItem } from './ihorz-scale-behavior';\nimport { Pane } from './pane';\nimport { PriceScale } from './price-scale';\nimport { ISeries } from './series';\nimport { SeriesType } from './series-options';\nimport { TimePointIndex } from './time-data';\n\nexport interface CrosshairPriceAndCoordinate {\n\tprice: number;\n\tcoordinate: number;\n}\n\nexport interface CrosshairTimeAndCoordinate {\n\ttime: InternalHorzScaleItem;\n\tcoordinate: number;\n}\n\nexport type PriceAndCoordinateProvider = (priceScale: PriceScale) => CrosshairPriceAndCoordinate;\nexport type TimeAndCoordinateProvider = () => CrosshairTimeAndCoordinate | null;\n\n/**\n * Represents the crosshair mode.\n */\nexport const enum CrosshairMode {\n\t/**\n\t * This mode allows crosshair to move freely on the chart.\n\t */\n\tNormal,\n\t/**\n\t * This mode sticks crosshair's horizontal line to the price value of a single-value series or to the close price of OHLC-based series.\n\t */\n\tMagnet,\n\t/**\n\t * This mode disables rendering of the crosshair.\n\t */\n\tHidden,\n}\n\n/** Structure describing a crosshair line (vertical or horizontal) */\nexport interface CrosshairLineOptions {\n\t/**\n\t * Crosshair line color.\n\t *\n\t * @defaultValue `'#758696'`\n\t */\n\tcolor: string;\n\n\t/**\n\t * Crosshair line width.\n\t *\n\t * @defaultValue `1`\n\t */\n\twidth: LineWidth;\n\n\t/**\n\t * Crosshair line style.\n\t *\n\t * @defaultValue {@link LineStyle.LargeDashed}\n\t */\n\tstyle: LineStyle;\n\n\t/**\n\t * Display the crosshair line.\n\t *\n\t * Note that disabling crosshair lines does not disable crosshair marker on Line and Area series.\n\t * It can be disabled by using `crosshairMarkerVisible` option of a relevant series.\n\t *\n\t * @see {@link LineStyleOptions.crosshairMarkerVisible}\n\t * @see {@link AreaStyleOptions.crosshairMarkerVisible}\n\t * @see {@link BaselineStyleOptions.crosshairMarkerVisible}\n\t * @defaultValue `true`\n\t */\n\tvisible: boolean;\n\n\t/**\n\t * Display the crosshair label on the relevant scale.\n\t *\n\t * @defaultValue `true`\n\t */\n\tlabelVisible: boolean;\n\n\t/**\n\t * Crosshair label background color.\n\t *\n\t * @defaultValue `'#4c525e'`\n\t */\n\tlabelBackgroundColor: string;\n}\n\n/** Structure describing crosshair options  */\nexport interface CrosshairOptions {\n\t/**\n\t * Crosshair mode\n\t *\n\t * @defaultValue {@link CrosshairMode.Magnet}\n\t */\n\tmode: CrosshairMode;\n\n\t/**\n\t * Vertical line options.\n\t */\n\tvertLine: CrosshairLineOptions;\n\n\t/**\n\t * Horizontal line options.\n\t */\n\thorzLine: CrosshairLineOptions;\n}\n\ntype RawPriceProvider = () => BarPrice;\ntype RawCoordinateProvider = () => Coordinate;\ntype RawIndexProvider = () => TimePointIndex;\n\nexport class Crosshair extends DataSource {\n\tprivate _pane: Pane | null = null;\n\tprivate _price: number = NaN;\n\tprivate _index: TimePointIndex = 0 as TimePointIndex;\n\tprivate _visible: boolean = true;\n\tprivate readonly _model: IChartModelBase;\n\tprivate _priceAxisViews: Map<PriceScale, CrosshairPriceAxisView> = new Map();\n\tprivate readonly _timeAxisView: CrosshairTimeAxisView;\n\tprivate readonly _markersPaneView: CrosshairMarksPaneView;\n\tprivate _subscribed: boolean = false;\n\tprivate readonly _currentPosPriceProvider: PriceAndCoordinateProvider;\n\tprivate readonly _options: CrosshairOptions;\n\tprivate readonly _paneView: CrosshairPaneView;\n\n\tprivate _x: Coordinate = NaN as Coordinate;\n\tprivate _y: Coordinate = NaN as Coordinate;\n\n\tprivate _originX: Coordinate = NaN as Coordinate;\n\tprivate _originY: Coordinate = NaN as Coordinate;\n\n\tpublic constructor(model: IChartModelBase, options: CrosshairOptions) {\n\t\tsuper();\n\t\tthis._model = model;\n\t\tthis._options = options;\n\t\tthis._markersPaneView = new CrosshairMarksPaneView(model, this);\n\n\t\tconst valuePriceProvider = (rawPriceProvider: RawPriceProvider, rawCoordinateProvider: RawCoordinateProvider) => {\n\t\t\treturn (priceScale: PriceScale) => {\n\t\t\t\tconst coordinate = rawCoordinateProvider();\n\t\t\t\tconst rawPrice = rawPriceProvider();\n\t\t\t\tif (priceScale === ensureNotNull(this._pane).defaultPriceScale()) {\n\t\t\t\t\t// price must be defined\n\t\t\t\t\treturn { price: rawPrice, coordinate: coordinate };\n\t\t\t\t} else {\n\t\t\t\t\t// always convert from coordinate\n\t\t\t\t\tconst firstValue = ensureNotNull(priceScale.firstValue());\n\t\t\t\t\tconst price = priceScale.coordinateToPrice(coordinate, firstValue);\n\t\t\t\t\treturn { price: price, coordinate: coordinate };\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\n\t\tconst valueTimeProvider = (rawIndexProvider: RawIndexProvider, rawCoordinateProvider: RawCoordinateProvider) => {\n\t\t\treturn () => {\n\t\t\t\tconst time = this._model.timeScale().indexToTime(rawIndexProvider());\n\t\t\t\tconst coordinate = rawCoordinateProvider();\n\t\t\t\tif (!time || !Number.isFinite(coordinate)) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\ttime,\n\t\t\t\t\tcoordinate,\n\t\t\t\t};\n\t\t\t};\n\t\t};\n\n\t\t// for current position always return both price and coordinate\n\t\tthis._currentPosPriceProvider = valuePriceProvider(\n\t\t\t() => this._price as BarPrice,\n\t\t\t() => this._y\n\t\t);\n\n\t\tconst currentPosTimeProvider = valueTimeProvider(\n\t\t\t() => this._index,\n\t\t\t() => this.appliedX()\n\t\t);\n\n\t\tthis._timeAxisView = new CrosshairTimeAxisView(this, model, currentPosTimeProvider);\n\t\tthis._paneView = new CrosshairPaneView(this);\n\t}\n\n\tpublic options(): Readonly<CrosshairOptions> {\n\t\treturn this._options;\n\t}\n\n\tpublic saveOriginCoord(x: Coordinate, y: Coordinate): void {\n\t\tthis._originX = x;\n\t\tthis._originY = y;\n\t}\n\n\tpublic clearOriginCoord(): void {\n\t\tthis._originX = NaN as Coordinate;\n\t\tthis._originY = NaN as Coordinate;\n\t}\n\n\tpublic originCoordX(): Coordinate {\n\t\treturn this._originX;\n\t}\n\n\tpublic originCoordY(): Coordinate {\n\t\treturn this._originY;\n\t}\n\n\tpublic setPosition(index: TimePointIndex, price: number, pane: Pane): void {\n\t\tif (!this._subscribed) {\n\t\t\tthis._subscribed = true;\n\t\t}\n\n\t\tthis._visible = true;\n\n\t\tthis._tryToUpdateViews(index, price, pane);\n\t}\n\n\tpublic appliedIndex(): TimePointIndex {\n\t\treturn this._index;\n\t}\n\n\tpublic appliedX(): Coordinate {\n\t\treturn this._x;\n\t}\n\n\tpublic appliedY(): Coordinate {\n\t\treturn this._y;\n\t}\n\n\tpublic override visible(): boolean {\n\t\treturn this._visible;\n\t}\n\n\tpublic clearPosition(): void {\n\t\tthis._visible = false;\n\t\tthis._setIndexToLastSeriesBarIndex();\n\n\t\tthis._price = NaN;\n\t\tthis._x = NaN as Coordinate;\n\t\tthis._y = NaN as Coordinate;\n\t\tthis._pane = null;\n\n\t\tthis.clearOriginCoord();\n\t}\n\n\tpublic paneViews(pane: Pane): readonly IPaneView[] {\n\t\treturn this._pane !== null ? [this._paneView, this._markersPaneView] : [];\n\t}\n\n\tpublic horzLineVisible(pane: Pane): boolean {\n\t\treturn pane === this._pane && this._options.horzLine.visible;\n\t}\n\n\tpublic vertLineVisible(): boolean {\n\t\treturn this._options.vertLine.visible;\n\t}\n\n\tpublic override priceAxisViews(pane: Pane, priceScale: PriceScale): IPriceAxisView[] {\n\t\tif (!this._visible || this._pane !== pane) {\n\t\t\tthis._priceAxisViews.clear();\n\t\t}\n\n\t\tconst views: IPriceAxisView[] = [];\n\t\tif (this._pane === pane) {\n\t\t\tviews.push(this._createPriceAxisViewOnDemand(this._priceAxisViews, priceScale, this._currentPosPriceProvider));\n\t\t}\n\n\t\treturn views;\n\t}\n\n\tpublic override timeAxisViews(): readonly ITimeAxisView[] {\n\t\treturn this._visible ? [this._timeAxisView] : [];\n\t}\n\n\tpublic pane(): Pane | null {\n\t\treturn this._pane;\n\t}\n\n\tpublic updateAllViews(): void {\n\t\tthis._paneView.update();\n\t\tthis._priceAxisViews.forEach((value: PriceAxisView) => value.update());\n\t\tthis._timeAxisView.update();\n\t\tthis._markersPaneView.update();\n\t}\n\n\tprivate _priceScaleByPane(pane: Pane): PriceScale | null {\n\t\tif (pane && !pane.defaultPriceScale().isEmpty()) {\n\t\t\treturn pane.defaultPriceScale();\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate _tryToUpdateViews(index: TimePointIndex, price: number, pane: Pane): void {\n\t\tif (this._tryToUpdateData(index, price, pane)) {\n\t\t\tthis.updateAllViews();\n\t\t}\n\t}\n\n\tprivate _tryToUpdateData(newIndex: TimePointIndex, newPrice: number, newPane: Pane): boolean {\n\t\tconst oldX = this._x;\n\t\tconst oldY = this._y;\n\t\tconst oldPrice = this._price;\n\t\tconst oldIndex = this._index;\n\t\tconst oldPane = this._pane;\n\t\tconst priceScale = this._priceScaleByPane(newPane);\n\n\t\tthis._index = newIndex;\n\t\tthis._x = isNaN(newIndex) ? NaN as Coordinate : this._model.timeScale().indexToCoordinate(newIndex);\n\t\tthis._pane = newPane;\n\n\t\tconst firstValue = priceScale !== null ? priceScale.firstValue() : null;\n\t\tif (priceScale !== null && firstValue !== null) {\n\t\t\tthis._price = newPrice;\n\t\t\tthis._y = priceScale.priceToCoordinate(newPrice, firstValue);\n\t\t} else {\n\t\t\tthis._price = NaN;\n\t\t\tthis._y = NaN as Coordinate;\n\t\t}\n\n\t\treturn (oldX !== this._x || oldY !== this._y || oldIndex !== this._index ||\n\t\t\toldPrice !== this._price || oldPane !== this._pane);\n\t}\n\n\tprivate _setIndexToLastSeriesBarIndex(): void {\n\t\tconst lastIndexes = this._model.serieses()\n\t\t\t.map((s: ISeries<SeriesType>) => s.bars().lastIndex())\n\t\t\t.filter(notNull);\n\t\tconst lastBarIndex = (lastIndexes.length === 0) ? null : (Math.max(...lastIndexes) as TimePointIndex);\n\t\tthis._index = lastBarIndex !== null ? lastBarIndex : NaN as TimePointIndex;\n\t}\n\n\tprivate _createPriceAxisViewOnDemand(map: Map<PriceScale, CrosshairPriceAxisView>, priceScale: PriceScale, valueProvider: PriceAndCoordinateProvider): IPriceAxisView {\n\t\tlet view = map.get(priceScale);\n\n\t\tif (view === undefined) {\n\t\t\tview = new CrosshairPriceAxisView(this, priceScale, valueProvider);\n\t\t\tmap.set(priceScale, view);\n\t\t}\n\n\t\treturn view;\n\t}\n}\n","export const enum DefaultPriceScaleId {\n\tLeft = 'left',\n\tRight = 'right',\n}\n\nexport function isDefaultPriceScale(priceScaleId: string): priceScaleId is DefaultPriceScaleId {\n\treturn priceScaleId === DefaultPriceScaleId.Left || priceScaleId === DefaultPriceScaleId.Right;\n}\n","import { LogicalRange } from '../model/time-data';\n\nexport const enum InvalidationLevel {\n\tNone = 0,\n\tCursor = 1,\n\tLight = 2,\n\tFull = 3,\n}\n\nexport interface PaneInvalidation {\n\tlevel: InvalidationLevel;\n\tautoScale?: boolean;\n}\n\nfunction mergePaneInvalidation(beforeValue: PaneInvalidation | undefined, newValue: PaneInvalidation): PaneInvalidation {\n\tif (beforeValue === undefined) {\n\t\treturn newValue;\n\t}\n\tconst level = Math.max(beforeValue.level, newValue.level);\n\tconst autoScale = beforeValue.autoScale || newValue.autoScale;\n\treturn { level, autoScale };\n}\n\nexport const enum TimeScaleInvalidationType {\n\tFitContent,\n\tApplyRange,\n\tApplyBarSpacing,\n\tApplyRightOffset,\n\tReset,\n\tAnimation,\n\tStopAnimation,\n}\n\nexport interface TimeScaleApplyRangeInvalidation {\n\ttype: TimeScaleInvalidationType.ApplyRange;\n\tvalue: LogicalRange;\n}\n\nexport interface TimeScaleFitContentInvalidation {\n\ttype: TimeScaleInvalidationType.FitContent;\n}\n\nexport interface TimeScaleApplyRightOffsetInvalidation {\n\ttype: TimeScaleInvalidationType.ApplyRightOffset;\n\tvalue: number;\n}\n\nexport interface TimeScaleApplyBarSpacingInvalidation {\n\ttype: TimeScaleInvalidationType.ApplyBarSpacing;\n\tvalue: number;\n}\n\nexport interface TimeScaleResetInvalidation {\n\ttype: TimeScaleInvalidationType.Reset;\n}\n\nexport interface ITimeScaleAnimation {\n\tgetPosition(time: number): number;\n\tfinished(time: number): boolean;\n}\nexport interface StartTimeScaleAnimationInvalidation {\n\ttype: TimeScaleInvalidationType.Animation;\n\tvalue: ITimeScaleAnimation;\n}\n\nexport interface StopTimeScaleAnimationInvalidation {\n\ttype: TimeScaleInvalidationType.StopAnimation;\n}\n\nexport type TimeScaleInvalidation =\n\t| TimeScaleApplyRangeInvalidation\n\t| TimeScaleFitContentInvalidation\n\t| TimeScaleApplyRightOffsetInvalidation\n\t| TimeScaleApplyBarSpacingInvalidation\n\t| TimeScaleResetInvalidation\n\t| StartTimeScaleAnimationInvalidation\n\t| StopTimeScaleAnimationInvalidation;\n\nexport class InvalidateMask {\n\tprivate _invalidatedPanes: Map<number, PaneInvalidation> = new Map();\n\tprivate _globalLevel: InvalidationLevel;\n\tprivate _timeScaleInvalidations: TimeScaleInvalidation[] = [];\n\n\tpublic constructor(globalLevel: InvalidationLevel) {\n\t\tthis._globalLevel = globalLevel;\n\t}\n\n\tpublic invalidatePane(paneIndex: number, invalidation: PaneInvalidation): void {\n\t\tconst prevValue = this._invalidatedPanes.get(paneIndex);\n\t\tconst newValue = mergePaneInvalidation(prevValue, invalidation);\n\t\tthis._invalidatedPanes.set(paneIndex, newValue);\n\t}\n\n\tpublic fullInvalidation(): InvalidationLevel {\n\t\treturn this._globalLevel;\n\t}\n\n\tpublic invalidateForPane(paneIndex: number): PaneInvalidation {\n\t\tconst paneInvalidation = this._invalidatedPanes.get(paneIndex);\n\t\tif (paneInvalidation === undefined) {\n\t\t\treturn {\n\t\t\t\tlevel: this._globalLevel,\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tlevel: Math.max(this._globalLevel, paneInvalidation.level),\n\t\t\tautoScale: paneInvalidation.autoScale,\n\t\t};\n\t}\n\n\tpublic setFitContent(): void {\n\t\tthis.stopTimeScaleAnimation();\n\t\t// modifies both bar spacing and right offset\n\t\tthis._timeScaleInvalidations = [{ type: TimeScaleInvalidationType.FitContent }];\n\t}\n\n\tpublic applyRange(range: LogicalRange): void {\n\t\tthis.stopTimeScaleAnimation();\n\t\t// modifies both bar spacing and right offset\n\t\tthis._timeScaleInvalidations = [{ type: TimeScaleInvalidationType.ApplyRange, value: range }];\n\t}\n\n\tpublic setTimeScaleAnimation(animation: ITimeScaleAnimation): void {\n\t\tthis._removeTimeScaleAnimation();\n\t\tthis._timeScaleInvalidations.push({ type: TimeScaleInvalidationType.Animation, value: animation });\n\t}\n\n\tpublic stopTimeScaleAnimation(): void {\n\t\tthis._removeTimeScaleAnimation();\n\t\tthis._timeScaleInvalidations.push({ type: TimeScaleInvalidationType.StopAnimation });\n\t}\n\n\tpublic resetTimeScale(): void {\n\t\tthis.stopTimeScaleAnimation();\n\t\t// modifies both bar spacing and right offset\n\t\tthis._timeScaleInvalidations = [{ type: TimeScaleInvalidationType.Reset }];\n\t}\n\n\tpublic setBarSpacing(barSpacing: number): void {\n\t\tthis.stopTimeScaleAnimation();\n\t\tthis._timeScaleInvalidations.push({ type: TimeScaleInvalidationType.ApplyBarSpacing, value: barSpacing });\n\t}\n\n\tpublic setRightOffset(offset: number): void {\n\t\tthis.stopTimeScaleAnimation();\n\t\tthis._timeScaleInvalidations.push({ type: TimeScaleInvalidationType.ApplyRightOffset, value: offset });\n\t}\n\n\tpublic timeScaleInvalidations(): readonly TimeScaleInvalidation[] {\n\t\treturn this._timeScaleInvalidations;\n\t}\n\n\tpublic merge(other: InvalidateMask): void {\n\t\tfor (const tsInvalidation of other._timeScaleInvalidations) {\n\t\t\tthis._applyTimeScaleInvalidation(tsInvalidation);\n\t\t}\n\n\t\tthis._globalLevel = Math.max(this._globalLevel, other._globalLevel);\n\t\tother._invalidatedPanes.forEach((invalidation: PaneInvalidation, index: number) => {\n\t\t\tthis.invalidatePane(index, invalidation);\n\t\t});\n\t}\n\n\tpublic static light(): InvalidateMask {\n\t\treturn new InvalidateMask(InvalidationLevel.Light);\n\t}\n\n\tpublic static full(): InvalidateMask {\n\t\treturn new InvalidateMask(InvalidationLevel.Full);\n\t}\n\n\tprivate _applyTimeScaleInvalidation(invalidation: TimeScaleInvalidation): void {\n\t\tswitch (invalidation.type) {\n\t\t\tcase TimeScaleInvalidationType.FitContent:\n\t\t\t\tthis.setFitContent();\n\t\t\t\tbreak;\n\t\t\tcase TimeScaleInvalidationType.ApplyRange:\n\t\t\t\tthis.applyRange(invalidation.value);\n\t\t\t\tbreak;\n\t\t\tcase TimeScaleInvalidationType.ApplyBarSpacing:\n\t\t\t\tthis.setBarSpacing(invalidation.value);\n\t\t\t\tbreak;\n\t\t\tcase TimeScaleInvalidationType.ApplyRightOffset:\n\t\t\t\tthis.setRightOffset(invalidation.value);\n\t\t\t\tbreak;\n\t\t\tcase TimeScaleInvalidationType.Reset:\n\t\t\t\tthis.resetTimeScale();\n\t\t\t\tbreak;\n\t\t\tcase TimeScaleInvalidationType.Animation:\n\t\t\t\tthis.setTimeScaleAnimation(invalidation.value);\n\t\t\t\tbreak;\n\t\t\tcase TimeScaleInvalidationType.StopAnimation:\n\t\t\t\tthis._removeTimeScaleAnimation();\n\t\t}\n\t}\n\n\tprivate _removeTimeScaleAnimation(): void {\n\t\tconst index = this._timeScaleInvalidations.findIndex((inv: TimeScaleInvalidation) => inv.type === TimeScaleInvalidationType.Animation);\n\t\tif (index !== -1) {\n\t\t\tthis._timeScaleInvalidations.splice(index, 1);\n\t\t}\n\t}\n}\n","import { isInteger, isNumber } from '../helpers/strict-type-checks';\n\nimport { IPriceFormatter } from './iprice-formatter';\n\nconst formatterOptions = {\n\tdecimalSign: '.',\n\tdecimalSignFractional: '\\'',\n};\n\n/**\n * @param value - The number of convert.\n * @param length - The length. Must be between 0 and 16 inclusive.\n */\nexport function numberToStringWithLeadingZero(value: number, length: number): string {\n\tif (!isNumber(value)) {\n\t\treturn 'n/a';\n\t}\n\n\tif (!isInteger(length)) {\n\t\tthrow new TypeError('invalid length');\n\t}\n\n\tif (length < 0 || length > 16) {\n\t\tthrow new TypeError('invalid length');\n\t}\n\n\tif (length === 0) {\n\t\treturn value.toString();\n\t}\n\n\tconst dummyString = '0000000000000000';\n\treturn (dummyString + value.toString()).slice(-length);\n}\n\nexport class PriceFormatter implements IPriceFormatter {\n\tprotected _fractionalLength: number | undefined;\n\tprivate readonly _priceScale: number;\n\tprivate readonly _minMove: number;\n\n\tpublic constructor(priceScale?: number, minMove?: number) {\n\t\tif (!minMove) {\n\t\t\tminMove = 1;\n\t\t}\n\n\t\tif (!isNumber(priceScale) || !isInteger(priceScale)) {\n\t\t\tpriceScale = 100;\n\t\t}\n\n\t\tif (priceScale < 0) {\n\t\t\tthrow new TypeError('invalid base');\n\t\t}\n\n\t\tthis._priceScale = priceScale;\n\t\tthis._minMove = minMove;\n\n\t\tthis._calculateDecimal();\n\t}\n\n\tpublic format(price: number): string {\n\t\t// \\u2212 is unicode's minus sign https://www.fileformat.info/info/unicode/char/2212/index.htm\n\t\t// we should use it because it has the same width as plus sign +\n\t\tconst sign = price < 0 ? '\\u2212' : '';\n\t\tprice = Math.abs(price);\n\n\t\treturn sign + this._formatAsDecimal(price);\n\t}\n\n\tprivate _calculateDecimal(): void {\n\t\t// check if this._base is power of 10\n\t\t// for double fractional _fractionalLength if for the main fractional only\n\t\tthis._fractionalLength = 0;\n\t\tif (this._priceScale > 0 && this._minMove > 0) {\n\t\t\tlet base = this._priceScale;\n\n\t\t\twhile (base > 1) {\n\t\t\t\tbase /= 10;\n\t\t\t\tthis._fractionalLength++;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _formatAsDecimal(price: number): string {\n\t\tconst base = this._priceScale / this._minMove;\n\n\t\tlet intPart = Math.floor(price);\n\n\t\tlet fracString = '';\n\t\tconst fracLength = this._fractionalLength !== undefined ? this._fractionalLength : NaN;\n\t\tif (base > 1) {\n\t\t\tlet fracPart = +(Math.round(price * base) - intPart * base).toFixed(this._fractionalLength);\n\t\t\tif (fracPart >= base) {\n\t\t\t\tfracPart -= base;\n\t\t\t\tintPart += 1;\n\t\t\t}\n\n\t\t\tfracString = formatterOptions.decimalSign + numberToStringWithLeadingZero(+fracPart.toFixed(this._fractionalLength) * this._minMove, fracLength);\n\t\t} else {\n\t\t\t// should round int part to min move\n\t\t\tintPart = Math.round(intPart * base) / base;\n\t\t\t// if min move > 1, fractional part is always = 0\n\t\t\tif (fracLength > 0) {\n\t\t\t\tfracString = formatterOptions.decimalSign + numberToStringWithLeadingZero(0, fracLength);\n\t\t\t}\n\t\t}\n\n\t\treturn intPart.toFixed(0) + fracString;\n\t}\n}\n","import { PriceFormatter } from './price-formatter';\n\nexport class PercentageFormatter extends PriceFormatter {\n\tpublic constructor(priceScale: number = 100) {\n\t\tsuper(priceScale);\n\t}\n\n\tpublic override format(price: number): string {\n\t\treturn `${super.format(price)}%`;\n\t}\n}\n","import { IPriceFormatter } from './iprice-formatter';\n\nexport class VolumeFormatter implements IPriceFormatter {\n\tprivate readonly _precision: number;\n\n\tpublic constructor(precision: number) {\n\t\tthis._precision = precision;\n\t}\n\n\tpublic format(vol: number): string {\n\t\tlet sign = '';\n\t\tif (vol < 0) {\n\t\t\tsign = '-';\n\t\t\tvol = -vol;\n\t\t}\n\n\t\tif (vol < 995) {\n\t\t\treturn sign + this._formatNumber(vol);\n\t\t} else if (vol < 999995) {\n\t\t\treturn sign + this._formatNumber(vol / 1000) + 'K';\n\t\t} else if (vol < 999999995) {\n\t\t\tvol = 1000 * Math.round(vol / 1000);\n\t\t\treturn sign + this._formatNumber(vol / 1000000) + 'M';\n\t\t} else {\n\t\t\tvol = 1000000 * Math.round(vol / 1000000);\n\t\t\treturn sign + this._formatNumber(vol / 1000000000) + 'B';\n\t\t}\n\t}\n\n\tprivate _formatNumber(value: number): string {\n\t\tlet res: string;\n\t\tconst priceScale = Math.pow(10, this._precision);\n\t\tvalue = Math.round(value * priceScale) / priceScale;\n\t\tif (value >= 1e-15 && value < 1) {\n\t\t\tres = value.toFixed(this._precision).replace(/\\.?0+$/, ''); // regex removes trailing zeroes\n\t\t} else {\n\t\t\tres = String(value);\n\t\t}\n\t\treturn res.replace(/(\\.[1-9]*)0+$/, (e: string, p1: string): string => p1);\n\t}\n}\n","import { BitmapCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { Coordinate } from '../model/coordinate';\nimport { SeriesItemsIndexesRange } from '../model/time-data';\n\nimport { LinePoint, LineType } from './draw-line';\n\n// eslint-disable-next-line max-params, complexity\nexport function walkLine<TItem extends LinePoint, TStyle extends CanvasRenderingContext2D['fillStyle'] | CanvasRenderingContext2D['strokeStyle']>(\n\trenderingScope: BitmapCoordinatesRenderingScope,\n\titems: readonly TItem[],\n\tlineType: LineType,\n\tvisibleRange: SeriesItemsIndexesRange,\n\tbarWidth: number,\n\t// the values returned by styleGetter are compared using the operator !==,\n\t// so if styleGetter returns objects, then styleGetter should return the same object for equal styles\n\tstyleGetter: (renderingScope: BitmapCoordinatesRenderingScope, item: TItem) => TStyle,\n\tfinishStyledArea: (renderingScope: BitmapCoordinatesRenderingScope, style: TStyle, areaFirstItem: LinePoint, newAreaFirstItem: LinePoint) => void\n): void {\n\tif (items.length === 0 || visibleRange.from >= items.length || visibleRange.to <= 0) {\n\t\treturn;\n\t}\n\n\tconst { context: ctx, horizontalPixelRatio, verticalPixelRatio } = renderingScope;\n\n\tconst firstItem = items[visibleRange.from];\n\tlet currentStyle = styleGetter(renderingScope, firstItem);\n\tlet currentStyleFirstItem = firstItem;\n\n\tif (visibleRange.to - visibleRange.from < 2) {\n\t\tconst halfBarWidth = barWidth / 2;\n\n\t\tctx.beginPath();\n\n\t\tconst item1: LinePoint = { x: firstItem.x - halfBarWidth as Coordinate, y: firstItem.y };\n\t\tconst item2: LinePoint = { x: firstItem.x + halfBarWidth as Coordinate, y: firstItem.y };\n\n\t\tctx.moveTo(item1.x * horizontalPixelRatio, item1.y * verticalPixelRatio);\n\t\tctx.lineTo(item2.x * horizontalPixelRatio, item2.y * verticalPixelRatio);\n\n\t\tfinishStyledArea(renderingScope, currentStyle, item1, item2);\n\t} else {\n\t\tconst changeStyle = (newStyle: TStyle, currentItem: TItem) => {\n\t\t\tfinishStyledArea(renderingScope, currentStyle, currentStyleFirstItem, currentItem);\n\n\t\t\tctx.beginPath();\n\t\t\tcurrentStyle = newStyle;\n\t\t\tcurrentStyleFirstItem = currentItem;\n\t\t};\n\n\t\tlet currentItem = currentStyleFirstItem;\n\n\t\tctx.beginPath();\n\t\tctx.moveTo(firstItem.x * horizontalPixelRatio, firstItem.y * verticalPixelRatio);\n\n\t\tfor (let i = visibleRange.from + 1; i < visibleRange.to; ++i) {\n\t\t\tcurrentItem = items[i];\n\t\t\tconst itemStyle = styleGetter(renderingScope, currentItem);\n\n\t\t\tswitch (lineType) {\n\t\t\t\tcase LineType.Simple:\n\t\t\t\t\tctx.lineTo(currentItem.x * horizontalPixelRatio, currentItem.y * verticalPixelRatio);\n\t\t\t\t\tbreak;\n\t\t\t\tcase LineType.WithSteps:\n\t\t\t\t\tctx.lineTo(currentItem.x * horizontalPixelRatio, items[i - 1].y * verticalPixelRatio);\n\n\t\t\t\t\tif (itemStyle !== currentStyle) {\n\t\t\t\t\t\tchangeStyle(itemStyle, currentItem);\n\t\t\t\t\t\tctx.lineTo(currentItem.x * horizontalPixelRatio, items[i - 1].y * verticalPixelRatio);\n\t\t\t\t\t}\n\n\t\t\t\t\tctx.lineTo(currentItem.x * horizontalPixelRatio, currentItem.y * verticalPixelRatio);\n\t\t\t\t\tbreak;\n\t\t\t\tcase LineType.Curved: {\n\t\t\t\t\tconst [cp1, cp2] = getControlPoints(items, i - 1, i);\n\t\t\t\t\tctx.bezierCurveTo(\n\t\t\t\t\t\tcp1.x * horizontalPixelRatio,\n\t\t\t\t\t\tcp1.y * verticalPixelRatio,\n\t\t\t\t\t\tcp2.x * horizontalPixelRatio,\n\t\t\t\t\t\tcp2.y * verticalPixelRatio,\n\t\t\t\t\t\tcurrentItem.x * horizontalPixelRatio,\n\t\t\t\t\t\tcurrentItem.y * verticalPixelRatio\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (lineType !== LineType.WithSteps && itemStyle !== currentStyle) {\n\t\t\t\tchangeStyle(itemStyle, currentItem);\n\t\t\t\tctx.moveTo(currentItem.x * horizontalPixelRatio, currentItem.y * verticalPixelRatio);\n\t\t\t}\n\t\t}\n\n\t\tif (currentStyleFirstItem !== currentItem || currentStyleFirstItem === currentItem && lineType === LineType.WithSteps) {\n\t\t\tfinishStyledArea(renderingScope, currentStyle, currentStyleFirstItem, currentItem);\n\t\t}\n\t}\n}\n\nconst curveTension = 6;\n\nfunction subtract(p1: LinePoint, p2: LinePoint): LinePoint {\n\treturn { x: p1.x - p2.x as Coordinate, y: p1.y - p2.y as Coordinate };\n}\n\nfunction add(p1: LinePoint, p2: LinePoint): LinePoint {\n\treturn { x: p1.x + p2.x as Coordinate, y: p1.y + p2.y as Coordinate };\n}\n\nfunction divide(p1: LinePoint, n: number): LinePoint {\n\treturn { x: p1.x / n as Coordinate, y: p1.y / n as Coordinate };\n}\n\n/**\n * @returns Two control points that can be used as arguments to {@link CanvasRenderingContext2D.bezierCurveTo} to draw a curved line between `points[fromPointIndex]` and `points[toPointIndex]`.\n */\nexport function getControlPoints(points: readonly LinePoint[], fromPointIndex: number, toPointIndex: number): [LinePoint, LinePoint] {\n\tconst beforeFromPointIndex = Math.max(0, fromPointIndex - 1);\n\tconst afterToPointIndex = Math.min(points.length - 1, toPointIndex + 1);\n\tconst cp1 = add(points[fromPointIndex], divide(subtract(points[toPointIndex], points[beforeFromPointIndex]), curveTension));\n\tconst cp2 = subtract(points[toPointIndex], divide(subtract(points[afterToPointIndex], points[fromPointIndex]), curveTension));\n\n\treturn [cp1, cp2];\n}\n","import { BitmapCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { Coordinate } from '../model/coordinate';\nimport { PricedValue } from '../model/price-scale';\nimport { SeriesItemsIndexesRange, TimedValue } from '../model/time-data';\n\nimport { BitmapCoordinatesPaneRenderer } from './bitmap-coordinates-pane-renderer';\nimport { LinePoint, LineStyle, LineType, LineWidth, setLineStyle } from './draw-line';\nimport { walkLine } from './walk-line';\n\nexport type AreaFillItemBase = TimedValue & PricedValue & LinePoint;\nexport interface PaneRendererAreaDataBase<TItem extends AreaFillItemBase = AreaFillItemBase> {\n\titems: TItem[];\n\tlineType: LineType;\n\tlineWidth: LineWidth;\n\tlineStyle: LineStyle;\n\n\tbaseLevelCoordinate: Coordinate | null;\n\tinvertFilledArea: boolean;\n\n\tbarWidth: number;\n\n\tvisibleRange: SeriesItemsIndexesRange | null;\n}\n\nfunction finishStyledArea(\n\tbaseLevelCoordinate: Coordinate,\n\tscope: BitmapCoordinatesRenderingScope,\n\tstyle: CanvasRenderingContext2D['fillStyle'],\n\tareaFirstItem: LinePoint,\n\tnewAreaFirstItem: LinePoint\n): void {\n\tconst { context, horizontalPixelRatio, verticalPixelRatio } = scope;\n\tcontext.lineTo(newAreaFirstItem.x * horizontalPixelRatio, baseLevelCoordinate * verticalPixelRatio);\n\tcontext.lineTo(areaFirstItem.x * horizontalPixelRatio, baseLevelCoordinate * verticalPixelRatio);\n\tcontext.closePath();\n\tcontext.fillStyle = style;\n\tcontext.fill();\n}\n\nexport abstract class PaneRendererAreaBase<TData extends PaneRendererAreaDataBase> extends BitmapCoordinatesPaneRenderer {\n\tprotected _data: TData | null = null;\n\n\tpublic setData(data: TData): void {\n\t\tthis._data = data;\n\t}\n\n\tprotected _drawImpl(renderingScope: BitmapCoordinatesRenderingScope): void {\n\t\tif (this._data === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { items, visibleRange, barWidth, lineWidth, lineStyle, lineType } = this._data;\n\t\tconst baseLevelCoordinate =\n\t\t\tthis._data.baseLevelCoordinate ??\n\t\t\t\t(this._data.invertFilledArea ? 0 : renderingScope.mediaSize.height) as Coordinate;\n\n\t\tif (visibleRange === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst ctx = renderingScope.context;\n\n\t\tctx.lineCap = 'butt';\n\t\tctx.lineJoin = 'round';\n\t\tctx.lineWidth = lineWidth;\n\t\tsetLineStyle(ctx, lineStyle);\n\n\t\t// walk lines with width=1 to have more accurate gradient's filling\n\t\tctx.lineWidth = 1;\n\n\t\twalkLine(renderingScope, items, lineType, visibleRange, barWidth, this._fillStyle.bind(this), finishStyledArea.bind(null, baseLevelCoordinate));\n\t}\n\n\tprotected abstract _fillStyle(renderingScope: BitmapCoordinatesRenderingScope, item: TData['items'][0]): CanvasRenderingContext2D['fillStyle'];\n}\n","export function clamp(value: number, minVal: number, maxVal: number): number {\n\treturn Math.min(Math.max(value, minVal), maxVal);\n}\n\nexport function isBaseDecimal(value: number): boolean {\n\tif (value < 0) {\n\t\treturn false;\n\t}\n\n\tfor (let current = value; current > 1; current /= 10) {\n\t\tif ((current % 10) !== 0) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\nexport function greaterOrEqual(x1: number, x2: number, epsilon: number): boolean {\n\treturn (x2 - x1) <= epsilon;\n}\n\nexport function equal(x1: number, x2: number, epsilon: number): boolean {\n\treturn Math.abs(x1 - x2) < epsilon;\n}\n\n// We can't use Math.min(...arr) because that would only support arrays shorter than 65536 items.\nexport function min(arr: number[]): number {\n\tif (arr.length < 1) {\n\t\tthrow Error('array is empty');\n\t}\n\n\tlet minVal = arr[0];\n\tfor (let i = 1; i < arr.length; ++i) {\n\t\tif (arr[i] < minVal) {\n\t\t\tminVal = arr[i];\n\t\t}\n\t}\n\n\treturn minVal;\n}\n\nexport function ceiledEven(x: number): number {\n\tconst ceiled = Math.ceil(x);\n\treturn (ceiled % 2 !== 0) ? ceiled - 1 : ceiled;\n}\n\nexport function ceiledOdd(x: number): number {\n\tconst ceiled = Math.ceil(x);\n\treturn (ceiled % 2 === 0) ? ceiled - 1 : ceiled;\n}\n","import { BitmapCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { clamp } from '../helpers/mathex';\n\nimport { Coordinate } from '../model/coordinate';\n\nexport interface GradientCacheParams {\n\ttopColor1: string;\n\ttopColor2: string;\n\tbottomColor1: string;\n\tbottomColor2: string;\n\tbaseLevelCoordinate?: Coordinate | null;\n\tbottom: Coordinate;\n}\n\nexport class GradientStyleCache {\n\tprivate _params?: GradientCacheParams;\n\tprivate _cachedValue?: CanvasGradient;\n\n\tpublic get(scope: BitmapCoordinatesRenderingScope, params: GradientCacheParams): CanvasGradient {\n\t\tconst cachedParams = this._params;\n\t\tconst { topColor1, topColor2, bottomColor1, bottomColor2, bottom, baseLevelCoordinate } = params;\n\n\t\tif (\n\t\t\tthis._cachedValue === undefined ||\n\t\t\tcachedParams === undefined ||\n\t\t\tcachedParams.topColor1 !== topColor1 ||\n\t\t\tcachedParams.topColor2 !== topColor2 ||\n\t\t\tcachedParams.bottomColor1 !== bottomColor1 ||\n\t\t\tcachedParams.bottomColor2 !== bottomColor2 ||\n\t\t\tcachedParams.baseLevelCoordinate !== baseLevelCoordinate ||\n\t\t\tcachedParams.bottom !== bottom\n\t\t) {\n\t\t\tconst gradient = scope.context.createLinearGradient(0, 0, 0, bottom);\n\n\t\t\tgradient.addColorStop(0, topColor1);\n\n\t\t\tif (baseLevelCoordinate != null) {\n\t\t\t\tconst baselinePercent = clamp(baseLevelCoordinate * scope.verticalPixelRatio / bottom, 0, 1);\n\t\t\t\tgradient.addColorStop(baselinePercent, topColor2);\n\t\t\t\tgradient.addColorStop(baselinePercent, bottomColor1);\n\t\t\t}\n\n\t\t\tgradient.addColorStop(1, bottomColor2);\n\n\t\t\tthis._cachedValue = gradient;\n\t\t\tthis._params = params;\n\t\t}\n\n\t\treturn this._cachedValue;\n\t}\n}\n","import { BitmapCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { Coordinate } from '../model/coordinate';\nimport { AreaFillColorerStyle } from '../model/series-bar-colorer';\n\nimport { AreaFillItemBase, PaneRendererAreaBase, PaneRendererAreaDataBase } from './area-renderer-base';\nimport { GradientStyleCache } from './gradient-style-cache';\n\nexport type AreaFillItem = AreaFillItemBase & AreaFillColorerStyle;\nexport interface PaneRendererAreaData extends PaneRendererAreaDataBase<AreaFillItem> {\n}\n\nexport class PaneRendererArea extends PaneRendererAreaBase<PaneRendererAreaData> {\n\tprivate readonly _fillCache: GradientStyleCache = new GradientStyleCache();\n\n\tprotected override _fillStyle(renderingScope: BitmapCoordinatesRenderingScope, item: AreaFillItem): CanvasRenderingContext2D['fillStyle'] {\n\t\treturn this._fillCache.get(\n\t\t\trenderingScope,\n\t\t\t{\n\t\t\t\ttopColor1: item.topColor,\n\t\t\t\ttopColor2: '',\n\t\t\t\tbottomColor1: '',\n\t\t\t\tbottomColor2: item.bottomColor,\n\t\t\t\tbottom: renderingScope.bitmapSize.height as Coordinate,\n\t\t\t}\n\t\t);\n\t}\n}\n","import { BitmapCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { SeriesItemsIndexesRange } from '../model/time-data';\n\nimport { LinePoint } from './draw-line';\n\nexport function drawSeriesPointMarkers<TItem extends LinePoint, TStyle extends CanvasRenderingContext2D['fillStyle']>(\n\trenderingScope: BitmapCoordinatesRenderingScope,\n\titems: readonly TItem[],\n\tpointMarkersRadius: number,\n\tvisibleRange: SeriesItemsIndexesRange,\n\t// the values returned by styleGetter are compared using the operator !==,\n\t// so if styleGetter returns objects, then styleGetter should return the same object for equal styles\n\tstyleGetter: (renderingScope: BitmapCoordinatesRenderingScope, item: TItem) => TStyle\n): void {\n\tconst { horizontalPixelRatio, verticalPixelRatio, context } = renderingScope;\n\tlet prevStyle: TStyle | null = null;\n\n\tconst tickWidth = Math.max(1, Math.floor(horizontalPixelRatio));\n\tconst correction = (tickWidth % 2) / 2;\n\n\tconst radius = pointMarkersRadius * verticalPixelRatio + correction;\n\tfor (let i = visibleRange.to - 1; i >= visibleRange.from; --i) {\n\t\tconst point = items[i];\n\t\tif (point) {\n\t\t\tconst style = styleGetter(renderingScope, point);\n\t\t\tif (style !== prevStyle) {\n\t\t\t\tcontext.beginPath();\n\t\t\t\tif (prevStyle !== null) {\n\t\t\t\t\tcontext.fill();\n\t\t\t\t}\n\n\t\t\t\tcontext.fillStyle = style;\n\t\t\t\tprevStyle = style;\n\t\t\t}\n\n\t\t\tconst centerX = Math.round(point.x * horizontalPixelRatio) + correction; // correct x coordinate only\n\t\t\tconst centerY = point.y * verticalPixelRatio;\n\n\t\t\tcontext.moveTo(centerX, centerY);\n\t\t\tcontext.arc(centerX, centerY, radius, 0, Math.PI * 2);\n\t\t}\n\t}\n\n\tcontext.fill();\n}\n","import { BitmapCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { PricedValue } from '../model/price-scale';\nimport { SeriesItemsIndexesRange, TimedValue } from '../model/time-data';\n\nimport { BitmapCoordinatesPaneRenderer } from './bitmap-coordinates-pane-renderer';\nimport { LinePoint, LineStyle, LineType, LineWidth, setLineStyle } from './draw-line';\nimport { drawSeriesPointMarkers } from './draw-series-point-markers';\nimport { walkLine } from './walk-line';\n\nexport type LineItemBase = TimedValue & PricedValue & LinePoint;\n\nexport interface PaneRendererLineDataBase<TItem extends LineItemBase = LineItemBase> {\n\tlineType?: LineType;\n\n\titems: TItem[];\n\n\tbarWidth: number;\n\n\tlineWidth: LineWidth;\n\tlineStyle: LineStyle;\n\n\tvisibleRange: SeriesItemsIndexesRange | null;\n\n\tpointMarkersRadius?: number;\n}\n\nfunction finishStyledArea(scope: BitmapCoordinatesRenderingScope, style: CanvasRenderingContext2D['strokeStyle']): void {\n\tconst ctx = scope.context;\n\tctx.strokeStyle = style;\n\tctx.stroke();\n}\n\nexport abstract class PaneRendererLineBase<TData extends PaneRendererLineDataBase> extends BitmapCoordinatesPaneRenderer {\n\tprotected _data: TData | null = null;\n\n\tpublic setData(data: TData): void {\n\t\tthis._data = data;\n\t}\n\n\tprotected _drawImpl(renderingScope: BitmapCoordinatesRenderingScope): void {\n\t\tif (this._data === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { items, visibleRange, barWidth, lineType, lineWidth, lineStyle, pointMarkersRadius } = this._data;\n\n\t\tif (visibleRange === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst ctx = renderingScope.context;\n\n\t\tctx.lineCap = 'butt';\n\t\tctx.lineWidth = lineWidth * renderingScope.verticalPixelRatio;\n\n\t\tsetLineStyle(ctx, lineStyle);\n\n\t\tctx.lineJoin = 'round';\n\n\t\tconst styleGetter = this._strokeStyle.bind(this);\n\n\t\tif (lineType !== undefined) {\n\t\t\twalkLine(renderingScope, items, lineType, visibleRange, barWidth, styleGetter, finishStyledArea);\n\t\t}\n\n\t\tif (pointMarkersRadius) {\n\t\t\tdrawSeriesPointMarkers(renderingScope, items, pointMarkersRadius, visibleRange, styleGetter);\n\t\t}\n\t}\n\n\tprotected abstract _strokeStyle(renderingScope: BitmapCoordinatesRenderingScope, item: TData['items'][0]): CanvasRenderingContext2D['strokeStyle'];\n}\n","import { MediaCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { LineStrokeColorerStyle } from '../model/series-bar-colorer';\n\nimport { LineItemBase, PaneRendererLineBase, PaneRendererLineDataBase } from './line-renderer-base';\n\nexport type LineStrokeItem = LineItemBase & LineStrokeColorerStyle;\nexport interface PaneRendererLineData extends PaneRendererLineDataBase<LineStrokeItem> {\n}\n\nexport class PaneRendererLine extends PaneRendererLineBase<PaneRendererLineData> {\n\tprotected override _strokeStyle(renderingScope: MediaCoordinatesRenderingScope, item: LineStrokeItem): CanvasRenderingContext2D['strokeStyle'] {\n\t\treturn item.lineColor;\n\t}\n}\n","export type BoundComparatorType<TArrayElementType, TValueType> = (a: TArrayElementType, b: TValueType) => boolean;\n\n/**\n * Binary function that accepts two arguments (the first of the type of array elements, and the second is always val), and returns a value convertible to bool.\n * The value returned indicates whether the first argument is considered to go before the second.\n * The function shall not modify any of its arguments.\n */\n\nfunction boundCompare<TArrayElementType, TValueType>(\n\tlower: boolean,\n\tarr: readonly TArrayElementType[],\n\tvalue: TValueType,\n\tcompare: BoundComparatorType<TArrayElementType, TValueType>,\n\tstart: number = 0,\n\tto: number = arr.length): number {\n\tlet count: number = to - start;\n\twhile (0 < count) {\n\t\tconst count2: number = (count >> 1);\n\t\tconst mid: number = start + count2;\n\t\tif (compare(arr[mid], value) === lower) {\n\t\t\tstart = mid + 1;\n\t\t\tcount -= count2 + 1;\n\t\t} else {\n\t\t\tcount = count2;\n\t\t}\n\t}\n\n\treturn start;\n}\n\ntype BoundCompareFunctionDefinition = <TArrayElementType, TValueType>(\n\tarr: readonly TArrayElementType[],\n\tvalue: TValueType,\n\tcompare: BoundComparatorType<TArrayElementType, TValueType>,\n\tstart?: number,\n\tto?: number\n) => number;\n\nexport const lowerBound = boundCompare.bind(null, true) as BoundCompareFunctionDefinition;\nexport const upperBound = boundCompare.bind(null, false) as BoundCompareFunctionDefinition;\n","import { lowerBound, upperBound } from '../helpers/algorithms';\nimport { Nominal } from '../helpers/nominal';\n\nimport { Coordinate } from './coordinate';\nimport { InternalHorzScaleItem } from './ihorz-scale-behavior';\nimport { RangeImpl } from './range-impl';\n\n/**\n * Weight of the tick mark. @see TickMarkWeight enum\n */\nexport type TickMarkWeightValue = Nominal<number, 'TickMarkWeightValue'>;\n\n/**\n * Represents a point on the time scale\n */\nexport interface TimeScalePoint {\n\t/** Weight of the point */\n\treadonly timeWeight: TickMarkWeightValue;\n\t/** Time of the point */\n\treadonly time: InternalHorzScaleItem;\n\t/** Original time for the point */\n\treadonly originalTime: unknown;\n}\n\n/**\n * Represents a generic range `from` one value `to` another.\n */\nexport interface Range<T> {\n\t/**\n\t * The from value. The start of the range.\n\t */\n\tfrom: T;\n\t/**\n\t * The to value. The end of the range.\n\t */\n\tto: T;\n}\n\nexport type TimePointsRange = Range<Omit<TimeScalePoint, 'timeWeight'>>;\n\n/**\n * Index for a point on the horizontal (time) scale.\n */\nexport type TimePointIndex = Nominal<number, 'TimePointIndex'>;\n\n/**\n * Represents the `to` or `from` number in a logical range.\n */\nexport type Logical = Nominal<number, 'Logical'>;\n\n/**\n * A logical range is an object with 2 properties: `from` and `to`, which are numbers and represent logical indexes on the time scale.\n *\n * The starting point of the time scale's logical range is the first data item among all series.\n * Before that point all indexes are negative, starting from that point - positive.\n *\n * Indexes might have fractional parts, for instance 4.2, due to the time-scale being continuous rather than discrete.\n *\n * Integer part of the logical index means index of the fully visible bar.\n * Thus, if we have 5.2 as the last visible logical index (`to` field), that means that the last visible bar has index 5, but we also have partially visible (for 20%) 6th bar.\n * Half (e.g. 1.5, 3.5, 10.5) means exactly a middle of the bar.\n */\nexport type LogicalRange = Range<Logical>;\n\nexport interface TimedValue {\n\ttime: TimePointIndex;\n\tx: Coordinate;\n}\n\nexport type SeriesItemsIndexesRange = Range<number>;\n\nfunction lowerBoundItemsCompare(item: TimedValue, time: TimePointIndex): boolean {\n\treturn item.time < time;\n}\n\nfunction upperBoundItemsCompare(item: TimedValue, time: TimePointIndex): boolean {\n\treturn time < item.time;\n}\n\nexport function visibleTimedValues(items: TimedValue[], range: RangeImpl<TimePointIndex>, extendedRange: boolean): SeriesItemsIndexesRange {\n\tconst firstBar = range.left();\n\tconst lastBar = range.right();\n\n\tconst from = lowerBound(items, firstBar, lowerBoundItemsCompare);\n\tconst to = upperBound(items, lastBar, upperBoundItemsCompare);\n\n\tif (!extendedRange) {\n\t\treturn { from, to };\n\t}\n\n\tlet extendedFrom = from;\n\tlet extendedTo = to;\n\n\tif (from > 0 && from < items.length && items[from].time >= firstBar) {\n\t\textendedFrom = from - 1;\n\t}\n\n\tif (to > 0 && to < items.length && items[to - 1].time <= lastBar) {\n\t\textendedTo = to + 1;\n\t}\n\n\treturn { from: extendedFrom, to: extendedTo };\n}\n","import { IChartModelBase } from '../../model/chart-model';\nimport { PriceScale } from '../../model/price-scale';\nimport { ISeries } from '../../model/series';\nimport { SeriesType } from '../../model/series-options';\nimport { SeriesItemsIndexesRange, TimedValue, visibleTimedValues } from '../../model/time-data';\nimport { ITimeScale } from '../../model/time-scale';\nimport { IPaneRenderer } from '../../renderers/ipane-renderer';\n\nimport { IUpdatablePaneView, UpdateType } from './iupdatable-pane-view';\n\nexport abstract class SeriesPaneViewBase<TSeriesType extends SeriesType, ItemType extends TimedValue, TRenderer extends IPaneRenderer> implements IUpdatablePaneView {\n\tprotected readonly _series: ISeries<TSeriesType>;\n\tprotected readonly _model: IChartModelBase;\n\tprotected _invalidated: boolean = true;\n\tprotected _dataInvalidated: boolean = true;\n\tprotected _optionsInvalidated: boolean = true;\n\tprotected _items: ItemType[] = [];\n\tprotected _itemsVisibleRange: SeriesItemsIndexesRange | null = null;\n\tprotected readonly abstract _renderer: TRenderer;\n\tprivate readonly _extendedVisibleRange: boolean;\n\n\tpublic constructor(series: ISeries<TSeriesType>, model: IChartModelBase, extendedVisibleRange: boolean) {\n\t\tthis._series = series;\n\t\tthis._model = model;\n\t\tthis._extendedVisibleRange = extendedVisibleRange;\n\t}\n\n\tpublic update(updateType?: UpdateType): void {\n\t\tthis._invalidated = true;\n\t\tif (updateType === 'data') {\n\t\t\tthis._dataInvalidated = true;\n\t\t}\n\t\tif (updateType === 'options') {\n\t\t\tthis._optionsInvalidated = true;\n\t\t}\n\t}\n\n\tpublic renderer(): IPaneRenderer | null {\n\t\tif (!this._series.visible()) {\n\t\t\treturn null;\n\t\t}\n\n\t\tthis._makeValid();\n\n\t\treturn this._itemsVisibleRange === null ? null : this._renderer;\n\t}\n\n\tprotected abstract _fillRawPoints(): void;\n\n\tprotected _updateOptions(): void {\n\t\tthis._items = this._items.map((item: ItemType) => ({\n\t\t\t...item,\n\t\t\t...this._series.barColorer().barStyle(item.time),\n\t\t}));\n\t}\n\n\tprotected abstract _convertToCoordinates(priceScale: PriceScale, timeScale: ITimeScale, firstValue: number): void;\n\n\tprotected _clearVisibleRange(): void {\n\t\tthis._itemsVisibleRange = null;\n\t}\n\n\tprotected abstract _prepareRendererData(): void;\n\n\tprivate _makeValid(): void {\n\t\tif (this._dataInvalidated) {\n\t\t\tthis._fillRawPoints();\n\t\t\tthis._dataInvalidated = false;\n\t\t}\n\n\t\tif (this._optionsInvalidated) {\n\t\t\tthis._updateOptions();\n\t\t\tthis._optionsInvalidated = false;\n\t\t}\n\n\t\tif (this._invalidated) {\n\t\t\tthis._makeValidImpl();\n\t\t\tthis._invalidated = false;\n\t\t}\n\t}\n\n\tprivate _makeValidImpl(): void {\n\t\tconst priceScale = this._series.priceScale();\n\t\tconst timeScale = this._model.timeScale();\n\n\t\tthis._clearVisibleRange();\n\n\t\tif (timeScale.isEmpty() || priceScale.isEmpty()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst visibleBars = timeScale.visibleStrictRange();\n\t\tif (visibleBars === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._series.bars().size() === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst firstValue = this._series.firstValue();\n\t\tif (firstValue === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._itemsVisibleRange = visibleTimedValues(this._items, visibleBars, this._extendedVisibleRange);\n\t\tthis._convertToCoordinates(priceScale, timeScale, firstValue.value);\n\n\t\tthis._prepareRendererData();\n\t}\n}\n","import { undefinedIfNull } from '../../helpers/strict-type-checks';\n\nimport { BarPrice } from '../../model/bar';\nimport { IChartModelBase } from '../../model/chart-model';\nimport { Coordinate } from '../../model/coordinate';\nimport { PlotRowValueIndex } from '../../model/plot-data';\nimport { PricedValue, PriceScale } from '../../model/price-scale';\nimport { ISeries } from '../../model/series';\nimport { ISeriesBarColorer } from '../../model/series-bar-colorer';\nimport { SeriesPlotRow } from '../../model/series-data';\nimport { TimedValue, TimePointIndex } from '../../model/time-data';\nimport { ITimeScale } from '../../model/time-scale';\nimport { IPaneRenderer } from '../../renderers/ipane-renderer';\n\nimport { SeriesPaneViewBase } from './series-pane-view-base';\n\nexport abstract class LinePaneViewBase<\n\tTSeriesType extends 'Line' | 'Area' | 'Baseline' | 'Histogram',\n\tItemType extends PricedValue & TimedValue,\n\tTRenderer extends IPaneRenderer\n> extends SeriesPaneViewBase<TSeriesType, ItemType, TRenderer> {\n\tpublic constructor(series: ISeries<TSeriesType>, model: IChartModelBase) {\n\t\tsuper(series, model, true);\n\t}\n\n\tprotected _convertToCoordinates(priceScale: PriceScale, timeScale: ITimeScale, firstValue: number): void {\n\t\ttimeScale.indexesToCoordinates(this._items, undefinedIfNull(this._itemsVisibleRange));\n\t\tpriceScale.pointsArrayToCoordinates(this._items, firstValue, undefinedIfNull(this._itemsVisibleRange));\n\t}\n\n\tprotected abstract _createRawItem(time: TimePointIndex, price: BarPrice, colorer: ISeriesBarColorer<TSeriesType>): ItemType;\n\n\tprotected _createRawItemBase(time: TimePointIndex, price: BarPrice): PricedValue & TimedValue {\n\t\treturn {\n\t\t\ttime: time,\n\t\t\tprice: price,\n\t\t\tx: NaN as Coordinate,\n\t\t\ty: NaN as Coordinate,\n\t\t};\n\t}\n\n\tprotected _fillRawPoints(): void {\n\t\tconst colorer = this._series.barColorer();\n\t\tthis._items = this._series.bars().rows().map((row: SeriesPlotRow<TSeriesType>) => {\n\t\t\tconst value = row.value[PlotRowValueIndex.Close] as BarPrice;\n\t\t\treturn this._createRawItem(row.index, value, colorer);\n\t\t});\n\t}\n}\n","import { BarPrice } from '../../model/bar';\nimport { IChartModelBase } from '../../model/chart-model';\nimport { ISeries } from '../../model/series';\nimport { ISeriesBarColorer } from '../../model/series-bar-colorer';\nimport { TimePointIndex } from '../../model/time-data';\nimport { AreaFillItem, PaneRendererArea } from '../../renderers/area-renderer';\nimport { CompositeRenderer } from '../../renderers/composite-renderer';\nimport { LineStrokeItem, PaneRendererLine } from '../../renderers/line-renderer';\n\nimport { LinePaneViewBase } from './line-pane-view-base';\n\nexport class SeriesAreaPaneView extends LinePaneViewBase<'Area', AreaFillItem & LineStrokeItem, CompositeRenderer> {\n\tprotected readonly _renderer: CompositeRenderer = new CompositeRenderer();\n\tprivate readonly _areaRenderer: PaneRendererArea = new PaneRendererArea();\n\tprivate readonly _lineRenderer: PaneRendererLine = new PaneRendererLine();\n\n\tpublic constructor(series: ISeries<'Area'>, model: IChartModelBase) {\n\t\tsuper(series, model);\n\t\tthis._renderer.setRenderers([this._areaRenderer, this._lineRenderer]);\n\t}\n\n\tprotected _createRawItem(time: TimePointIndex, price: BarPrice, colorer: ISeriesBarColorer<'Area'>): AreaFillItem & LineStrokeItem {\n\t\treturn {\n\t\t\t...this._createRawItemBase(time, price),\n\t\t\t...colorer.barStyle(time),\n\t\t};\n\t}\n\n\tprotected _prepareRendererData(): void {\n\t\tconst options = this._series.options();\n\n\t\tthis._areaRenderer.setData({\n\t\t\tlineType: options.lineType,\n\t\t\titems: this._items,\n\t\t\tlineStyle: options.lineStyle,\n\t\t\tlineWidth: options.lineWidth,\n\t\t\tbaseLevelCoordinate: null,\n\t\t\tinvertFilledArea: options.invertFilledArea,\n\t\t\tvisibleRange: this._itemsVisibleRange,\n\t\t\tbarWidth: this._model.timeScale().barSpacing(),\n\t\t});\n\n\t\tthis._lineRenderer.setData({\n\t\t\tlineType: options.lineVisible ? options.lineType : undefined,\n\t\t\titems: this._items,\n\t\t\tlineStyle: options.lineStyle,\n\t\t\tlineWidth: options.lineWidth,\n\t\t\tvisibleRange: this._itemsVisibleRange,\n\t\t\tbarWidth: this._model.timeScale().barSpacing(),\n\t\t\tpointMarkersRadius: options.pointMarkersVisible ? (options.pointMarkersRadius || options.lineWidth / 2 + 2) : undefined,\n\t\t});\n\t}\n}\n","export function optimalBarWidth(barSpacing: number, pixelRatio: number): number {\n\treturn Math.floor(barSpacing * 0.3 * pixelRatio);\n}\n\nexport function optimalCandlestickWidth(barSpacing: number, pixelRatio: number): number {\n\tconst barSpacingSpecialCaseFrom = 2.5;\n\tconst barSpacingSpecialCaseTo = 4;\n\tconst barSpacingSpecialCaseCoeff = 3;\n\tif (barSpacing >= barSpacingSpecialCaseFrom && barSpacing <= barSpacingSpecialCaseTo) {\n\t\treturn Math.floor(barSpacingSpecialCaseCoeff * pixelRatio);\n\t}\n\t// coeff should be 1 on small barspacing and go to 0.8 while groing bar spacing\n\tconst barSpacingReducingCoeff = 0.2;\n\tconst coeff = 1 - barSpacingReducingCoeff * Math.atan(Math.max(barSpacingSpecialCaseTo, barSpacing) - barSpacingSpecialCaseTo) / (Math.PI * 0.5);\n\tconst res = Math.floor(barSpacing * coeff * pixelRatio);\n\tconst scaledBarSpacing = Math.floor(barSpacing * pixelRatio);\n\tconst optimal = Math.min(res, scaledBarSpacing);\n\treturn Math.max(Math.floor(pixelRatio), optimal);\n}\n","import { BitmapCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { ensureNotNull } from '../helpers/assertions';\n\nimport { BarCoordinates, BarPrices } from '../model/bar';\nimport { BarColorerStyle } from '../model/series-bar-colorer';\nimport { SeriesItemsIndexesRange, TimedValue } from '../model/time-data';\n\nimport { BitmapCoordinatesPaneRenderer } from './bitmap-coordinates-pane-renderer';\nimport { optimalBarWidth } from './optimal-bar-width';\n\nexport type BarCandlestickItemBase = TimedValue & BarPrices & BarCoordinates;\n\nexport interface BarItem extends BarCandlestickItemBase, BarColorerStyle {\n}\n\nexport interface PaneRendererBarsData {\n\tbars: readonly BarItem[];\n\tbarSpacing: number;\n\topenVisible: boolean;\n\tthinBars: boolean;\n\n\tvisibleRange: SeriesItemsIndexesRange | null;\n}\n\nexport class PaneRendererBars extends BitmapCoordinatesPaneRenderer {\n\tprivate _data: PaneRendererBarsData | null = null;\n\tprivate _barWidth: number = 0;\n\tprivate _barLineWidth: number = 0;\n\n\tpublic setData(data: PaneRendererBarsData): void {\n\t\tthis._data = data;\n\t}\n\n\t// eslint-disable-next-line complexity\n\tprotected override _drawImpl({ context: ctx, horizontalPixelRatio, verticalPixelRatio }: BitmapCoordinatesRenderingScope): void {\n\t\tif (this._data === null || this._data.bars.length === 0 || this._data.visibleRange === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._barWidth = this._calcBarWidth(horizontalPixelRatio);\n\n\t\t// grid and crosshair have line width = Math.floor(pixelRatio)\n\t\t// if this value is odd, we have to make bars' width odd\n\t\t// if this value is even, we have to make bars' width even\n\t\t// in order of keeping crosshair-over-bar drawing symmetric\n\t\tif (this._barWidth >= 2) {\n\t\t\tconst lineWidth = Math.max(1, Math.floor(horizontalPixelRatio));\n\t\t\tif ((lineWidth % 2) !== (this._barWidth % 2)) {\n\t\t\t\tthis._barWidth--;\n\t\t\t}\n\t\t}\n\n\t\t// if scale is compressed, bar could become less than 1 CSS pixel\n\t\tthis._barLineWidth = this._data.thinBars ? Math.min(this._barWidth, Math.floor(horizontalPixelRatio)) : this._barWidth;\n\t\tlet prevColor: string | null = null;\n\n\t\tconst drawOpenClose = this._barLineWidth <= this._barWidth && this._data.barSpacing >= Math.floor(1.5 * horizontalPixelRatio);\n\t\tfor (let i = this._data.visibleRange.from; i < this._data.visibleRange.to; ++i) {\n\t\t\tconst bar = this._data.bars[i];\n\t\t\tif (prevColor !== bar.barColor) {\n\t\t\t\tctx.fillStyle = bar.barColor;\n\t\t\t\tprevColor = bar.barColor;\n\t\t\t}\n\n\t\t\tconst bodyWidthHalf = Math.floor(this._barLineWidth * 0.5);\n\n\t\t\tconst bodyCenter = Math.round(bar.x * horizontalPixelRatio);\n\t\t\tconst bodyLeft = bodyCenter - bodyWidthHalf;\n\t\t\tconst bodyWidth = this._barLineWidth;\n\t\t\tconst bodyRight = bodyLeft + bodyWidth - 1;\n\n\t\t\tconst high = Math.min(bar.highY, bar.lowY);\n\t\t\tconst low = Math.max(bar.highY, bar.lowY);\n\n\t\t\tconst bodyTop = Math.round(high * verticalPixelRatio) - bodyWidthHalf;\n\n\t\t\tconst bodyBottom = Math.round(low * verticalPixelRatio) + bodyWidthHalf;\n\n\t\t\tconst bodyHeight = Math.max((bodyBottom - bodyTop), this._barLineWidth);\n\n\t\t\tctx.fillRect(\n\t\t\t\tbodyLeft,\n\t\t\t\tbodyTop,\n\t\t\t\tbodyWidth,\n\t\t\t\tbodyHeight\n\t\t\t);\n\n\t\t\tconst sideWidth = Math.ceil(this._barWidth * 1.5);\n\n\t\t\tif (drawOpenClose) {\n\t\t\t\tif (this._data.openVisible) {\n\t\t\t\t\tconst openLeft = bodyCenter - sideWidth;\n\t\t\t\t\tlet openTop = Math.max(bodyTop, Math.round(bar.openY * verticalPixelRatio) - bodyWidthHalf);\n\t\t\t\t\tlet openBottom = openTop + bodyWidth - 1;\n\t\t\t\t\tif (openBottom > bodyTop + bodyHeight - 1) {\n\t\t\t\t\t\topenBottom = bodyTop + bodyHeight - 1;\n\t\t\t\t\t\topenTop = openBottom - bodyWidth + 1;\n\t\t\t\t\t}\n\t\t\t\t\tctx.fillRect(\n\t\t\t\t\t\topenLeft,\n\t\t\t\t\t\topenTop,\n\t\t\t\t\t\tbodyLeft - openLeft,\n\t\t\t\t\t\topenBottom - openTop + 1\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tconst closeRight = bodyCenter + sideWidth;\n\t\t\t\tlet closeTop = Math.max(bodyTop, Math.round(bar.closeY * verticalPixelRatio) - bodyWidthHalf);\n\t\t\t\tlet closeBottom = closeTop + bodyWidth - 1;\n\t\t\t\tif (closeBottom > bodyTop + bodyHeight - 1) {\n\t\t\t\t\tcloseBottom = bodyTop + bodyHeight - 1;\n\t\t\t\t\tcloseTop = closeBottom - bodyWidth + 1;\n\t\t\t\t}\n\n\t\t\t\tctx.fillRect(\n\t\t\t\t\tbodyRight + 1,\n\t\t\t\t\tcloseTop,\n\t\t\t\t\tcloseRight - bodyRight,\n\t\t\t\t\tcloseBottom - closeTop + 1\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _calcBarWidth(pixelRatio: number): number {\n\t\tconst limit = Math.floor(pixelRatio);\n\t\treturn Math.max(limit, Math.floor(optimalBarWidth(ensureNotNull(this._data).barSpacing, pixelRatio)));\n\t}\n}\n","import { undefinedIfNull } from '../../helpers/strict-type-checks';\n\nimport { BarPrice } from '../../model/bar';\nimport { IChartModelBase } from '../../model/chart-model';\nimport { Coordinate } from '../../model/coordinate';\nimport { PlotRowValueIndex } from '../../model/plot-data';\nimport { PriceScale } from '../../model/price-scale';\nimport { ISeries } from '../../model/series';\nimport { ISeriesBarColorer } from '../../model/series-bar-colorer';\nimport { SeriesPlotRow } from '../../model/series-data';\nimport { TimePointIndex } from '../../model/time-data';\nimport { ITimeScale } from '../../model/time-scale';\nimport { BarCandlestickItemBase } from '../../renderers/bars-renderer';\nimport { IPaneRenderer } from '../../renderers/ipane-renderer';\n\nimport { SeriesPaneViewBase } from './series-pane-view-base';\n\nexport abstract class BarsPaneViewBase<TSeriesType extends 'Bar' | 'Candlestick', ItemType extends BarCandlestickItemBase, TRenderer extends IPaneRenderer> extends SeriesPaneViewBase<TSeriesType, ItemType, TRenderer> {\n\tpublic constructor(series: ISeries<TSeriesType>, model: IChartModelBase) {\n\t\tsuper(series, model, false);\n\t}\n\n\tprotected _convertToCoordinates(priceScale: PriceScale, timeScale: ITimeScale, firstValue: number): void {\n\t\ttimeScale.indexesToCoordinates(this._items, undefinedIfNull(this._itemsVisibleRange));\n\t\tpriceScale.barPricesToCoordinates(this._items, firstValue, undefinedIfNull(this._itemsVisibleRange));\n\t}\n\n\tprotected abstract _createRawItem(time: TimePointIndex, bar: SeriesPlotRow<TSeriesType>, colorer: ISeriesBarColorer<TSeriesType>): ItemType;\n\n\tprotected _createDefaultItem(time: TimePointIndex, bar: SeriesPlotRow<TSeriesType>, colorer: ISeriesBarColorer<TSeriesType>): BarCandlestickItemBase {\n\t\treturn {\n\t\t\ttime: time,\n\t\t\topen: bar.value[PlotRowValueIndex.Open] as BarPrice,\n\t\t\thigh: bar.value[PlotRowValueIndex.High] as BarPrice,\n\t\t\tlow: bar.value[PlotRowValueIndex.Low] as BarPrice,\n\t\t\tclose: bar.value[PlotRowValueIndex.Close] as BarPrice,\n\t\t\tx: NaN as Coordinate,\n\t\t\topenY: NaN as Coordinate,\n\t\t\thighY: NaN as Coordinate,\n\t\t\tlowY: NaN as Coordinate,\n\t\t\tcloseY: NaN as Coordinate,\n\t\t};\n\t}\n\n\tprotected _fillRawPoints(): void {\n\t\tconst colorer = this._series.barColorer();\n\n\t\tthis._items = this._series.bars().rows().map((row: SeriesPlotRow<TSeriesType>) => this._createRawItem(row.index, row, colorer));\n\t}\n}\n","import { SeriesBarColorer } from '../../model/series-bar-colorer';\nimport { SeriesPlotRow } from '../../model/series-data';\nimport { SeriesType } from '../../model/series-options';\nimport { TimePointIndex } from '../../model/time-data';\nimport {\n\tBarItem,\n\tPaneRendererBars,\n} from '../../renderers/bars-renderer';\n\nimport { BarsPaneViewBase } from './bars-pane-view-base';\n\nexport class SeriesBarsPaneView extends BarsPaneViewBase<'Bar', BarItem, PaneRendererBars> {\n\tprotected readonly _renderer: PaneRendererBars = new PaneRendererBars();\n\n\tprotected _createRawItem(time: TimePointIndex, bar: SeriesPlotRow<SeriesType>, colorer: SeriesBarColorer<'Bar'>): BarItem {\n\t\treturn {\n\t\t\t...this._createDefaultItem(time, bar, colorer),\n\t\t\t...colorer.barStyle(time),\n\t\t};\n\t}\n\n\tprotected _prepareRendererData(): void {\n\t\tconst barStyleProps = this._series.options();\n\n\t\tthis._renderer.setData({\n\t\t\tbars: this._items,\n\t\t\tbarSpacing: this._model.timeScale().barSpacing(),\n\t\t\topenVisible: barStyleProps.openVisible,\n\t\t\tthinBars: barStyleProps.thinBars,\n\t\t\tvisibleRange: this._itemsVisibleRange,\n\t\t});\n\t}\n}\n","import { BitmapCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { Coordinate } from '../model/coordinate';\nimport { BaselineFillColorerStyle } from '../model/series-bar-colorer';\n\nimport { AreaFillItemBase, PaneRendererAreaBase, PaneRendererAreaDataBase } from './area-renderer-base';\nimport { GradientStyleCache } from './gradient-style-cache';\n\nexport type BaselineFillItem = AreaFillItemBase & BaselineFillColorerStyle;\nexport interface PaneRendererBaselineData extends PaneRendererAreaDataBase<BaselineFillItem> {\n}\nexport class PaneRendererBaselineArea extends PaneRendererAreaBase<PaneRendererBaselineData> {\n\tprivate readonly _fillCache: GradientStyleCache = new GradientStyleCache();\n\n\tprotected override _fillStyle(renderingScope: BitmapCoordinatesRenderingScope, item: BaselineFillItem): CanvasRenderingContext2D['fillStyle'] {\n\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\tconst data = this._data!;\n\n\t\treturn this._fillCache.get(\n\t\t\trenderingScope,\n\t\t\t{\n\t\t\t\ttopColor1: item.topFillColor1,\n\t\t\t\ttopColor2: item.topFillColor2,\n\t\t\t\tbottomColor1: item.bottomFillColor1,\n\t\t\t\tbottomColor2: item.bottomFillColor2,\n\t\t\t\tbottom: renderingScope.bitmapSize.height as Coordinate,\n\t\t\t\tbaseLevelCoordinate: data.baseLevelCoordinate,\n\t\t\t}\n\t\t);\n\t}\n}\n","import { BitmapCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { Coordinate } from '../model/coordinate';\nimport { BaselineStrokeColorerStyle } from '../model/series-bar-colorer';\n\nimport { GradientStyleCache } from './gradient-style-cache';\nimport { LineItemBase as LineStrokeItemBase, PaneRendererLineBase, PaneRendererLineDataBase } from './line-renderer-base';\n\nexport type BaselineStrokeItem = LineStrokeItemBase & BaselineStrokeColorerStyle;\nexport interface PaneRendererBaselineLineData extends PaneRendererLineDataBase<BaselineStrokeItem> {\n\tbaseLevelCoordinate: Coordinate;\n}\n\nexport class PaneRendererBaselineLine extends PaneRendererLineBase<PaneRendererBaselineLineData> {\n\tprivate readonly _strokeCache: GradientStyleCache = new GradientStyleCache();\n\n\tprotected override _strokeStyle(renderingScope: BitmapCoordinatesRenderingScope, item: BaselineStrokeItem): CanvasRenderingContext2D['strokeStyle'] {\n\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\tconst data = this._data!;\n\n\t\treturn this._strokeCache.get(\n\t\t\trenderingScope,\n\t\t\t{\n\t\t\t\ttopColor1: item.topLineColor,\n\t\t\t\ttopColor2: item.topLineColor,\n\t\t\t\tbottomColor1: item.bottomLineColor,\n\t\t\t\tbottomColor2: item.bottomLineColor,\n\t\t\t\tbottom: renderingScope.bitmapSize.height as Coordinate,\n\t\t\t\tbaseLevelCoordinate: data.baseLevelCoordinate,\n\t\t\t}\n\t\t);\n\t}\n}\n","import { BarPrice } from '../../model/bar';\nimport { IChartModelBase } from '../../model/chart-model';\nimport { ISeries } from '../../model/series';\nimport { ISeriesBarColorer } from '../../model/series-bar-colorer';\nimport { TimePointIndex } from '../../model/time-data';\nimport { BaselineFillItem, PaneRendererBaselineArea } from '../../renderers/baseline-renderer-area';\nimport { BaselineStrokeItem, PaneRendererBaselineLine } from '../../renderers/baseline-renderer-line';\nimport { CompositeRenderer } from '../../renderers/composite-renderer';\n\nimport { LinePaneViewBase } from './line-pane-view-base';\n\nexport class SeriesBaselinePaneView extends LinePaneViewBase<'Baseline', BaselineFillItem & BaselineStrokeItem, CompositeRenderer> {\n\tprotected readonly _renderer: CompositeRenderer = new CompositeRenderer();\n\tprivate readonly _baselineAreaRenderer: PaneRendererBaselineArea = new PaneRendererBaselineArea();\n\tprivate readonly _baselineLineRenderer: PaneRendererBaselineLine = new PaneRendererBaselineLine();\n\n\tpublic constructor(series: ISeries<'Baseline'>, model: IChartModelBase) {\n\t\tsuper(series, model);\n\t\tthis._renderer.setRenderers([this._baselineAreaRenderer, this._baselineLineRenderer]);\n\t}\n\n\tprotected _createRawItem(time: TimePointIndex, price: BarPrice, colorer: ISeriesBarColorer<'Baseline'>): BaselineFillItem & BaselineStrokeItem {\n\t\treturn {\n\t\t\t...this._createRawItemBase(time, price),\n\t\t\t...colorer.barStyle(time),\n\t\t};\n\t}\n\n\tprotected _prepareRendererData(): void {\n\t\tconst firstValue = this._series.firstValue();\n\t\tif (firstValue === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst options = this._series.options();\n\n\t\tconst baseLevelCoordinate = this._series.priceScale().priceToCoordinate(options.baseValue.price, firstValue.value);\n\t\tconst barWidth = this._model.timeScale().barSpacing();\n\n\t\tthis._baselineAreaRenderer.setData({\n\t\t\titems: this._items,\n\n\t\t\tlineWidth: options.lineWidth,\n\t\t\tlineStyle: options.lineStyle,\n\t\t\tlineType: options.lineType,\n\n\t\t\tbaseLevelCoordinate,\n\t\t\tinvertFilledArea: false,\n\n\t\t\tvisibleRange: this._itemsVisibleRange,\n\t\t\tbarWidth,\n\t\t});\n\n\t\tthis._baselineLineRenderer.setData({\n\t\t\titems: this._items,\n\n\t\t\tlineWidth: options.lineWidth,\n\t\t\tlineStyle: options.lineStyle,\n\t\t\tlineType: options.lineVisible ? options.lineType : undefined,\n\t\t\tpointMarkersRadius: options.pointMarkersVisible ? (options.pointMarkersRadius || options.lineWidth / 2 + 2) : undefined,\n\n\t\t\tbaseLevelCoordinate,\n\n\t\t\tvisibleRange: this._itemsVisibleRange,\n\t\t\tbarWidth,\n\t\t});\n\t}\n}\n","import { BitmapCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { fillRectInnerBorder } from '../helpers/canvas-helpers';\n\nimport { CandlesticksColorerStyle } from '../model/series-bar-colorer';\nimport { SeriesItemsIndexesRange } from '../model/time-data';\n\nimport { BarCandlestickItemBase } from './bars-renderer';\nimport { BitmapCoordinatesPaneRenderer } from './bitmap-coordinates-pane-renderer';\nimport { optimalCandlestickWidth } from './optimal-bar-width';\n\nexport interface CandlestickItem extends BarCandlestickItemBase, CandlesticksColorerStyle {\n}\n\nexport interface PaneRendererCandlesticksData {\n\tbars: readonly CandlestickItem[];\n\n\tbarSpacing: number;\n\n\twickVisible: boolean;\n\tborderVisible: boolean;\n\n\tvisibleRange: SeriesItemsIndexesRange | null;\n}\n\nconst enum Constants {\n\tBarBorderWidth = 1,\n}\n\nexport class PaneRendererCandlesticks extends BitmapCoordinatesPaneRenderer {\n\tprivate _data: PaneRendererCandlesticksData | null = null;\n\n\t// scaled with pixelRatio\n\tprivate _barWidth: number = 0;\n\n\tpublic setData(data: PaneRendererCandlesticksData): void {\n\t\tthis._data = data;\n\t}\n\n\tprotected override _drawImpl(renderingScope: BitmapCoordinatesRenderingScope): void {\n\t\tif (this._data === null || this._data.bars.length === 0 || this._data.visibleRange === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { horizontalPixelRatio } = renderingScope;\n\n\t\t// now we know pixelRatio and we could calculate barWidth effectively\n\t\tthis._barWidth = optimalCandlestickWidth(this._data.barSpacing, horizontalPixelRatio);\n\n\t\t// grid and crosshair have line width = Math.floor(pixelRatio)\n\t\t// if this value is odd, we have to make candlesticks' width odd\n\t\t// if this value is even, we have to make candlesticks' width even\n\t\t// in order of keeping crosshair-over-candlesticks drawing symmetric\n\t\tif (this._barWidth >= 2) {\n\t\t\tconst wickWidth = Math.floor(horizontalPixelRatio);\n\t\t\tif ((wickWidth % 2) !== (this._barWidth % 2)) {\n\t\t\t\tthis._barWidth--;\n\t\t\t}\n\t\t}\n\n\t\tconst bars = this._data.bars;\n\t\tif (this._data.wickVisible) {\n\t\t\tthis._drawWicks(renderingScope, bars, this._data.visibleRange);\n\t\t}\n\n\t\tif (this._data.borderVisible) {\n\t\t\tthis._drawBorder(renderingScope, bars, this._data.visibleRange);\n\t\t}\n\n\t\tconst borderWidth = this._calculateBorderWidth(horizontalPixelRatio);\n\n\t\tif (!this._data.borderVisible || this._barWidth > borderWidth * 2) {\n\t\t\tthis._drawCandles(renderingScope, bars, this._data.visibleRange);\n\t\t}\n\t}\n\n\tprivate _drawWicks(renderingScope: BitmapCoordinatesRenderingScope, bars: readonly CandlestickItem[], visibleRange: SeriesItemsIndexesRange): void {\n\t\tif (this._data === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { context: ctx, horizontalPixelRatio, verticalPixelRatio } = renderingScope;\n\n\t\tlet prevWickColor = '';\n\t\tlet wickWidth = Math.min(\n\t\t\tMath.floor(horizontalPixelRatio),\n\t\t\tMath.floor(this._data.barSpacing * horizontalPixelRatio)\n\t\t);\n\t\twickWidth = Math.max(\n\t\t\tMath.floor(horizontalPixelRatio),\n\t\t\tMath.min(wickWidth, this._barWidth)\n\t\t);\n\t\tconst wickOffset = Math.floor(wickWidth * 0.5);\n\n\t\tlet prevEdge: number | null = null;\n\n\t\tfor (let i = visibleRange.from; i < visibleRange.to; i++) {\n\t\t\tconst bar = bars[i];\n\t\t\tif (bar.barWickColor !== prevWickColor) {\n\t\t\t\tctx.fillStyle = bar.barWickColor;\n\t\t\t\tprevWickColor = bar.barWickColor;\n\t\t\t}\n\n\t\t\tconst top = Math.round(Math.min(bar.openY, bar.closeY) * verticalPixelRatio);\n\t\t\tconst bottom = Math.round(Math.max(bar.openY, bar.closeY) * verticalPixelRatio);\n\n\t\t\tconst high = Math.round(bar.highY * verticalPixelRatio);\n\t\t\tconst low = Math.round(bar.lowY * verticalPixelRatio);\n\n\t\t\tconst scaledX = Math.round(horizontalPixelRatio * bar.x);\n\n\t\t\tlet left = scaledX - wickOffset;\n\t\t\tconst right = left + wickWidth - 1;\n\t\t\tif (prevEdge !== null) {\n\t\t\t\tleft = Math.max(prevEdge + 1, left);\n\t\t\t\tleft = Math.min(left, right);\n\t\t\t}\n\t\t\tconst width = right - left + 1;\n\n\t\t\tctx.fillRect(left, high, width, top - high);\n\t\t\tctx.fillRect(left, bottom + 1, width, low - bottom);\n\n\t\t\tprevEdge = right;\n\t\t}\n\t}\n\n\tprivate _calculateBorderWidth(pixelRatio: number): number {\n\t\tlet borderWidth = Math.floor(Constants.BarBorderWidth * pixelRatio);\n\t\tif (this._barWidth <= 2 * borderWidth) {\n\t\t\tborderWidth = Math.floor((this._barWidth - 1) * 0.5);\n\t\t}\n\t\tconst res = Math.max(Math.floor(pixelRatio), borderWidth);\n\t\tif (this._barWidth <= res * 2) {\n\t\t\t// do not draw bodies, restore original value\n\t\t\treturn Math.max(Math.floor(pixelRatio), Math.floor(Constants.BarBorderWidth * pixelRatio));\n\t\t}\n\t\treturn res;\n\t}\n\n\tprivate _drawBorder(renderingScope: BitmapCoordinatesRenderingScope, bars: readonly CandlestickItem[], visibleRange: SeriesItemsIndexesRange): void {\n\t\tif (this._data === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { context: ctx, horizontalPixelRatio, verticalPixelRatio } = renderingScope;\n\n\t\tlet prevBorderColor: string | undefined = '';\n\t\tconst borderWidth = this._calculateBorderWidth(horizontalPixelRatio);\n\n\t\tlet prevEdge: number | null = null;\n\n\t\tfor (let i = visibleRange.from; i < visibleRange.to; i++) {\n\t\t\tconst bar = bars[i];\n\t\t\tif (bar.barBorderColor !== prevBorderColor) {\n\t\t\t\tctx.fillStyle = bar.barBorderColor;\n\t\t\t\tprevBorderColor = bar.barBorderColor;\n\t\t\t}\n\n\t\t\tlet left = Math.round(bar.x * horizontalPixelRatio) - Math.floor(this._barWidth * 0.5);\n\t\t\t// this is important to calculate right before patching left\n\t\t\tconst right = left + this._barWidth - 1;\n\n\t\t\tconst top = Math.round(Math.min(bar.openY, bar.closeY) * verticalPixelRatio);\n\t\t\tconst bottom = Math.round(Math.max(bar.openY, bar.closeY) * verticalPixelRatio);\n\n\t\t\tif (prevEdge !== null) {\n\t\t\t\tleft = Math.max(prevEdge + 1, left);\n\t\t\t\tleft = Math.min(left, right);\n\t\t\t}\n\t\t\tif (this._data.barSpacing * horizontalPixelRatio > 2 * borderWidth) {\n\t\t\t\tfillRectInnerBorder(ctx, left, top, right - left + 1, bottom - top + 1, borderWidth);\n\t\t\t} else {\n\t\t\t\tconst width = right - left + 1;\n\t\t\t\tctx.fillRect(left, top, width, bottom - top + 1);\n\t\t\t}\n\t\t\tprevEdge = right;\n\t\t}\n\t}\n\n\tprivate _drawCandles(renderingScope: BitmapCoordinatesRenderingScope, bars: readonly CandlestickItem[], visibleRange: SeriesItemsIndexesRange): void {\n\t\tif (this._data === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { context: ctx, horizontalPixelRatio, verticalPixelRatio } = renderingScope;\n\n\t\tlet prevBarColor = '';\n\t\tconst borderWidth = this._calculateBorderWidth(horizontalPixelRatio);\n\n\t\tfor (let i = visibleRange.from; i < visibleRange.to; i++) {\n\t\t\tconst bar = bars[i];\n\n\t\t\tlet top = Math.round(Math.min(bar.openY, bar.closeY) * verticalPixelRatio);\n\t\t\tlet bottom = Math.round(Math.max(bar.openY, bar.closeY) * verticalPixelRatio);\n\n\t\t\tlet left = Math.round(bar.x * horizontalPixelRatio) - Math.floor(this._barWidth * 0.5);\n\t\t\tlet right = left + this._barWidth - 1;\n\n\t\t\tif (bar.barColor !== prevBarColor) {\n\t\t\t\tconst barColor = bar.barColor;\n\t\t\t\tctx.fillStyle = barColor;\n\t\t\t\tprevBarColor = barColor;\n\t\t\t}\n\n\t\t\tif (this._data.borderVisible) {\n\t\t\t\tleft += borderWidth;\n\t\t\t\ttop += borderWidth;\n\t\t\t\tright -= borderWidth;\n\t\t\t\tbottom -= borderWidth;\n\t\t\t}\n\n\t\t\tif (top > bottom) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tctx.fillRect(left, top, right - left + 1, bottom - top + 1);\n\t\t}\n\t}\n}\n","import { SeriesBarColorer } from '../../model/series-bar-colorer';\nimport { SeriesPlotRow } from '../../model/series-data';\nimport { TimePointIndex } from '../../model/time-data';\nimport {\n\tCandlestickItem,\n\tPaneRendererCandlesticks,\n} from '../../renderers/candlesticks-renderer';\n\nimport { BarsPaneViewBase } from './bars-pane-view-base';\n\nexport class SeriesCandlesticksPaneView extends BarsPaneViewBase<'Candlestick', CandlestickItem, PaneRendererCandlesticks> {\n\tprotected readonly _renderer: PaneRendererCandlesticks = new PaneRendererCandlesticks();\n\n\tprotected _createRawItem(time: TimePointIndex, bar: SeriesPlotRow<'Candlestick'>, colorer: SeriesBarColorer<'Candlestick'>): CandlestickItem {\n\t\treturn {\n\t\t\t...this._createDefaultItem(time, bar, colorer),\n\t\t\t...colorer.barStyle(time),\n\t\t};\n\t}\n\n\tprotected _prepareRendererData(): void {\n\t\tconst candlestickStyleProps = this._series.options();\n\n\t\tthis._renderer.setData({\n\t\t\tbars: this._items,\n\t\t\tbarSpacing: this._model.timeScale().barSpacing(),\n\t\t\twickVisible: candlestickStyleProps.wickVisible,\n\t\t\tborderVisible: candlestickStyleProps.borderVisible,\n\t\t\tvisibleRange: this._itemsVisibleRange,\n\t\t});\n\t}\n}\n","import { CanvasRenderingTarget2D } from 'fancy-canvas';\n\nimport { undefinedIfNull } from '../../helpers/strict-type-checks';\n\nimport { IChartModelBase } from '../../model/chart-model';\nimport { Coordinate } from '../../model/coordinate';\nimport {\n\tCustomBarItemData,\n\tCustomData,\n\tCustomSeriesPricePlotValues,\n\tCustomSeriesWhitespaceData,\n\tICustomSeriesPaneRenderer,\n\tICustomSeriesPaneView,\n\tPriceToCoordinateConverter,\n} from '../../model/icustom-series';\nimport { PriceScale } from '../../model/price-scale';\nimport { Series } from '../../model/series';\nimport { SeriesPlotRow } from '../../model/series-data';\nimport { TimedValue } from '../../model/time-data';\nimport { ITimeScale } from '../../model/time-scale';\nimport { IPaneRenderer } from '../../renderers/ipane-renderer';\n\nimport { SeriesPaneViewBase } from './series-pane-view-base';\n\ntype CustomBarItemBase = TimedValue;\n\ninterface CustomBarItem extends CustomBarItemBase {\n\tbarColor: string;\n\toriginalData?: Record<string, unknown>;\n}\n\nclass CustomSeriesPaneRendererWrapper implements IPaneRenderer {\n\tprivate _sourceRenderer: ICustomSeriesPaneRenderer;\n\tprivate _priceScale: PriceToCoordinateConverter;\n\tpublic constructor(\n\t\tsourceRenderer: ICustomSeriesPaneRenderer,\n\t\tpriceScale: PriceToCoordinateConverter\n\t) {\n\t\tthis._sourceRenderer = sourceRenderer;\n\t\tthis._priceScale = priceScale;\n\t}\n\n\tpublic draw(\n\t\ttarget: CanvasRenderingTarget2D,\n\t\tisHovered: boolean,\n\t\thitTestData?: unknown\n\t): void {\n\t\tthis._sourceRenderer.draw(target, this._priceScale, isHovered, hitTestData);\n\t}\n}\n\nexport class SeriesCustomPaneView extends SeriesPaneViewBase<\n\t'Custom',\n\tCustomBarItem,\n\tCustomSeriesPaneRendererWrapper\n> {\n\tprotected readonly _renderer: CustomSeriesPaneRendererWrapper;\n\tprivate readonly _paneView: ICustomSeriesPaneView<unknown>;\n\n\tpublic constructor(\n\t\tseries: Series<'Custom'>,\n\t\tmodel: IChartModelBase,\n\t\tpaneView: ICustomSeriesPaneView<unknown>\n\t) {\n\t\tsuper(series, model, false);\n\t\tthis._paneView = paneView;\n\t\tthis._renderer = new CustomSeriesPaneRendererWrapper(\n\t\t\tthis._paneView.renderer(),\n\t\t\t(price: number) => {\n\t\t\t\tconst firstValue = series.firstValue();\n\t\t\t\tif (firstValue === null) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\treturn series.priceScale().priceToCoordinate(price, firstValue.value);\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic priceValueBuilder(plotRow: CustomData<unknown> | CustomSeriesWhitespaceData<unknown>): CustomSeriesPricePlotValues {\n\t\treturn this._paneView.priceValueBuilder(plotRow);\n\t}\n\n\tpublic isWhitespace(data: CustomData<unknown> | CustomSeriesWhitespaceData<unknown>): data is CustomSeriesWhitespaceData<unknown> {\n\t\treturn this._paneView.isWhitespace(data);\n\t}\n\n\tprotected _fillRawPoints(): void {\n\t\tconst colorer = this._series.barColorer();\n\t\tthis._items = this._series\n\t\t\t.bars()\n\t\t\t.rows()\n\t\t\t.map((row: SeriesPlotRow<'Custom'>) => {\n\t\t\t\treturn {\n\t\t\t\t\ttime: row.index,\n\t\t\t\t\tx: NaN as Coordinate,\n\t\t\t\t\t...colorer.barStyle(row.index),\n\t\t\t\t\toriginalData: row.data,\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\tprotected override _convertToCoordinates(\n\t\tpriceScale: PriceScale,\n\t\ttimeScale: ITimeScale\n\t): void {\n\t\ttimeScale.indexesToCoordinates(\n\t\t\tthis._items,\n\t\t\tundefinedIfNull(this._itemsVisibleRange)\n\t\t);\n\t}\n\n\tprotected _prepareRendererData(): void {\n\t\tthis._paneView.update(\n\t\t\t{\n\t\t\t\tbars: this._items.map(unwrapItemData) as CustomBarItemData<unknown>[],\n\t\t\t\tbarSpacing: this._model.timeScale().barSpacing(),\n\t\t\t\tvisibleRange: this._itemsVisibleRange,\n\t\t\t},\n\t\t\tthis._series.options()\n\t\t);\n\t}\n}\n\nfunction unwrapItemData(\n\titem: CustomBarItem\n): Record<keyof CustomBarItem, unknown> {\n\treturn {\n\t\tx: item.x,\n\t\ttime: item.time,\n\t\toriginalData: item.originalData,\n\t\tbarColor: item.barColor,\n\t};\n}\n","import { BitmapCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { PricedValue } from '../model/price-scale';\nimport { SeriesItemsIndexesRange, TimedValue, TimePointIndex } from '../model/time-data';\n\nimport { BitmapCoordinatesPaneRenderer } from './bitmap-coordinates-pane-renderer';\n\nconst showSpacingMinimalBarWidth = 1;\nconst alignToMinimalWidthLimit = 4;\n\nexport interface HistogramItem extends PricedValue, TimedValue {\n\tbarColor: string;\n}\n\nexport interface PaneRendererHistogramData {\n\titems: HistogramItem[];\n\n\tbarSpacing: number;\n\thistogramBase: number;\n\n\tvisibleRange: SeriesItemsIndexesRange | null;\n}\n\ninterface PrecalculatedItemCoordinates {\n\tleft: number;\n\tright: number;\n\troundedCenter: number;\n\tcenter: number;\n\ttime: TimePointIndex;\n}\n\nexport class PaneRendererHistogram extends BitmapCoordinatesPaneRenderer {\n\tprivate _data: PaneRendererHistogramData | null = null;\n\tprivate _precalculatedCache: PrecalculatedItemCoordinates[] = [];\n\n\tpublic setData(data: PaneRendererHistogramData): void {\n\t\tthis._data = data;\n\t\tthis._precalculatedCache = [];\n\t}\n\n\tprotected override _drawImpl({ context: ctx, horizontalPixelRatio, verticalPixelRatio }: BitmapCoordinatesRenderingScope): void {\n\t\tif (this._data === null || this._data.items.length === 0 || this._data.visibleRange === null) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this._precalculatedCache.length) {\n\t\t\tthis._fillPrecalculatedCache(horizontalPixelRatio);\n\t\t}\n\n\t\tconst tickWidth = Math.max(1, Math.floor(verticalPixelRatio));\n\t\tconst histogramBase = Math.round((this._data.histogramBase) * verticalPixelRatio);\n\t\tconst topHistogramBase = histogramBase - Math.floor(tickWidth / 2);\n\t\tconst bottomHistogramBase = topHistogramBase + tickWidth;\n\n\t\tfor (let i = this._data.visibleRange.from; i < this._data.visibleRange.to; i++) {\n\t\t\tconst item = this._data.items[i];\n\t\t\tconst current = this._precalculatedCache[i - this._data.visibleRange.from];\n\t\t\tconst y = Math.round(item.y * verticalPixelRatio);\n\t\t\tctx.fillStyle = item.barColor;\n\n\t\t\tlet top: number;\n\t\t\tlet bottom: number;\n\n\t\t\tif (y <= topHistogramBase) {\n\t\t\t\ttop = y;\n\t\t\t\tbottom = bottomHistogramBase;\n\t\t\t} else {\n\t\t\t\ttop = topHistogramBase;\n\t\t\t\tbottom = y - Math.floor(tickWidth / 2) + tickWidth;\n\t\t\t}\n\n\t\t\tctx.fillRect(current.left, top, current.right - current.left + 1, bottom - top);\n\t\t}\n\t}\n\n\t// eslint-disable-next-line complexity\n\tprivate _fillPrecalculatedCache(pixelRatio: number): void {\n\t\tif (this._data === null || this._data.items.length === 0 || this._data.visibleRange === null) {\n\t\t\tthis._precalculatedCache = [];\n\t\t\treturn;\n\t\t}\n\t\tconst spacing = Math.ceil(this._data.barSpacing * pixelRatio) <= showSpacingMinimalBarWidth ? 0 : Math.max(1, Math.floor(pixelRatio));\n\t\tconst columnWidth = Math.round(this._data.barSpacing * pixelRatio) - spacing;\n\n\t\tthis._precalculatedCache = new Array(this._data.visibleRange.to - this._data.visibleRange.from);\n\n\t\tfor (let i = this._data.visibleRange.from; i < this._data.visibleRange.to; i++) {\n\t\t\tconst item = this._data.items[i];\n\t\t\t// force cast to avoid ensureDefined call\n\t\t\tconst x = Math.round(item.x * pixelRatio);\n\t\t\tlet left: number;\n\t\t\tlet right: number;\n\n\t\t\tif (columnWidth % 2) {\n\t\t\t\tconst halfWidth = (columnWidth - 1) / 2;\n\t\t\t\tleft = x - halfWidth;\n\t\t\t\tright = x + halfWidth;\n\t\t\t} else {\n\t\t\t\t// shift pixel to left\n\t\t\t\tconst halfWidth = columnWidth / 2;\n\t\t\t\tleft = x - halfWidth;\n\t\t\t\tright = x + halfWidth - 1;\n\t\t\t}\n\t\t\tthis._precalculatedCache[i - this._data.visibleRange.from] = {\n\t\t\t\tleft,\n\t\t\t\tright,\n\t\t\t\troundedCenter: x,\n\t\t\t\tcenter: (item.x * pixelRatio),\n\t\t\t\ttime: item.time,\n\t\t\t};\n\t\t}\n\n\t\t// correct positions\n\t\tfor (let i = this._data.visibleRange.from + 1; i < this._data.visibleRange.to; i++) {\n\t\t\tconst current = this._precalculatedCache[i - this._data.visibleRange.from];\n\t\t\tconst prev = this._precalculatedCache[i - this._data.visibleRange.from - 1];\n\t\t\tif (current.time !== prev.time + 1) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (current.left - prev.right !== (spacing + 1)) {\n\t\t\t\t// have to align\n\t\t\t\tif (prev.roundedCenter > prev.center) {\n\t\t\t\t\t// prev wasshifted to left, so add pixel to right\n\t\t\t\t\tprev.right = current.left - spacing - 1;\n\t\t\t\t} else {\n\t\t\t\t\t// extend current to left\n\t\t\t\t\tcurrent.left = prev.right + spacing + 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet minWidth = Math.ceil(this._data.barSpacing * pixelRatio);\n\t\tfor (let i = this._data.visibleRange.from; i < this._data.visibleRange.to; i++) {\n\t\t\tconst current = this._precalculatedCache[i - this._data.visibleRange.from];\n\t\t\t// this could happen if barspacing < 1\n\t\t\tif (current.right < current.left) {\n\t\t\t\tcurrent.right = current.left;\n\t\t\t}\n\t\t\tconst width = current.right - current.left + 1;\n\t\t\tminWidth = Math.min(width, minWidth);\n\t\t}\n\n\t\tif (spacing > 0 && minWidth < alignToMinimalWidthLimit) {\n\t\t\tfor (let i = this._data.visibleRange.from; i < this._data.visibleRange.to; i++) {\n\t\t\t\tconst current = this._precalculatedCache[i - this._data.visibleRange.from];\n\t\t\t\tconst width = current.right - current.left + 1;\n\t\t\t\tif (width > minWidth) {\n\t\t\t\t\tif (current.roundedCenter > current.center) {\n\t\t\t\t\t\tcurrent.right -= 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurrent.left += 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","import { ensureNotNull } from '../../helpers/assertions';\n\nimport { BarPrice } from '../../model/bar';\nimport { ISeriesBarColorer } from '../../model/series-bar-colorer';\nimport { TimePointIndex } from '../../model/time-data';\nimport { HistogramItem, PaneRendererHistogram, PaneRendererHistogramData } from '../../renderers/histogram-renderer';\n\nimport { LinePaneViewBase } from './line-pane-view-base';\n\nexport class SeriesHistogramPaneView extends LinePaneViewBase<'Histogram', HistogramItem, PaneRendererHistogram> {\n\tprotected readonly _renderer: PaneRendererHistogram = new PaneRendererHistogram();\n\n\tprotected _createRawItem(time: TimePointIndex, price: BarPrice, colorer: ISeriesBarColorer<'Histogram'>): HistogramItem {\n\t\treturn {\n\t\t\t...this._createRawItemBase(time, price),\n\t\t\t...colorer.barStyle(time),\n\t\t};\n\t}\n\n\tprotected _prepareRendererData(): void {\n\t\tconst data: PaneRendererHistogramData = {\n\t\t\titems: this._items,\n\t\t\tbarSpacing: this._model.timeScale().barSpacing(),\n\t\t\tvisibleRange: this._itemsVisibleRange,\n\t\t\thistogramBase: this._series.priceScale().priceToCoordinate(this._series.options().base, ensureNotNull(this._series.firstValue()).value),\n\t\t};\n\n\t\tthis._renderer.setData(data);\n\t}\n}\n","import { BarPrice } from '../../model/bar';\nimport { ISeriesBarColorer } from '../../model/series-bar-colorer';\nimport { TimePointIndex } from '../../model/time-data';\nimport { LineStrokeItem, PaneRendererLine, PaneRendererLineData } from '../../renderers/line-renderer';\n\nimport { LinePaneViewBase } from './line-pane-view-base';\n\nexport class SeriesLinePaneView extends LinePaneViewBase<'Line', LineStrokeItem, PaneRendererLine> {\n\tprotected readonly _renderer: PaneRendererLine = new PaneRendererLine();\n\n\tprotected _createRawItem(time: TimePointIndex, price: BarPrice, colorer: ISeriesBarColorer<'Line'>): LineStrokeItem {\n\t\treturn {\n\t\t\t...this._createRawItemBase(time, price),\n\t\t\t...colorer.barStyle(time),\n\t\t};\n\t}\n\n\tprotected _prepareRendererData(): void {\n\t\tconst options = this._series.options();\n\n\t\tconst data: PaneRendererLineData = {\n\t\t\titems: this._items,\n\t\t\tlineStyle: options.lineStyle,\n\t\t\tlineType: options.lineVisible ? options.lineType : undefined,\n\t\t\tlineWidth: options.lineWidth,\n\t\t\tpointMarkersRadius: options.pointMarkersVisible ? (options.pointMarkersRadius || options.lineWidth / 2 + 2) : undefined,\n\t\t\tvisibleRange: this._itemsVisibleRange,\n\t\t\tbarWidth: this._model.timeScale().barSpacing(),\n\t\t};\n\n\t\tthis._renderer.setData(data);\n\t}\n}\n","import { ensureDefined } from '../helpers/assertions';\n\nexport type CanvasCtxLike = Pick<CanvasRenderingContext2D, 'measureText' | 'save' | 'restore' | 'textBaseline'>;\n\nconst defaultReplacementRe = /[2-9]/g;\n\nexport class TextWidthCache {\n\tprivate readonly _maxSize: number;\n\tprivate _actualSize: number = 0;\n\tprivate _usageTick: number = 1;\n\tprivate _oldestTick: number = 1;\n\tprivate _tick2Labels: Record<number, string> = {};\n\tprivate _cache: Map<string, { metrics: TextMetrics; tick: number }> = new Map();\n\n\tpublic constructor(size: number = 50) {\n\t\tthis._maxSize = size;\n\t}\n\n\tpublic reset(): void {\n\t\tthis._actualSize = 0;\n\t\tthis._cache.clear();\n\t\tthis._usageTick = 1;\n\t\tthis._oldestTick = 1;\n\t\tthis._tick2Labels = {};\n\t}\n\n\tpublic measureText(ctx: CanvasCtxLike, text: string, optimizationReplacementRe?: RegExp): number {\n\t\treturn this._getMetrics(ctx, text, optimizationReplacementRe).width;\n\t}\n\n\tpublic yMidCorrection(ctx: CanvasCtxLike, text: string, optimizationReplacementRe?: RegExp): number {\n\t\tconst metrics = this._getMetrics(ctx, text, optimizationReplacementRe);\n\t\t// if actualBoundingBoxAscent/actualBoundingBoxDescent are not supported we use 0 as a fallback\n\t\treturn ((metrics.actualBoundingBoxAscent || 0) - (metrics.actualBoundingBoxDescent || 0)) / 2;\n\t}\n\n\tprivate _getMetrics(ctx: CanvasCtxLike, text: string, optimizationReplacementRe?: RegExp): TextMetrics {\n\t\tconst re = optimizationReplacementRe || defaultReplacementRe;\n\t\tconst cacheString = String(text).replace(re, '0');\n\n\t\tif (this._cache.has(cacheString)) {\n\t\t\treturn ensureDefined(this._cache.get(cacheString)).metrics;\n\t\t}\n\n\t\tif (this._actualSize === this._maxSize) {\n\t\t\tconst oldestValue = this._tick2Labels[this._oldestTick];\n\t\t\tdelete this._tick2Labels[this._oldestTick];\n\t\t\tthis._cache.delete(oldestValue);\n\t\t\tthis._oldestTick++;\n\t\t\tthis._actualSize--;\n\t\t}\n\n\t\tctx.save();\n\t\tctx.textBaseline = 'middle';\n\t\tconst metrics = ctx.measureText(cacheString);\n\t\tctx.restore();\n\n\t\tif (metrics.width === 0 && !!text.length) {\n\t\t\t// measureText can return 0 in FF depending on a canvas size, don't cache it\n\t\t\treturn metrics;\n\t\t}\n\n\t\tthis._cache.set(cacheString, { metrics: metrics, tick: this._usageTick });\n\t\tthis._tick2Labels[this._usageTick] = cacheString;\n\t\tthis._actualSize++;\n\t\tthis._usageTick++;\n\t\treturn metrics;\n\t}\n}\n","import { CanvasRenderingTarget2D } from 'fancy-canvas';\n\nimport { IChartModelBase } from '../../model/chart-model';\nimport { IPriceDataSource } from '../../model/iprice-data-source';\nimport { TextWidthCache } from '../../model/text-width-cache';\nimport { IPaneRenderer } from '../../renderers/ipane-renderer';\nimport { IPriceAxisViewRenderer, PriceAxisViewRendererOptions } from '../../renderers/iprice-axis-view-renderer';\n\nimport { IPriceAxisView } from '../price-axis/iprice-axis-view';\nimport { IPaneView } from './ipane-view';\n\nclass PanePriceAxisViewRenderer implements IPaneRenderer {\n\tprivate _priceAxisViewRenderer: IPriceAxisViewRenderer | null = null;\n\tprivate _rendererOptions: PriceAxisViewRendererOptions | null = null;\n\tprivate _align: 'left' | 'right' = 'right';\n\tprivate readonly _textWidthCache: TextWidthCache;\n\n\tpublic constructor(textWidthCache: TextWidthCache) {\n\t\tthis._textWidthCache = textWidthCache;\n\t}\n\n\tpublic setParams(\n\t\tpriceAxisViewRenderer: IPriceAxisViewRenderer,\n\t\trendererOptions: PriceAxisViewRendererOptions,\n\t\talign: 'left' | 'right'\n\t): void {\n\t\tthis._priceAxisViewRenderer = priceAxisViewRenderer;\n\t\tthis._rendererOptions = rendererOptions;\n\t\tthis._align = align;\n\t}\n\n\tpublic draw(target: CanvasRenderingTarget2D): void {\n\t\tif (this._rendererOptions === null || this._priceAxisViewRenderer === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._priceAxisViewRenderer.draw(target, this._rendererOptions, this._textWidthCache, this._align);\n\t}\n}\n\nexport class PanePriceAxisView implements IPaneView {\n\tprivate _priceAxisView: IPriceAxisView;\n\tprivate readonly _textWidthCache: TextWidthCache;\n\tprivate readonly _dataSource: IPriceDataSource;\n\tprivate readonly _chartModel: IChartModelBase;\n\tprivate readonly _renderer: PanePriceAxisViewRenderer;\n\tprivate _fontSize: number;\n\n\tpublic constructor(priceAxisView: IPriceAxisView, dataSource: IPriceDataSource, chartModel: IChartModelBase) {\n\t\tthis._priceAxisView = priceAxisView;\n\t\tthis._textWidthCache = new TextWidthCache(50); // when should we clear cache?\n\t\tthis._dataSource = dataSource;\n\t\tthis._chartModel = chartModel;\n\t\tthis._fontSize = -1;\n\t\tthis._renderer = new PanePriceAxisViewRenderer(this._textWidthCache);\n\t}\n\n\tpublic renderer(): IPaneRenderer | null {\n\t\tconst pane = this._chartModel.paneForSource(this._dataSource);\n\t\tif (pane === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// this price scale will be used to find label placement only (left, right, none)\n\t\tconst priceScale = pane.isOverlay(this._dataSource) ? pane.defaultVisiblePriceScale() : this._dataSource.priceScale();\n\t\tif (priceScale === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst position = pane.priceScalePosition(priceScale);\n\t\tif (position === 'overlay') {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst options = this._chartModel.priceAxisRendererOptions();\n\t\tif (options.fontSize !== this._fontSize) {\n\t\t\tthis._fontSize = options.fontSize;\n\t\t\tthis._textWidthCache.reset();\n\t\t}\n\n\t\tthis._renderer.setParams(this._priceAxisView.paneRenderer(), options, position);\n\t\treturn this._renderer;\n\t}\n}\n","import { BitmapCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { HoveredObject } from '../model/chart-model';\nimport { Coordinate } from '../model/coordinate';\n\nimport { BitmapCoordinatesPaneRenderer } from './bitmap-coordinates-pane-renderer';\nimport { drawHorizontalLine, LineStyle, LineWidth, setLineStyle } from './draw-line';\n\nexport interface HorizontalLineRendererData {\n\tcolor: string;\n\tlineStyle: LineStyle;\n\tlineWidth: LineWidth;\n\n\ty: Coordinate;\n\tvisible?: boolean;\n\texternalId?: string;\n}\n\nconst enum Constants { HitTestThreshold = 7, }\n\nexport class HorizontalLineRenderer extends BitmapCoordinatesPaneRenderer {\n\tprivate _data: HorizontalLineRendererData | null = null;\n\n\tpublic setData(data: HorizontalLineRendererData): void {\n\t\tthis._data = data;\n\t}\n\n\tpublic hitTest(x: Coordinate, y: Coordinate): HoveredObject | null {\n\t\tif (!this._data?.visible) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst { y: itemY, lineWidth, externalId } = this._data;\n\t\t// add a fixed area threshold around line (Y + width) for hit test\n\t\tif (y >= itemY - lineWidth - Constants.HitTestThreshold && y <= itemY + lineWidth + Constants.HitTestThreshold) {\n\t\t\treturn {\n\t\t\t\thitTestData: this._data,\n\t\t\t\texternalId: externalId,\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprotected _drawImpl({ context: ctx, bitmapSize, horizontalPixelRatio, verticalPixelRatio }: BitmapCoordinatesRenderingScope): void {\n\t\tif (this._data === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._data.visible === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst y = Math.round(this._data.y * verticalPixelRatio);\n\t\tif (y < 0 || y > bitmapSize.height) {\n\t\t\treturn;\n\t\t}\n\n\t\tctx.lineCap = 'butt';\n\t\tctx.strokeStyle = this._data.color;\n\t\tctx.lineWidth = Math.floor(this._data.lineWidth * horizontalPixelRatio);\n\t\tsetLineStyle(ctx, this._data.lineStyle);\n\t\tdrawHorizontalLine(ctx, y, 0, bitmapSize.width);\n\t}\n}\n","import { IChartModelBase } from '../../model/chart-model';\nimport { Coordinate } from '../../model/coordinate';\nimport { ISeries } from '../../model/series';\nimport { SeriesType } from '../../model/series-options';\nimport { LineStyle } from '../../renderers/draw-line';\nimport { HorizontalLineRenderer, HorizontalLineRendererData } from '../../renderers/horizontal-line-renderer';\nimport { IPaneRenderer } from '../../renderers/ipane-renderer';\n\nimport { IPaneView } from './ipane-view';\n\nexport abstract class SeriesHorizontalLinePaneView implements IPaneView {\n\tprotected readonly _lineRendererData: HorizontalLineRendererData = {\n\t\ty: 0 as Coordinate,\n\t\tcolor: 'rgba(0, 0, 0, 0)',\n\t\tlineWidth: 1,\n\t\tlineStyle: LineStyle.Solid,\n\t\tvisible: false,\n\t};\n\n\tprotected readonly _series: ISeries<SeriesType>;\n\tprotected readonly _model: IChartModelBase;\n\tprotected readonly _lineRenderer: HorizontalLineRenderer = new HorizontalLineRenderer();\n\tprivate _invalidated: boolean = true;\n\n\tprotected constructor(series: ISeries<SeriesType>) {\n\t\tthis._series = series;\n\t\tthis._model = series.model();\n\t\tthis._lineRenderer.setData(this._lineRendererData);\n\t}\n\n\tpublic update(): void {\n\t\tthis._invalidated = true;\n\t}\n\n\tpublic renderer(): IPaneRenderer | null {\n\t\tif (!this._series.visible()) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this._invalidated) {\n\t\t\tthis._updateImpl();\n\t\t\tthis._invalidated = false;\n\t\t}\n\t\treturn this._lineRenderer;\n\t}\n\n\tprotected abstract _updateImpl(): void;\n}\n","import { PriceScaleMode } from '../../model/price-scale';\nimport { ISeries } from '../../model/series';\nimport { SeriesType } from '../../model/series-options';\n\nimport { SeriesHorizontalLinePaneView } from './series-horizontal-line-pane-view';\n\nexport class SeriesHorizontalBaseLinePaneView extends SeriesHorizontalLinePaneView {\n\t// eslint-disable-next-line no-useless-constructor\n\tpublic constructor(series: ISeries<SeriesType>) {\n\t\tsuper(series);\n\t}\n\n\tprotected _updateImpl(): void {\n\t\tthis._lineRendererData.visible = false;\n\n\t\tconst priceScale = this._series.priceScale();\n\t\tconst mode = priceScale.mode().mode;\n\t\tif (mode !== PriceScaleMode.Percentage && mode !== PriceScaleMode.IndexedTo100) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst seriesOptions = this._series.options();\n\n\t\tif (!seriesOptions.baseLineVisible || !this._series.visible()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst firstValue = this._series.firstValue();\n\t\tif (firstValue === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._lineRendererData.visible = true;\n\t\tthis._lineRendererData.y = priceScale.priceToCoordinate(firstValue.value, firstValue.value);\n\t\tthis._lineRendererData.color = seriesOptions.baseLineColor;\n\t\tthis._lineRendererData.lineWidth = seriesOptions.baseLineWidth;\n\t\tthis._lineRendererData.lineStyle = seriesOptions.baseLineStyle;\n\t}\n}\n","import { BitmapCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { Point } from '../model/point';\n\nimport { BitmapCoordinatesPaneRenderer } from './bitmap-coordinates-pane-renderer';\n\nexport interface LastPriceCircleRendererData {\n\tradius: number;\n\tfillColor: string;\n\tstrokeColor: string;\n\tseriesLineColor: string;\n\tseriesLineWidth: number;\n\tcenter: Point;\n}\n\nexport class SeriesLastPriceAnimationRenderer extends BitmapCoordinatesPaneRenderer {\n\tprivate _data: LastPriceCircleRendererData | null = null;\n\n\tpublic setData(data: LastPriceCircleRendererData | null): void {\n\t\tthis._data = data;\n\t}\n\n\tpublic data(): LastPriceCircleRendererData | null {\n\t\treturn this._data;\n\t}\n\n\tprotected override _drawImpl({ context: ctx, horizontalPixelRatio, verticalPixelRatio }: BitmapCoordinatesRenderingScope): void {\n\t\tconst data = this._data;\n\t\tif (data === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst tickWidth = Math.max(1, Math.floor(horizontalPixelRatio));\n\n\t\tconst correction = (tickWidth % 2) / 2;\n\t\tconst centerX = Math.round(data.center.x * horizontalPixelRatio) + correction; // correct x coordinate only\n\t\tconst centerY = data.center.y * verticalPixelRatio;\n\n\t\tctx.fillStyle = data.seriesLineColor;\n\t\tctx.beginPath();\n\t\t// TODO: it is better to have different horizontal and vertical radii\n\t\tconst centerPointRadius = Math.max(2, data.seriesLineWidth * 1.5) * horizontalPixelRatio;\n\t\tctx.arc(centerX, centerY, centerPointRadius, 0, 2 * Math.PI, false);\n\t\tctx.fill();\n\n\t\tctx.fillStyle = data.fillColor;\n\t\tctx.beginPath();\n\t\tctx.arc(centerX, centerY, data.radius * horizontalPixelRatio, 0, 2 * Math.PI, false);\n\t\tctx.fill();\n\n\t\tctx.lineWidth = tickWidth;\n\t\tctx.strokeStyle = data.strokeColor;\n\t\tctx.beginPath();\n\t\tctx.arc(centerX, centerY, data.radius * horizontalPixelRatio + tickWidth / 2, 0, 2 * Math.PI, false);\n\t\tctx.stroke();\n\t}\n}\n","import { assert } from '../../helpers/assertions';\nimport { applyAlpha } from '../../helpers/color';\n\nimport { Point } from '../../model/point';\nimport { ISeries } from '../../model/series';\nimport { LastPriceAnimationMode } from '../../model/series-options';\nimport { IPaneRenderer } from '../../renderers/ipane-renderer';\nimport { SeriesLastPriceAnimationRenderer } from '../../renderers/series-last-price-animation-renderer';\n\nimport { IUpdatablePaneView } from './iupdatable-pane-view';\n\nconst enum Constants {\n\tAnimationPeriod = 2600,\n\n\tStage1Period = 0.25,\n\tStage2Period = 0.275,\n\tStage3Period = 0.475,\n\n\tStage1StartCircleRadius = 4,\n\tStage1EndCircleRadius = 10,\n\tStage1StartFillAlpha = 0.25,\n\tStage1EndFillAlpha = 0,\n\tStage1StartStrokeAlpha = 0.4,\n\tStage1EndStrokeAlpha = 0.8,\n\n\tStage2StartCircleRadius = Stage1EndCircleRadius,\n\tStage2EndCircleRadius = 14,\n\tStage2StartFillAlpha = Stage1EndFillAlpha,\n\tStage2EndFillAlpha = 0,\n\tStage2StartStrokeAlpha = Stage1EndStrokeAlpha,\n\tStage2EndStrokeAlpha = 0,\n\n\tStage3StartCircleRadius = Stage2EndCircleRadius,\n\tStage3EndCircleRadius = Stage2EndCircleRadius,\n\tStage3StartFillAlpha = Stage2EndFillAlpha,\n\tStage3EndFillAlpha = Stage2EndFillAlpha,\n\tStage3StartStrokeAlpha = Stage2EndStrokeAlpha,\n\tStage3EndStrokeAlpha = Stage2EndStrokeAlpha,\n}\n\ninterface AnimationStageData {\n\tstart: number;\n\tend: number;\n\tstartRadius: number;\n\tendRadius: number;\n\tstartFillAlpha: number;\n\tendFillAlpha: number;\n\tstartStrokeAlpha: number;\n\tendStrokeAlpha: number;\n}\n\nconst animationStagesData: AnimationStageData[] = [\n\t{\n\t\tstart: 0,\n\t\tend: Constants.Stage1Period,\n\t\tstartRadius: Constants.Stage1StartCircleRadius,\n\t\tendRadius: Constants.Stage1EndCircleRadius,\n\t\tstartFillAlpha: Constants.Stage1StartFillAlpha,\n\t\tendFillAlpha: Constants.Stage1EndFillAlpha,\n\t\tstartStrokeAlpha: Constants.Stage1StartStrokeAlpha,\n\t\tendStrokeAlpha: Constants.Stage1EndStrokeAlpha,\n\t},\n\t{\n\t\tstart: Constants.Stage1Period,\n\t\tend: Constants.Stage1Period + Constants.Stage2Period,\n\t\tstartRadius: Constants.Stage2StartCircleRadius,\n\t\tendRadius: Constants.Stage2EndCircleRadius,\n\t\tstartFillAlpha: Constants.Stage2StartFillAlpha,\n\t\tendFillAlpha: Constants.Stage2EndFillAlpha,\n\t\tstartStrokeAlpha: Constants.Stage2StartStrokeAlpha,\n\t\tendStrokeAlpha: Constants.Stage2EndStrokeAlpha,\n\t},\n\t{\n\t\tstart: Constants.Stage1Period + Constants.Stage2Period,\n\t\tend: Constants.Stage1Period + Constants.Stage2Period + Constants.Stage3Period,\n\t\tstartRadius: Constants.Stage3StartCircleRadius,\n\t\tendRadius: Constants.Stage3EndCircleRadius,\n\t\tstartFillAlpha: Constants.Stage3StartFillAlpha,\n\t\tendFillAlpha: Constants.Stage3EndFillAlpha,\n\t\tstartStrokeAlpha: Constants.Stage3StartStrokeAlpha,\n\t\tendStrokeAlpha: Constants.Stage3EndStrokeAlpha,\n\t},\n];\n\ninterface AnimationData {\n\tradius: number;\n\tfillColor: string;\n\tstrokeColor: string;\n}\n\nfunction color(seriesLineColor: string, stage: number, startAlpha: number, endAlpha: number): string {\n\tconst alpha = startAlpha + (endAlpha - startAlpha) * stage;\n\treturn applyAlpha(seriesLineColor, alpha);\n}\n\nfunction radius(stage: number, startRadius: number, endRadius: number): number {\n\treturn startRadius + (endRadius - startRadius) * stage;\n}\n\nfunction animationData(durationSinceStart: number, lineColor: string): AnimationData {\n\tconst globalStage = (durationSinceStart % Constants.AnimationPeriod) / Constants.AnimationPeriod;\n\n\tlet currentStageData: AnimationStageData | undefined;\n\n\tfor (const stageData of animationStagesData) {\n\t\tif (globalStage >= stageData.start && globalStage <= stageData.end) {\n\t\t\tcurrentStageData = stageData;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tassert(currentStageData !== undefined, 'Last price animation internal logic error');\n\n\tconst subStage = (globalStage - currentStageData.start) / (currentStageData.end - currentStageData.start);\n\treturn {\n\t\tfillColor: color(lineColor, subStage, currentStageData.startFillAlpha, currentStageData.endFillAlpha),\n\t\tstrokeColor: color(lineColor, subStage, currentStageData.startStrokeAlpha, currentStageData.endStrokeAlpha),\n\t\tradius: radius(subStage, currentStageData.startRadius, currentStageData.endRadius),\n\t};\n}\n\nexport class SeriesLastPriceAnimationPaneView implements IUpdatablePaneView {\n\tprivate readonly _series: ISeries<'Area'> | ISeries<'Line'> | ISeries<'Baseline'>;\n\tprivate readonly _renderer: SeriesLastPriceAnimationRenderer = new SeriesLastPriceAnimationRenderer();\n\tprivate _invalidated: boolean = true;\n\tprivate _stageInvalidated: boolean = true;\n\n\tprivate _startTime: number = performance.now();\n\tprivate _endTime: number = this._startTime - 1;\n\n\tpublic constructor(series: ISeries<'Area'> | ISeries<'Line'> | ISeries<'Baseline'>) {\n\t\tthis._series = series;\n\t}\n\n\tpublic onDataCleared(): void {\n\t\tthis._endTime = this._startTime - 1;\n\t\tthis.update();\n\t}\n\n\tpublic onNewRealtimeDataReceived(): void {\n\t\tthis.update();\n\t\tif (this._series.options().lastPriceAnimation === LastPriceAnimationMode.OnDataUpdate) {\n\t\t\tconst now = performance.now();\n\t\t\tconst timeToAnimationEnd = this._endTime - now;\n\t\t\tif (timeToAnimationEnd > 0) {\n\t\t\t\tif (timeToAnimationEnd < Constants.AnimationPeriod / 4) {\n\t\t\t\t\tthis._endTime += Constants.AnimationPeriod;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._startTime = now;\n\t\t\tthis._endTime = now + Constants.AnimationPeriod;\n\t\t}\n\t}\n\n\tpublic update(): void {\n\t\tthis._invalidated = true;\n\t}\n\n\tpublic invalidateStage(): void {\n\t\tthis._stageInvalidated = true;\n\t}\n\n\tpublic visible(): boolean {\n\t\t// center point is always visible if lastPriceAnimation is not LastPriceAnimationMode.Disabled\n\t\treturn this._series.options().lastPriceAnimation !== LastPriceAnimationMode.Disabled;\n\t}\n\n\tpublic animationActive(): boolean {\n\t\tswitch (this._series.options().lastPriceAnimation) {\n\t\t\tcase LastPriceAnimationMode.Disabled:\n\t\t\t\treturn false;\n\t\t\tcase LastPriceAnimationMode.Continuous:\n\t\t\t\treturn true;\n\t\t\tcase LastPriceAnimationMode.OnDataUpdate:\n\t\t\t\treturn performance.now() <= this._endTime;\n\t\t}\n\t}\n\n\tpublic renderer(): IPaneRenderer | null {\n\t\tif (this._invalidated) {\n\t\t\tthis._updateImpl();\n\t\t\tthis._invalidated = false;\n\t\t\tthis._stageInvalidated = false;\n\t\t} else if (this._stageInvalidated) {\n\t\t\tthis._updateRendererDataStage();\n\t\t\tthis._stageInvalidated = false;\n\t\t}\n\n\t\treturn this._renderer;\n\t}\n\n\tprivate _updateImpl(): void {\n\t\tthis._renderer.setData(null);\n\n\t\tconst timeScale = this._series.model().timeScale();\n\t\tconst visibleRange = timeScale.visibleStrictRange();\n\t\tconst firstValue = this._series.firstValue();\n\t\tif (visibleRange === null || firstValue === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst lastValue = this._series.lastValueData(true);\n\t\tif (lastValue.noData || !visibleRange.contains(lastValue.index)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst lastValuePoint: Point = {\n\t\t\tx: timeScale.indexToCoordinate(lastValue.index),\n\t\t\ty: this._series.priceScale().priceToCoordinate(lastValue.price, firstValue.value),\n\t\t};\n\n\t\tconst seriesLineColor = lastValue.color;\n\t\tconst seriesLineWidth = this._series.options().lineWidth;\n\n\t\tconst data = animationData(this._duration(), seriesLineColor);\n\n\t\tthis._renderer.setData({\n\t\t\tseriesLineColor,\n\t\t\tseriesLineWidth,\n\t\t\tfillColor: data.fillColor,\n\t\t\tstrokeColor: data.strokeColor,\n\t\t\tradius: data.radius,\n\t\t\tcenter: lastValuePoint,\n\t\t});\n\t}\n\n\tprivate _updateRendererDataStage(): void {\n\t\tconst rendererData = this._renderer.data();\n\t\tif (rendererData !== null) {\n\t\t\tconst data = animationData(this._duration(), rendererData.seriesLineColor);\n\t\t\trendererData.fillColor = data.fillColor;\n\t\t\trendererData.strokeColor = data.strokeColor;\n\t\t\trendererData.radius = data.radius;\n\t\t}\n\t}\n\n\tprivate _duration(): number {\n\t\treturn this.animationActive() ? performance.now() - this._startTime : Constants.AnimationPeriod - 1;\n\t}\n}\n","import { ceiledEven, ceiledOdd } from '../helpers/mathex';\n\nimport { SeriesMarkerShape } from '../model/series-markers';\n\nconst enum Constants {\n\tMinShapeSize = 12,\n\tMaxShapeSize = 30,\n\tMinShapeMargin = 3,\n}\n\nfunction size(barSpacing: number, coeff: number): number {\n\tconst result = Math.min(Math.max(barSpacing, Constants.MinShapeSize), Constants.MaxShapeSize) * coeff;\n\treturn ceiledOdd(result);\n}\n\nexport function shapeSize(shape: SeriesMarkerShape, originalSize: number): number {\n\tswitch (shape) {\n\t\tcase 'arrowDown':\n\t\tcase 'arrowUp':\n\t\t\treturn size(originalSize, 1);\n\t\tcase 'circle':\n\t\t\treturn size(originalSize, 0.8);\n\t\tcase 'square':\n\t\t\treturn size(originalSize, 0.7);\n\t}\n}\n\nexport function calculateShapeHeight(barSpacing: number): number {\n\treturn ceiledEven(size(barSpacing, 1));\n}\n\nexport function shapeMargin(barSpacing: number): number {\n\treturn Math.max(size(barSpacing, 0.1), Constants.MinShapeMargin);\n}\n\nexport interface BitmapShapeItemCoordinates {\n\tx: number;\n\ty: number;\n\tpixelRatio: number;\n}\n\nexport function calculateAdjustedMargin(margin: number, hasSide: boolean, hasInBar: boolean): number {\n\tif (hasSide) {\n\t\treturn margin;\n\t} else if (hasInBar) {\n\t\treturn Math.ceil(margin / 2);\n\t}\n\n\treturn 0;\n}\n","import { Coordinate } from '../model/coordinate';\n\nimport { BitmapShapeItemCoordinates, shapeSize } from './series-markers-utils';\n\nexport function drawSquare(\n\tctx: CanvasRenderingContext2D,\n\tcoords: BitmapShapeItemCoordinates,\n\tsize: number\n): void {\n\tconst squareSize = shapeSize('square', size);\n\tconst halfSize = ((squareSize - 1) * coords.pixelRatio) / 2;\n\tconst left = coords.x - halfSize;\n\tconst top = coords.y - halfSize;\n\n\tctx.fillRect(left, top, squareSize * coords.pixelRatio, squareSize * coords.pixelRatio);\n}\n\nexport function hitTestSquare(\n\tcenterX: Coordinate,\n\tcenterY: Coordinate,\n\tsize: number,\n\tx: Coordinate,\n\ty: Coordinate\n): boolean {\n\tconst squareSize = shapeSize('square', size);\n\tconst halfSize = (squareSize - 1) / 2;\n\tconst left = centerX - halfSize;\n\tconst top = centerY - halfSize;\n\n\treturn x >= left && x <= left + squareSize &&\n\t\ty >= top && y <= top + squareSize;\n}\n","import { ceiledOdd } from '../helpers/mathex';\n\nimport { Coordinate } from '../model/coordinate';\n\nimport { hitTestSquare } from './series-markers-square';\nimport { BitmapShapeItemCoordinates, shapeSize } from './series-markers-utils';\n\nexport function drawArrow(\n\tup: boolean,\n\tctx: CanvasRenderingContext2D,\n\tcoords: BitmapShapeItemCoordinates,\n\tsize: number\n): void {\n\tconst arrowSize = shapeSize('arrowUp', size);\n\tconst halfArrowSize = ((arrowSize - 1) / 2) * coords.pixelRatio;\n\tconst baseSize = ceiledOdd(size / 2);\n\tconst halfBaseSize = ((baseSize - 1) / 2) * coords.pixelRatio;\n\n\tctx.beginPath();\n\tif (up) {\n\t\tctx.moveTo(coords.x - halfArrowSize, coords.y);\n\t\tctx.lineTo(coords.x, coords.y - halfArrowSize);\n\t\tctx.lineTo(coords.x + halfArrowSize, coords.y);\n\t\tctx.lineTo(coords.x + halfBaseSize, coords.y);\n\t\tctx.lineTo(coords.x + halfBaseSize, coords.y + halfArrowSize);\n\t\tctx.lineTo(coords.x - halfBaseSize, coords.y + halfArrowSize);\n\t\tctx.lineTo(coords.x - halfBaseSize, coords.y);\n\t} else {\n\t\tctx.moveTo(coords.x - halfArrowSize, coords.y);\n\t\tctx.lineTo(coords.x, coords.y + halfArrowSize);\n\t\tctx.lineTo(coords.x + halfArrowSize, coords.y);\n\t\tctx.lineTo(coords.x + halfBaseSize, coords.y);\n\t\tctx.lineTo(coords.x + halfBaseSize, coords.y - halfArrowSize);\n\t\tctx.lineTo(coords.x - halfBaseSize, coords.y - halfArrowSize);\n\t\tctx.lineTo(coords.x - halfBaseSize, coords.y);\n\t}\n\n\tctx.fill();\n}\n\nexport function hitTestArrow(\n\tup: boolean,\n\tcenterX: Coordinate,\n\tcenterY: Coordinate,\n\tsize: number,\n\tx: Coordinate,\n\ty: Coordinate\n): boolean {\n\t// TODO: implement arrow hit test\n\treturn hitTestSquare(centerX, centerY, size, x, y);\n}\n","import { Coordinate } from '../model/coordinate';\n\nimport { BitmapShapeItemCoordinates, shapeSize } from './series-markers-utils';\n\nexport function drawCircle(\n\tctx: CanvasRenderingContext2D,\n\tcoords: BitmapShapeItemCoordinates,\n\tsize: number\n): void {\n\tconst circleSize = shapeSize('circle', size);\n\tconst halfSize = (circleSize - 1) / 2;\n\n\tctx.beginPath();\n\tctx.arc(coords.x, coords.y, halfSize * coords.pixelRatio, 0, 2 * Math.PI, false);\n\n\tctx.fill();\n}\n\nexport function hitTestCircle(\n\tcenterX: Coordinate,\n\tcenterY: Coordinate,\n\tsize: number,\n\tx: Coordinate,\n\ty: Coordinate\n): boolean {\n\tconst circleSize = shapeSize('circle', size);\n\tconst tolerance = 2 + circleSize / 2;\n\n\tconst xOffset = centerX - x;\n\tconst yOffset = centerY - y;\n\n\tconst dist = Math.sqrt(xOffset * xOffset + yOffset * yOffset);\n\n\treturn dist <= tolerance;\n}\n","import { Coordinate } from '../model/coordinate';\n\nexport function drawText(\n\tctx: CanvasRenderingContext2D,\n\ttext: string,\n\tx: number,\n\ty: number,\n\thorizontalPixelRatio: number,\n\tverticalPixelRatio: number\n): void {\n\tctx.save();\n\tctx.scale(horizontalPixelRatio, verticalPixelRatio);\n\tctx.fillText(text, x, y);\n\tctx.restore();\n}\n\nexport function hitTestText(\n\ttextX: number,\n\ttextY: number,\n\ttextWidth: number,\n\ttextHeight: number,\n\tx: Coordinate,\n\ty: Coordinate\n): boolean {\n\tconst halfHeight = textHeight / 2;\n\n\treturn x >= textX && x <= textX + textWidth &&\n\t\ty >= textY - halfHeight && y <= textY + halfHeight;\n}\n","import { BitmapCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { ensureNever } from '../helpers/assertions';\nimport { makeFont } from '../helpers/make-font';\n\nimport { HoveredObject } from '../model/chart-model';\nimport { Coordinate } from '../model/coordinate';\nimport { SeriesMarkerShape } from '../model/series-markers';\nimport { TextWidthCache } from '../model/text-width-cache';\nimport { SeriesItemsIndexesRange, TimedValue } from '../model/time-data';\n\nimport { BitmapCoordinatesPaneRenderer } from './bitmap-coordinates-pane-renderer';\nimport { drawArrow, hitTestArrow } from './series-markers-arrow';\nimport { drawCircle, hitTestCircle } from './series-markers-circle';\nimport { drawSquare, hitTestSquare } from './series-markers-square';\nimport { drawText, hitTestText } from './series-markers-text';\nimport { BitmapShapeItemCoordinates } from './series-markers-utils';\n\nexport interface SeriesMarkerText {\n\tcontent: string;\n\tx: Coordinate;\n\ty: Coordinate;\n\twidth: number;\n\theight: number;\n}\n\nexport interface SeriesMarkerRendererDataItem extends TimedValue {\n\ty: Coordinate;\n\tsize: number;\n\tshape: SeriesMarkerShape;\n\tcolor: string;\n\tinternalId: number;\n\texternalId?: string;\n\ttext?: SeriesMarkerText;\n}\n\nexport interface SeriesMarkerRendererData {\n\titems: SeriesMarkerRendererDataItem[];\n\tvisibleRange: SeriesItemsIndexesRange | null;\n}\n\nexport class SeriesMarkersRenderer extends BitmapCoordinatesPaneRenderer {\n\tprivate _data: SeriesMarkerRendererData | null = null;\n\tprivate _textWidthCache: TextWidthCache = new TextWidthCache();\n\tprivate _fontSize: number = -1;\n\tprivate _fontFamily: string = '';\n\tprivate _font: string = '';\n\n\tpublic setData(data: SeriesMarkerRendererData): void {\n\t\tthis._data = data;\n\t}\n\n\tpublic setParams(fontSize: number, fontFamily: string): void {\n\t\tif (this._fontSize !== fontSize || this._fontFamily !== fontFamily) {\n\t\t\tthis._fontSize = fontSize;\n\t\t\tthis._fontFamily = fontFamily;\n\t\t\tthis._font = makeFont(fontSize, fontFamily);\n\t\t\tthis._textWidthCache.reset();\n\t\t}\n\t}\n\n\tpublic hitTest(x: Coordinate, y: Coordinate): HoveredObject | null {\n\t\tif (this._data === null || this._data.visibleRange === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\tfor (let i = this._data.visibleRange.from; i < this._data.visibleRange.to; i++) {\n\t\t\tconst item = this._data.items[i];\n\t\t\tif (hitTestItem(item, x, y)) {\n\t\t\t\treturn {\n\t\t\t\t\thitTestData: item.internalId,\n\t\t\t\t\texternalId: item.externalId,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprotected _drawImpl({ context: ctx, horizontalPixelRatio, verticalPixelRatio }: BitmapCoordinatesRenderingScope, isHovered: boolean, hitTestData?: unknown): void {\n\t\tif (this._data === null || this._data.visibleRange === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tctx.textBaseline = 'middle';\n\t\tctx.font = this._font;\n\n\t\tfor (let i = this._data.visibleRange.from; i < this._data.visibleRange.to; i++) {\n\t\t\tconst item = this._data.items[i];\n\t\t\tif (item.text !== undefined) {\n\t\t\t\titem.text.width = this._textWidthCache.measureText(ctx, item.text.content);\n\t\t\t\titem.text.height = this._fontSize;\n\t\t\t\titem.text.x = item.x - item.text.width / 2 as Coordinate;\n\t\t\t}\n\t\t\tdrawItem(item, ctx, horizontalPixelRatio, verticalPixelRatio);\n\t\t}\n\t}\n}\n\nfunction bitmapShapeItemCoordinates(item: SeriesMarkerRendererDataItem, horizontalPixelRatio: number, verticalPixelRatio: number): BitmapShapeItemCoordinates {\n\tconst tickWidth = Math.max(1, Math.floor(horizontalPixelRatio));\n\tconst correction = (tickWidth % 2) / 2;\n\treturn {\n\t\tx: Math.round(item.x * horizontalPixelRatio) + correction,\n\t\ty: item.y * verticalPixelRatio,\n\t\tpixelRatio: horizontalPixelRatio,\n\t};\n}\n\nfunction drawItem(item: SeriesMarkerRendererDataItem, ctx: CanvasRenderingContext2D, horizontalPixelRatio: number, verticalPixelRatio: number): void {\n\tctx.fillStyle = item.color;\n\n\tif (item.text !== undefined) {\n\t\tdrawText(ctx, item.text.content, item.text.x, item.text.y, horizontalPixelRatio, verticalPixelRatio);\n\t}\n\n\tdrawShape(item, ctx, bitmapShapeItemCoordinates(item, horizontalPixelRatio, verticalPixelRatio));\n}\n\nfunction drawShape(item: SeriesMarkerRendererDataItem, ctx: CanvasRenderingContext2D, coordinates: BitmapShapeItemCoordinates): void {\n\tif (item.size === 0) {\n\t\treturn;\n\t}\n\n\tswitch (item.shape) {\n\t\tcase 'arrowDown':\n\t\t\tdrawArrow(false, ctx, coordinates, item.size);\n\t\t\treturn;\n\t\tcase 'arrowUp':\n\t\t\tdrawArrow(true, ctx, coordinates, item.size);\n\t\t\treturn;\n\t\tcase 'circle':\n\t\t\tdrawCircle(ctx, coordinates, item.size);\n\t\t\treturn;\n\t\tcase 'square':\n\t\t\tdrawSquare(ctx, coordinates, item.size);\n\t\t\treturn;\n\t}\n\n\tensureNever(item.shape);\n}\n\nfunction hitTestItem(item: SeriesMarkerRendererDataItem, x: Coordinate, y: Coordinate): boolean {\n\tif (item.text !== undefined && hitTestText(item.text.x, item.text.y, item.text.width, item.text.height, x, y)) {\n\t\treturn true;\n\t}\n\n\treturn hitTestShape(item, x, y);\n}\n\nfunction hitTestShape(item: SeriesMarkerRendererDataItem, x: Coordinate, y: Coordinate): boolean {\n\tif (item.size === 0) {\n\t\treturn false;\n\t}\n\n\tswitch (item.shape) {\n\t\tcase 'arrowDown':\n\t\t\treturn hitTestArrow(true, item.x, item.y, item.size, x, y);\n\t\tcase 'arrowUp':\n\t\t\treturn hitTestArrow(false, item.x, item.y, item.size, x, y);\n\t\tcase 'circle':\n\t\t\treturn hitTestCircle(item.x, item.y, item.size, x, y);\n\t\tcase 'square':\n\t\t\treturn hitTestSquare(item.x, item.y, item.size, x, y);\n\t}\n}\n","import { ensureNever } from '../../helpers/assertions';\nimport { isNumber } from '../../helpers/strict-type-checks';\n\nimport { AutoScaleMargins } from '../../model/autoscale-info-impl';\nimport { BarPrice, BarPrices } from '../../model/bar';\nimport { IChartModelBase } from '../../model/chart-model';\nimport { Coordinate } from '../../model/coordinate';\nimport { PriceScale } from '../../model/price-scale';\nimport { ISeries } from '../../model/series';\nimport { InternalSeriesMarker, SeriesMarkerPosition } from '../../model/series-markers';\nimport { SeriesType } from '../../model/series-options';\nimport { TimePointIndex, visibleTimedValues } from '../../model/time-data';\nimport { ITimeScale } from '../../model/time-scale';\nimport { IPaneRenderer } from '../../renderers/ipane-renderer';\nimport {\n\tSeriesMarkerRendererData,\n\tSeriesMarkerRendererDataItem,\n\tSeriesMarkersRenderer,\n} from '../../renderers/series-markers-renderer';\nimport {\n\tcalculateAdjustedMargin,\n\tcalculateShapeHeight,\n\tshapeMargin as calculateShapeMargin,\n} from '../../renderers/series-markers-utils';\n\nimport { IUpdatablePaneView, UpdateType } from './iupdatable-pane-view';\n\nconst enum Constants {\n\tTextMargin = 0.1,\n}\n\ninterface Offsets {\n\taboveBar: number;\n\tbelowBar: number;\n}\n\ntype MarkerPositions = Record<SeriesMarkerPosition, boolean>;\n\n// eslint-disable-next-line max-params\nfunction fillSizeAndY(\n\trendererItem: SeriesMarkerRendererDataItem,\n\tmarker: InternalSeriesMarker<TimePointIndex>,\n\tseriesData: BarPrices | BarPrice,\n\toffsets: Offsets,\n\ttextHeight: number,\n\tshapeMargin: number,\n\tpriceScale: PriceScale,\n\ttimeScale: ITimeScale,\n\tfirstValue: number\n): void {\n\tconst inBarPrice = isNumber(seriesData) ? seriesData : seriesData.close;\n\tconst highPrice = isNumber(seriesData) ? seriesData : seriesData.high;\n\tconst lowPrice = isNumber(seriesData) ? seriesData : seriesData.low;\n\tconst sizeMultiplier = isNumber(marker.size) ? Math.max(marker.size, 0) : 1;\n\tconst shapeSize = calculateShapeHeight(timeScale.barSpacing()) * sizeMultiplier;\n\tconst halfSize = shapeSize / 2;\n\trendererItem.size = shapeSize;\n\n\tswitch (marker.position) {\n\t\tcase 'inBar': {\n\t\t\trendererItem.y = priceScale.priceToCoordinate(inBarPrice, firstValue);\n\t\t\tif (rendererItem.text !== undefined) {\n\t\t\t\trendererItem.text.y = rendererItem.y + halfSize + shapeMargin + textHeight * (0.5 + Constants.TextMargin) as Coordinate;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tcase 'aboveBar': {\n\t\t\trendererItem.y = (priceScale.priceToCoordinate(highPrice, firstValue) - halfSize - offsets.aboveBar) as Coordinate;\n\t\t\tif (rendererItem.text !== undefined) {\n\t\t\t\trendererItem.text.y = rendererItem.y - halfSize - textHeight * (0.5 + Constants.TextMargin) as Coordinate;\n\t\t\t\toffsets.aboveBar += textHeight * (1 + 2 * Constants.TextMargin);\n\t\t\t}\n\t\t\toffsets.aboveBar += shapeSize + shapeMargin;\n\t\t\treturn;\n\t\t}\n\t\tcase 'belowBar': {\n\t\t\trendererItem.y = (priceScale.priceToCoordinate(lowPrice, firstValue) + halfSize + offsets.belowBar) as Coordinate;\n\t\t\tif (rendererItem.text !== undefined) {\n\t\t\t\trendererItem.text.y = rendererItem.y + halfSize + shapeMargin + textHeight * (0.5 + Constants.TextMargin) as Coordinate;\n\t\t\t\toffsets.belowBar += textHeight * (1 + 2 * Constants.TextMargin);\n\t\t\t}\n\t\t\toffsets.belowBar += shapeSize + shapeMargin;\n\t\t\treturn;\n\t\t}\n\t}\n\n\tensureNever(marker.position);\n}\n\nexport class SeriesMarkersPaneView implements IUpdatablePaneView {\n\tprivate readonly _series: ISeries<SeriesType>;\n\tprivate readonly _model: IChartModelBase;\n\tprivate _data: SeriesMarkerRendererData;\n\n\tprivate _invalidated: boolean = true;\n\tprivate _dataInvalidated: boolean = true;\n\tprivate _autoScaleMarginsInvalidated: boolean = true;\n\n\tprivate _autoScaleMargins: AutoScaleMargins | null = null;\n\tprivate _markersPositions: MarkerPositions | null = null;\n\tprivate _renderer: SeriesMarkersRenderer = new SeriesMarkersRenderer();\n\n\tpublic constructor(series: ISeries<SeriesType>, model: IChartModelBase) {\n\t\tthis._series = series;\n\t\tthis._model = model;\n\t\tthis._data = {\n\t\t\titems: [],\n\t\t\tvisibleRange: null,\n\t\t};\n\t}\n\n\tpublic update(updateType?: UpdateType): void {\n\t\tthis._invalidated = true;\n\t\tthis._autoScaleMarginsInvalidated = true;\n\t\tif (updateType === 'data') {\n\t\t\tthis._dataInvalidated = true;\n\t\t\tthis._markersPositions = null;\n\t\t}\n\t}\n\n\tpublic renderer(addAnchors?: boolean): IPaneRenderer | null {\n\t\tif (!this._series.visible()) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this._invalidated) {\n\t\t\tthis._makeValid();\n\t\t}\n\n\t\tconst layout = this._model.options().layout;\n\t\tthis._renderer.setParams(layout.fontSize, layout.fontFamily);\n\t\tthis._renderer.setData(this._data);\n\n\t\treturn this._renderer;\n\t}\n\n\tpublic autoScaleMargins(): AutoScaleMargins | null {\n\t\tif (this._autoScaleMarginsInvalidated) {\n\t\t\tif (this._series.indexedMarkers().length > 0) {\n\t\t\t\tconst barSpacing = this._model.timeScale().barSpacing();\n\t\t\t\tconst shapeMargin = calculateShapeMargin(barSpacing);\n\t\t\t\tconst marginValue = calculateShapeHeight(barSpacing) * 1.5 + shapeMargin * 2;\n\t\t\t\tconst positions = this._getMarkerPositions();\n\n\t\t\t\tthis._autoScaleMargins = {\n\t\t\t\t\tabove: calculateAdjustedMargin(marginValue, positions.aboveBar, positions.inBar),\n\t\t\t\t\tbelow: calculateAdjustedMargin(marginValue, positions.belowBar, positions.inBar),\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tthis._autoScaleMargins = null;\n\t\t\t}\n\n\t\t\tthis._autoScaleMarginsInvalidated = false;\n\t\t}\n\n\t\treturn this._autoScaleMargins;\n\t}\n\n\tprotected _getMarkerPositions(): MarkerPositions {\n\t\tif (this._markersPositions === null) {\n\t\t\tthis._markersPositions = this._series.indexedMarkers().reduce(\n\t\t\t\t(acc: MarkerPositions, marker: InternalSeriesMarker<TimePointIndex>) => {\n\t\t\t\t\tif (!acc[marker.position]) {\n\t\t\t\t\t\tacc[marker.position] = true;\n\t\t\t\t\t}\n\t\t\t\t\treturn acc;\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tinBar: false,\n\t\t\t\t\taboveBar: false,\n\t\t\t\t\tbelowBar: false,\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn this._markersPositions;\n\t}\n\n\tprotected _makeValid(): void {\n\t\tconst priceScale = this._series.priceScale();\n\t\tconst timeScale = this._model.timeScale();\n\t\tconst seriesMarkers = this._series.indexedMarkers();\n\t\tif (this._dataInvalidated) {\n\t\t\tthis._data.items = seriesMarkers.map<SeriesMarkerRendererDataItem>((marker: InternalSeriesMarker<TimePointIndex>) => ({\n\t\t\t\ttime: marker.time,\n\t\t\t\tx: 0 as Coordinate,\n\t\t\t\ty: 0 as Coordinate,\n\t\t\t\tsize: 0,\n\t\t\t\tshape: marker.shape,\n\t\t\t\tcolor: marker.color,\n\t\t\t\tinternalId: marker.internalId,\n\t\t\t\texternalId: marker.id,\n\t\t\t\ttext: undefined,\n\t\t\t}));\n\t\t\tthis._dataInvalidated = false;\n\t\t}\n\n\t\tconst layoutOptions = this._model.options().layout;\n\n\t\tthis._data.visibleRange = null;\n\t\tconst visibleBars = timeScale.visibleStrictRange();\n\t\tif (visibleBars === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst firstValue = this._series.firstValue();\n\t\tif (firstValue === null) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._data.items.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tlet prevTimeIndex = NaN;\n\t\tconst shapeMargin = calculateShapeMargin(timeScale.barSpacing());\n\t\tconst offsets: Offsets = {\n\t\t\taboveBar: shapeMargin,\n\t\t\tbelowBar: shapeMargin,\n\t\t};\n\t\tthis._data.visibleRange = visibleTimedValues(this._data.items, visibleBars, true);\n\t\tfor (let index = this._data.visibleRange.from; index < this._data.visibleRange.to; index++) {\n\t\t\tconst marker = seriesMarkers[index];\n\t\t\tif (marker.time !== prevTimeIndex) {\n\t\t\t\t// new bar, reset stack counter\n\t\t\t\toffsets.aboveBar = shapeMargin;\n\t\t\t\toffsets.belowBar = shapeMargin;\n\t\t\t\tprevTimeIndex = marker.time;\n\t\t\t}\n\n\t\t\tconst rendererItem = this._data.items[index];\n\t\t\trendererItem.x = timeScale.indexToCoordinate(marker.time);\n\t\t\tif (marker.text !== undefined && marker.text.length > 0) {\n\t\t\t\trendererItem.text = {\n\t\t\t\t\tcontent: marker.text,\n\t\t\t\t\tx: 0 as Coordinate,\n\t\t\t\t\ty: 0 as Coordinate,\n\t\t\t\t\twidth: 0,\n\t\t\t\t\theight: 0,\n\t\t\t\t};\n\t\t\t}\n\t\t\tconst dataAt = this._series.dataAt(marker.time);\n\t\t\tif (dataAt === null) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfillSizeAndY(rendererItem, marker, dataAt, offsets, layoutOptions.fontSize, shapeMargin, priceScale, timeScale, firstValue.value);\n\t\t}\n\t\tthis._invalidated = false;\n\t}\n}\n","import { ISeries } from '../../model/series';\nimport { PriceLineSource, SeriesType } from '../../model/series-options';\n\nimport { SeriesHorizontalLinePaneView } from './series-horizontal-line-pane-view';\n\nexport class SeriesPriceLinePaneView extends SeriesHorizontalLinePaneView {\n\t// eslint-disable-next-line no-useless-constructor\n\tpublic constructor(series: ISeries<SeriesType>) {\n\t\tsuper(series);\n\t}\n\n\tprotected _updateImpl(): void {\n\t\tconst data = this._lineRendererData;\n\t\tdata.visible = false;\n\n\t\tconst seriesOptions = this._series.options();\n\t\tif (!seriesOptions.priceLineVisible || !this._series.visible()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst lastValueData = this._series.lastValueData(seriesOptions.priceLineSource === PriceLineSource.LastBar);\n\t\tif (lastValueData.noData) {\n\t\t\treturn;\n\t\t}\n\n\t\tdata.visible = true;\n\t\tdata.y = lastValueData.coordinate;\n\t\tdata.color = this._series.priceLineColor(lastValueData.color);\n\t\tdata.lineWidth = seriesOptions.priceLineWidth;\n\t\tdata.lineStyle = seriesOptions.priceLineStyle;\n\t}\n}\n","import { generateContrastColors } from '../../helpers/color';\n\nimport { ISeries, LastValueDataResultWithData } from '../../model/series';\nimport { PriceAxisLastValueMode, SeriesType } from '../../model/series-options';\nimport { PriceAxisViewRendererCommonData, PriceAxisViewRendererData } from '../../renderers/iprice-axis-view-renderer';\n\nimport { PriceAxisView } from './price-axis-view';\n\nexport class SeriesPriceAxisView extends PriceAxisView {\n\tprivate readonly _source: ISeries<SeriesType>;\n\n\tpublic constructor(source: ISeries<SeriesType>) {\n\t\tsuper();\n\t\tthis._source = source;\n\t}\n\n\tprotected _updateRendererData(\n\t\taxisRendererData: PriceAxisViewRendererData,\n\t\tpaneRendererData: PriceAxisViewRendererData,\n\t\tcommonRendererData: PriceAxisViewRendererCommonData\n\t): void {\n\t\taxisRendererData.visible = false;\n\t\tpaneRendererData.visible = false;\n\n\t\tconst source = this._source;\n\t\tif (!source.visible()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst seriesOptions = source.options();\n\n\t\tconst showSeriesLastValue = seriesOptions.lastValueVisible;\n\n\t\tconst showSymbolLabel = source.title() !== '';\n\t\tconst showPriceAndPercentage = seriesOptions.seriesLastValueMode === PriceAxisLastValueMode.LastPriceAndPercentageValue;\n\n\t\tconst lastValueData = source.lastValueData(false);\n\t\tif (lastValueData.noData) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (showSeriesLastValue) {\n\t\t\taxisRendererData.text = this._axisText(lastValueData, showSeriesLastValue, showPriceAndPercentage);\n\t\t\taxisRendererData.visible = axisRendererData.text.length !== 0;\n\t\t}\n\n\t\tif (showSymbolLabel || showPriceAndPercentage) {\n\t\t\tpaneRendererData.text = this._paneText(lastValueData, showSeriesLastValue, showSymbolLabel, showPriceAndPercentage);\n\t\t\tpaneRendererData.visible = paneRendererData.text.length > 0;\n\t\t}\n\n\t\tconst lastValueColor = source.priceLineColor(lastValueData.color);\n\t\tconst colors = generateContrastColors(lastValueColor);\n\n\t\tcommonRendererData.background = colors.background;\n\t\tcommonRendererData.coordinate = lastValueData.coordinate;\n\t\tpaneRendererData.borderColor = source.model().backgroundColorAtYPercentFromTop(lastValueData.coordinate / source.priceScale().height());\n\t\taxisRendererData.borderColor = lastValueColor;\n\t\taxisRendererData.color = colors.foreground;\n\t\tpaneRendererData.color = colors.foreground;\n\t}\n\n\tprotected _paneText(\n\t\tlastValue: LastValueDataResultWithData,\n\t\tshowSeriesLastValue: boolean,\n\t\tshowSymbolLabel: boolean,\n\t\tshowPriceAndPercentage: boolean\n\t): string {\n\t\tlet result = '';\n\n\t\tconst title = this._source.title();\n\n\t\tif (showSymbolLabel && title.length !== 0) {\n\t\t\tresult += `${title} `;\n\t\t}\n\n\t\tif (showSeriesLastValue && showPriceAndPercentage) {\n\t\t\tresult += this._source.priceScale().isPercentage() ?\n\t\t\t\tlastValue.formattedPriceAbsolute : lastValue.formattedPricePercentage;\n\t\t}\n\n\t\treturn result.trim();\n\t}\n\n\tprotected _axisText(lastValueData: LastValueDataResultWithData, showSeriesLastValue: boolean, showPriceAndPercentage: boolean): string {\n\t\tif (!showSeriesLastValue) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (!showPriceAndPercentage) {\n\t\t\treturn lastValueData.text;\n\t\t}\n\n\t\treturn this._source.priceScale().isPercentage() ?\n\t\t\tlastValueData.formattedPricePercentage : lastValueData.formattedPriceAbsolute;\n\t}\n}\n","import { isNumber } from '../helpers/strict-type-checks';\n\nimport { PriceRange } from './series-options';\n\nfunction computeFiniteResult(\n\tmethod: (...values: number[]) => number,\n\tvalueOne: number,\n\tvalueTwo: number,\n\tfallback: number\n): number {\n\tconst firstFinite = Number.isFinite(valueOne);\n\tconst secondFinite = Number.isFinite(valueTwo);\n\n\tif (firstFinite && secondFinite) {\n\t\treturn method(valueOne, valueTwo);\n\t}\n\n\treturn !firstFinite && !secondFinite ? fallback : (firstFinite ? valueOne : valueTwo);\n}\n\nexport class PriceRangeImpl {\n\tprivate _minValue: number;\n\tprivate _maxValue!: number;\n\n\tpublic constructor(minValue: number, maxValue: number) {\n\t\tthis._minValue = minValue;\n\t\tthis._maxValue = maxValue;\n\t}\n\n\tpublic equals(pr: PriceRangeImpl | null): boolean {\n\t\tif (pr === null) {\n\t\t\treturn false;\n\t\t}\n\t\treturn this._minValue === pr._minValue && this._maxValue === pr._maxValue;\n\t}\n\n\tpublic clone(): PriceRangeImpl {\n\t\treturn new PriceRangeImpl(this._minValue, this._maxValue);\n\t}\n\n\tpublic minValue(): number {\n\t\treturn this._minValue;\n\t}\n\n\tpublic maxValue(): number {\n\t\treturn this._maxValue;\n\t}\n\n\tpublic length(): number {\n\t\treturn this._maxValue - this._minValue;\n\t}\n\n\tpublic isEmpty(): boolean {\n\t\treturn this._maxValue === this._minValue || Number.isNaN(this._maxValue) || Number.isNaN(this._minValue);\n\t}\n\n\tpublic merge(anotherRange: PriceRangeImpl | null): PriceRangeImpl {\n\t\tif (anotherRange === null) {\n\t\t\treturn this;\n\t\t}\n\t\treturn new PriceRangeImpl(\n\t\t\tcomputeFiniteResult(Math.min, this.minValue(), anotherRange.minValue(), -Infinity),\n\t\t\tcomputeFiniteResult(Math.max, this.maxValue(), anotherRange.maxValue(), Infinity)\n\t\t);\n\t}\n\n\tpublic scaleAroundCenter(coeff: number): void {\n\t\tif (!isNumber(coeff)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst delta = this._maxValue - this._minValue;\n\t\tif (delta === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst center = (this._maxValue + this._minValue) * 0.5;\n\t\tlet maxDelta = this._maxValue - center;\n\t\tlet minDelta = this._minValue - center;\n\t\tmaxDelta *= coeff;\n\t\tminDelta *= coeff;\n\t\tthis._maxValue = center + maxDelta;\n\t\tthis._minValue = center + minDelta;\n\t}\n\n\tpublic shift(delta: number): void {\n\t\tif (!isNumber(delta)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._maxValue += delta;\n\t\tthis._minValue += delta;\n\t}\n\n\tpublic toRaw(): PriceRange {\n\t\treturn {\n\t\t\tminValue: this._minValue,\n\t\t\tmaxValue: this._maxValue,\n\t\t};\n\t}\n\n\tpublic static fromRaw(raw: PriceRange | null): PriceRangeImpl | null {\n\t\treturn (raw === null) ? null : new PriceRangeImpl(raw.minValue, raw.maxValue);\n\t}\n}\n","import { PriceRangeImpl } from './price-range-impl';\nimport { AutoscaleInfo } from './series-options';\n\n/**\n * Represents the margin used when updating a price scale.\n */\nexport interface AutoScaleMargins {\n\t/** The number of pixels for bottom margin */\n\tbelow: number;\n\t/** The number of pixels for top margin */\n\tabove: number;\n}\n\nexport class AutoscaleInfoImpl {\n\tprivate readonly _priceRange: PriceRangeImpl | null;\n\tprivate readonly _margins: AutoScaleMargins | null;\n\n\tpublic constructor(priceRange: PriceRangeImpl | null, margins?: AutoScaleMargins | null) {\n\t\tthis._priceRange = priceRange;\n\t\tthis._margins = margins || null;\n\t}\n\n\tpublic priceRange(): PriceRangeImpl | null {\n\t\treturn this._priceRange;\n\t}\n\n\tpublic margins(): AutoScaleMargins | null {\n\t\treturn this._margins;\n\t}\n\n\tpublic toRaw(): AutoscaleInfo | null {\n\t\tif (this._priceRange === null) {\n\t\t\treturn null;\n\t\t}\n\t\treturn {\n\t\t\tpriceRange: this._priceRange.toRaw(),\n\t\t\tmargins: this._margins || undefined,\n\t\t};\n\t}\n\n\tpublic static fromRaw(raw: AutoscaleInfo | null): AutoscaleInfoImpl | null {\n\t\treturn (raw === null) ? null : new AutoscaleInfoImpl(PriceRangeImpl.fromRaw(raw.priceRange), raw.margins);\n\t}\n}\n","import { CustomPriceLine } from '../../model/custom-price-line';\nimport { ISeries } from '../../model/series';\nimport { SeriesType } from '../../model/series-options';\n\nimport { SeriesHorizontalLinePaneView } from './series-horizontal-line-pane-view';\n\nexport class CustomPriceLinePaneView extends SeriesHorizontalLinePaneView {\n\tprivate readonly _priceLine: CustomPriceLine;\n\n\tpublic constructor(series: ISeries<SeriesType>, priceLine: CustomPriceLine) {\n\t\tsuper(series);\n\t\tthis._priceLine = priceLine;\n\t}\n\n\tprotected _updateImpl(): void {\n\t\tconst data = this._lineRendererData;\n\t\tdata.visible = false;\n\n\t\tconst lineOptions = this._priceLine.options();\n\n\t\tif (!this._series.visible() || !lineOptions.lineVisible) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst y = this._priceLine.yCoord();\n\t\tif (y === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tdata.visible = true;\n\t\tdata.y = y;\n\t\tdata.color = lineOptions.color;\n\t\tdata.lineWidth = lineOptions.lineWidth;\n\t\tdata.lineStyle = lineOptions.lineStyle;\n\t\tdata.externalId = this._priceLine.options().id;\n\t}\n}\n","import { generateContrastColors } from '../../helpers/color';\n\nimport { CustomPriceLine } from '../../model/custom-price-line';\nimport { ISeries } from '../../model/series';\nimport { SeriesType } from '../../model/series-options';\nimport {\n\tPriceAxisViewRendererCommonData,\n\tPriceAxisViewRendererData,\n} from '../../renderers/iprice-axis-view-renderer';\n\nimport { PriceAxisView } from './price-axis-view';\n\nexport class CustomPriceLinePriceAxisView extends PriceAxisView {\n\tprivate readonly _series: ISeries<SeriesType>;\n\tprivate readonly _priceLine: CustomPriceLine;\n\n\tpublic constructor(series: ISeries<SeriesType>, priceLine: CustomPriceLine) {\n\t\tsuper();\n\t\tthis._series = series;\n\t\tthis._priceLine = priceLine;\n\t}\n\n\tprotected _updateRendererData(\n\t\taxisRendererData: PriceAxisViewRendererData,\n\t\tpaneRendererData: PriceAxisViewRendererData,\n\t\tcommonData: PriceAxisViewRendererCommonData\n\t): void {\n\t\taxisRendererData.visible = false;\n\t\tpaneRendererData.visible = false;\n\n\t\tconst options = this._priceLine.options();\n\t\tconst labelVisible = options.axisLabelVisible;\n\t\tconst showPaneLabel = options.title !== '';\n\n\t\tconst series = this._series;\n\n\t\tif (!labelVisible || !series.visible()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst y = this._priceLine.yCoord();\n\t\tif (y === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (showPaneLabel) {\n\t\t\tpaneRendererData.text = options.title;\n\t\t\tpaneRendererData.visible = true;\n\t\t}\n\n\t\tpaneRendererData.borderColor = series.model().backgroundColorAtYPercentFromTop(y / series.priceScale().height());\n\n\t\taxisRendererData.text = this._formatPrice(options.price);\n\t\taxisRendererData.visible = true;\n\n\t\tconst colors = generateContrastColors(options.axisLabelColor || options.color);\n\t\tcommonData.background = colors.background;\n\n\t\tconst textColor = options.axisLabelTextColor || colors.foreground;\n\t\taxisRendererData.color = textColor; // price text\n\t\tpaneRendererData.color = textColor; // title text\n\n\t\tcommonData.coordinate = y;\n\t}\n\n\tprivate _formatPrice(price: number): string {\n\t\tconst firstValue = this._series.firstValue();\n\t\tif (firstValue === null) {\n\t\t\treturn '';\n\t\t}\n\n\t\treturn this._series.priceScale().formatPrice(price, firstValue.value);\n\t}\n}\n","import { merge } from '../helpers/strict-type-checks';\n\nimport { CustomPriceLinePaneView } from '../views/pane/custom-price-line-pane-view';\nimport { IPaneView } from '../views/pane/ipane-view';\nimport { PanePriceAxisView } from '../views/pane/pane-price-axis-view';\nimport { CustomPriceLinePriceAxisView } from '../views/price-axis/custom-price-line-price-axis-view';\nimport { IPriceAxisView } from '../views/price-axis/iprice-axis-view';\n\nimport { Coordinate } from './coordinate';\nimport { PriceLineOptions } from './price-line-options';\nimport { ISeries } from './series';\nimport { SeriesType } from './series-options';\n\nexport class CustomPriceLine {\n\tprivate readonly _series: ISeries<SeriesType>;\n\tprivate readonly _priceLineView: CustomPriceLinePaneView;\n\tprivate readonly _priceAxisView: CustomPriceLinePriceAxisView;\n\tprivate readonly _panePriceAxisView: PanePriceAxisView;\n\tprivate readonly _options: PriceLineOptions;\n\n\tpublic constructor(series: ISeries<SeriesType>, options: PriceLineOptions) {\n\t\tthis._series = series;\n\t\tthis._options = options;\n\t\tthis._priceLineView = new CustomPriceLinePaneView(series, this);\n\t\tthis._priceAxisView = new CustomPriceLinePriceAxisView(series, this);\n\t\tthis._panePriceAxisView = new PanePriceAxisView(this._priceAxisView, series, series.model());\n\t}\n\n\tpublic applyOptions(options: Partial<PriceLineOptions>): void {\n\t\tmerge(this._options, options);\n\t\tthis.update();\n\t\tthis._series.model().lightUpdate();\n\t}\n\n\tpublic options(): PriceLineOptions {\n\t\treturn this._options;\n\t}\n\n\tpublic paneView(): IPaneView {\n\t\treturn this._priceLineView;\n\t}\n\n\tpublic labelPaneView(): IPaneView {\n\t\treturn this._panePriceAxisView;\n\t}\n\n\tpublic priceAxisView(): IPriceAxisView {\n\t\treturn this._priceAxisView;\n\t}\n\n\tpublic update(): void {\n\t\tthis._priceLineView.update();\n\t\tthis._priceAxisView.update();\n\t}\n\n\tpublic yCoord(): Coordinate | null {\n\t\tconst series = this._series;\n\t\tconst priceScale = series.priceScale();\n\t\tconst timeScale = series.model().timeScale();\n\n\t\tif (timeScale.isEmpty() || priceScale.isEmpty()) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst firstValue = series.firstValue();\n\t\tif (firstValue === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn priceScale.priceToCoordinate(this._options.price, firstValue.value);\n\t}\n}\n","import { IPriceFormatter } from '../formatters/iprice-formatter';\n\nimport { AutoscaleInfoImpl } from './autoscale-info-impl';\nimport { IChartModelBase } from './chart-model';\nimport { DataSource } from './data-source';\nimport { FirstValue, IPriceDataSource } from './iprice-data-source';\nimport { TimePointIndex } from './time-data';\n\nexport abstract class PriceDataSource extends DataSource implements IPriceDataSource {\n\tprivate readonly _model: IChartModelBase;\n\n\tpublic constructor(model: IChartModelBase) {\n\t\tsuper();\n\t\tthis._model = model;\n\t}\n\n\tpublic model(): IChartModelBase {\n\t\treturn this._model;\n\t}\n\n\tpublic abstract minMove(): number;\n\n\tpublic abstract autoscaleInfo(startTimePoint: TimePointIndex, endTimePoint: TimePointIndex): AutoscaleInfoImpl | null;\n\n\tpublic abstract firstValue(): FirstValue | null;\n\tpublic abstract formatter(): IPriceFormatter;\n\tpublic abstract priceLineColor(lastBarColor: string): string;\n}\n","import { ensure, ensureNotNull } from '../helpers/assertions';\n\nimport { PlotRowValueIndex } from './plot-data';\nimport { Series } from './series';\nimport { SeriesPlotRow } from './series-data';\nimport {\n\tAreaStyleOptions,\n\tBarStyleOptions,\n\tBaselineStyleOptions,\n\tCandlestickStyleOptions,\n\tCustomStyleOptions,\n\tHistogramStyleOptions,\n\tLineStyleOptions,\n\tSeriesOptionsMap,\n\tSeriesType,\n} from './series-options';\nimport { TimePointIndex } from './time-data';\n\nexport interface PrecomputedBars {\n\tvalue: SeriesPlotRow;\n\tpreviousValue?: SeriesPlotRow;\n}\n\nexport interface CommonBarColorerStyle {\n\tbarColor: string;\n}\n\nexport interface LineStrokeColorerStyle {\n\tlineColor: string;\n}\n\nexport interface LineBarColorerStyle extends CommonBarColorerStyle, LineStrokeColorerStyle {\n}\n\nexport interface HistogramBarColorerStyle extends CommonBarColorerStyle {\n}\nexport interface AreaFillColorerStyle {\n\ttopColor: string;\n\tbottomColor: string;\n}\nexport interface AreaBarColorerStyle extends CommonBarColorerStyle, AreaFillColorerStyle, LineStrokeColorerStyle {\n}\n\nexport interface BaselineStrokeColorerStyle {\n\ttopLineColor: string;\n\tbottomLineColor: string;\n}\n\nexport interface BaselineFillColorerStyle {\n\ttopFillColor1: string;\n\ttopFillColor2: string;\n\tbottomFillColor2: string;\n\tbottomFillColor1: string;\n}\n\nexport interface BaselineBarColorerStyle extends CommonBarColorerStyle, BaselineStrokeColorerStyle, BaselineFillColorerStyle {\n}\n\nexport interface BarColorerStyle extends CommonBarColorerStyle {\n}\n\nexport interface CandlesticksColorerStyle extends CommonBarColorerStyle {\n\tbarBorderColor: string;\n\tbarWickColor: string;\n}\n\nexport interface CustomBarColorerStyle extends CommonBarColorerStyle {}\n\nexport interface BarStylesMap {\n\tBar: BarColorerStyle;\n\tCandlestick: CandlesticksColorerStyle;\n\tArea: AreaBarColorerStyle;\n\tBaseline: BaselineBarColorerStyle;\n\tLine: LineBarColorerStyle;\n\tHistogram: HistogramBarColorerStyle;\n\tCustom: CustomBarColorerStyle;\n}\n\ntype FindBarFn = (barIndex: TimePointIndex, precomputedBars?: PrecomputedBars) => SeriesPlotRow<SeriesType> | null;\n\ntype StyleGetterFn<T extends SeriesType> = (\n\tfindBar: FindBarFn,\n\tbarStyle: ReturnType<Series<T>['options']>,\n\tbarIndex: TimePointIndex,\n\tprecomputedBars?: PrecomputedBars\n) => BarStylesMap[T];\n\ntype BarStylesFnMap = {\n\t[T in keyof SeriesOptionsMap]: StyleGetterFn<T>;\n};\n\nexport interface ISeriesBarColorer<T extends SeriesType> {\n\tbarStyle(barIndex: TimePointIndex, precomputedBars?: PrecomputedBars): BarStylesMap[T];\n}\n\nconst barStyleFnMap: BarStylesFnMap = {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tBar: (findBar: FindBarFn, barStyle: BarStyleOptions, barIndex: TimePointIndex, precomputedBars?: PrecomputedBars): BarColorerStyle => {\n\t\tconst upColor = barStyle.upColor;\n\t\tconst downColor = barStyle.downColor;\n\n\t\tconst currentBar = ensureNotNull(findBar(barIndex, precomputedBars)) as SeriesPlotRow<'Bar'>;\n\t\tconst isUp = ensure(currentBar.value[PlotRowValueIndex.Open]) <= ensure(currentBar.value[PlotRowValueIndex.Close]);\n\n\t\treturn {\n\t\t\tbarColor: currentBar.color ?? (isUp ? upColor : downColor),\n\t\t};\n\t},\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tCandlestick: (findBar: FindBarFn, candlestickStyle: CandlestickStyleOptions, barIndex: TimePointIndex, precomputedBars?: PrecomputedBars): CandlesticksColorerStyle => {\n\t\tconst upColor = candlestickStyle.upColor;\n\t\tconst downColor = candlestickStyle.downColor;\n\t\tconst borderUpColor = candlestickStyle.borderUpColor;\n\t\tconst borderDownColor = candlestickStyle.borderDownColor;\n\n\t\tconst wickUpColor = candlestickStyle.wickUpColor;\n\t\tconst wickDownColor = candlestickStyle.wickDownColor;\n\n\t\tconst currentBar = ensureNotNull(findBar(barIndex, precomputedBars)) as SeriesPlotRow<'Candlestick'>;\n\t\tconst isUp = ensure(currentBar.value[PlotRowValueIndex.Open]) <= ensure(currentBar.value[PlotRowValueIndex.Close]);\n\n\t\treturn {\n\t\t\tbarColor: currentBar.color ?? (isUp ? upColor : downColor),\n\t\t\tbarBorderColor: currentBar.borderColor ?? (isUp ? borderUpColor : borderDownColor),\n\t\t\tbarWickColor: currentBar.wickColor ?? (isUp ? wickUpColor : wickDownColor),\n\t\t};\n\t},\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tCustom: (findBar: FindBarFn, customStyle: CustomStyleOptions, barIndex: TimePointIndex, precomputedBars?: PrecomputedBars): CustomBarColorerStyle => {\n\t\tconst currentBar = ensureNotNull(findBar(barIndex, precomputedBars)) as SeriesPlotRow<'Line'>;\n\n\t\treturn {\n\t\t\tbarColor: currentBar.color ?? customStyle.color,\n\t\t};\n\t},\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tArea: (findBar: FindBarFn, areaStyle: AreaStyleOptions, barIndex: TimePointIndex, precomputedBars?: PrecomputedBars): AreaBarColorerStyle => {\n\t\tconst currentBar = ensureNotNull(findBar(barIndex, precomputedBars)) as SeriesPlotRow<'Area'>;\n\t\treturn {\n\t\t\tbarColor: currentBar.lineColor ?? areaStyle.lineColor,\n\t\t\tlineColor: currentBar.lineColor ?? areaStyle.lineColor,\n\t\t\ttopColor: currentBar.topColor ?? areaStyle.topColor,\n\t\t\tbottomColor: currentBar.bottomColor ?? areaStyle.bottomColor,\n\t\t};\n\t},\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tBaseline: (findBar: FindBarFn, baselineStyle: BaselineStyleOptions, barIndex: TimePointIndex, precomputedBars?: PrecomputedBars): BaselineBarColorerStyle => {\n\t\tconst currentBar = ensureNotNull(findBar(barIndex, precomputedBars)) as SeriesPlotRow<'Baseline'>;\n\t\tconst isAboveBaseline = currentBar.value[PlotRowValueIndex.Close] >= baselineStyle.baseValue.price;\n\n\t\treturn {\n\t\t\tbarColor: isAboveBaseline ? baselineStyle.topLineColor : baselineStyle.bottomLineColor,\n\t\t\ttopLineColor: currentBar.topLineColor ?? baselineStyle.topLineColor,\n\t\t\tbottomLineColor: currentBar.bottomLineColor ?? baselineStyle.bottomLineColor,\n\t\t\ttopFillColor1: currentBar.topFillColor1 ?? baselineStyle.topFillColor1,\n\t\t\ttopFillColor2: currentBar.topFillColor2 ?? baselineStyle.topFillColor2,\n\t\t\tbottomFillColor1: currentBar.bottomFillColor1 ?? baselineStyle.bottomFillColor1,\n\t\t\tbottomFillColor2: currentBar.bottomFillColor2 ?? baselineStyle.bottomFillColor2,\n\t\t};\n\t},\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tLine: (findBar: FindBarFn, lineStyle: LineStyleOptions, barIndex: TimePointIndex, precomputedBars?: PrecomputedBars): LineBarColorerStyle => {\n\t\tconst currentBar = ensureNotNull(findBar(barIndex, precomputedBars)) as SeriesPlotRow<'Line'>;\n\n\t\treturn {\n\t\t\tbarColor: currentBar.color ?? lineStyle.color,\n\t\t\tlineColor: currentBar.color ?? lineStyle.color,\n\t\t};\n\t},\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tHistogram: (findBar: FindBarFn, histogramStyle: HistogramStyleOptions, barIndex: TimePointIndex, precomputedBars?: PrecomputedBars): HistogramBarColorerStyle => {\n\t\tconst currentBar = ensureNotNull(findBar(barIndex, precomputedBars)) as SeriesPlotRow<'Histogram'>;\n\t\treturn {\n\t\t\tbarColor: currentBar.color ?? histogramStyle.color,\n\t\t};\n\t},\n};\n\nexport class SeriesBarColorer<T extends SeriesType> implements ISeriesBarColorer<T> {\n\tprivate _series: Series<T>;\n\tprivate readonly _styleGetter: BarStylesFnMap[T];\n\n\tpublic constructor(series: Series<T>) {\n\t\tthis._series = series;\n\t\tthis._styleGetter = barStyleFnMap[series.seriesType()];\n\t}\n\n\tpublic barStyle(barIndex: TimePointIndex, precomputedBars?: PrecomputedBars): BarStylesMap[T] {\n\t\t// precomputedBars: {value: [Array BarValues], previousValue: [Array BarValues] | undefined}\n\t\t// Used to avoid binary search if bars are already known\n\t\treturn this._styleGetter(this._findBar, this._series.options(), barIndex, precomputedBars);\n\t}\n\n\tprivate _findBar = (barIndex: TimePointIndex, precomputedBars?: PrecomputedBars): SeriesPlotRow | null => {\n\t\tif (precomputedBars !== undefined) {\n\t\t\treturn precomputedBars.value;\n\t\t}\n\n\t\treturn this._series.bars().valueAt(barIndex);\n\t};\n}\n","import { lowerBound, upperBound } from '../helpers/algorithms';\nimport { ensureNotNull } from '../helpers/assertions';\nimport { Nominal } from '../helpers/nominal';\n\nimport { PlotRow, PlotRowValueIndex } from '../model/plot-data';\nimport { TimePointIndex } from '../model/time-data';\n\n/**\n * Search direction if no data found at provided index\n */\nexport const enum MismatchDirection {\n\t/**\n\t * Search the nearest left item\n\t */\n\tNearestLeft = -1,\n\t/**\n\t * Do not search\n\t */\n\tNone = 0,\n\t/**\n\t * Search the nearest right item\n\t */\n\tNearestRight = 1,\n}\n\nexport interface MinMax {\n\tmin: number;\n\tmax: number;\n}\n\ntype PlotRowIndex = Nominal<number, 'PlotRowIndex'>;\n\n// TODO: think about changing it dynamically\nconst CHUNK_SIZE = 30;\n\n/**\n * PlotList is an array of plot rows\n * each plot row consists of key (index in timescale) and plot value map\n */\nexport class PlotList<PlotRowType extends PlotRow = PlotRow> {\n\tprivate _items: readonly PlotRowType[] = [];\n\tprivate _minMaxCache: Map<PlotRowValueIndex, Map<number, MinMax | null>> = new Map();\n\tprivate _rowSearchCache: Map<TimePointIndex, Map<MismatchDirection, PlotRowType>> = new Map();\n\n\t// @returns Last row\n\tpublic last(): PlotRowType | null {\n\t\treturn this.size() > 0 ? this._items[this._items.length - 1] : null;\n\t}\n\n\tpublic firstIndex(): TimePointIndex | null {\n\t\treturn this.size() > 0 ? this._indexAt(0 as PlotRowIndex) : null;\n\t}\n\n\tpublic lastIndex(): TimePointIndex | null {\n\t\treturn this.size() > 0 ? this._indexAt((this._items.length - 1) as PlotRowIndex) : null;\n\t}\n\n\tpublic size(): number {\n\t\treturn this._items.length;\n\t}\n\n\tpublic isEmpty(): boolean {\n\t\treturn this.size() === 0;\n\t}\n\n\tpublic contains(index: TimePointIndex): boolean {\n\t\treturn this._search(index, MismatchDirection.None) !== null;\n\t}\n\n\tpublic valueAt(index: TimePointIndex): PlotRowType | null {\n\t\treturn this.search(index);\n\t}\n\n\tpublic search(index: TimePointIndex, searchMode: MismatchDirection = MismatchDirection.None): PlotRowType | null {\n\t\tconst pos = this._search(index, searchMode);\n\t\tif (pos === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\t...this._valueAt(pos),\n\t\t\tindex: this._indexAt(pos),\n\t\t};\n\t}\n\n\tpublic rows(): readonly PlotRowType[] {\n\t\treturn this._items;\n\t}\n\n\tpublic minMaxOnRangeCached(start: TimePointIndex, end: TimePointIndex, plots: readonly PlotRowValueIndex[]): MinMax | null {\n\t\t// this code works for single series only\n\t\t// could fail after whitespaces implementation\n\n\t\tif (this.isEmpty()) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet result: MinMax | null = null;\n\n\t\tfor (const plot of plots) {\n\t\t\tconst plotMinMax = this._minMaxOnRangeCachedImpl(start, end, plot);\n\t\t\tresult = mergeMinMax(result, plotMinMax);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tpublic setData(plotRows: readonly PlotRowType[]): void {\n\t\tthis._rowSearchCache.clear();\n\t\tthis._minMaxCache.clear();\n\n\t\tthis._items = plotRows;\n\t}\n\n\tprivate _indexAt(offset: PlotRowIndex): TimePointIndex {\n\t\treturn this._items[offset].index;\n\t}\n\n\tprivate _valueAt(offset: PlotRowIndex): PlotRowType {\n\t\treturn this._items[offset];\n\t}\n\n\tprivate _search(index: TimePointIndex, searchMode: MismatchDirection): PlotRowIndex | null {\n\t\tconst exactPos = this._bsearch(index);\n\n\t\tif (exactPos === null && searchMode !== MismatchDirection.None) {\n\t\t\tswitch (searchMode) {\n\t\t\t\tcase MismatchDirection.NearestLeft:\n\t\t\t\t\treturn this._searchNearestLeft(index);\n\t\t\t\tcase MismatchDirection.NearestRight:\n\t\t\t\t\treturn this._searchNearestRight(index);\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new TypeError('Unknown search mode');\n\t\t\t}\n\t\t}\n\n\t\treturn exactPos;\n\t}\n\n\tprivate _searchNearestLeft(index: TimePointIndex): PlotRowIndex | null {\n\t\tlet nearestLeftPos = this._lowerbound(index);\n\t\tif (nearestLeftPos > 0) {\n\t\t\tnearestLeftPos = nearestLeftPos - 1;\n\t\t}\n\n\t\treturn (nearestLeftPos !== this._items.length && this._indexAt(nearestLeftPos as PlotRowIndex) < index) ? nearestLeftPos as PlotRowIndex : null;\n\t}\n\n\tprivate _searchNearestRight(index: TimePointIndex): PlotRowIndex | null {\n\t\tconst nearestRightPos = this._upperbound(index);\n\t\treturn (nearestRightPos !== this._items.length && index < this._indexAt(nearestRightPos as PlotRowIndex)) ? nearestRightPos as PlotRowIndex : null;\n\t}\n\n\tprivate _bsearch(index: TimePointIndex): PlotRowIndex | null {\n\t\tconst start = this._lowerbound(index);\n\t\tif (start !== this._items.length && !(index < this._items[start as PlotRowIndex].index)) {\n\t\t\treturn start as PlotRowIndex;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate _lowerbound(index: TimePointIndex): number {\n\t\treturn lowerBound(\n\t\t\tthis._items,\n\t\t\tindex,\n\t\t\t(a: PlotRowType, b: TimePointIndex) => a.index < b\n\t\t);\n\t}\n\n\tprivate _upperbound(index: TimePointIndex): number {\n\t\treturn upperBound(\n\t\t\tthis._items,\n\t\t\tindex,\n\t\t\t(a: PlotRowType, b: TimePointIndex) => a.index > b\n\t\t);\n\t}\n\n\tprivate _plotMinMax(startIndex: PlotRowIndex, endIndexExclusive: PlotRowIndex, plotIndex: PlotRowValueIndex): MinMax | null {\n\t\tlet result: MinMax | null = null;\n\n\t\tfor (let i = startIndex; i < endIndexExclusive; i++) {\n\t\t\tconst values = this._items[i].value;\n\n\t\t\tconst v = values[plotIndex];\n\t\t\tif (Number.isNaN(v)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (result === null) {\n\t\t\t\tresult = { min: v, max: v };\n\t\t\t} else {\n\t\t\t\tif (v < result.min) {\n\t\t\t\t\tresult.min = v;\n\t\t\t\t}\n\n\t\t\t\tif (v > result.max) {\n\t\t\t\t\tresult.max = v;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate _minMaxOnRangeCachedImpl(start: TimePointIndex, end: TimePointIndex, plotIndex: PlotRowValueIndex): MinMax | null {\n\t\t// this code works for single series only\n\t\t// could fail after whitespaces implementation\n\n\t\tif (this.isEmpty()) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet result: MinMax | null = null;\n\n\t\t// assume that bar indexes only increase\n\t\tconst firstIndex = ensureNotNull(this.firstIndex());\n\t\tconst lastIndex = ensureNotNull(this.lastIndex());\n\n\t\tconst s = Math.max(start, firstIndex);\n\t\tconst e = Math.min(end, lastIndex);\n\n\t\tconst cachedLow = Math.ceil(s / CHUNK_SIZE) * CHUNK_SIZE;\n\t\tconst cachedHigh = Math.max(cachedLow, Math.floor(e / CHUNK_SIZE) * CHUNK_SIZE);\n\n\t\t{\n\t\t\tconst startIndex = this._lowerbound(s as TimePointIndex);\n\t\t\tconst endIndex = this._upperbound(Math.min(e, cachedLow, end) as TimePointIndex); // non-inclusive end\n\t\t\tconst plotMinMax = this._plotMinMax(startIndex as PlotRowIndex, endIndex as PlotRowIndex, plotIndex);\n\t\t\tresult = mergeMinMax(result, plotMinMax);\n\t\t}\n\n\t\tlet minMaxCache = this._minMaxCache.get(plotIndex);\n\n\t\tif (minMaxCache === undefined) {\n\t\t\tminMaxCache = new Map();\n\t\t\tthis._minMaxCache.set(plotIndex, minMaxCache);\n\t\t}\n\n\t\t// now go cached\n\t\tfor (let c = Math.max(cachedLow + 1, s); c < cachedHigh; c += CHUNK_SIZE) {\n\t\t\tconst chunkIndex = Math.floor(c / CHUNK_SIZE);\n\n\t\t\tlet chunkMinMax = minMaxCache.get(chunkIndex);\n\t\t\tif (chunkMinMax === undefined) {\n\t\t\t\tconst chunkStart = this._lowerbound(chunkIndex * CHUNK_SIZE as TimePointIndex);\n\t\t\t\tconst chunkEnd = this._upperbound((chunkIndex + 1) * CHUNK_SIZE - 1 as TimePointIndex);\n\t\t\t\tchunkMinMax = this._plotMinMax(chunkStart as PlotRowIndex, chunkEnd as PlotRowIndex, plotIndex);\n\t\t\t\tminMaxCache.set(chunkIndex, chunkMinMax);\n\t\t\t}\n\n\t\t\tresult = mergeMinMax(result, chunkMinMax);\n\t\t}\n\n\t\t// tail\n\t\t{\n\t\t\tconst startIndex = this._lowerbound(cachedHigh as TimePointIndex);\n\t\t\tconst endIndex = this._upperbound(e as TimePointIndex); // non-inclusive end\n\t\t\tconst plotMinMax = this._plotMinMax(startIndex as PlotRowIndex, endIndex as PlotRowIndex, plotIndex);\n\t\t\tresult = mergeMinMax(result, plotMinMax);\n\t\t}\n\n\t\treturn result;\n\t}\n}\n\nfunction mergeMinMax(first: MinMax | null, second: MinMax | null): MinMax | null {\n\tif (first === null) {\n\t\treturn second;\n\t} else {\n\t\tif (second === null) {\n\t\t\treturn first;\n\t\t} else {\n\t\t\t// merge MinMax values\n\t\t\tconst min = Math.min(first.min, second.min);\n\t\t\tconst max = Math.max(first.max, second.max);\n\t\t\treturn { min: min, max: max };\n\t\t}\n\t}\n}\n","import { PlotRow } from './plot-data';\nimport { PlotList } from './plot-list';\nimport { SeriesType } from './series-options';\n\nexport interface LinePlotRow extends PlotRow {\n\treadonly color?: string;\n}\n\nexport interface AreaPlotRow extends PlotRow {\n\tlineColor?: string;\n\ttopColor?: string;\n\tbottomColor?: string;\n}\n\nexport interface BaselinePlotRow extends PlotRow {\n\ttopFillColor1?: string;\n\ttopFillColor2?: string;\n\ttopLineColor?: string;\n\tbottomFillColor1?: string;\n\tbottomFillColor2?: string;\n\tbottomLineColor?: string;\n}\n\nexport interface HistogramPlotRow extends PlotRow {\n\treadonly color?: string;\n}\n\nexport interface BarPlotRow extends PlotRow {\n\treadonly color?: string;\n}\n\nexport interface CandlestickPlotRow extends PlotRow {\n\treadonly color?: string;\n\treadonly borderColor?: string;\n\treadonly wickColor?: string;\n}\n\nexport interface CustomPlotRow extends PlotRow {\n\t// Used to store the original data values\n\tdata: Record<string, unknown>;\n\treadonly color?: string;\n}\n\nexport interface SeriesPlotRowTypeAtTypeMap {\n\tBar: BarPlotRow;\n\tCandlestick: CandlestickPlotRow;\n\tArea: AreaPlotRow;\n\tBaseline: BaselinePlotRow;\n\tLine: LinePlotRow;\n\tHistogram: HistogramPlotRow;\n\tCustom: CustomPlotRow;\n}\n\nexport type SeriesPlotRow<T extends SeriesType = SeriesType> = SeriesPlotRowTypeAtTypeMap[T];\nexport type SeriesPlotList<T extends SeriesType = SeriesType> = PlotList<SeriesPlotRow<T>>;\n\nexport function createSeriesPlotList<T extends SeriesType>(): SeriesPlotList<T> {\n\treturn new PlotList<SeriesPlotRow<T>>();\n}\n","import { CanvasRenderingTarget2D } from 'fancy-canvas';\n\nimport { IPaneRenderer } from '../renderers/ipane-renderer';\nimport { PriceAxisViewRendererCommonData, PriceAxisViewRendererData } from '../renderers/iprice-axis-view-renderer';\nimport { TimeAxisViewRenderer } from '../renderers/time-axis-view-renderer';\nimport { IPaneView } from '../views/pane/ipane-view';\nimport { IPriceAxisView } from '../views/price-axis/iprice-axis-view';\nimport { PriceAxisView } from '../views/price-axis/price-axis-view';\nimport { ITimeAxisView } from '../views/time-axis/itime-axis-view';\n\nimport { Coordinate } from './coordinate';\nimport {\n\tISeriesPrimitiveAxisView,\n\tISeriesPrimitiveBase,\n\tISeriesPrimitivePaneRenderer,\n\tISeriesPrimitivePaneView,\n\tPrimitiveHoveredItem,\n\tSeriesPrimitivePaneViewZOrder,\n} from './iseries-primitive';\nimport { PriceScale } from './price-scale';\nimport { Series } from './series';\nimport { AutoscaleInfo, SeriesType } from './series-options';\nimport { Logical, TimePointIndex } from './time-data';\nimport { ITimeScale } from './time-scale';\n\nclass SeriesPrimitiveRendererWrapper implements IPaneRenderer {\n\tprivate readonly _baseRenderer: ISeriesPrimitivePaneRenderer;\n\n\tpublic constructor(baseRenderer: ISeriesPrimitivePaneRenderer) {\n\t\tthis._baseRenderer = baseRenderer;\n\t}\n\n\tpublic draw(target: CanvasRenderingTarget2D, isHovered: boolean, hitTestData?: unknown): void {\n\t\tthis._baseRenderer.draw(target);\n\t}\n\n\tpublic drawBackground?(target: CanvasRenderingTarget2D, isHovered: boolean, hitTestData?: unknown): void {\n\t\tthis._baseRenderer.drawBackground?.(target);\n\t}\n}\n\ninterface RendererCache<Base, Wrapper> {\n\tbase: Base;\n\twrapper: Wrapper;\n}\n\nexport interface ISeriesPrimitivePaneViewWrapper extends IPaneView {\n\tzOrder(): SeriesPrimitivePaneViewZOrder;\n}\n\nclass SeriesPrimitivePaneViewWrapper implements IPaneView {\n\tprivate readonly _paneView: ISeriesPrimitivePaneView;\n\tprivate _cache: RendererCache<ISeriesPrimitivePaneRenderer, SeriesPrimitiveRendererWrapper> | null = null;\n\n\tpublic constructor(paneView: ISeriesPrimitivePaneView) {\n\t\tthis._paneView = paneView;\n\t}\n\n\tpublic renderer(): IPaneRenderer | null {\n\t\tconst baseRenderer = this._paneView.renderer();\n\t\tif (baseRenderer === null) {\n\t\t\treturn null;\n\t\t}\n\t\tif (this._cache?.base === baseRenderer) {\n\t\t\treturn this._cache.wrapper;\n\t\t}\n\t\tconst wrapper = new SeriesPrimitiveRendererWrapper(baseRenderer);\n\t\tthis._cache = {\n\t\t\tbase: baseRenderer,\n\t\t\twrapper,\n\t\t};\n\t\treturn wrapper;\n\t}\n\n\tpublic zOrder(): SeriesPrimitivePaneViewZOrder {\n\t\treturn this._paneView.zOrder?.() ?? 'normal';\n\t}\n}\n\ninterface AxisViewData {\n\ttext: string;\n\tcoordinate: number;\n\tfixedCoordinate: number | undefined;\n\tcolor: string;\n\tbackground: string;\n\tvisible: boolean;\n\ttickVisible: boolean;\n}\n\nfunction getAxisViewData(baseView: ISeriesPrimitiveAxisView): AxisViewData {\n\treturn {\n\t\ttext: baseView.text(),\n\t\tcoordinate: baseView.coordinate(),\n\t\tfixedCoordinate: baseView.fixedCoordinate?.(),\n\t\tcolor: baseView.textColor(),\n\t\tbackground: baseView.backColor(),\n\t\tvisible: baseView.visible?.() ?? true,\n\t\ttickVisible: baseView.tickVisible?.() ?? true,\n\t};\n}\n\nclass SeriesPrimitiveTimeAxisViewWrapper implements ITimeAxisView {\n\tprivate readonly _baseView: ISeriesPrimitiveAxisView;\n\tprivate readonly _timeScale: ITimeScale;\n\tprivate readonly _renderer: TimeAxisViewRenderer = new TimeAxisViewRenderer();\n\n\tpublic constructor(baseView: ISeriesPrimitiveAxisView, timeScale: ITimeScale) {\n\t\tthis._baseView = baseView;\n\t\tthis._timeScale = timeScale;\n\t}\n\n\tpublic renderer(): TimeAxisViewRenderer {\n\t\tthis._renderer.setData({\n\t\t\twidth: this._timeScale.width(),\n\t\t\t...getAxisViewData(this._baseView),\n\t\t});\n\t\treturn this._renderer;\n\t}\n}\n\nclass SeriesPrimitivePriceAxisViewWrapper extends PriceAxisView {\n\tprivate readonly _baseView: ISeriesPrimitiveAxisView;\n\tprivate readonly _priceScale: PriceScale;\n\n\tpublic constructor(baseView: ISeriesPrimitiveAxisView, priceScale: PriceScale) {\n\t\tsuper();\n\t\tthis._baseView = baseView;\n\t\tthis._priceScale = priceScale;\n\t}\n\n\tprotected override _updateRendererData(\n\t\taxisRendererData: PriceAxisViewRendererData,\n\t\tpaneRendererData: PriceAxisViewRendererData,\n\t\tcommonRendererData: PriceAxisViewRendererCommonData\n\t): void {\n\t\tconst data = getAxisViewData(this._baseView);\n\t\tcommonRendererData.background = data.background;\n\t\taxisRendererData.color = data.color;\n\n\t\tconst additionalPadding = 2 / 12 * this._priceScale.fontSize();\n\n\t\tcommonRendererData.additionalPaddingTop = additionalPadding;\n\t\tcommonRendererData.additionalPaddingBottom = additionalPadding;\n\n\t\tcommonRendererData.coordinate = data.coordinate;\n\t\tcommonRendererData.fixedCoordinate = data.fixedCoordinate;\n\t\taxisRendererData.text = data.text;\n\t\taxisRendererData.visible = data.visible;\n\t\taxisRendererData.tickVisible = data.tickVisible;\n\t}\n}\n\nexport class SeriesPrimitiveWrapper<TSeriesAttachedParameters = unknown> {\n\tprivate readonly _primitive: ISeriesPrimitiveBase<TSeriesAttachedParameters>;\n\tprivate readonly _series: Series<SeriesType>;\n\tprivate _paneViewsCache: RendererCache<readonly ISeriesPrimitivePaneView[], readonly SeriesPrimitivePaneViewWrapper[]> | null = null;\n\tprivate _timeAxisViewsCache: RendererCache<readonly ISeriesPrimitiveAxisView[], readonly SeriesPrimitiveTimeAxisViewWrapper[]> | null = null;\n\tprivate _priceAxisViewsCache: RendererCache<readonly ISeriesPrimitiveAxisView[], readonly SeriesPrimitivePriceAxisViewWrapper[]> | null = null;\n\tprivate _priceAxisPaneViewsCache: RendererCache<readonly ISeriesPrimitivePaneView[], readonly SeriesPrimitivePaneViewWrapper[]> | null = null;\n\tprivate _timeAxisPaneViewsCache: RendererCache<readonly ISeriesPrimitivePaneView[], readonly SeriesPrimitivePaneViewWrapper[]> | null = null;\n\n\tpublic constructor(primitive: ISeriesPrimitiveBase<TSeriesAttachedParameters>, series: Series<SeriesType>) {\n\t\tthis._primitive = primitive;\n\t\tthis._series = series;\n\t}\n\n\tpublic primitive(): ISeriesPrimitiveBase<TSeriesAttachedParameters> {\n\t\treturn this._primitive;\n\t}\n\n\tpublic updateAllViews(): void {\n\t\tthis._primitive.updateAllViews?.();\n\t}\n\n\tpublic paneViews(): readonly ISeriesPrimitivePaneViewWrapper[] {\n\t\tconst base = this._primitive.paneViews?.() ?? [];\n\t\tif (this._paneViewsCache?.base === base) {\n\t\t\treturn this._paneViewsCache.wrapper;\n\t\t}\n\t\tconst wrapper = base.map((pw: ISeriesPrimitivePaneView) => new SeriesPrimitivePaneViewWrapper(pw));\n\t\tthis._paneViewsCache = {\n\t\t\tbase,\n\t\t\twrapper,\n\t\t};\n\t\treturn wrapper;\n\t}\n\n\tpublic timeAxisViews(): readonly ITimeAxisView[] {\n\t\tconst base = this._primitive.timeAxisViews?.() ?? [];\n\t\tif (this._timeAxisViewsCache?.base === base) {\n\t\t\treturn this._timeAxisViewsCache.wrapper;\n\t\t}\n\t\tconst timeScale = this._series.model().timeScale();\n\t\tconst wrapper = base.map((aw: ISeriesPrimitiveAxisView) => new SeriesPrimitiveTimeAxisViewWrapper(aw, timeScale));\n\t\tthis._timeAxisViewsCache = {\n\t\t\tbase,\n\t\t\twrapper,\n\t\t};\n\t\treturn wrapper;\n\t}\n\n\tpublic priceAxisViews(): readonly IPriceAxisView[] {\n\t\tconst base = this._primitive.priceAxisViews?.() ?? [];\n\t\tif (this._priceAxisViewsCache?.base === base) {\n\t\t\treturn this._priceAxisViewsCache.wrapper;\n\t\t}\n\t\tconst priceScale = this._series.priceScale();\n\t\tconst wrapper = base.map((aw: ISeriesPrimitiveAxisView) => new SeriesPrimitivePriceAxisViewWrapper(aw, priceScale));\n\t\tthis._priceAxisViewsCache = {\n\t\t\tbase,\n\t\t\twrapper,\n\t\t};\n\t\treturn wrapper;\n\t}\n\n\tpublic priceAxisPaneViews(): readonly ISeriesPrimitivePaneViewWrapper[] {\n\t\tconst base = this._primitive.priceAxisPaneViews?.() ?? [];\n\t\tif (this._priceAxisPaneViewsCache?.base === base) {\n\t\t\treturn this._priceAxisPaneViewsCache.wrapper;\n\t\t}\n\t\tconst wrapper = base.map((pw: ISeriesPrimitivePaneView) => new SeriesPrimitivePaneViewWrapper(pw));\n\t\tthis._priceAxisPaneViewsCache = {\n\t\t\tbase,\n\t\t\twrapper,\n\t\t};\n\t\treturn wrapper;\n\t}\n\n\tpublic timeAxisPaneViews(): readonly ISeriesPrimitivePaneViewWrapper[] {\n\t\tconst base = this._primitive.timeAxisPaneViews?.() ?? [];\n\t\tif (this._timeAxisPaneViewsCache?.base === base) {\n\t\t\treturn this._timeAxisPaneViewsCache.wrapper;\n\t\t}\n\t\tconst wrapper = base.map((pw: ISeriesPrimitivePaneView) => new SeriesPrimitivePaneViewWrapper(pw));\n\t\tthis._timeAxisPaneViewsCache = {\n\t\t\tbase,\n\t\t\twrapper,\n\t\t};\n\t\treturn wrapper;\n\t}\n\n\tpublic autoscaleInfo(\n\t\tstartTimePoint: TimePointIndex,\n\t\tendTimePoint: TimePointIndex\n\t): AutoscaleInfo | null {\n\t\treturn (\n\t\t\tthis._primitive.autoscaleInfo?.(\n\t\t\t\tstartTimePoint as unknown as Logical,\n\t\t\t\tendTimePoint as unknown as Logical\n\t\t\t) ?? null\n\t\t);\n\t}\n\n\tpublic hitTest(x: Coordinate, y: Coordinate): PrimitiveHoveredItem | null {\n\t\treturn this._primitive.hitTest?.(x, y) ?? null;\n\t}\n}\n","import { IPriceFormatter } from '../formatters/iprice-formatter';\nimport { PercentageFormatter } from '../formatters/percentage-formatter';\nimport { PriceFormatter } from '../formatters/price-formatter';\nimport { VolumeFormatter } from '../formatters/volume-formatter';\n\nimport { ensureDefined, ensureNotNull } from '../helpers/assertions';\nimport { IDestroyable } from '../helpers/idestroyable';\nimport { isInteger, merge } from '../helpers/strict-type-checks';\n\nimport { SeriesAreaPaneView } from '../views/pane/area-pane-view';\nimport { SeriesBarsPaneView } from '../views/pane/bars-pane-view';\nimport { SeriesBaselinePaneView } from '../views/pane/baseline-pane-view';\nimport { SeriesCandlesticksPaneView } from '../views/pane/candlesticks-pane-view';\nimport { SeriesCustomPaneView } from '../views/pane/custom-pane-view';\nimport { SeriesHistogramPaneView } from '../views/pane/histogram-pane-view';\nimport { IPaneView } from '../views/pane/ipane-view';\nimport { IUpdatablePaneView } from '../views/pane/iupdatable-pane-view';\nimport { SeriesLinePaneView } from '../views/pane/line-pane-view';\nimport { PanePriceAxisView } from '../views/pane/pane-price-axis-view';\nimport { SeriesHorizontalBaseLinePaneView } from '../views/pane/series-horizontal-base-line-pane-view';\nimport { SeriesLastPriceAnimationPaneView } from '../views/pane/series-last-price-animation-pane-view';\nimport { SeriesMarkersPaneView } from '../views/pane/series-markers-pane-view';\nimport { SeriesPriceLinePaneView } from '../views/pane/series-price-line-pane-view';\nimport { IPriceAxisView } from '../views/price-axis/iprice-axis-view';\nimport { SeriesPriceAxisView } from '../views/price-axis/series-price-axis-view';\nimport { ITimeAxisView } from '../views/time-axis/itime-axis-view';\n\nimport { AutoscaleInfoImpl, AutoScaleMargins } from './autoscale-info-impl';\nimport { BarPrice, BarPrices } from './bar';\nimport { IChartModelBase } from './chart-model';\nimport { Coordinate } from './coordinate';\nimport { CustomPriceLine } from './custom-price-line';\nimport { isDefaultPriceScale } from './default-price-scale';\nimport { CustomData, CustomSeriesWhitespaceData, ICustomSeriesPaneView, WhitespaceCheck } from './icustom-series';\nimport { InternalHorzScaleItem } from './ihorz-scale-behavior';\nimport { FirstValue, IPriceDataSource } from './iprice-data-source';\nimport { ISeriesPrimitiveBase, PrimitiveHoveredItem, SeriesPrimitivePaneViewZOrder } from './iseries-primitive';\nimport { Pane } from './pane';\nimport { PlotRowValueIndex } from './plot-data';\nimport { MismatchDirection } from './plot-list';\nimport { PriceDataSource } from './price-data-source';\nimport { PriceLineOptions } from './price-line-options';\nimport { PriceRangeImpl } from './price-range-impl';\nimport { PriceScale } from './price-scale';\nimport { ISeriesBarColorer, SeriesBarColorer } from './series-bar-colorer';\nimport { createSeriesPlotList, SeriesPlotList, SeriesPlotRow } from './series-data';\nimport { InternalSeriesMarker, SeriesMarker } from './series-markers';\nimport {\n\tAreaStyleOptions,\n\tBaselineStyleOptions,\n\tHistogramStyleOptions,\n\tLineStyleOptions,\n\tSeriesOptionsMap,\n\tSeriesPartialOptionsMap,\n\tSeriesType,\n} from './series-options';\nimport { ISeriesPrimitivePaneViewWrapper, SeriesPrimitiveWrapper } from './series-primitive-wrapper';\nimport { TimePointIndex } from './time-data';\n\ntype PrimitivePaneViewExtractor = (wrapper: SeriesPrimitiveWrapper) => readonly ISeriesPrimitivePaneViewWrapper[];\nfunction extractPrimitivePaneViews(\n\tprimitives: SeriesPrimitiveWrapper[],\n\textractor: PrimitivePaneViewExtractor,\n\tzOrder: SeriesPrimitivePaneViewZOrder,\n\tdestination: IPaneView[]\n): void {\n\tprimitives.forEach((wrapper: SeriesPrimitiveWrapper) => {\n\t\textractor(wrapper).forEach((paneView: ISeriesPrimitivePaneViewWrapper) => {\n\t\t\tif (paneView.zOrder() !== zOrder) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdestination.push(paneView);\n\t\t});\n\t});\n}\n\nfunction primitivePaneViewsExtractor(wrapper: SeriesPrimitiveWrapper): readonly ISeriesPrimitivePaneViewWrapper[] {\n\treturn wrapper.paneViews();\n}\nfunction primitivePricePaneViewsExtractor(wrapper: SeriesPrimitiveWrapper): readonly ISeriesPrimitivePaneViewWrapper[] {\n\treturn wrapper.priceAxisPaneViews();\n}\nfunction primitiveTimePaneViewsExtractor(wrapper: SeriesPrimitiveWrapper): readonly ISeriesPrimitivePaneViewWrapper[] {\n\treturn wrapper.timeAxisPaneViews();\n}\n\ntype CustomDataToPlotRowValueConverter<HorzScaleItem> = (item: CustomData<HorzScaleItem> | CustomSeriesWhitespaceData<HorzScaleItem>) => number[];\n\nexport interface LastValueDataResultWithoutData {\n\tnoData: true;\n}\n\nexport interface LastValueDataResultWithData {\n\tnoData: false;\n\n\tprice: number;\n\ttext: string;\n\tformattedPriceAbsolute: string;\n\tformattedPricePercentage: string;\n\tcolor: string;\n\tcoordinate: Coordinate;\n\tindex: TimePointIndex;\n}\n\nexport type LastValueDataResult = LastValueDataResultWithoutData | LastValueDataResultWithData;\n\nexport interface MarkerData {\n\tprice: BarPrice;\n\tradius: number;\n\tborderColor: string | null;\n\tborderWidth: number;\n\tbackgroundColor: string;\n}\n\nexport interface SeriesDataAtTypeMap {\n\tBar: BarPrices;\n\tCandlestick: BarPrices;\n\tArea: BarPrice;\n\tBaseline: BarPrice;\n\tLine: BarPrice;\n\tHistogram: BarPrice;\n\tCustom: BarPrice;\n}\n\nexport interface SeriesUpdateInfo {\n\tlastBarUpdatedOrNewBarsAddedToTheRight: boolean;\n}\n\n// note that if would like to use `Omit` here - you can't due https://github.com/microsoft/TypeScript/issues/36981\nexport type SeriesOptionsInternal<T extends SeriesType = SeriesType> = SeriesOptionsMap[T];\nexport type SeriesPartialOptionsInternal<T extends SeriesType = SeriesType> = SeriesPartialOptionsMap[T];\n\nexport interface ISeries<T extends SeriesType> extends IPriceDataSource {\n\tbars(): SeriesPlotList<T>;\n\tvisible(): boolean;\n\toptions(): Readonly<SeriesOptionsMap[T]>;\n\ttitle(): string;\n\tpriceScale(): PriceScale;\n\tlastValueData(globalLast: boolean): LastValueDataResult;\n\tindexedMarkers(): InternalSeriesMarker<TimePointIndex>[];\n\tbarColorer(): ISeriesBarColorer<T>;\n\tmarkerDataAtIndex(index: TimePointIndex): MarkerData | null;\n\tdataAt(time: TimePointIndex): SeriesDataAtTypeMap[SeriesType] | null;\n}\n\nexport class Series<T extends SeriesType> extends PriceDataSource implements IDestroyable, ISeries<SeriesType> {\n\tprivate readonly _seriesType: T;\n\tprivate _data: SeriesPlotList<T> = createSeriesPlotList<T>();\n\tprivate readonly _priceAxisViews: IPriceAxisView[];\n\tprivate readonly _panePriceAxisView: PanePriceAxisView;\n\tprivate _formatter!: IPriceFormatter;\n\tprivate readonly _priceLineView: SeriesPriceLinePaneView = new SeriesPriceLinePaneView(this);\n\tprivate readonly _customPriceLines: CustomPriceLine[] = [];\n\tprivate readonly _baseHorizontalLineView: SeriesHorizontalBaseLinePaneView = new SeriesHorizontalBaseLinePaneView(this);\n\tprivate _paneView!: IUpdatablePaneView | SeriesCustomPaneView;\n\tprivate readonly _lastPriceAnimationPaneView: SeriesLastPriceAnimationPaneView | null = null;\n\tprivate _barColorerCache: SeriesBarColorer<T> | null = null;\n\tprivate readonly _options: SeriesOptionsInternal<T>;\n\tprivate _markers: readonly SeriesMarker<InternalHorzScaleItem>[] = [];\n\tprivate _indexedMarkers: InternalSeriesMarker<TimePointIndex>[] = [];\n\tprivate _markersPaneView!: SeriesMarkersPaneView;\n\tprivate _animationTimeoutId: TimerId | null = null;\n\tprivate _primitives: SeriesPrimitiveWrapper[] = [];\n\n\tpublic constructor(model: IChartModelBase, options: SeriesOptionsInternal<T>, seriesType: T, pane?: Pane, customPaneView?: ICustomSeriesPaneView<unknown>) {\n\t\tsuper(model);\n\t\tthis._options = options;\n\t\tthis._seriesType = seriesType;\n\n\t\tconst priceAxisView = new SeriesPriceAxisView(this);\n\t\tthis._priceAxisViews = [priceAxisView];\n\n\t\tthis._panePriceAxisView = new PanePriceAxisView(priceAxisView, this, model);\n\n\t\tif (seriesType === 'Area' || seriesType === 'Line' || seriesType === 'Baseline') {\n\t\t\tthis._lastPriceAnimationPaneView = new SeriesLastPriceAnimationPaneView(this as Series<'Area'> | Series<'Line'> | Series<'Baseline'>);\n\t\t}\n\n\t\tthis._recreateFormatter();\n\n\t\tthis._recreatePaneViews(customPaneView);\n\t}\n\n\tpublic destroy(): void {\n\t\tif (this._animationTimeoutId !== null) {\n\t\t\tclearTimeout(this._animationTimeoutId);\n\t\t}\n\t}\n\n\tpublic priceLineColor(lastBarColor: string): string {\n\t\treturn this._options.priceLineColor || lastBarColor;\n\t}\n\n\tpublic lastValueData(globalLast: boolean): LastValueDataResult {\n\t\tconst noDataRes: LastValueDataResultWithoutData = { noData: true };\n\n\t\tconst priceScale = this.priceScale();\n\n\t\tif (this.model().timeScale().isEmpty() || priceScale.isEmpty() || this._data.isEmpty()) {\n\t\t\treturn noDataRes;\n\t\t}\n\n\t\tconst visibleBars = this.model().timeScale().visibleStrictRange();\n\t\tconst firstValue = this.firstValue();\n\t\tif (visibleBars === null || firstValue === null) {\n\t\t\treturn noDataRes;\n\t\t}\n\n\t\t// find range of bars inside range\n\t\t// TODO: make it more optimal\n\t\tlet bar: SeriesPlotRow<T> | null;\n\t\tlet lastIndex: TimePointIndex;\n\t\tif (globalLast) {\n\t\t\tconst lastBar = this._data.last();\n\t\t\tif (lastBar === null) {\n\t\t\t\treturn noDataRes;\n\t\t\t}\n\n\t\t\tbar = lastBar;\n\t\t\tlastIndex = lastBar.index;\n\t\t} else {\n\t\t\tconst endBar = this._data.search(visibleBars.right(), MismatchDirection.NearestLeft);\n\t\t\tif (endBar === null) {\n\t\t\t\treturn noDataRes;\n\t\t\t}\n\n\t\t\tbar = this._data.valueAt(endBar.index);\n\t\t\tif (bar === null) {\n\t\t\t\treturn noDataRes;\n\t\t\t}\n\t\t\tlastIndex = endBar.index;\n\t\t}\n\n\t\tconst price = bar.value[PlotRowValueIndex.Close];\n\t\tconst barColorer = this.barColorer();\n\t\tconst style = barColorer.barStyle(lastIndex, { value: bar });\n\t\tconst coordinate = priceScale.priceToCoordinate(price, firstValue.value);\n\n\t\treturn {\n\t\t\tnoData: false,\n\t\t\tprice,\n\t\t\ttext: priceScale.formatPrice(price, firstValue.value),\n\t\t\tformattedPriceAbsolute: priceScale.formatPriceAbsolute(price),\n\t\t\tformattedPricePercentage: priceScale.formatPricePercentage(price, firstValue.value),\n\t\t\tcolor: style.barColor,\n\t\t\tcoordinate: coordinate,\n\t\t\tindex: lastIndex,\n\t\t};\n\t}\n\n\tpublic barColorer(): SeriesBarColorer<T> {\n\t\tif (this._barColorerCache !== null) {\n\t\t\treturn this._barColorerCache;\n\t\t}\n\n\t\tthis._barColorerCache = new SeriesBarColorer(this);\n\t\treturn this._barColorerCache;\n\t}\n\n\tpublic options(): Readonly<SeriesOptionsMap[T]> {\n\t\treturn this._options as SeriesOptionsMap[T];\n\t}\n\n\tpublic applyOptions(options: SeriesPartialOptionsInternal<T>): void {\n\t\tconst targetPriceScaleId = options.priceScaleId;\n\t\tif (targetPriceScaleId !== undefined && targetPriceScaleId !== this._options.priceScaleId) {\n\t\t\t// series cannot do it itself, ask model\n\t\t\tthis.model().moveSeriesToScale(this, targetPriceScaleId);\n\t\t}\n\t\tmerge(this._options, options);\n\n\t\tif (options.priceFormat !== undefined) {\n\t\t\tthis._recreateFormatter();\n\n\t\t\t// updated formatter might affect rendering  and as a consequence of this the width of price axis might be changed\n\t\t\t// thus we need to force the chart to do a full update to apply changes correctly\n\t\t\t// full update is quite heavy operation in terms of performance\n\t\t\t// but updating formatter looks like quite rare so forcing a full update here shouldn't affect the performance a lot\n\t\t\tthis.model().fullUpdate();\n\t\t}\n\n\t\tthis.model().updateSource(this);\n\n\t\t// a series might affect crosshair by some options (like crosshair markers)\n\t\t// that's why we need to update crosshair as well\n\t\tthis.model().updateCrosshair();\n\n\t\tthis._paneView.update('options');\n\t}\n\n\tpublic setData(data: readonly SeriesPlotRow<T>[], updateInfo?: SeriesUpdateInfo): void {\n\t\tthis._data.setData(data);\n\n\t\tthis._recalculateMarkers();\n\n\t\tthis._paneView.update('data');\n\t\tthis._markersPaneView.update('data');\n\n\t\tif (this._lastPriceAnimationPaneView !== null) {\n\t\t\tif (updateInfo && updateInfo.lastBarUpdatedOrNewBarsAddedToTheRight) {\n\t\t\t\tthis._lastPriceAnimationPaneView.onNewRealtimeDataReceived();\n\t\t\t} else if (data.length === 0) {\n\t\t\t\tthis._lastPriceAnimationPaneView.onDataCleared();\n\t\t\t}\n\t\t}\n\n\t\tconst sourcePane = this.model().paneForSource(this);\n\t\tthis.model().recalculatePane(sourcePane);\n\t\tthis.model().updateSource(this);\n\t\tthis.model().updateCrosshair();\n\t\tthis.model().lightUpdate();\n\t}\n\n\tpublic setMarkers(data: readonly SeriesMarker<InternalHorzScaleItem>[]): void {\n\t\tthis._markers = data;\n\t\tthis._recalculateMarkers();\n\t\tconst sourcePane = this.model().paneForSource(this);\n\t\tthis._markersPaneView.update('data');\n\t\tthis.model().recalculatePane(sourcePane);\n\t\tthis.model().updateSource(this);\n\t\tthis.model().updateCrosshair();\n\t\tthis.model().lightUpdate();\n\t}\n\n\tpublic markers(): readonly SeriesMarker<InternalHorzScaleItem>[] {\n\t\treturn this._markers;\n\t}\n\n\tpublic indexedMarkers(): InternalSeriesMarker<TimePointIndex>[] {\n\t\treturn this._indexedMarkers;\n\t}\n\n\tpublic createPriceLine(options: PriceLineOptions): CustomPriceLine {\n\t\tconst result = new CustomPriceLine(this, options);\n\t\tthis._customPriceLines.push(result);\n\t\tthis.model().updateSource(this);\n\t\treturn result;\n\t}\n\n\tpublic removePriceLine(line: CustomPriceLine): void {\n\t\tconst index = this._customPriceLines.indexOf(line);\n\t\tif (index !== -1) {\n\t\t\tthis._customPriceLines.splice(index, 1);\n\t\t}\n\t\tthis.model().updateSource(this);\n\t}\n\n\tpublic seriesType(): T {\n\t\treturn this._seriesType;\n\t}\n\n\tpublic firstValue(): FirstValue | null {\n\t\tconst bar = this.firstBar();\n\t\tif (bar === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tvalue: bar.value[PlotRowValueIndex.Close],\n\t\t\ttimePoint: bar.time,\n\t\t};\n\t}\n\n\tpublic firstBar(): SeriesPlotRow<T> | null {\n\t\tconst visibleBars = this.model().timeScale().visibleStrictRange();\n\t\tif (visibleBars === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst startTimePoint = visibleBars.left();\n\t\treturn this._data.search(startTimePoint, MismatchDirection.NearestRight);\n\t}\n\n\tpublic bars(): SeriesPlotList<T> {\n\t\treturn this._data;\n\t}\n\n\tpublic dataAt(time: TimePointIndex): SeriesDataAtTypeMap[SeriesType] | null {\n\t\tconst prices = this._data.valueAt(time);\n\t\tif (prices === null) {\n\t\t\treturn null;\n\t\t}\n\t\tif (this._seriesType === 'Bar' || this._seriesType === 'Candlestick' || this._seriesType === 'Custom') {\n\t\t\treturn {\n\t\t\t\topen: prices.value[PlotRowValueIndex.Open] as BarPrice,\n\t\t\t\thigh: prices.value[PlotRowValueIndex.High] as BarPrice,\n\t\t\t\tlow: prices.value[PlotRowValueIndex.Low] as BarPrice,\n\t\t\t\tclose: prices.value[PlotRowValueIndex.Close] as BarPrice,\n\t\t\t};\n\t\t} else {\n\t\t\treturn prices.value[PlotRowValueIndex.Close] as BarPrice;\n\t\t}\n\t}\n\n\tpublic topPaneViews(pane: Pane): readonly IPaneView[] {\n\t\tconst res: IPaneView[] = [];\n\t\textractPrimitivePaneViews(this._primitives, primitivePaneViewsExtractor, 'top', res);\n\t\tconst animationPaneView = this._lastPriceAnimationPaneView;\n\t\tif (animationPaneView === null || !animationPaneView.visible()) {\n\t\t\treturn res;\n\t\t}\n\n\t\tif (this._animationTimeoutId === null && animationPaneView.animationActive()) {\n\t\t\tthis._animationTimeoutId = setTimeout(\n\t\t\t\t() => {\n\t\t\t\t\tthis._animationTimeoutId = null;\n\t\t\t\t\tthis.model().cursorUpdate();\n\t\t\t\t},\n\t\t\t\t0\n\t\t\t);\n\t\t}\n\n\t\tanimationPaneView.invalidateStage();\n\t\tres.unshift(animationPaneView);\n\t\treturn res;\n\t}\n\n\tpublic paneViews(): readonly IPaneView[] {\n\t\tconst res: IPaneView[] = [];\n\n\t\tif (!this._isOverlay()) {\n\t\t\tres.push(this._baseHorizontalLineView);\n\t\t}\n\n\t\tres.push(\n\t\t\tthis._paneView,\n\t\t\tthis._priceLineView,\n\t\t\tthis._markersPaneView\n\t\t);\n\n\t\tconst priceLineViews = this._customPriceLines.map((line: CustomPriceLine) => line.paneView());\n\t\tres.push(...priceLineViews);\n\t\textractPrimitivePaneViews(this._primitives, primitivePaneViewsExtractor, 'normal', res);\n\n\t\treturn res;\n\t}\n\n\tpublic bottomPaneViews(): readonly IPaneView[] {\n\t\treturn this._extractPaneViews(primitivePaneViewsExtractor, 'bottom');\n\t}\n\n\tpublic pricePaneViews(zOrder: SeriesPrimitivePaneViewZOrder): readonly IPaneView[] {\n\t\treturn this._extractPaneViews(primitivePricePaneViewsExtractor, zOrder);\n\t}\n\n\tpublic timePaneViews(zOrder: SeriesPrimitivePaneViewZOrder): readonly IPaneView[] {\n\t\treturn this._extractPaneViews(primitiveTimePaneViewsExtractor, zOrder);\n\t}\n\n\tpublic primitiveHitTest(x: Coordinate, y: Coordinate): PrimitiveHoveredItem[] {\n\t\treturn this._primitives\n\t\t\t.map((primitive: SeriesPrimitiveWrapper) => primitive.hitTest(x, y))\n\t\t\t.filter(\n\t\t\t\t(result: PrimitiveHoveredItem | null): result is PrimitiveHoveredItem =>\n\t\t\t\t\tresult !== null\n\t\t\t);\n\t}\n\n\tpublic override labelPaneViews(pane?: Pane): readonly IPaneView[] {\n\t\treturn [\n\t\t\tthis._panePriceAxisView,\n\t\t\t...this._customPriceLines.map((line: CustomPriceLine) => line.labelPaneView()),\n\t\t];\n\t}\n\n\tpublic override priceAxisViews(pane: Pane, priceScale: PriceScale): readonly IPriceAxisView[] {\n\t\tif (priceScale !== this._priceScale && !this._isOverlay()) {\n\t\t\treturn [];\n\t\t}\n\t\tconst result = [...this._priceAxisViews];\n\t\tfor (const customPriceLine of this._customPriceLines) {\n\t\t\tresult.push(customPriceLine.priceAxisView());\n\t\t}\n\t\tthis._primitives.forEach((wrapper: SeriesPrimitiveWrapper) => {\n\t\t\tresult.push(...wrapper.priceAxisViews());\n\t\t});\n\t\treturn result;\n\t}\n\n\tpublic override timeAxisViews(): readonly ITimeAxisView[] {\n\t\tconst res: ITimeAxisView[] = [];\n\t\tthis._primitives.forEach((wrapper: SeriesPrimitiveWrapper) => {\n\t\t\tres.push(...wrapper.timeAxisViews());\n\t\t});\n\t\treturn res;\n\t}\n\n\tpublic autoscaleInfo(startTimePoint: TimePointIndex, endTimePoint: TimePointIndex): AutoscaleInfoImpl | null {\n\t\tif (this._options.autoscaleInfoProvider !== undefined) {\n\t\t\tconst autoscaleInfo = this._options.autoscaleInfoProvider(() => {\n\t\t\t\tconst res = this._autoscaleInfoImpl(startTimePoint, endTimePoint);\n\t\t\t\treturn (res === null) ? null : res.toRaw();\n\t\t\t});\n\n\t\t\treturn AutoscaleInfoImpl.fromRaw(autoscaleInfo);\n\t\t}\n\t\treturn this._autoscaleInfoImpl(startTimePoint, endTimePoint);\n\t}\n\n\tpublic minMove(): number {\n\t\treturn this._options.priceFormat.minMove;\n\t}\n\n\tpublic formatter(): IPriceFormatter {\n\t\treturn this._formatter;\n\t}\n\n\tpublic updateAllViews(): void {\n\t\tthis._paneView.update();\n\t\tthis._markersPaneView.update();\n\n\t\tfor (const priceAxisView of this._priceAxisViews) {\n\t\t\tpriceAxisView.update();\n\t\t}\n\n\t\tfor (const customPriceLine of this._customPriceLines) {\n\t\t\tcustomPriceLine.update();\n\t\t}\n\n\t\tthis._priceLineView.update();\n\t\tthis._baseHorizontalLineView.update();\n\t\tthis._lastPriceAnimationPaneView?.update();\n\n\t\tthis._primitives.forEach((wrapper: SeriesPrimitiveWrapper) => wrapper.updateAllViews());\n\t}\n\n\tpublic override priceScale(): PriceScale {\n\t\treturn ensureNotNull(super.priceScale());\n\t}\n\n\tpublic markerDataAtIndex(index: TimePointIndex): MarkerData | null {\n\t\tconst getValue = (this._seriesType === 'Line' || this._seriesType === 'Area' || this._seriesType === 'Baseline') &&\n\t\t\t(this._options as (LineStyleOptions | AreaStyleOptions | BaselineStyleOptions)).crosshairMarkerVisible;\n\n\t\tif (!getValue) {\n\t\t\treturn null;\n\t\t}\n\t\tconst bar = this._data.valueAt(index);\n\t\tif (bar === null) {\n\t\t\treturn null;\n\t\t}\n\t\tconst price = bar.value[PlotRowValueIndex.Close] as BarPrice;\n\t\tconst radius = this._markerRadius();\n\t\tconst borderColor = this._markerBorderColor();\n\t\tconst borderWidth = this._markerBorderWidth();\n\t\tconst backgroundColor = this._markerBackgroundColor(index);\n\t\treturn { price, radius, borderColor, borderWidth, backgroundColor };\n\t}\n\n\tpublic title(): string {\n\t\treturn this._options.title;\n\t}\n\n\tpublic override visible(): boolean {\n\t\treturn this._options.visible;\n\t}\n\n\tpublic attachPrimitive(primitive: ISeriesPrimitiveBase): void {\n\t\tthis._primitives.push(new SeriesPrimitiveWrapper(primitive, this));\n\t}\n\n\tpublic detachPrimitive(source: ISeriesPrimitiveBase): void {\n\t\tthis._primitives = this._primitives.filter((wrapper: SeriesPrimitiveWrapper) => wrapper.primitive() !== source);\n\t}\n\n\tpublic customSeriesPlotValuesBuilder(): CustomDataToPlotRowValueConverter<unknown> | undefined {\n\t\tif (this._paneView instanceof SeriesCustomPaneView === false) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn (data: CustomData<unknown> | CustomSeriesWhitespaceData<unknown>) => {\n\t\t\treturn (this._paneView as SeriesCustomPaneView).priceValueBuilder(data);\n\t\t};\n\t}\n\n\tpublic customSeriesWhitespaceCheck<HorzScaleItem>(): WhitespaceCheck<HorzScaleItem> | undefined {\n\t\tif (this._paneView instanceof SeriesCustomPaneView === false) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn (data: CustomData<HorzScaleItem> | CustomSeriesWhitespaceData<HorzScaleItem>): data is CustomSeriesWhitespaceData<HorzScaleItem> => {\n\t\t\treturn (this._paneView as SeriesCustomPaneView).isWhitespace(data);\n\t\t};\n\t}\n\n\tprivate _isOverlay(): boolean {\n\t\tconst priceScale = this.priceScale();\n\t\treturn !isDefaultPriceScale(priceScale.id());\n\t}\n\n\tprivate _autoscaleInfoImpl(startTimePoint: TimePointIndex, endTimePoint: TimePointIndex): AutoscaleInfoImpl | null {\n\t\tif (!isInteger(startTimePoint) || !isInteger(endTimePoint) || this._data.isEmpty()) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// TODO: refactor this\n\t\t// series data is strongly hardcoded to keep bars\n\t\tconst plots = this._seriesType === 'Line' || this._seriesType === 'Area' || this._seriesType === 'Baseline' || this._seriesType === 'Histogram'\n\t\t\t? [PlotRowValueIndex.Close]\n\t\t\t: [PlotRowValueIndex.Low, PlotRowValueIndex.High];\n\n\t\tconst barsMinMax = this._data.minMaxOnRangeCached(startTimePoint, endTimePoint, plots);\n\n\t\tlet range = barsMinMax !== null ? new PriceRangeImpl(barsMinMax.min, barsMinMax.max) : null;\n\n\t\tif (this.seriesType() === 'Histogram') {\n\t\t\tconst base = (this._options as HistogramStyleOptions).base;\n\t\t\tconst rangeWithBase = new PriceRangeImpl(base, base);\n\t\t\trange = range !== null ? range.merge(rangeWithBase) : rangeWithBase;\n\t\t}\n\n\t\tlet margins = this._markersPaneView.autoScaleMargins();\n\t\tthis._primitives.forEach((primitive: SeriesPrimitiveWrapper) => {\n\t\t\tconst primitiveAutoscale = primitive.autoscaleInfo(\n\t\t\t\tstartTimePoint,\n\t\t\t\tendTimePoint\n\t\t\t);\n\n\t\t\tif (primitiveAutoscale?.priceRange) {\n\t\t\t\tconst primitiveRange = new PriceRangeImpl(\n\t\t\t\t\tprimitiveAutoscale.priceRange.minValue,\n\t\t\t\t\tprimitiveAutoscale.priceRange.maxValue\n\t\t\t\t);\n\t\t\t\trange = range !== null ? range.merge(primitiveRange) : primitiveRange;\n\t\t\t}\n\t\t\tif (primitiveAutoscale?.margins) {\n\t\t\t\tmargins = mergeMargins(margins, primitiveAutoscale.margins);\n\t\t\t}\n\t\t});\n\n\t\treturn new AutoscaleInfoImpl(range,\tmargins);\n\t}\n\n\tprivate _markerRadius(): number {\n\t\tswitch (this._seriesType) {\n\t\t\tcase 'Line':\n\t\t\tcase 'Area':\n\t\t\tcase 'Baseline':\n\t\t\t\treturn (this._options as (LineStyleOptions | AreaStyleOptions | BaselineStyleOptions)).crosshairMarkerRadius;\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\tprivate _markerBorderColor(): string | null {\n\t\tswitch (this._seriesType) {\n\t\t\tcase 'Line':\n\t\t\tcase 'Area':\n\t\t\tcase 'Baseline': {\n\t\t\t\tconst crosshairMarkerBorderColor = (this._options as (LineStyleOptions | AreaStyleOptions | BaselineStyleOptions)).crosshairMarkerBorderColor;\n\t\t\t\tif (crosshairMarkerBorderColor.length !== 0) {\n\t\t\t\t\treturn crosshairMarkerBorderColor;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate _markerBorderWidth(): number {\n\t\tswitch (this._seriesType) {\n\t\t\tcase 'Line':\n\t\t\tcase 'Area':\n\t\t\tcase 'Baseline':\n\t\t\t\treturn (this._options as (LineStyleOptions | AreaStyleOptions | BaselineStyleOptions)).crosshairMarkerBorderWidth;\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\tprivate _markerBackgroundColor(index: TimePointIndex): string {\n\t\tswitch (this._seriesType) {\n\t\t\tcase 'Line':\n\t\t\tcase 'Area':\n\t\t\tcase 'Baseline': {\n\t\t\t\tconst crosshairMarkerBackgroundColor = (this._options as (LineStyleOptions | AreaStyleOptions | BaselineStyleOptions)).crosshairMarkerBackgroundColor;\n\t\t\t\tif (crosshairMarkerBackgroundColor.length !== 0) {\n\t\t\t\t\treturn crosshairMarkerBackgroundColor;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.barColorer().barStyle(index).barColor;\n\t}\n\n\tprivate _recreateFormatter(): void {\n\t\tswitch (this._options.priceFormat.type) {\n\t\t\tcase 'custom': {\n\t\t\t\tthis._formatter = { format: this._options.priceFormat.formatter };\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'volume': {\n\t\t\t\tthis._formatter = new VolumeFormatter(this._options.priceFormat.precision);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'percent': {\n\t\t\t\tthis._formatter = new PercentageFormatter(this._options.priceFormat.precision);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault: {\n\t\t\t\tconst priceScale = Math.pow(10, this._options.priceFormat.precision);\n\t\t\t\tthis._formatter = new PriceFormatter(\n\t\t\t\t\tpriceScale,\n\t\t\t\t\tthis._options.priceFormat.minMove * priceScale\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (this._priceScale !== null) {\n\t\t\tthis._priceScale.updateFormatter();\n\t\t}\n\t}\n\n\tprivate _recalculateMarkers(): void {\n\t\tconst timeScale = this.model().timeScale();\n\t\tif (!timeScale.hasPoints() || this._data.isEmpty()) {\n\t\t\tthis._indexedMarkers = [];\n\t\t\treturn;\n\t\t}\n\n\t\tconst firstDataIndex = ensureNotNull(this._data.firstIndex());\n\n\t\tthis._indexedMarkers = this._markers.map<InternalSeriesMarker<TimePointIndex>>((marker: SeriesMarker<InternalHorzScaleItem>, index: number) => {\n\t\t\t// the first find index on the time scale (across all series)\n\t\t\tconst timePointIndex = ensureNotNull(timeScale.timeToIndex(marker.time, true));\n\n\t\t\t// and then search that index inside the series data\n\t\t\tconst searchMode = timePointIndex < firstDataIndex ? MismatchDirection.NearestRight : MismatchDirection.NearestLeft;\n\t\t\tconst seriesDataIndex = ensureNotNull(this._data.search(timePointIndex, searchMode)).index;\n\t\t\treturn {\n\t\t\t\ttime: seriesDataIndex,\n\t\t\t\tposition: marker.position,\n\t\t\t\tshape: marker.shape,\n\t\t\t\tcolor: marker.color,\n\t\t\t\tid: marker.id,\n\t\t\t\tinternalId: index,\n\t\t\t\ttext: marker.text,\n\t\t\t\tsize: marker.size,\n\t\t\t\toriginalTime: marker.originalTime,\n\t\t\t};\n\t\t});\n\t}\n\n\tprivate _recreatePaneViews(customPaneView?: ICustomSeriesPaneView<unknown>): void {\n\t\tthis._markersPaneView = new SeriesMarkersPaneView(this, this.model());\n\n\t\tswitch (this._seriesType) {\n\t\t\tcase 'Bar': {\n\t\t\t\tthis._paneView = new SeriesBarsPaneView(this as Series<'Bar'>, this.model());\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'Candlestick': {\n\t\t\t\tthis._paneView = new SeriesCandlesticksPaneView(this as Series<'Candlestick'>, this.model());\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'Line': {\n\t\t\t\tthis._paneView = new SeriesLinePaneView(this as Series<'Line'>, this.model());\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'Custom': {\n\t\t\t\tthis._paneView = new SeriesCustomPaneView(this as Series<'Custom'>, this.model(), ensureDefined(customPaneView));\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'Area': {\n\t\t\t\tthis._paneView = new SeriesAreaPaneView(this as Series<'Area'>, this.model());\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'Baseline': {\n\t\t\t\tthis._paneView = new SeriesBaselinePaneView(this as Series<'Baseline'>, this.model());\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'Histogram': {\n\t\t\t\tthis._paneView = new SeriesHistogramPaneView(this as Series<'Histogram'>, this.model());\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdefault: throw Error('Unknown chart style assigned: ' + this._seriesType);\n\t\t}\n\t}\n\n\tprivate _extractPaneViews(extractor: PrimitivePaneViewExtractor, zOrder: SeriesPrimitivePaneViewZOrder): readonly IPaneView[] {\n\t\tconst res: IPaneView[] = [];\n\t\textractPrimitivePaneViews(this._primitives, extractor, zOrder, res);\n\t\treturn res;\n\t}\n}\n\nfunction mergeMargins(source: AutoScaleMargins | null, additionalMargin: AutoScaleMargins): AutoScaleMargins {\n\treturn {\n\t\tabove: Math.max(source?.above ?? 0, additionalMargin.above),\n\t\tbelow: Math.max(source?.below ?? 0, additionalMargin.below),\n\t};\n}\n","import { ensure } from '../helpers/assertions';\n\nimport { Coordinate } from './coordinate';\nimport { CrosshairMode, CrosshairOptions } from './crosshair';\nimport { IPriceDataSource } from './iprice-data-source';\nimport { Pane } from './pane';\nimport { PlotRowValueIndex } from './plot-data';\nimport { ISeries, Series } from './series';\nimport { SeriesType } from './series-options';\nimport { TimePointIndex } from './time-data';\n\nexport class Magnet {\n\tprivate readonly _options: CrosshairOptions;\n\n\tpublic constructor(options: CrosshairOptions) {\n\t\tthis._options = options;\n\t}\n\n\tpublic align(price: number, index: TimePointIndex, pane: Pane): number {\n\t\tlet res = price;\n\t\tif (this._options.mode === CrosshairMode.Normal) {\n\t\t\treturn res;\n\t\t}\n\n\t\tconst defaultPriceScale = pane.defaultPriceScale();\n\t\tconst firstValue = defaultPriceScale.firstValue();\n\n\t\tif (firstValue === null) {\n\t\t\treturn res;\n\t\t}\n\n\t\tconst y = defaultPriceScale.priceToCoordinate(price, firstValue);\n\n\t\t// get all serieses from the pane\n\t\tconst serieses: readonly ISeries<SeriesType>[] = pane.dataSources().filter(\n\t\t\t((ds: IPriceDataSource) => (ds instanceof Series<SeriesType>)) as (ds: IPriceDataSource) => ds is Series<SeriesType>);\n\n\t\tconst candidates = serieses.reduce(\n\t\t\t(acc: Coordinate[], series: ISeries<SeriesType>) => {\n\t\t\t\tif (pane.isOverlay(series) || !series.visible()) {\n\t\t\t\t\treturn acc;\n\t\t\t\t}\n\t\t\t\tconst ps = series.priceScale();\n\t\t\t\tconst bars = series.bars();\n\t\t\t\tif (ps.isEmpty() || !bars.contains(index)) {\n\t\t\t\t\treturn acc;\n\t\t\t\t}\n\n\t\t\t\tconst bar = bars.valueAt(index);\n\t\t\t\tif (bar === null) {\n\t\t\t\t\treturn acc;\n\t\t\t\t}\n\n\t\t\t\t// convert bar to pixels\n\t\t\t\tconst firstPrice = ensure(series.firstValue());\n\t\t\t\treturn acc.concat([ps.priceToCoordinate(bar.value[PlotRowValueIndex.Close], firstPrice.value)]);\n\t\t\t},\n\t\t\t[] as Coordinate[]);\n\n\t\tif (candidates.length === 0) {\n\t\t\treturn res;\n\t\t}\n\n\t\tcandidates.sort((y1: Coordinate, y2: Coordinate) => Math.abs(y1 - y) - Math.abs(y2 - y));\n\n\t\tconst nearest = candidates[0];\n\t\tres = defaultPriceScale.coordinateToPrice(nearest, firstValue);\n\n\t\treturn res;\n\t}\n}\n","import { BitmapCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { ensureNotNull } from '../helpers/assertions';\n\nimport { PriceMark } from '../model/price-scale';\n\nimport { BitmapCoordinatesPaneRenderer } from './bitmap-coordinates-pane-renderer';\nimport { LineStyle, setLineStyle, strokeInPixel } from './draw-line';\n\nexport interface GridMarks {\n\tcoord: number;\n}\nexport interface GridRendererData {\n\tvertLinesVisible: boolean;\n\tvertLinesColor: string;\n\tvertLineStyle: LineStyle;\n\ttimeMarks: GridMarks[];\n\n\thorzLinesVisible: boolean;\n\thorzLinesColor: string;\n\thorzLineStyle: LineStyle;\n\tpriceMarks: PriceMark[];\n}\n\nexport class GridRenderer extends BitmapCoordinatesPaneRenderer {\n\tprivate _data: GridRendererData | null = null;\n\n\tpublic setData(data: GridRendererData | null): void {\n\t\tthis._data = data;\n\t}\n\n\tprotected override _drawImpl({ context: ctx, bitmapSize, horizontalPixelRatio, verticalPixelRatio }: BitmapCoordinatesRenderingScope): void {\n\t\tif (this._data === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst lineWidth = Math.max(1, Math.floor(horizontalPixelRatio));\n\t\tctx.lineWidth = lineWidth;\n\n\t\tstrokeInPixel(ctx, () => {\n\t\t\tconst data = ensureNotNull(this._data);\n\t\t\tif (data.vertLinesVisible) {\n\t\t\t\tctx.strokeStyle = data.vertLinesColor;\n\t\t\t\tsetLineStyle(ctx, data.vertLineStyle);\n\t\t\t\tctx.beginPath();\n\t\t\t\tfor (const timeMark of data.timeMarks) {\n\t\t\t\t\tconst x = Math.round(timeMark.coord * horizontalPixelRatio);\n\t\t\t\t\tctx.moveTo(x, -lineWidth);\n\t\t\t\t\tctx.lineTo(x, bitmapSize.height + lineWidth);\n\t\t\t\t}\n\t\t\t\tctx.stroke();\n\t\t\t}\n\t\t\tif (data.horzLinesVisible) {\n\t\t\t\tctx.strokeStyle = data.horzLinesColor;\n\t\t\t\tsetLineStyle(ctx, data.horzLineStyle);\n\t\t\t\tctx.beginPath();\n\t\t\t\tfor (const priceMark of data.priceMarks) {\n\t\t\t\t\tconst y = Math.round(priceMark.coord * verticalPixelRatio);\n\t\t\t\t\tctx.moveTo(-lineWidth, y);\n\t\t\t\t\tctx.lineTo(bitmapSize.width + lineWidth, y);\n\t\t\t\t}\n\t\t\t\tctx.stroke();\n\t\t\t}\n\t\t});\n\t}\n}\n","import { Pane } from '../../model/pane';\nimport { TimeMark } from '../../model/time-scale';\nimport { GridRenderer, GridRendererData } from '../../renderers/grid-renderer';\nimport { IPaneRenderer } from '../../renderers/ipane-renderer';\n\nimport { IUpdatablePaneView } from './iupdatable-pane-view';\n\nexport class GridPaneView implements IUpdatablePaneView {\n\tprivate readonly _pane: Pane;\n\tprivate readonly _renderer: GridRenderer = new GridRenderer();\n\tprivate _invalidated: boolean = true;\n\n\tpublic constructor(pane: Pane) {\n\t\tthis._pane = pane;\n\t}\n\n\tpublic update(): void {\n\t\tthis._invalidated = true;\n\t}\n\n\tpublic renderer(): IPaneRenderer | null {\n\t\tif (this._invalidated) {\n\t\t\tconst gridOptions = this._pane.model().options().grid;\n\n\t\t\tconst data: GridRendererData = {\n\t\t\t\thorzLinesVisible: gridOptions.horzLines.visible,\n\t\t\t\tvertLinesVisible: gridOptions.vertLines.visible,\n\t\t\t\thorzLinesColor: gridOptions.horzLines.color,\n\t\t\t\tvertLinesColor: gridOptions.vertLines.color,\n\t\t\t\thorzLineStyle: gridOptions.horzLines.style,\n\t\t\t\tvertLineStyle: gridOptions.vertLines.style,\n\t\t\t\tpriceMarks: this._pane.defaultPriceScale().marks(),\n\t\t\t\t// need this conversiom because TimeMark is a part of external interface\n\t\t\t\t// and fields inside TimeMark are not minified\n\t\t\t\ttimeMarks: (this._pane.model().timeScale().marks() || []).map((tm: TimeMark) => {\n\t\t\t\t\treturn { coord: tm.coord };\n\t\t\t\t}),\n\t\t\t};\n\n\t\t\tthis._renderer.setData(data);\n\t\t\tthis._invalidated = false;\n\t\t}\n\n\t\treturn this._renderer;\n\t}\n}\n","import { LineStyle } from '../renderers/draw-line';\nimport { GridPaneView } from '../views/pane/grid-pane-view';\nimport { IUpdatablePaneView } from '../views/pane/iupdatable-pane-view';\n\nimport { Pane } from './pane';\n\n/** Grid line options. */\nexport interface GridLineOptions {\n\t/**\n\t * Line color.\n\t *\n\t * @defaultValue `'#D6DCDE'`\n\t */\n\tcolor: string;\n\n\t/**\n\t * Line style.\n\t *\n\t * @defaultValue {@link LineStyle.Solid}\n\t */\n\tstyle: LineStyle;\n\n\t/**\n\t * Display the lines.\n\t *\n\t * @defaultValue `true`\n\t */\n\tvisible: boolean;\n}\n\n/** Structure describing grid options. */\nexport interface GridOptions {\n\t/**\n\t * Vertical grid line options.\n\t */\n\tvertLines: GridLineOptions;\n\n\t/**\n\t * Horizontal grid line options.\n\t */\n\thorzLines: GridLineOptions;\n}\n\nexport class Grid {\n\tprivate _paneView: GridPaneView;\n\n\tpublic constructor(pane: Pane) {\n\t\tthis._paneView = new GridPaneView(pane);\n\t}\n\n\tpublic paneView(): IUpdatablePaneView {\n\t\treturn this._paneView;\n\t}\n}\n","import { PriceRangeImpl } from './price-range-impl';\n\nexport interface LogFormula {\n\tlogicalOffset: number;\n\tcoordOffset: number;\n}\n\nconst defLogFormula: LogFormula = {\n\tlogicalOffset: 4,\n\tcoordOffset: 0.0001,\n};\n\nexport function fromPercent(value: number, baseValue: number): number {\n\tif (baseValue < 0) {\n\t\tvalue = -value;\n\t}\n\n\treturn (value / 100) * baseValue + baseValue;\n}\n\nexport function toPercent(value: number, baseValue: number): number {\n\tconst result = 100 * (value - baseValue) / baseValue;\n\treturn (baseValue < 0 ? -result : result);\n}\n\nexport function toPercentRange(priceRange: PriceRangeImpl, baseValue: number): PriceRangeImpl {\n\tconst minPercent = toPercent(priceRange.minValue(), baseValue);\n\tconst maxPercent = toPercent(priceRange.maxValue(), baseValue);\n\treturn new PriceRangeImpl(minPercent, maxPercent);\n}\n\nexport function fromIndexedTo100(value: number, baseValue: number): number {\n\tvalue -= 100;\n\tif (baseValue < 0) {\n\t\tvalue = -value;\n\t}\n\n\treturn (value / 100) * baseValue + baseValue;\n}\n\nexport function toIndexedTo100(value: number, baseValue: number): number {\n\tconst result = 100 * (value - baseValue) / baseValue + 100;\n\treturn (baseValue < 0 ? -result : result);\n}\n\nexport function toIndexedTo100Range(priceRange: PriceRangeImpl, baseValue: number): PriceRangeImpl {\n\tconst minPercent = toIndexedTo100(priceRange.minValue(), baseValue);\n\tconst maxPercent = toIndexedTo100(priceRange.maxValue(), baseValue);\n\treturn new PriceRangeImpl(minPercent, maxPercent);\n}\n\nexport function toLog(price: number, logFormula: LogFormula): number {\n\tconst m = Math.abs(price);\n\tif (m < 1e-15) {\n\t\treturn 0;\n\t}\n\n\tconst res = Math.log10(m + logFormula.coordOffset) + logFormula.logicalOffset;\n\treturn ((price < 0) ? -res : res);\n}\n\nexport function fromLog(logical: number, logFormula: LogFormula): number {\n\tconst m = Math.abs(logical);\n\tif (m < 1e-15) {\n\t\treturn 0;\n\t}\n\n\tconst res = Math.pow(10, m - logFormula.logicalOffset) - logFormula.coordOffset;\n\treturn (logical < 0) ? -res : res;\n}\n\nexport function convertPriceRangeToLog(priceRange: PriceRangeImpl | null, logFormula: LogFormula): PriceRangeImpl | null {\n\tif (priceRange === null) {\n\t\treturn null;\n\t}\n\n\tconst min = toLog(priceRange.minValue(), logFormula);\n\tconst max = toLog(priceRange.maxValue(), logFormula);\n\n\treturn new PriceRangeImpl(min, max);\n}\n\nexport function canConvertPriceRangeFromLog(priceRange: PriceRangeImpl | null, logFormula: LogFormula): boolean {\n\tif (priceRange === null) {\n\t\treturn false;\n\t}\n\n\tconst min = fromLog(priceRange.minValue(), logFormula);\n\tconst max = fromLog(priceRange.maxValue(), logFormula);\n\n\treturn isFinite(min) && isFinite(max);\n}\n\nexport function convertPriceRangeFromLog(priceRange: PriceRangeImpl, logFormula: LogFormula): PriceRangeImpl;\nexport function convertPriceRangeFromLog(priceRange: null, logFormula: LogFormula): null;\nexport function convertPriceRangeFromLog(priceRange: PriceRangeImpl | null, logFormula: LogFormula): PriceRangeImpl | null;\nexport function convertPriceRangeFromLog(priceRange: PriceRangeImpl | null, logFormula: LogFormula): PriceRangeImpl | null {\n\tif (priceRange === null) {\n\t\treturn null;\n\t}\n\n\tconst min = fromLog(priceRange.minValue(), logFormula);\n\tconst max = fromLog(priceRange.maxValue(), logFormula);\n\n\treturn new PriceRangeImpl(min, max);\n}\n\nexport function logFormulaForPriceRange(range: PriceRangeImpl | null): LogFormula {\n\tif (range === null) {\n\t\treturn defLogFormula;\n\t}\n\n\tconst diff = Math.abs(range.maxValue() - range.minValue());\n\tif (diff >= 1 || diff < 1e-15) {\n\t\treturn defLogFormula;\n\t}\n\n\tconst digits = Math.ceil(Math.abs(Math.log10(diff)));\n\tconst logicalOffset = defLogFormula.logicalOffset + digits;\n\tconst coordOffset = 1 / Math.pow(10, logicalOffset);\n\n\treturn {\n\t\tlogicalOffset,\n\t\tcoordOffset,\n\t};\n}\n\nexport function logFormulasAreSame(f1: LogFormula, f2: LogFormula): boolean {\n\treturn f1.logicalOffset === f2.logicalOffset && f1.coordOffset === f2.coordOffset;\n}\n","import { equal, greaterOrEqual, isBaseDecimal } from '../helpers/mathex';\n\nconst enum Constants {\n\tTickSpanEpsilon = 1e-14,\n}\n\nexport class PriceTickSpanCalculator {\n\tprivate readonly _base: number;\n\tprivate readonly _integralDividers: number[];\n\tprivate readonly _fractionalDividers: number[];\n\n\tpublic constructor(base: number, integralDividers: number[]) {\n\t\tthis._base = base;\n\t\tthis._integralDividers = integralDividers;\n\n\t\tif (isBaseDecimal(this._base)) {\n\t\t\tthis._fractionalDividers = [2, 2.5, 2];\n\t\t} else {\n\t\t\tthis._fractionalDividers = [];\n\t\t\tfor (let baseRest = this._base; baseRest !== 1;) {\n\t\t\t\tif ((baseRest % 2) === 0) {\n\t\t\t\t\tthis._fractionalDividers.push(2);\n\t\t\t\t\tbaseRest /= 2;\n\t\t\t\t} else if ((baseRest % 5) === 0) {\n\t\t\t\t\tthis._fractionalDividers.push(2, 2.5);\n\t\t\t\t\tbaseRest /= 5;\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('unexpected base');\n\t\t\t\t}\n\n\t\t\t\tif (this._fractionalDividers.length > 100) {\n\t\t\t\t\tthrow new Error('something wrong with base');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic tickSpan(high: number, low: number, maxTickSpan: number): number {\n\t\tconst minMovement = (this._base === 0) ? (0) : (1 / this._base);\n\n\t\tlet resultTickSpan = Math.pow(10, Math.max(0, Math.ceil(Math.log10(high - low))));\n\n\t\tlet index = 0;\n\t\tlet c = this._integralDividers[0];\n\n\t\t// eslint-disable-next-line no-constant-condition\n\t\twhile (true) {\n\t\t\t// the second part is actual for small with very small values like 1e-10\n\t\t\t// greaterOrEqual fails for such values\n\t\t\tconst resultTickSpanLargerMinMovement = greaterOrEqual(resultTickSpan, minMovement, Constants.TickSpanEpsilon) && resultTickSpan > (minMovement + Constants.TickSpanEpsilon);\n\t\t\tconst resultTickSpanLargerMaxTickSpan = greaterOrEqual(resultTickSpan, maxTickSpan * c, Constants.TickSpanEpsilon);\n\t\t\tconst resultTickSpanLarger1 = greaterOrEqual(resultTickSpan, 1, Constants.TickSpanEpsilon);\n\t\t\tconst haveToContinue = resultTickSpanLargerMinMovement && resultTickSpanLargerMaxTickSpan && resultTickSpanLarger1;\n\t\t\tif (!haveToContinue) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tresultTickSpan /= c;\n\t\t\tc = this._integralDividers[++index % this._integralDividers.length];\n\t\t}\n\n\t\tif (resultTickSpan <= (minMovement + Constants.TickSpanEpsilon)) {\n\t\t\tresultTickSpan = minMovement;\n\t\t}\n\n\t\tresultTickSpan = Math.max(1, resultTickSpan);\n\n\t\tif ((this._fractionalDividers.length > 0) && equal(resultTickSpan, 1, Constants.TickSpanEpsilon)) {\n\t\t\tindex = 0;\n\t\t\tc = this._fractionalDividers[0];\n\t\t\twhile (greaterOrEqual(resultTickSpan, maxTickSpan * c, Constants.TickSpanEpsilon) && resultTickSpan > (minMovement + Constants.TickSpanEpsilon)) {\n\t\t\t\tresultTickSpan /= c;\n\t\t\t\tc = this._fractionalDividers[++index % this._fractionalDividers.length];\n\t\t\t}\n\t\t}\n\n\t\treturn resultTickSpan;\n\t}\n}\n","import { min } from '../helpers/mathex';\n\nimport { Coordinate } from './coordinate';\nimport { PriceMark, PriceScale } from './price-scale';\nimport { PriceTickSpanCalculator } from './price-tick-span-calculator';\n\nexport type CoordinateToLogicalConverter = (x: number, firstValue: number) => number;\nexport type LogicalToCoordinateConverter = (x: number, firstValue: number, keepItFloat: boolean) => number;\n\nconst TICK_DENSITY = 2.5;\n\nexport class PriceTickMarkBuilder {\n\tprivate _marks: PriceMark[] = [];\n\tprivate _base: number;\n\tprivate readonly _priceScale: PriceScale;\n\tprivate readonly _coordinateToLogicalFunc: CoordinateToLogicalConverter;\n\tprivate readonly _logicalToCoordinateFunc: LogicalToCoordinateConverter;\n\n\tpublic constructor(\n\t\tpriceScale: PriceScale,\n\t\tbase: number,\n\t\tcoordinateToLogicalFunc: CoordinateToLogicalConverter,\n\t\tlogicalToCoordinateFunc: LogicalToCoordinateConverter\n\t) {\n\t\tthis._priceScale = priceScale;\n\t\tthis._base = base;\n\t\tthis._coordinateToLogicalFunc = coordinateToLogicalFunc;\n\t\tthis._logicalToCoordinateFunc = logicalToCoordinateFunc;\n\t}\n\n\tpublic tickSpan(high: number, low: number): number {\n\t\tif (high < low) {\n\t\t\tthrow new Error('high < low');\n\t\t}\n\n\t\tconst scaleHeight = this._priceScale.height();\n\t\tconst markHeight = this._tickMarkHeight();\n\n\t\tconst maxTickSpan = (high - low) * markHeight / scaleHeight;\n\n\t\tconst spanCalculator1 = new PriceTickSpanCalculator(this._base, [2, 2.5, 2]);\n\t\tconst spanCalculator2 = new PriceTickSpanCalculator(this._base, [2, 2, 2.5]);\n\t\tconst spanCalculator3 = new PriceTickSpanCalculator(this._base, [2.5, 2, 2]);\n\n\t\tconst spans: number[] = [];\n\n\t\tspans.push(\n\t\t\tspanCalculator1.tickSpan(high, low, maxTickSpan),\n\t\t\tspanCalculator2.tickSpan(high, low, maxTickSpan),\n\t\t\tspanCalculator3.tickSpan(high, low, maxTickSpan)\n\t\t);\n\n\t\treturn min(spans);\n\t}\n\n\tpublic rebuildTickMarks(): void {\n\t\tconst priceScale = this._priceScale;\n\n\t\tconst firstValue = priceScale.firstValue();\n\n\t\tif (firstValue === null) {\n\t\t\tthis._marks = [];\n\t\t\treturn;\n\t\t}\n\n\t\tconst scaleHeight = priceScale.height();\n\n\t\tconst bottom = this._coordinateToLogicalFunc(scaleHeight - 1, firstValue);\n\t\tconst top = this._coordinateToLogicalFunc(0, firstValue);\n\n\t\tconst extraTopBottomMargin = this._priceScale.options().entireTextOnly ? this._fontHeight() / 2 : 0;\n\t\tconst minCoord = extraTopBottomMargin;\n\t\tconst maxCoord = scaleHeight - 1 - extraTopBottomMargin;\n\n\t\tconst high = Math.max(bottom, top);\n\t\tconst low = Math.min(bottom, top);\n\t\tif (high === low) {\n\t\t\tthis._marks = [];\n\t\t\treturn;\n\t\t}\n\n\t\tlet span = this.tickSpan(high, low);\n\t\tlet mod = high % span;\n\t\tmod += mod < 0 ? span : 0;\n\n\t\tconst sign = (high >= low) ? 1 : -1;\n\t\tlet prevCoord: number | null = null;\n\n\t\tlet targetIndex = 0;\n\n\t\tfor (let logical = high - mod; logical > low; logical -= span) {\n\t\t\tconst coord = this._logicalToCoordinateFunc(logical, firstValue, true);\n\n\t\t\t// check if there is place for it\n\t\t\t// this is required for log scale\n\t\t\tif (prevCoord !== null && Math.abs(coord - prevCoord) < this._tickMarkHeight()) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// check if a tick mark is partially visible and skip it if entireTextOnly is true\n\t\t\tif (coord < minCoord || coord > maxCoord) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (targetIndex < this._marks.length) {\n\t\t\t\tthis._marks[targetIndex].coord = coord as Coordinate;\n\t\t\t\tthis._marks[targetIndex].label = priceScale.formatLogical(logical);\n\t\t\t} else {\n\t\t\t\tthis._marks.push({\n\t\t\t\t\tcoord: coord as Coordinate,\n\t\t\t\t\tlabel: priceScale.formatLogical(logical),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\ttargetIndex++;\n\n\t\t\tprevCoord = coord;\n\t\t\tif (priceScale.isLog()) {\n\t\t\t\t// recalc span\n\t\t\t\tspan = this.tickSpan(logical * sign, low);\n\t\t\t}\n\t\t}\n\t\tthis._marks.length = targetIndex;\n\t}\n\n\tpublic marks(): PriceMark[] {\n\t\treturn this._marks;\n\t}\n\n\tprivate _fontHeight(): number {\n\t\treturn this._priceScale.fontSize();\n\t}\n\n\tprivate _tickMarkHeight(): number {\n\t\treturn Math.ceil(this._fontHeight() * TICK_DENSITY);\n\t}\n}\n","import { ensureNotNull } from '../helpers/assertions';\n\nimport { ZOrdered } from './idata-source';\n\nexport function sortSources<T extends ZOrdered>(sources: readonly T[]): T[] {\n\treturn sources.slice().sort((s1: ZOrdered, s2: ZOrdered) => {\n\t\treturn (ensureNotNull(s1.zorder()) - ensureNotNull(s2.zorder()));\n\t});\n}\n","import { IPriceFormatter } from '../formatters/iprice-formatter';\nimport { PercentageFormatter } from '../formatters/percentage-formatter';\nimport { PriceFormatter } from '../formatters/price-formatter';\n\nimport { ensureDefined, ensureNotNull } from '../helpers/assertions';\nimport { Delegate } from '../helpers/delegate';\nimport { ISubscription } from '../helpers/isubscription';\nimport { DeepPartial, merge } from '../helpers/strict-type-checks';\n\nimport { BarCoordinates, BarPrice, BarPrices } from './bar';\nimport { Coordinate } from './coordinate';\nimport { FirstValue, IPriceDataSource } from './iprice-data-source';\nimport { LayoutOptions } from './layout-options';\nimport { LocalizationOptionsBase } from './localization-options';\nimport { PriceFormatterFn } from './price-formatter-fn';\nimport { PriceRangeImpl } from './price-range-impl';\nimport {\n\tcanConvertPriceRangeFromLog,\n\tconvertPriceRangeFromLog,\n\tconvertPriceRangeToLog,\n\tfromIndexedTo100,\n\tfromLog,\n\tfromPercent,\n\tLogFormula,\n\tlogFormulaForPriceRange,\n\tlogFormulasAreSame,\n\ttoIndexedTo100,\n\ttoIndexedTo100Range,\n\ttoLog,\n\ttoPercent,\n\ttoPercentRange,\n} from './price-scale-conversions';\nimport { PriceTickMarkBuilder } from './price-tick-mark-builder';\nimport { RangeImpl } from './range-impl';\nimport { sortSources } from './sort-sources';\nimport { SeriesItemsIndexesRange, TimePointIndex } from './time-data';\n\n/**\n * Represents the price scale mode.\n */\nexport const enum PriceScaleMode {\n\t/**\n\t * Price scale shows prices. Price range changes linearly.\n\t */\n\tNormal,\n\t/**\n\t * Price scale shows prices. Price range changes logarithmically.\n\t */\n\tLogarithmic,\n\t/**\n\t * Price scale shows percentage values according the first visible value of the price scale.\n\t * The first visible value is 0% in this mode.\n\t */\n\tPercentage,\n\t/**\n\t * The same as percentage mode, but the first value is moved to 100.\n\t */\n\tIndexedTo100,\n}\n\nexport interface PriceScaleState {\n\tautoScale: boolean;\n\tisInverted: boolean;\n\tmode: PriceScaleMode;\n}\n\nexport interface PriceMark {\n\tcoord: Coordinate;\n\tlabel: string;\n}\n\nexport interface PricedValue {\n\tprice: BarPrice;\n\ty: Coordinate;\n}\n\n/** Defines margins of the price scale. */\nexport interface PriceScaleMargins {\n\t/**\n\t * Top margin in percentages. Must be greater or equal to 0 and less than 1.\n\t */\n\ttop: number;\n\t/**\n\t * Bottom margin in percentages. Must be greater or equal to 0 and less than 1.\n\t */\n\tbottom: number;\n}\n\n/** Structure that describes price scale options */\nexport interface PriceScaleOptions {\n\t/**\n\t * Autoscaling is a feature that automatically adjusts a price scale to fit the visible range of data.\n\t * Note that overlay price scales are always auto-scaled.\n\t *\n\t * @defaultValue `true`\n\t */\n\tautoScale: boolean;\n\n\t/**\n\t * Price scale mode.\n\t *\n\t * @defaultValue {@link PriceScaleMode.Normal}\n\t */\n\tmode: PriceScaleMode;\n\n\t/**\n\t * Invert the price scale, so that a upwards trend is shown as a downwards trend and vice versa.\n\t * Affects both the price scale and the data on the chart.\n\t *\n\t * @defaultValue `false`\n\t */\n\tinvertScale: boolean;\n\n\t/**\n\t * Align price scale labels to prevent them from overlapping.\n\t *\n\t * @defaultValue `true`\n\t */\n\talignLabels: boolean;\n\n\t/**\n\t * Price scale margins.\n\t *\n\t * @defaultValue `{ bottom: 0.1, top: 0.2 }`\n\t * @example\n\t * ```js\n\t * chart.priceScale('right').applyOptions({\n\t *     scaleMargins: {\n\t *         top: 0.8,\n\t *         bottom: 0,\n\t *     },\n\t * });\n\t * ```\n\t */\n\tscaleMargins: PriceScaleMargins;\n\n\t/**\n\t * Set true to draw a border between the price scale and the chart area.\n\t *\n\t * @defaultValue `true`\n\t */\n\tborderVisible: boolean;\n\n\t/**\n\t * Price scale border color.\n\t *\n\t * @defaultValue `'#2B2B43'`\n\t */\n\tborderColor: string;\n\n\t/**\n\t * Price scale text color.\n\t * If not provided {@link LayoutOptions.textColor} is used.\n\t *\n\t * @defaultValue `undefined`\n\t */\n\ttextColor?: string;\n\n\t/**\n\t * Show top and bottom corner labels only if entire text is visible.\n\t *\n\t * @defaultValue `false`\n\t */\n\tentireTextOnly: boolean;\n\n\t/**\n\t * Indicates if this price scale visible. Ignored by overlay price scales.\n\t *\n\t * @defaultValue `true` for the right price scale and `false` for the left\n\t */\n\tvisible: boolean;\n\n\t/**\n\t * Draw small horizontal line on price axis labels.\n\t *\n\t * @defaultValue `false`\n\t */\n\tticksVisible: boolean;\n\n\t/**\n\t * Define a minimum width for the price scale.\n\t * Note: This value will be exceeded if the\n\t * price scale needs more space to display it's contents.\n\t *\n\t * Setting a minimum width could be useful for ensuring that\n\t * multiple charts positioned in a vertical stack each have\n\t * an identical price scale width, or for plugins which\n\t * require a bit more space within the price scale pane.\n\t *\n\t * @defaultValue 0\n\t */\n\tminimumWidth: number;\n}\n\ninterface RangeCache {\n\tisValid: boolean;\n\tvisibleBars: RangeImpl<TimePointIndex> | null;\n}\n\n// actually price should be BarPrice\ntype PriceTransformer = (price: BarPrice, baseValue: number) => number;\n\nconst percentageFormatter = new PercentageFormatter();\nconst defaultPriceFormatter = new PriceFormatter(100, 1);\n\ninterface MarksCache {\n\tmarks: PriceMark[];\n\tfirstValueIsNull: boolean;\n}\n\nexport class PriceScale {\n\tprivate readonly _id: string;\n\n\tprivate readonly _layoutOptions: LayoutOptions;\n\tprivate readonly _localizationOptions: LocalizationOptionsBase;\n\tprivate readonly _options: PriceScaleOptions;\n\n\tprivate _height: number = 0;\n\tprivate _internalHeightCache: number | null = null;\n\n\tprivate _priceRange: PriceRangeImpl | null = null;\n\tprivate _priceRangeSnapshot: PriceRangeImpl | null = null;\n\tprivate _invalidatedForRange: RangeCache = { isValid: false, visibleBars: null };\n\n\tprivate _marginAbove: number = 0;\n\tprivate _marginBelow: number = 0;\n\n\tprivate _markBuilder: PriceTickMarkBuilder;\n\tprivate _onMarksChanged: Delegate = new Delegate();\n\n\tprivate _modeChanged: Delegate<PriceScaleState, PriceScaleState> = new Delegate();\n\n\tprivate _dataSources: IPriceDataSource[] = [];\n\tprivate _cachedOrderedSources: IPriceDataSource[] | null = null;\n\n\tprivate _marksCache: MarksCache | null = null;\n\n\tprivate _scaleStartPoint: number | null = null;\n\tprivate _scrollStartPoint: number | null = null;\n\tprivate _formatter: IPriceFormatter = defaultPriceFormatter;\n\n\tprivate _logFormula: LogFormula = logFormulaForPriceRange(null);\n\n\tpublic constructor(id: string, options: PriceScaleOptions, layoutOptions: LayoutOptions, localizationOptions: LocalizationOptionsBase) {\n\t\tthis._id = id;\n\t\tthis._options = options;\n\t\tthis._layoutOptions = layoutOptions;\n\t\tthis._localizationOptions = localizationOptions;\n\t\tthis._markBuilder = new PriceTickMarkBuilder(this, 100, this._coordinateToLogical.bind(this), this._logicalToCoordinate.bind(this));\n\t}\n\n\tpublic id(): string {\n\t\treturn this._id;\n\t}\n\n\tpublic options(): Readonly<PriceScaleOptions> {\n\t\treturn this._options;\n\t}\n\n\tpublic applyOptions(options: DeepPartial<PriceScaleOptions>): void {\n\t\tmerge(this._options, options);\n\t\tthis.updateFormatter();\n\n\t\tif (options.mode !== undefined) {\n\t\t\tthis.setMode({ mode: options.mode });\n\t\t}\n\n\t\tif (options.scaleMargins !== undefined) {\n\t\t\tconst top = ensureDefined(options.scaleMargins.top);\n\t\t\tconst bottom = ensureDefined(options.scaleMargins.bottom);\n\n\t\t\tif (top < 0 || top > 1) {\n\t\t\t\tthrow new Error(`Invalid top margin - expect value between 0 and 1, given=${top}`);\n\t\t\t}\n\n\t\t\tif (bottom < 0 || bottom > 1) {\n\t\t\t\tthrow new Error(`Invalid bottom margin - expect value between 0 and 1, given=${bottom}`);\n\t\t\t}\n\n\t\t\tif (top + bottom > 1) {\n\t\t\t\tthrow new Error(`Invalid margins - sum of margins must be less than 1, given=${top + bottom}`);\n\t\t\t}\n\n\t\t\tthis._invalidateInternalHeightCache();\n\t\t\tthis._marksCache = null;\n\t\t}\n\t}\n\n\tpublic isAutoScale(): boolean {\n\t\treturn this._options.autoScale;\n\t}\n\n\tpublic isLog(): boolean {\n\t\treturn this._options.mode === PriceScaleMode.Logarithmic;\n\t}\n\n\tpublic isPercentage(): boolean {\n\t\treturn this._options.mode === PriceScaleMode.Percentage;\n\t}\n\n\tpublic isIndexedTo100(): boolean {\n\t\treturn this._options.mode === PriceScaleMode.IndexedTo100;\n\t}\n\n\tpublic mode(): PriceScaleState {\n\t\treturn {\n\t\t\tautoScale: this._options.autoScale,\n\t\t\tisInverted: this._options.invertScale,\n\t\t\tmode: this._options.mode,\n\t\t};\n\t}\n\n\t// eslint-disable-next-line complexity\n\tpublic setMode(newMode: Partial<PriceScaleState>): void {\n\t\tconst oldMode = this.mode();\n\t\tlet priceRange: PriceRangeImpl | null = null;\n\n\t\tif (newMode.autoScale !== undefined) {\n\t\t\tthis._options.autoScale = newMode.autoScale;\n\t\t}\n\n\t\tif (newMode.mode !== undefined) {\n\t\t\tthis._options.mode = newMode.mode;\n\t\t\tif (newMode.mode === PriceScaleMode.Percentage || newMode.mode === PriceScaleMode.IndexedTo100) {\n\t\t\t\tthis._options.autoScale = true;\n\t\t\t}\n\t\t\t// TODO: Remove after making rebuildTickMarks lazy\n\t\t\tthis._invalidatedForRange.isValid = false;\n\t\t}\n\n\t\t// define which scale converted from\n\t\tif (oldMode.mode === PriceScaleMode.Logarithmic && newMode.mode !== oldMode.mode) {\n\t\t\tif (canConvertPriceRangeFromLog(this._priceRange, this._logFormula)) {\n\t\t\t\tpriceRange = convertPriceRangeFromLog(this._priceRange, this._logFormula);\n\n\t\t\t\tif (priceRange !== null) {\n\t\t\t\t\tthis.setPriceRange(priceRange);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._options.autoScale = true;\n\t\t\t}\n\t\t}\n\n\t\t// define which scale converted to\n\t\tif (newMode.mode === PriceScaleMode.Logarithmic && newMode.mode !== oldMode.mode) {\n\t\t\tpriceRange = convertPriceRangeToLog(this._priceRange, this._logFormula);\n\n\t\t\tif (priceRange !== null) {\n\t\t\t\tthis.setPriceRange(priceRange);\n\t\t\t}\n\t\t}\n\n\t\tconst modeChanged = oldMode.mode !== this._options.mode;\n\t\tif (modeChanged && (oldMode.mode === PriceScaleMode.Percentage || this.isPercentage())) {\n\t\t\tthis.updateFormatter();\n\t\t}\n\n\t\tif (modeChanged && (oldMode.mode === PriceScaleMode.IndexedTo100 || this.isIndexedTo100())) {\n\t\t\tthis.updateFormatter();\n\t\t}\n\n\t\tif (newMode.isInverted !== undefined && oldMode.isInverted !== newMode.isInverted) {\n\t\t\tthis._options.invertScale = newMode.isInverted;\n\t\t\tthis._onIsInvertedChanged();\n\t\t}\n\n\t\tthis._modeChanged.fire(oldMode, this.mode());\n\t}\n\n\tpublic modeChanged(): ISubscription<PriceScaleState, PriceScaleState> {\n\t\treturn this._modeChanged;\n\t}\n\n\tpublic fontSize(): number {\n\t\treturn this._layoutOptions.fontSize;\n\t}\n\n\tpublic height(): number {\n\t\treturn this._height;\n\t}\n\n\tpublic setHeight(value: number): void {\n\t\tif (this._height === value) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._height = value;\n\t\tthis._invalidateInternalHeightCache();\n\t\tthis._marksCache = null;\n\t}\n\n\tpublic internalHeight(): number {\n\t\tif (this._internalHeightCache) {\n\t\t\treturn this._internalHeightCache;\n\t\t}\n\n\t\tconst res = this.height() - this._topMarginPx() - this._bottomMarginPx();\n\t\tthis._internalHeightCache = res;\n\t\treturn res;\n\t}\n\n\tpublic priceRange(): PriceRangeImpl | null {\n\t\tthis._makeSureItIsValid();\n\t\treturn this._priceRange;\n\t}\n\n\tpublic setPriceRange(newPriceRange: PriceRangeImpl | null, isForceSetValue?: boolean): void {\n\t\tconst oldPriceRange = this._priceRange;\n\n\t\tif (!isForceSetValue &&\n\t\t\t!(oldPriceRange === null && newPriceRange !== null) &&\n\t\t\t(oldPriceRange === null || oldPriceRange.equals(newPriceRange))) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._marksCache = null;\n\t\tthis._priceRange = newPriceRange;\n\t}\n\n\tpublic isEmpty(): boolean {\n\t\tthis._makeSureItIsValid();\n\t\treturn this._height === 0 || !this._priceRange || this._priceRange.isEmpty();\n\t}\n\n\tpublic invertedCoordinate(coordinate: number): number {\n\t\treturn this.isInverted() ? coordinate : this.height() - 1 - coordinate;\n\t}\n\n\tpublic priceToCoordinate(price: number, baseValue: number): Coordinate {\n\t\tif (this.isPercentage()) {\n\t\t\tprice = toPercent(price, baseValue);\n\t\t} else if (this.isIndexedTo100()) {\n\t\t\tprice = toIndexedTo100(price, baseValue);\n\t\t}\n\n\t\treturn this._logicalToCoordinate(price, baseValue);\n\t}\n\n\tpublic pointsArrayToCoordinates<T extends PricedValue>(points: T[], baseValue: number, visibleRange?: SeriesItemsIndexesRange): void {\n\t\tthis._makeSureItIsValid();\n\t\tconst bh = this._bottomMarginPx();\n\t\tconst range = ensureNotNull(this.priceRange());\n\t\tconst min = range.minValue();\n\t\tconst max = range.maxValue();\n\t\tconst ih = (this.internalHeight() - 1);\n\t\tconst isInverted = this.isInverted();\n\n\t\tconst hmm = ih / (max - min);\n\n\t\tconst fromIndex = (visibleRange === undefined) ? 0 : visibleRange.from;\n\t\tconst toIndex = (visibleRange === undefined) ? points.length : visibleRange.to;\n\n\t\tconst transformFn = this._getCoordinateTransformer();\n\t\tfor (let i = fromIndex; i < toIndex; i++) {\n\t\t\tconst point = points[i];\n\t\t\tconst price = point.price;\n\n\t\t\tif (isNaN(price)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet logical = price;\n\t\t\tif (transformFn !== null) {\n\t\t\t\tlogical = transformFn(point.price, baseValue) as BarPrice;\n\t\t\t}\n\n\t\t\tconst invCoordinate = bh + hmm * (logical - min);\n\t\t\tconst coordinate = isInverted ? invCoordinate : this._height - 1 - invCoordinate;\n\t\t\tpoint.y = coordinate as Coordinate;\n\t\t}\n\t}\n\n\tpublic barPricesToCoordinates<T extends BarPrices & BarCoordinates>(pricesList: T[], baseValue: number, visibleRange?: SeriesItemsIndexesRange): void {\n\t\tthis._makeSureItIsValid();\n\t\tconst bh = this._bottomMarginPx();\n\t\tconst range = ensureNotNull(this.priceRange());\n\t\tconst min = range.minValue();\n\t\tconst max = range.maxValue();\n\t\tconst ih = (this.internalHeight() - 1);\n\t\tconst isInverted = this.isInverted();\n\n\t\tconst hmm = ih / (max - min);\n\n\t\tconst fromIndex = (visibleRange === undefined) ? 0 : visibleRange.from;\n\t\tconst toIndex = (visibleRange === undefined) ? pricesList.length : visibleRange.to;\n\n\t\tconst transformFn = this._getCoordinateTransformer();\n\t\tfor (let i = fromIndex; i < toIndex; i++) {\n\t\t\tconst bar = pricesList[i];\n\n\t\t\tlet openLogical = bar.open;\n\t\t\tlet highLogical = bar.high;\n\t\t\tlet lowLogical = bar.low;\n\t\t\tlet closeLogical = bar.close;\n\n\t\t\tif (transformFn !== null) {\n\t\t\t\topenLogical = transformFn(bar.open, baseValue) as BarPrice;\n\t\t\t\thighLogical = transformFn(bar.high, baseValue) as BarPrice;\n\t\t\t\tlowLogical = transformFn(bar.low, baseValue) as BarPrice;\n\t\t\t\tcloseLogical = transformFn(bar.close, baseValue) as BarPrice;\n\t\t\t}\n\n\t\t\tlet invCoordinate = bh + hmm * (openLogical - min);\n\t\t\tlet coordinate = isInverted ? invCoordinate : this._height - 1 - invCoordinate;\n\t\t\tbar.openY = coordinate as Coordinate;\n\n\t\t\tinvCoordinate = bh + hmm * (highLogical - min);\n\t\t\tcoordinate = isInverted ? invCoordinate : this._height - 1 - invCoordinate;\n\t\t\tbar.highY = coordinate as Coordinate;\n\n\t\t\tinvCoordinate = bh + hmm * (lowLogical - min);\n\t\t\tcoordinate = isInverted ? invCoordinate : this._height - 1 - invCoordinate;\n\t\t\tbar.lowY = coordinate as Coordinate;\n\n\t\t\tinvCoordinate = bh + hmm * (closeLogical - min);\n\t\t\tcoordinate = isInverted ? invCoordinate : this._height - 1 - invCoordinate;\n\t\t\tbar.closeY = coordinate as Coordinate;\n\t\t}\n\t}\n\n\tpublic coordinateToPrice(coordinate: Coordinate, baseValue: number): BarPrice {\n\t\tconst logical = this._coordinateToLogical(coordinate, baseValue);\n\t\treturn this.logicalToPrice(logical, baseValue);\n\t}\n\n\tpublic logicalToPrice(logical: number, baseValue: number): BarPrice {\n\t\tlet value = logical;\n\t\tif (this.isPercentage()) {\n\t\t\tvalue = fromPercent(value, baseValue);\n\t\t} else if (this.isIndexedTo100()) {\n\t\t\tvalue = fromIndexedTo100(value, baseValue);\n\t\t}\n\t\treturn value as BarPrice;\n\t}\n\n\tpublic dataSources(): readonly IPriceDataSource[] {\n\t\treturn this._dataSources;\n\t}\n\n\tpublic orderedSources(): readonly IPriceDataSource[] {\n\t\tif (this._cachedOrderedSources) {\n\t\t\treturn this._cachedOrderedSources;\n\t\t}\n\n\t\tlet sources: IPriceDataSource[] = [];\n\t\tfor (let i = 0; i < this._dataSources.length; i++) {\n\t\t\tconst ds = this._dataSources[i];\n\t\t\tif (ds.zorder() === null) {\n\t\t\t\tds.setZorder(i + 1);\n\t\t\t}\n\n\t\t\tsources.push(ds);\n\t\t}\n\n\t\tsources = sortSources<IPriceDataSource>(sources);\n\t\tthis._cachedOrderedSources = sources;\n\t\treturn this._cachedOrderedSources;\n\t}\n\n\tpublic addDataSource(source: IPriceDataSource): void {\n\t\tif (this._dataSources.indexOf(source) !== -1) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._dataSources.push(source);\n\t\tthis.updateFormatter();\n\t\tthis.invalidateSourcesCache();\n\t}\n\n\tpublic removeDataSource(source: IPriceDataSource): void {\n\t\tconst index = this._dataSources.indexOf(source);\n\t\tif (index === -1) {\n\t\t\tthrow new Error('source is not attached to scale');\n\t\t}\n\n\t\tthis._dataSources.splice(index, 1);\n\n\t\tif (this._dataSources.length === 0) {\n\t\t\tthis.setMode({\n\t\t\t\tautoScale: true,\n\t\t\t});\n\n\t\t\t// if no sources on price scale let's clear price range cache as well as enabling auto scale\n\t\t\tthis.setPriceRange(null);\n\t\t}\n\n\t\tthis.updateFormatter();\n\t\tthis.invalidateSourcesCache();\n\t}\n\n\tpublic firstValue(): number | null {\n\t\t// TODO: cache the result\n\t\tlet result: FirstValue | null = null;\n\n\t\tfor (const source of this._dataSources) {\n\t\t\tconst firstValue = source.firstValue();\n\t\t\tif (firstValue === null) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (result === null || firstValue.timePoint < result.timePoint) {\n\t\t\t\tresult = firstValue;\n\t\t\t}\n\t\t}\n\n\t\treturn result === null ? null : result.value;\n\t}\n\n\tpublic isInverted(): boolean {\n\t\treturn this._options.invertScale;\n\t}\n\n\tpublic marks(): PriceMark[] {\n\t\tconst firstValueIsNull = this.firstValue() === null;\n\n\t\t// do not recalculate marks if firstValueIsNull is true because in this case we'll always get empty result\n\t\t// this could happen in case when a series had some data and then you set empty data to it (in a simplified case)\n\t\t// we could display an empty price scale, but this is not good from UX\n\t\t// so in this case we need to keep an previous marks to display them on the scale\n\t\t// as one of possible examples for this situation could be the following:\n\t\t// let's say you have a study/indicator attached to a price scale and then you decide to stop it, i.e. remove its data because of its visibility\n\t\t// a user will see the previous marks on the scale until you turn on your study back or remove it from the chart completely\n\t\tif (this._marksCache !== null && (firstValueIsNull || this._marksCache.firstValueIsNull === firstValueIsNull)) {\n\t\t\treturn this._marksCache.marks;\n\t\t}\n\n\t\tthis._markBuilder.rebuildTickMarks();\n\t\tconst marks = this._markBuilder.marks();\n\t\tthis._marksCache = { marks, firstValueIsNull };\n\t\tthis._onMarksChanged.fire();\n\n\t\treturn marks;\n\t}\n\n\tpublic onMarksChanged(): ISubscription {\n\t\treturn this._onMarksChanged;\n\t}\n\n\tpublic startScale(x: number): void {\n\t\tif (this.isPercentage() || this.isIndexedTo100()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._scaleStartPoint !== null || this._priceRangeSnapshot !== null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isEmpty()) {\n\t\t\treturn;\n\t\t}\n\n\t\t// invert x\n\t\tthis._scaleStartPoint = this._height - x;\n\t\tthis._priceRangeSnapshot = ensureNotNull(this.priceRange()).clone();\n\t}\n\n\tpublic scaleTo(x: number): void {\n\t\tif (this.isPercentage() || this.isIndexedTo100()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._scaleStartPoint === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setMode({\n\t\t\tautoScale: false,\n\t\t});\n\n\t\t// invert x\n\t\tx = this._height - x;\n\n\t\tif (x < 0) {\n\t\t\tx = 0;\n\t\t}\n\n\t\tlet scaleCoeff = (this._scaleStartPoint + (this._height - 1) * 0.2) / (x + (this._height - 1) * 0.2);\n\t\tconst newPriceRange = ensureNotNull(this._priceRangeSnapshot).clone();\n\n\t\tscaleCoeff = Math.max(scaleCoeff, 0.1);\n\t\tnewPriceRange.scaleAroundCenter(scaleCoeff);\n\t\tthis.setPriceRange(newPriceRange);\n\t}\n\n\tpublic endScale(): void {\n\t\tif (this.isPercentage() || this.isIndexedTo100()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._scaleStartPoint = null;\n\t\tthis._priceRangeSnapshot = null;\n\t}\n\n\tpublic startScroll(x: number): void {\n\t\tif (this.isAutoScale()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._scrollStartPoint !== null || this._priceRangeSnapshot !== null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isEmpty()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._scrollStartPoint = x;\n\t\tthis._priceRangeSnapshot = ensureNotNull(this.priceRange()).clone();\n\t}\n\n\tpublic scrollTo(x: number): void {\n\t\tif (this.isAutoScale()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._scrollStartPoint === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst priceUnitsPerPixel = ensureNotNull(this.priceRange()).length() / (this.internalHeight() - 1);\n\t\tlet pixelDelta = x - this._scrollStartPoint;\n\n\t\tif (this.isInverted()) {\n\t\t\tpixelDelta *= -1;\n\t\t}\n\n\t\tconst priceDelta = pixelDelta * priceUnitsPerPixel;\n\t\tconst newPriceRange = ensureNotNull(this._priceRangeSnapshot).clone();\n\n\t\tnewPriceRange.shift(priceDelta);\n\t\tthis.setPriceRange(newPriceRange, true);\n\t\tthis._marksCache = null;\n\t}\n\n\tpublic endScroll(): void {\n\t\tif (this.isAutoScale()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._scrollStartPoint === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._scrollStartPoint = null;\n\t\tthis._priceRangeSnapshot = null;\n\t}\n\n\tpublic formatter(): IPriceFormatter {\n\t\tif (!this._formatter) {\n\t\t\tthis.updateFormatter();\n\t\t}\n\n\t\treturn this._formatter;\n\t}\n\n\tpublic formatPrice(price: number, firstValue: number): string {\n\t\tswitch (this._options.mode) {\n\t\t\tcase PriceScaleMode.Percentage:\n\t\t\t\treturn this._formatPercentage(toPercent(price, firstValue));\n\t\t\tcase PriceScaleMode.IndexedTo100:\n\t\t\t\treturn this.formatter().format(toIndexedTo100(price, firstValue));\n\t\t\tdefault:\n\t\t\t\treturn this._formatPrice(price as BarPrice);\n\t\t}\n\t}\n\n\tpublic formatLogical(logical: number): string {\n\t\tswitch (this._options.mode) {\n\t\t\tcase PriceScaleMode.Percentage:\n\t\t\t\treturn this._formatPercentage(logical);\n\t\t\tcase PriceScaleMode.IndexedTo100:\n\t\t\t\treturn this.formatter().format(logical);\n\t\t\tdefault:\n\t\t\t\treturn this._formatPrice(logical as BarPrice);\n\t\t}\n\t}\n\n\tpublic formatPriceAbsolute(price: number): string {\n\t\treturn this._formatPrice(price as BarPrice, ensureNotNull(this._formatterSource()).formatter());\n\t}\n\n\tpublic formatPricePercentage(price: number, baseValue: number): string {\n\t\tprice = toPercent(price, baseValue);\n\t\treturn this._formatPercentage(price, percentageFormatter);\n\t}\n\n\tpublic sourcesForAutoScale(): readonly IPriceDataSource[] {\n\t\treturn this._dataSources;\n\t}\n\n\tpublic recalculatePriceRange(visibleBars: RangeImpl<TimePointIndex>): void {\n\t\tthis._invalidatedForRange = {\n\t\t\tvisibleBars: visibleBars,\n\t\t\tisValid: false,\n\t\t};\n\t}\n\n\tpublic updateAllViews(): void {\n\t\tthis._dataSources.forEach((s: IPriceDataSource) => s.updateAllViews());\n\t}\n\n\tpublic updateFormatter(): void {\n\t\tthis._marksCache = null;\n\t\tconst formatterSource = this._formatterSource();\n\t\tlet base = 100;\n\t\tif (formatterSource !== null) {\n\t\t\tbase = Math.round(1 / formatterSource.minMove());\n\t\t}\n\n\t\tthis._formatter = defaultPriceFormatter;\n\t\tif (this.isPercentage()) {\n\t\t\tthis._formatter = percentageFormatter;\n\t\t\tbase = 100;\n\t\t} else if (this.isIndexedTo100()) {\n\t\t\tthis._formatter = new PriceFormatter(100, 1);\n\t\t\tbase = 100;\n\t\t} else {\n\t\t\tif (formatterSource !== null) {\n\t\t\t\t// user\n\t\t\t\tthis._formatter = formatterSource.formatter();\n\t\t\t}\n\t\t}\n\n\t\tthis._markBuilder = new PriceTickMarkBuilder(\n\t\t\tthis,\n\t\t\tbase,\n\t\t\tthis._coordinateToLogical.bind(this),\n\t\t\tthis._logicalToCoordinate.bind(this)\n\t\t);\n\n\t\tthis._markBuilder.rebuildTickMarks();\n\t}\n\n\tpublic invalidateSourcesCache(): void {\n\t\tthis._cachedOrderedSources = null;\n\t}\n\n\t/**\n\t * @returns The {@link IPriceDataSource} that will be used as the \"formatter source\" (take minMove for formatter).\n\t */\n\tprivate _formatterSource(): IPriceDataSource | null {\n\t\treturn this._dataSources[0] || null;\n\t}\n\n\tprivate _topMarginPx(): number {\n\t\treturn this.isInverted()\n\t\t\t? this._options.scaleMargins.bottom * this.height() + this._marginBelow\n\t\t\t: this._options.scaleMargins.top * this.height() + this._marginAbove;\n\t}\n\n\tprivate _bottomMarginPx(): number {\n\t\treturn this.isInverted()\n\t\t\t? this._options.scaleMargins.top * this.height() + this._marginAbove\n\t\t\t: this._options.scaleMargins.bottom * this.height() + this._marginBelow;\n\t}\n\n\tprivate _makeSureItIsValid(): void {\n\t\tif (!this._invalidatedForRange.isValid) {\n\t\t\tthis._invalidatedForRange.isValid = true;\n\t\t\tthis._recalculatePriceRangeImpl();\n\t\t}\n\t}\n\n\tprivate _invalidateInternalHeightCache(): void {\n\t\tthis._internalHeightCache = null;\n\t}\n\n\tprivate _logicalToCoordinate(logical: number, baseValue: number): Coordinate {\n\t\tthis._makeSureItIsValid();\n\t\tif (this.isEmpty()) {\n\t\t\treturn 0 as Coordinate;\n\t\t}\n\n\t\tlogical = this.isLog() && logical ? toLog(logical, this._logFormula) : logical;\n\t\tconst range = ensureNotNull(this.priceRange());\n\t\tconst invCoordinate = this._bottomMarginPx() +\n\t\t\t(this.internalHeight() - 1) * (logical - range.minValue()) / range.length();\n\t\tconst coordinate = this.invertedCoordinate(invCoordinate);\n\t\treturn coordinate as Coordinate;\n\t}\n\n\tprivate _coordinateToLogical(coordinate: number, baseValue: number): number {\n\t\tthis._makeSureItIsValid();\n\t\tif (this.isEmpty()) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst invCoordinate = this.invertedCoordinate(coordinate);\n\t\tconst range = ensureNotNull(this.priceRange());\n\t\tconst logical = range.minValue() + range.length() *\n\t\t\t((invCoordinate - this._bottomMarginPx()) / (this.internalHeight() - 1));\n\t\treturn this.isLog() ? fromLog(logical, this._logFormula) : logical;\n\t}\n\n\tprivate _onIsInvertedChanged(): void {\n\t\tthis._marksCache = null;\n\t\tthis._markBuilder.rebuildTickMarks();\n\t}\n\n\t// eslint-disable-next-line complexity\n\tprivate _recalculatePriceRangeImpl(): void {\n\t\tconst visibleBars = this._invalidatedForRange.visibleBars;\n\t\tif (visibleBars === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet priceRange: PriceRangeImpl | null = null;\n\t\tconst sources = this.sourcesForAutoScale();\n\n\t\tlet marginAbove = 0;\n\t\tlet marginBelow = 0;\n\n\t\tfor (const source of sources) {\n\t\t\tif (!source.visible()) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst firstValue = source.firstValue();\n\t\t\tif (firstValue === null) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst autoScaleInfo = source.autoscaleInfo(visibleBars.left(), visibleBars.right());\n\t\t\tlet sourceRange = autoScaleInfo && autoScaleInfo.priceRange();\n\n\t\t\tif (sourceRange !== null) {\n\t\t\t\tswitch (this._options.mode) {\n\t\t\t\t\tcase PriceScaleMode.Logarithmic:\n\t\t\t\t\t\tsourceRange = convertPriceRangeToLog(sourceRange, this._logFormula);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PriceScaleMode.Percentage:\n\t\t\t\t\t\tsourceRange = toPercentRange(sourceRange, firstValue.value);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PriceScaleMode.IndexedTo100:\n\t\t\t\t\t\tsourceRange = toIndexedTo100Range(sourceRange, firstValue.value);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (priceRange === null) {\n\t\t\t\t\tpriceRange = sourceRange;\n\t\t\t\t} else {\n\t\t\t\t\tpriceRange = priceRange.merge(ensureNotNull(sourceRange));\n\t\t\t\t}\n\n\t\t\t\tif (autoScaleInfo !== null) {\n\t\t\t\t\tconst margins = autoScaleInfo.margins();\n\t\t\t\t\tif (margins !== null) {\n\t\t\t\t\t\tmarginAbove = Math.max(marginAbove, margins.above);\n\t\t\t\t\t\tmarginBelow = Math.max(marginBelow, margins.below);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (marginAbove !== this._marginAbove || marginBelow !== this._marginBelow) {\n\t\t\tthis._marginAbove = marginAbove;\n\t\t\tthis._marginBelow = marginBelow;\n\t\t\tthis._marksCache = null;\n\t\t\tthis._invalidateInternalHeightCache();\n\t\t}\n\n\t\tif (priceRange !== null) {\n\t\t\t// keep current range is new is empty\n\t\t\tif (priceRange.minValue() === priceRange.maxValue()) {\n\t\t\t\tconst formatterSource = this._formatterSource();\n\t\t\t\tconst minMove = formatterSource === null || this.isPercentage() || this.isIndexedTo100() ? 1 : formatterSource.minMove();\n\n\t\t\t\t// if price range is degenerated to 1 point let's extend it by 10 min move values\n\t\t\t\t// to avoid incorrect range and empty (blank) scale (in case of min tick much greater than 1)\n\t\t\t\tconst extendValue = 5 * minMove;\n\n\t\t\t\tif (this.isLog()) {\n\t\t\t\t\tpriceRange = convertPriceRangeFromLog(priceRange, this._logFormula);\n\t\t\t\t}\n\n\t\t\t\tpriceRange = new PriceRangeImpl(priceRange.minValue() - extendValue, priceRange.maxValue() + extendValue);\n\n\t\t\t\tif (this.isLog()) {\n\t\t\t\t\tpriceRange = convertPriceRangeToLog(priceRange, this._logFormula);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.isLog()) {\n\t\t\t\tconst rawRange = convertPriceRangeFromLog(priceRange, this._logFormula);\n\t\t\t\tconst newLogFormula = logFormulaForPriceRange(rawRange);\n\t\t\t\tif (!logFormulasAreSame(newLogFormula, this._logFormula)) {\n\t\t\t\t\tconst rawSnapshot = this._priceRangeSnapshot !== null ? convertPriceRangeFromLog(this._priceRangeSnapshot, this._logFormula) : null;\n\t\t\t\t\tthis._logFormula = newLogFormula;\n\t\t\t\t\tpriceRange = convertPriceRangeToLog(rawRange, newLogFormula);\n\t\t\t\t\tif (rawSnapshot !== null) {\n\t\t\t\t\t\tthis._priceRangeSnapshot = convertPriceRangeToLog(rawSnapshot, newLogFormula);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setPriceRange(priceRange);\n\t\t} else {\n\t\t\t// reset empty to default\n\t\t\tif (this._priceRange === null) {\n\t\t\t\tthis.setPriceRange(new PriceRangeImpl(-0.5, 0.5));\n\t\t\t\tthis._logFormula = logFormulaForPriceRange(null);\n\t\t\t}\n\t\t}\n\n\t\tthis._invalidatedForRange.isValid = true;\n\t}\n\n\tprivate _getCoordinateTransformer(): PriceTransformer | null {\n\t\tif (this.isPercentage()) {\n\t\t\treturn toPercent;\n\t\t} else if (this.isIndexedTo100()) {\n\t\t\treturn toIndexedTo100;\n\t\t} else if (this.isLog()) {\n\t\t\treturn (price: number) => toLog(price, this._logFormula);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate _formatValue(value: BarPrice | number, formatter: PriceFormatterFn | undefined, fallbackFormatter?: IPriceFormatter): string {\n\t\tif (formatter === undefined) {\n\t\t\tif (fallbackFormatter === undefined) {\n\t\t\t\tfallbackFormatter = this.formatter();\n\t\t\t}\n\t\t\treturn fallbackFormatter.format(value);\n\t\t}\n\n\t\treturn formatter(value as BarPrice);\n\t}\n\n\tprivate _formatPrice(price: BarPrice, fallbackFormatter?: IPriceFormatter): string {\n\t\treturn this._formatValue(price, this._localizationOptions.priceFormatter, fallbackFormatter);\n\t}\n\n\tprivate _formatPercentage(percentage: number, fallbackFormatter?: IPriceFormatter): string {\n\t\treturn this._formatValue(percentage, this._localizationOptions.percentageFormatter, fallbackFormatter);\n\t}\n}\n","import { assert, ensureDefined, ensureNotNull } from '../helpers/assertions';\nimport { Delegate } from '../helpers/delegate';\nimport { IDestroyable } from '../helpers/idestroyable';\nimport { ISubscription } from '../helpers/isubscription';\nimport { clone, DeepPartial } from '../helpers/strict-type-checks';\n\nimport { ChartOptionsBase, IChartModelBase, OverlayPriceScaleOptions, VisiblePriceScaleOptions } from './chart-model';\nimport { DefaultPriceScaleId, isDefaultPriceScale } from './default-price-scale';\nimport { Grid } from './grid';\nimport { IPriceDataSource } from './iprice-data-source';\nimport { PriceScale, PriceScaleOptions, PriceScaleState } from './price-scale';\nimport { sortSources } from './sort-sources';\nimport { ITimeScale } from './time-scale';\n\nexport const DEFAULT_STRETCH_FACTOR = 1000;\n\nexport type PriceScalePosition = 'left' | 'right' | 'overlay';\n\ninterface MinMaxOrderInfo {\n\tminZOrder: number;\n\tmaxZOrder: number;\n}\n\nexport class Pane implements IDestroyable {\n\tprivate readonly _timeScale: ITimeScale;\n\tprivate readonly _model: IChartModelBase;\n\tprivate readonly _grid: Grid;\n\n\tprivate _dataSources: IPriceDataSource[] = [];\n\tprivate _overlaySourcesByScaleId: Map<string, IPriceDataSource[]> = new Map();\n\n\tprivate _height: number = 0;\n\tprivate _width: number = 0;\n\tprivate _stretchFactor: number = DEFAULT_STRETCH_FACTOR;\n\tprivate _cachedOrderedSources: readonly IPriceDataSource[] | null = null;\n\n\tprivate _destroyed: Delegate = new Delegate();\n\n\tprivate _leftPriceScale: PriceScale;\n\tprivate _rightPriceScale: PriceScale;\n\n\tpublic constructor(timeScale: ITimeScale, model: IChartModelBase) {\n\t\tthis._timeScale = timeScale;\n\t\tthis._model = model;\n\t\tthis._grid = new Grid(this);\n\n\t\tconst options = model.options();\n\n\t\tthis._leftPriceScale = this._createPriceScale(DefaultPriceScaleId.Left, options.leftPriceScale);\n\t\tthis._rightPriceScale = this._createPriceScale(DefaultPriceScaleId.Right, options.rightPriceScale);\n\n\t\tthis._leftPriceScale.modeChanged().subscribe(this._onPriceScaleModeChanged.bind(this, this._leftPriceScale), this);\n\t\tthis._rightPriceScale.modeChanged().subscribe(this._onPriceScaleModeChanged.bind(this, this._rightPriceScale), this);\n\n\t\tthis.applyScaleOptions(options);\n\t}\n\n\tpublic applyScaleOptions(options: DeepPartial<ChartOptionsBase>): void {\n\t\tif (options.leftPriceScale) {\n\t\t\tthis._leftPriceScale.applyOptions(options.leftPriceScale);\n\t\t}\n\t\tif (options.rightPriceScale) {\n\t\t\tthis._rightPriceScale.applyOptions(options.rightPriceScale);\n\t\t}\n\t\tif (options.localization) {\n\t\t\tthis._leftPriceScale.updateFormatter();\n\t\t\tthis._rightPriceScale.updateFormatter();\n\t\t}\n\t\tif (options.overlayPriceScales) {\n\t\t\tconst sourceArrays = Array.from(this._overlaySourcesByScaleId.values());\n\t\t\tfor (const arr of sourceArrays) {\n\t\t\t\tconst priceScale = ensureNotNull(arr[0].priceScale());\n\t\t\t\tpriceScale.applyOptions(options.overlayPriceScales);\n\t\t\t\tif (options.localization) {\n\t\t\t\t\tpriceScale.updateFormatter();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic priceScaleById(id: string): PriceScale | null {\n\t\tswitch (id) {\n\t\t\tcase DefaultPriceScaleId.Left: {\n\t\t\t\treturn this._leftPriceScale;\n\t\t\t}\n\t\t\tcase DefaultPriceScaleId.Right: {\n\t\t\t\treturn this._rightPriceScale;\n\t\t\t}\n\t\t}\n\t\tif (this._overlaySourcesByScaleId.has(id)) {\n\t\t\treturn ensureDefined(this._overlaySourcesByScaleId.get(id))[0].priceScale();\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic destroy(): void {\n\t\tthis.model().priceScalesOptionsChanged().unsubscribeAll(this);\n\n\t\tthis._leftPriceScale.modeChanged().unsubscribeAll(this);\n\t\tthis._rightPriceScale.modeChanged().unsubscribeAll(this);\n\n\t\tthis._dataSources.forEach((source: IPriceDataSource) => {\n\t\t\tif (source.destroy) {\n\t\t\t\tsource.destroy();\n\t\t\t}\n\t\t});\n\t\tthis._destroyed.fire();\n\t}\n\n\tpublic stretchFactor(): number {\n\t\treturn this._stretchFactor;\n\t}\n\n\tpublic setStretchFactor(factor: number): void {\n\t\tthis._stretchFactor = factor;\n\t}\n\n\tpublic model(): IChartModelBase {\n\t\treturn this._model;\n\t}\n\n\tpublic width(): number {\n\t\treturn this._width;\n\t}\n\n\tpublic height(): number {\n\t\treturn this._height;\n\t}\n\n\tpublic setWidth(width: number): void {\n\t\tthis._width = width;\n\t\tthis.updateAllSources();\n\t}\n\n\tpublic setHeight(height: number): void {\n\t\tthis._height = height;\n\n\t\tthis._leftPriceScale.setHeight(height);\n\t\tthis._rightPriceScale.setHeight(height);\n\n\t\t// process overlays\n\t\tthis._dataSources.forEach((ds: IPriceDataSource) => {\n\t\t\tif (this.isOverlay(ds)) {\n\t\t\t\tconst priceScale = ds.priceScale();\n\t\t\t\tif (priceScale !== null) {\n\t\t\t\t\tpriceScale.setHeight(height);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.updateAllSources();\n\t}\n\n\tpublic dataSources(): readonly IPriceDataSource[] {\n\t\treturn this._dataSources;\n\t}\n\n\tpublic isOverlay(source: IPriceDataSource): boolean {\n\t\tconst priceScale = source.priceScale();\n\t\tif (priceScale === null) {\n\t\t\treturn true;\n\t\t}\n\t\treturn this._leftPriceScale !== priceScale && this._rightPriceScale !== priceScale;\n\t}\n\n\tpublic addDataSource(source: IPriceDataSource, targetScaleId: string, zOrder?: number): void {\n\t\tconst targetZOrder = (zOrder !== undefined) ? zOrder : this._getZOrderMinMax().maxZOrder + 1;\n\t\tthis._insertDataSource(source, targetScaleId, targetZOrder);\n\t}\n\n\tpublic removeDataSource(source: IPriceDataSource): void {\n\t\tconst index = this._dataSources.indexOf(source);\n\t\tassert(index !== -1, 'removeDataSource: invalid data source');\n\n\t\tthis._dataSources.splice(index, 1);\n\n\t\tconst priceScaleId = ensureNotNull(source.priceScale()).id();\n\t\tif (this._overlaySourcesByScaleId.has(priceScaleId)) {\n\t\t\tconst overlaySources = ensureDefined(this._overlaySourcesByScaleId.get(priceScaleId));\n\t\t\tconst overlayIndex = overlaySources.indexOf(source);\n\t\t\tif (overlayIndex !== -1) {\n\t\t\t\toverlaySources.splice(overlayIndex, 1);\n\t\t\t\tif (overlaySources.length === 0) {\n\t\t\t\t\tthis._overlaySourcesByScaleId.delete(priceScaleId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst priceScale = source.priceScale();\n\t\t// if source has owner, it returns owner's price scale\n\t\t// and it does not have source in their list\n\t\tif (priceScale && priceScale.dataSources().indexOf(source) >= 0) {\n\t\t\tpriceScale.removeDataSource(source);\n\t\t}\n\n\t\tif (priceScale !== null) {\n\t\t\tpriceScale.invalidateSourcesCache();\n\t\t\tthis.recalculatePriceScale(priceScale);\n\t\t}\n\n\t\tthis._cachedOrderedSources = null;\n\t}\n\n\tpublic priceScalePosition(priceScale: PriceScale): PriceScalePosition {\n\t\tif (priceScale === this._leftPriceScale) {\n\t\t\treturn 'left';\n\t\t}\n\t\tif (priceScale === this._rightPriceScale) {\n\t\t\treturn 'right';\n\t\t}\n\n\t\treturn 'overlay';\n\t}\n\n\tpublic leftPriceScale(): PriceScale {\n\t\treturn this._leftPriceScale;\n\t}\n\n\tpublic rightPriceScale(): PriceScale {\n\t\treturn this._rightPriceScale;\n\t}\n\n\tpublic startScalePrice(priceScale: PriceScale, x: number): void {\n\t\tpriceScale.startScale(x);\n\t}\n\n\tpublic scalePriceTo(priceScale: PriceScale, x: number): void {\n\t\tpriceScale.scaleTo(x);\n\n\t\t// TODO: be more smart and update only affected views\n\t\tthis.updateAllSources();\n\t}\n\n\tpublic endScalePrice(priceScale: PriceScale): void {\n\t\tpriceScale.endScale();\n\t}\n\n\tpublic startScrollPrice(priceScale: PriceScale, x: number): void {\n\t\tpriceScale.startScroll(x);\n\t}\n\n\tpublic scrollPriceTo(priceScale: PriceScale, x: number): void {\n\t\tpriceScale.scrollTo(x);\n\t\tthis.updateAllSources();\n\t}\n\n\tpublic endScrollPrice(priceScale: PriceScale): void {\n\t\tpriceScale.endScroll();\n\t}\n\n\tpublic updateAllSources(): void {\n\t\tthis._dataSources.forEach((source: IPriceDataSource) => {\n\t\t\tsource.updateAllViews();\n\t\t});\n\t}\n\n\tpublic defaultPriceScale(): PriceScale {\n\t\tlet priceScale: PriceScale | null = null;\n\n\t\tif (this._model.options().rightPriceScale.visible && this._rightPriceScale.dataSources().length !== 0) {\n\t\t\tpriceScale = this._rightPriceScale;\n\t\t} else if (this._model.options().leftPriceScale.visible && this._leftPriceScale.dataSources().length !== 0) {\n\t\t\tpriceScale = this._leftPriceScale;\n\t\t} else if (this._dataSources.length !== 0) {\n\t\t\tpriceScale = this._dataSources[0].priceScale();\n\t\t}\n\n\t\tif (priceScale === null) {\n\t\t\tpriceScale = this._rightPriceScale;\n\t\t}\n\n\t\treturn priceScale;\n\t}\n\n\tpublic defaultVisiblePriceScale(): PriceScale | null {\n\t\tlet priceScale: PriceScale | null = null;\n\n\t\tif (this._model.options().rightPriceScale.visible) {\n\t\t\tpriceScale = this._rightPriceScale;\n\t\t} else if (this._model.options().leftPriceScale.visible) {\n\t\t\tpriceScale = this._leftPriceScale;\n\t\t}\n\t\treturn priceScale;\n\t}\n\n\tpublic recalculatePriceScale(priceScale: PriceScale | null): void {\n\t\tif (priceScale === null || !priceScale.isAutoScale()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._recalculatePriceScaleImpl(priceScale);\n\t}\n\n\tpublic resetPriceScale(priceScale: PriceScale): void {\n\t\tconst visibleBars = this._timeScale.visibleStrictRange();\n\t\tpriceScale.setMode({ autoScale: true });\n\t\tif (visibleBars !== null) {\n\t\t\tpriceScale.recalculatePriceRange(visibleBars);\n\t\t}\n\t\tthis.updateAllSources();\n\t}\n\n\tpublic momentaryAutoScale(): void {\n\t\tthis._recalculatePriceScaleImpl(this._leftPriceScale);\n\t\tthis._recalculatePriceScaleImpl(this._rightPriceScale);\n\t}\n\n\tpublic recalculate(): void {\n\t\tthis.recalculatePriceScale(this._leftPriceScale);\n\t\tthis.recalculatePriceScale(this._rightPriceScale);\n\n\t\tthis._dataSources.forEach((ds: IPriceDataSource) => {\n\t\t\tif (this.isOverlay(ds)) {\n\t\t\t\tthis.recalculatePriceScale(ds.priceScale());\n\t\t\t}\n\t\t});\n\n\t\tthis.updateAllSources();\n\t\tthis._model.lightUpdate();\n\t}\n\n\tpublic orderedSources(): readonly IPriceDataSource[] {\n\t\tif (this._cachedOrderedSources === null) {\n\t\t\tthis._cachedOrderedSources = sortSources<IPriceDataSource>(this._dataSources);\n\t\t}\n\n\t\treturn this._cachedOrderedSources;\n\t}\n\n\tpublic onDestroyed(): ISubscription {\n\t\treturn this._destroyed;\n\t}\n\n\tpublic grid(): Grid {\n\t\treturn this._grid;\n\t}\n\n\tprivate _recalculatePriceScaleImpl(priceScale: PriceScale): void {\n\t\t// TODO: can use this checks\n\t\tconst sourceForAutoScale = priceScale.sourcesForAutoScale();\n\n\t\tif (sourceForAutoScale && sourceForAutoScale.length > 0 && !this._timeScale.isEmpty()) {\n\t\t\tconst visibleBars = this._timeScale.visibleStrictRange();\n\t\t\tif (visibleBars !== null) {\n\t\t\t\tpriceScale.recalculatePriceRange(visibleBars);\n\t\t\t}\n\t\t}\n\n\t\tpriceScale.updateAllViews();\n\t}\n\n\tprivate _getZOrderMinMax(): MinMaxOrderInfo {\n\t\tconst sources = this.orderedSources();\n\t\tif (sources.length === 0) {\n\t\t\treturn { minZOrder: 0, maxZOrder: 0 };\n\t\t}\n\n\t\tlet minZOrder = 0;\n\t\tlet maxZOrder = 0;\n\t\tfor (let j = 0; j < sources.length; j++) {\n\t\t\tconst ds = sources[j];\n\t\t\tconst zOrder = ds.zorder();\n\t\t\tif (zOrder !== null) {\n\t\t\t\tif (zOrder < minZOrder) {\n\t\t\t\t\tminZOrder = zOrder;\n\t\t\t\t}\n\n\t\t\t\tif (zOrder > maxZOrder) {\n\t\t\t\t\tmaxZOrder = zOrder;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn { minZOrder: minZOrder, maxZOrder: maxZOrder };\n\t}\n\n\tprivate _insertDataSource(source: IPriceDataSource, priceScaleId: string, zOrder: number): void {\n\t\tlet priceScale = this.priceScaleById(priceScaleId);\n\n\t\tif (priceScale === null) {\n\t\t\tpriceScale = this._createPriceScale(priceScaleId, this._model.options().overlayPriceScales);\n\t\t}\n\n\t\tthis._dataSources.push(source);\n\t\tif (!isDefaultPriceScale(priceScaleId)) {\n\t\t\tconst overlaySources = this._overlaySourcesByScaleId.get(priceScaleId) || [];\n\t\t\toverlaySources.push(source);\n\t\t\tthis._overlaySourcesByScaleId.set(priceScaleId, overlaySources);\n\t\t}\n\n\t\tpriceScale.addDataSource(source);\n\t\tsource.setPriceScale(priceScale);\n\n\t\tsource.setZorder(zOrder);\n\n\t\tthis.recalculatePriceScale(priceScale);\n\n\t\tthis._cachedOrderedSources = null;\n\t}\n\n\tprivate _onPriceScaleModeChanged(priceScale: PriceScale, oldMode: PriceScaleState, newMode: PriceScaleState): void {\n\t\tif (oldMode.mode === newMode.mode) {\n\t\t\treturn;\n\t\t}\n\n\t\t// momentary auto scale if we toggle percentage/indexedTo100 mode\n\t\tthis._recalculatePriceScaleImpl(priceScale);\n\t}\n\n\tprivate _createPriceScale(id: string, options: OverlayPriceScaleOptions | VisiblePriceScaleOptions): PriceScale {\n\t\tconst actualOptions: PriceScaleOptions = { visible: true, autoScale: true, ...clone(options) };\n\t\tconst priceScale = new PriceScale(\n\t\t\tid,\n\t\t\tactualOptions,\n\t\t\tthis._model.options().layout,\n\t\t\tthis._model.options().localization\n\t\t);\n\t\tpriceScale.setHeight(this.height());\n\t\treturn priceScale;\n\t}\n}\n","import { ensureDefined } from '../helpers/assertions';\n\nimport { IHorzScaleBehavior } from './ihorz-scale-behavior';\nimport { TickMark } from './tick-marks';\n\ninterface CachedTick {\n\tstring: string;\n\ttick: number;\n}\n\nexport type FormatFunction = (tickMark: TickMark) => string;\n\nexport class FormattedLabelsCache<HorzScaleItem> {\n\tprivate readonly _format: FormatFunction;\n\tprivate readonly _maxSize: number;\n\tprivate _actualSize: number = 0;\n\tprivate _usageTick: number = 1;\n\tprivate _oldestTick: number = 1;\n\tprivate _cache: Map<number, CachedTick> = new Map();\n\tprivate _tick2Labels: Map<number, number> = new Map();\n\n\tprivate readonly _horzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>;\n\n\tpublic constructor(format: FormatFunction, horzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>, size: number = 50) {\n\t\tthis._format = format;\n\t\tthis._horzScaleBehavior = horzScaleBehavior;\n\t\tthis._maxSize = size;\n\t}\n\n\tpublic format(tickMark: TickMark): string {\n\t\tconst time = tickMark.time;\n\n\t\tconst cacheKey = this._horzScaleBehavior.cacheKey(time);\n\n\t\tconst tick = this._cache.get(cacheKey);\n\t\tif (tick !== undefined) {\n\t\t\treturn tick.string;\n\t\t}\n\n\t\tif (this._actualSize === this._maxSize) {\n\t\t\tconst oldestValue = this._tick2Labels.get(this._oldestTick);\n\t\t\tthis._tick2Labels.delete(this._oldestTick);\n\t\t\tthis._cache.delete(ensureDefined(oldestValue));\n\t\t\tthis._oldestTick++;\n\t\t\tthis._actualSize--;\n\t\t}\n\n\t\tconst str = this._format(tickMark);\n\t\tthis._cache.set(cacheKey, { string: str, tick: this._usageTick });\n\t\tthis._tick2Labels.set(this._usageTick, cacheKey);\n\t\tthis._actualSize++;\n\t\tthis._usageTick++;\n\t\treturn str;\n\t}\n}\n","import { assert } from '../helpers/assertions';\n\nexport class RangeImpl<T extends number> {\n\tprivate readonly _left: T;\n\tprivate readonly _right: T;\n\n\tpublic constructor(left: T, right: T) {\n\t\tassert(left <= right, 'right should be >= left');\n\n\t\tthis._left = left;\n\t\tthis._right = right;\n\t}\n\n\tpublic left(): T {\n\t\treturn this._left;\n\t}\n\n\tpublic right(): T {\n\t\treturn this._right;\n\t}\n\n\tpublic count(): number {\n\t\treturn this._right - this._left + 1;\n\t}\n\n\tpublic contains(index: T): boolean {\n\t\treturn this._left <= index && index <= this._right;\n\t}\n\n\tpublic equals(other: RangeImpl<T>): boolean {\n\t\treturn this._left === other.left() && this._right === other.right();\n\t}\n}\n\nexport function areRangesEqual<T extends number>(first: RangeImpl<T> | null, second: RangeImpl<T> | null): boolean {\n\tif (first === null || second === null) {\n\t\treturn first === second;\n\t}\n\n\treturn first.equals(second);\n}\n","import { lowerBound } from '../helpers/algorithms';\nimport { ensureDefined } from '../helpers/assertions';\n\nimport { InternalHorzScaleItem } from './ihorz-scale-behavior';\nimport { TickMarkWeightValue, TimePointIndex, TimeScalePoint } from './time-data';\n\n/**\n * Tick mark for the horizontal scale.\n */\nexport interface TickMark {\n\t/** Index */\n\tindex: TimePointIndex;\n\t/** Time / Coordinate */\n\ttime: InternalHorzScaleItem;\n\t/** Weight of the tick mark */\n\tweight: TickMarkWeightValue;\n\t/** Original value for the `time` property */\n\toriginalTime: unknown;\n}\n\ninterface MarksCache {\n\tmaxIndexesPerMark: number;\n\tmarks: readonly TickMark[];\n}\n\nexport class TickMarks<HorzScaleItem> {\n\tprivate _marksByWeight: Map<TickMarkWeightValue, TickMark[]> = new Map();\n\tprivate _cache: MarksCache | null = null;\n\tprivate _uniformDistribution: boolean = false;\n\n\tpublic setUniformDistribution(val: boolean): void {\n\t\tthis._uniformDistribution = val;\n\t\tthis._cache = null;\n\t}\n\n\tpublic setTimeScalePoints(newPoints: readonly TimeScalePoint[], firstChangedPointIndex: number): void {\n\t\tthis._removeMarksSinceIndex(firstChangedPointIndex);\n\n\t\tthis._cache = null;\n\n\t\tfor (let index = firstChangedPointIndex; index < newPoints.length; ++index) {\n\t\t\tconst point = newPoints[index];\n\t\t\tlet marksForWeight = this._marksByWeight.get(point.timeWeight);\n\t\t\tif (marksForWeight === undefined) {\n\t\t\t\tmarksForWeight = [];\n\t\t\t\tthis._marksByWeight.set(point.timeWeight, marksForWeight);\n\t\t\t}\n\n\t\t\tmarksForWeight.push({\n\t\t\t\tindex: index as TimePointIndex,\n\t\t\t\ttime: point.time,\n\t\t\t\tweight: point.timeWeight,\n\t\t\t\toriginalTime: point.originalTime,\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic build(spacing: number, maxWidth: number): readonly TickMark[] {\n\t\tconst maxIndexesPerMark = Math.ceil(maxWidth / spacing);\n\t\tif (this._cache === null || this._cache.maxIndexesPerMark !== maxIndexesPerMark) {\n\t\t\tthis._cache = {\n\t\t\t\tmarks: this._buildMarksImpl(maxIndexesPerMark),\n\t\t\t\tmaxIndexesPerMark,\n\t\t\t};\n\t\t}\n\n\t\treturn this._cache.marks;\n\t}\n\n\tprivate _removeMarksSinceIndex(sinceIndex: number): void {\n\t\tif (sinceIndex === 0) {\n\t\t\tthis._marksByWeight.clear();\n\t\t\treturn;\n\t\t}\n\n\t\tconst weightsToClear: TickMarkWeightValue[] = [];\n\n\t\tthis._marksByWeight.forEach((marks: TickMark[], timeWeight: TickMarkWeightValue) => {\n\t\t\tif (sinceIndex <= marks[0].index) {\n\t\t\t\tweightsToClear.push(timeWeight);\n\t\t\t} else {\n\t\t\t\tmarks.splice(\n\t\t\t\t\tlowerBound(marks, sinceIndex, (tm: TickMark) => tm.index < sinceIndex),\n\t\t\t\t\tInfinity\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\tfor (const weight of weightsToClear) {\n\t\t\tthis._marksByWeight.delete(weight);\n\t\t}\n\t}\n\n\tprivate _buildMarksImpl(maxIndexesPerMark: number): readonly TickMark[] {\n\t\tlet marks: TickMark[] = [];\n\n\t\tfor (const weight of Array.from(this._marksByWeight.keys()).sort((a: number, b: number) => b - a)) {\n\t\t\tif (!this._marksByWeight.get(weight)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Built tickMarks are now prevMarks, and marks it as new array\n\t\t\tconst prevMarks = marks;\n\t\t\tmarks = [];\n\n\t\t\tconst prevMarksLength = prevMarks.length;\n\t\t\tlet prevMarksPointer = 0;\n\t\t\tconst currentWeight = ensureDefined(this._marksByWeight.get(weight));\n\t\t\tconst currentWeightLength = currentWeight.length;\n\n\t\t\tlet rightIndex = Infinity;\n\t\t\tlet leftIndex = -Infinity;\n\t\t\tfor (let i = 0; i < currentWeightLength; i++) {\n\t\t\t\tconst mark = currentWeight[i];\n\t\t\t\tconst currentIndex = mark.index;\n\n\t\t\t\t// Determine indexes with which current index will be compared\n\t\t\t\t// All marks to the right is moved to new array\n\t\t\t\twhile (prevMarksPointer < prevMarksLength) {\n\t\t\t\t\tconst lastMark = prevMarks[prevMarksPointer];\n\t\t\t\t\tconst lastIndex = lastMark.index;\n\t\t\t\t\tif (lastIndex < currentIndex) {\n\t\t\t\t\t\tprevMarksPointer++;\n\t\t\t\t\t\tmarks.push(lastMark);\n\t\t\t\t\t\tleftIndex = lastIndex;\n\t\t\t\t\t\trightIndex = Infinity;\n\t\t\t\t\t} else {\n\t\t\t\t\t\trightIndex = lastIndex;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (rightIndex - currentIndex >= maxIndexesPerMark && currentIndex - leftIndex >= maxIndexesPerMark) {\n\t\t\t\t\t// TickMark fits. Place it into new array\n\t\t\t\t\tmarks.push(mark);\n\t\t\t\t\tleftIndex = currentIndex;\n\t\t\t\t} else {\n\t\t\t\t\tif (this._uniformDistribution) {\n\t\t\t\t\t\treturn prevMarks;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Place all unused tickMarks into new array;\n\t\t\tfor (; prevMarksPointer < prevMarksLength; prevMarksPointer++) {\n\t\t\t\tmarks.push(prevMarks[prevMarksPointer]);\n\t\t\t}\n\t\t}\n\n\t\treturn marks;\n\t}\n}\n","import { RangeImpl } from './range-impl';\nimport { Logical, TimePointIndex } from './time-data';\n\nexport class TimeScaleVisibleRange {\n\tprivate readonly _logicalRange: RangeImpl<Logical> | null;\n\n\tpublic constructor(logicalRange: RangeImpl<Logical> | null) {\n\t\tthis._logicalRange = logicalRange;\n\t}\n\n\tpublic strictRange(): RangeImpl<TimePointIndex> | null {\n\t\tif (this._logicalRange === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn new RangeImpl(\n\t\t\tMath.floor(this._logicalRange.left()) as TimePointIndex,\n\t\t\tMath.ceil(this._logicalRange.right()) as TimePointIndex\n\t\t);\n\t}\n\n\tpublic logicalRange(): RangeImpl<Logical> | null {\n\t\treturn this._logicalRange;\n\t}\n\n\tpublic static invalid(): TimeScaleVisibleRange {\n\t\treturn new TimeScaleVisibleRange(null);\n\t}\n}\n","import { lowerBound } from '../helpers/algorithms';\nimport { ensureNotNull } from '../helpers/assertions';\nimport { Delegate } from '../helpers/delegate';\nimport { ISubscription } from '../helpers/isubscription';\nimport { clamp } from '../helpers/mathex';\nimport { DeepPartial, isInteger, merge } from '../helpers/strict-type-checks';\n\nimport { ChartModel } from './chart-model';\nimport { Coordinate } from './coordinate';\nimport { FormattedLabelsCache } from './formatted-labels-cache';\nimport { IHorzScaleBehavior, InternalHorzScaleItem, InternalHorzScaleItemKey } from './ihorz-scale-behavior';\nimport { LocalizationOptions } from './localization-options';\nimport { areRangesEqual, RangeImpl } from './range-impl';\nimport { TickMark, TickMarks } from './tick-marks';\nimport {\n\tLogical,\n\tLogicalRange,\n\tRange,\n\tSeriesItemsIndexesRange,\n\tTickMarkWeightValue,\n\tTimedValue,\n\tTimePointIndex,\n\tTimePointsRange,\n\tTimeScalePoint,\n} from './time-data';\nimport { TimeScaleVisibleRange } from './time-scale-visible-range';\n\nconst defaultTickMarkMaxCharacterLength = 8;\n\nconst enum Constants {\n\tDefaultAnimationDuration = 400,\n\t// make sure that this (1 / MinVisibleBarsCount) >= coeff in max bar spacing\n\tMinVisibleBarsCount = 2,\n}\n\ninterface TransitionState {\n\tbarSpacing: number;\n\trightOffset: number;\n}\n\n/**\n * Represents a tick mark on the horizontal (time) scale.\n */\nexport interface TimeMark {\n\t/** Does time mark need to be aligned */\n\tneedAlignCoordinate: boolean;\n\t/** Coordinate for the time mark */\n\tcoord: number;\n\t/** Display label for the time mark */\n\tlabel: string;\n\t/** Weight of the time mark */\n\tweight: TickMarkWeightValue;\n}\n\nexport function markWithGreaterWeight(a: TimeMark, b: TimeMark): TimeMark {\n\treturn a.weight > b.weight ? a : b;\n}\n\n/**\n * Options for the time scale; the horizontal scale at the bottom of the chart that displays the time of data.\n */\nexport interface HorzScaleOptions {\n\t/**\n\t * The margin space in bars from the right side of the chart.\n\t *\n\t * @defaultValue `0`\n\t */\n\trightOffset: number;\n\n\t/**\n\t * The space between bars in pixels.\n\t *\n\t * @defaultValue `6`\n\t */\n\tbarSpacing: number;\n\n\t/**\n\t * The minimum space between bars in pixels.\n\t *\n\t * @defaultValue `0.5`\n\t */\n\tminBarSpacing: number;\n\n\t/**\n\t * Prevent scrolling to the left of the first bar.\n\t *\n\t * @defaultValue `false`\n\t */\n\tfixLeftEdge: boolean;\n\n\t/**\n\t * Prevent scrolling to the right of the most recent bar.\n\t *\n\t * @defaultValue `false`\n\t */\n\tfixRightEdge: boolean;\n\n\t/**\n\t * Prevent changing the visible time range during chart resizing.\n\t *\n\t * @defaultValue `false`\n\t */\n\tlockVisibleTimeRangeOnResize: boolean;\n\n\t/**\n\t * Prevent the hovered bar from moving when scrolling.\n\t *\n\t * @defaultValue `false`\n\t */\n\trightBarStaysOnScroll: boolean;\n\n\t/**\n\t * Show the time scale border.\n\t *\n\t * @defaultValue `true`\n\t */\n\tborderVisible: boolean;\n\n\t/**\n\t * The time scale border color.\n\t *\n\t * @defaultValue `'#2B2B43'`\n\t */\n\tborderColor: string;\n\n\t/**\n\t * Show the time scale.\n\t *\n\t * @defaultValue `true`\n\t */\n\tvisible: boolean;\n\n\t/**\n\t * Show the time, not just the date, in the time scale and vertical crosshair label.\n\t *\n\t * @defaultValue `false`\n\t */\n\ttimeVisible: boolean;\n\n\t/**\n\t * Show seconds in the time scale and vertical crosshair label in `hh:mm:ss` format for intraday data.\n\t *\n\t * @defaultValue `true`\n\t */\n\tsecondsVisible: boolean;\n\n\t/**\n\t * Shift the visible range to the right (into the future) by the number of new bars when new data is added.\n\t *\n\t * Note that this only applies when the last bar is visible.\n\t *\n\t * @defaultValue `true`\n\t */\n\tshiftVisibleRangeOnNewBar: boolean;\n\n\t/**\n\t * Allow the visible range to be shifted to the right when a new bar is added which\n\t * is replacing an existing whitespace time point on the chart.\n\t *\n\t * Note that this only applies when the last bar is visible & `shiftVisibleRangeOnNewBar` is enabled.\n\t *\n\t * @defaultValue `false`\n\t */\n\tallowShiftVisibleRangeOnWhitespaceReplacement: boolean;\n\n\t/**\n\t * Draw small vertical line on time axis labels.\n\t *\n\t * @defaultValue `false`\n\t */\n\tticksVisible: boolean;\n\n\t/**\n\t * Maximum tick mark label length. Used to override the default 8 character maximum length.\n\t *\n\t * @defaultValue `undefined`\n\t */\n\ttickMarkMaxCharacterLength?: number;\n\t/**\n\t * Changes horizontal scale marks generation.\n\t * With this flag equal to `true`, marks of the same weight are either all drawn or none are drawn at all.\n\t */\n\tuniformDistribution: boolean;\n\n\t/**\n\t * Define a minimum height for the time scale.\n\t * Note: This value will be exceeded if the\n\t * time scale needs more space to display it's contents.\n\t *\n\t * Setting a minimum height could be useful for ensuring that\n\t * multiple charts positioned in a horizontal stack each have\n\t * an identical time scale height, or for plugins which\n\t * require a bit more space within the time scale pane.\n\t *\n\t * @defaultValue 0\n\t */\n\tminimumHeight: number;\n\n\t/**\n\t * Allow major time scale labels to be rendered in a bolder font weight.\n\t *\n\t * @defaultValue true\n\t */\n\tallowBoldLabels: boolean;\n}\n\nexport interface ITimeScale {\n\tmarks(): TimeMark[] | null;\n\tisEmpty(): boolean;\n\twidth(): number;\n\tindexToTime(index: TimePointIndex): InternalHorzScaleItem | null;\n\tindexToCoordinate(index: TimePointIndex): Coordinate;\n\tvisibleStrictRange(): RangeImpl<TimePointIndex> | null;\n\thasPoints(): boolean;\n\ttimeToIndex(time: InternalHorzScaleItem, findNearest: boolean): TimePointIndex | null;\n\n\tbarSpacing(): number;\n\trightOffset(): number;\n\n\tindexesToCoordinates<T extends TimedValue>(points: T[], visibleRange?: SeriesItemsIndexesRange): void;\n\tindexToTimeScalePoint(index: TimePointIndex): TimeScalePoint | null;\n\tformatDateTime(timeScalePoint: TimeScalePoint): string;\n\tcoordinateToIndex(x: Coordinate): TimePointIndex;\n\n\toptions(): Readonly<HorzScaleOptions>;\n}\n\nexport class TimeScale<HorzScaleItem> implements ITimeScale {\n\tprivate readonly _options: HorzScaleOptions;\n\tprivate readonly _model: ChartModel<HorzScaleItem>;\n\tprivate readonly _localizationOptions: LocalizationOptions<HorzScaleItem>;\n\n\tprivate _width: number = 0;\n\tprivate _baseIndexOrNull: TimePointIndex | null = null;\n\tprivate _rightOffset: number;\n\tprivate _points: readonly TimeScalePoint[] = [];\n\tprivate _barSpacing: number;\n\tprivate _scrollStartPoint: Coordinate | null = null;\n\tprivate _scaleStartPoint: Coordinate | null = null;\n\tprivate readonly _tickMarks: TickMarks<HorzScaleItem> = new TickMarks();\n\tprivate _formattedByWeight: Map<number, FormattedLabelsCache<HorzScaleItem>> = new Map();\n\n\tprivate _visibleRange: TimeScaleVisibleRange = TimeScaleVisibleRange.invalid();\n\tprivate _visibleRangeInvalidated: boolean = true;\n\n\tprivate readonly _visibleBarsChanged: Delegate = new Delegate();\n\tprivate readonly _logicalRangeChanged: Delegate = new Delegate();\n\n\tprivate readonly _optionsApplied: Delegate = new Delegate();\n\tprivate _commonTransitionStartState: TransitionState | null = null;\n\tprivate _timeMarksCache: TimeMark[] | null = null;\n\n\tprivate _labels: TimeMark[] = [];\n\n\tprivate readonly _horzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>;\n\n\tpublic constructor(model: ChartModel<HorzScaleItem>, options: HorzScaleOptions, localizationOptions: LocalizationOptions<HorzScaleItem>, horzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>) {\n\t\tthis._options = options;\n\t\tthis._localizationOptions = localizationOptions;\n\t\tthis._rightOffset = options.rightOffset;\n\t\tthis._barSpacing = options.barSpacing;\n\t\tthis._model = model;\n\n\t\tthis._horzScaleBehavior = horzScaleBehavior;\n\n\t\tthis._updateDateTimeFormatter();\n\n\t\tthis._tickMarks.setUniformDistribution(options.uniformDistribution);\n\t}\n\n\tpublic options(): Readonly<HorzScaleOptions> {\n\t\treturn this._options;\n\t}\n\n\tpublic applyLocalizationOptions(localizationOptions: DeepPartial<LocalizationOptions<HorzScaleItem>>): void {\n\t\tmerge(this._localizationOptions, localizationOptions);\n\n\t\tthis._invalidateTickMarks();\n\t\tthis._updateDateTimeFormatter();\n\t}\n\n\tpublic applyOptions(options: DeepPartial<HorzScaleOptions>, localizationOptions?: DeepPartial<LocalizationOptions<HorzScaleItem>>): void {\n\t\tmerge(this._options, options);\n\n\t\tif (this._options.fixLeftEdge) {\n\t\t\tthis._doFixLeftEdge();\n\t\t}\n\n\t\tif (this._options.fixRightEdge) {\n\t\t\tthis._doFixRightEdge();\n\t\t}\n\n\t\t// note that bar spacing should be applied before right offset\n\t\t// because right offset depends on bar spacing\n\t\tif (options.barSpacing !== undefined) {\n\t\t\tthis._model.setBarSpacing(options.barSpacing);\n\t\t}\n\n\t\tif (options.rightOffset !== undefined) {\n\t\t\tthis._model.setRightOffset(options.rightOffset);\n\t\t}\n\n\t\tif (options.minBarSpacing !== undefined) {\n\t\t\t// yes, if we apply min bar spacing then we need to correct bar spacing\n\t\t\t// the easiest way is to apply it once again\n\t\t\tthis._model.setBarSpacing(options.barSpacing ?? this._barSpacing);\n\t\t}\n\n\t\tthis._invalidateTickMarks();\n\t\tthis._updateDateTimeFormatter();\n\t\tthis._optionsApplied.fire();\n\t}\n\n\tpublic indexToTime(index: TimePointIndex): InternalHorzScaleItem | null {\n\t\treturn this._points[index]?.time ?? null;\n\t}\n\n\tpublic indexToTimeScalePoint(index: TimePointIndex): TimeScalePoint | null {\n\t\treturn this._points[index] ?? null;\n\t}\n\n\tpublic timeToIndex(time: InternalHorzScaleItem, findNearest: boolean): TimePointIndex | null {\n\t\tif (this._points.length < 1) {\n\t\t\t// no time points available\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this._horzScaleBehavior.key(time) > this._horzScaleBehavior.key(this._points[this._points.length - 1].time)) {\n\t\t\t// special case\n\t\t\treturn findNearest ? this._points.length - 1 as TimePointIndex : null;\n\t\t}\n\n\t\tconst index = lowerBound(this._points, this._horzScaleBehavior.key(time), (a: TimeScalePoint, b: InternalHorzScaleItemKey) => this._horzScaleBehavior.key(a.time) < b);\n\n\t\tif (this._horzScaleBehavior.key(time) < this._horzScaleBehavior.key(this._points[index].time)) {\n\t\t\treturn findNearest ? index as TimePointIndex : null;\n\t\t}\n\n\t\treturn index as TimePointIndex;\n\t}\n\n\tpublic isEmpty(): boolean {\n\t\treturn this._width === 0 || this._points.length === 0 || this._baseIndexOrNull === null;\n\t}\n\n\tpublic hasPoints(): boolean {\n\t\treturn this._points.length > 0;\n\t}\n\n\t// strict range: integer indices of the bars in the visible range rounded in more wide direction\n\tpublic visibleStrictRange(): RangeImpl<TimePointIndex> | null {\n\t\tthis._updateVisibleRange();\n\t\treturn this._visibleRange.strictRange();\n\t}\n\n\tpublic visibleLogicalRange(): RangeImpl<Logical> | null {\n\t\tthis._updateVisibleRange();\n\t\treturn this._visibleRange.logicalRange();\n\t}\n\n\tpublic visibleTimeRange(): TimePointsRange | null {\n\t\tconst visibleBars = this.visibleStrictRange();\n\t\tif (visibleBars === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst range: LogicalRange = {\n\t\t\tfrom: visibleBars.left() as number as Logical,\n\t\t\tto: visibleBars.right() as number as Logical,\n\t\t};\n\n\t\treturn this.timeRangeForLogicalRange(range);\n\t}\n\n\tpublic timeRangeForLogicalRange(range: LogicalRange): TimePointsRange {\n\t\tconst from = Math.round(range.from);\n\t\tconst to = Math.round(range.to);\n\n\t\tconst firstIndex = ensureNotNull(this._firstIndex());\n\t\tconst lastIndex = ensureNotNull(this._lastIndex());\n\n\t\treturn {\n\t\t\tfrom: ensureNotNull(this.indexToTimeScalePoint(Math.max(firstIndex, from) as TimePointIndex)),\n\t\t\tto: ensureNotNull(this.indexToTimeScalePoint(Math.min(lastIndex, to) as TimePointIndex)),\n\t\t};\n\t}\n\n\tpublic logicalRangeForTimeRange(range: Range<InternalHorzScaleItem>): LogicalRange {\n\t\treturn {\n\t\t\tfrom: ensureNotNull(this.timeToIndex(range.from, true)) as number as Logical,\n\t\t\tto: ensureNotNull(this.timeToIndex(range.to, true)) as number as Logical,\n\t\t};\n\t}\n\n\tpublic width(): number {\n\t\treturn this._width;\n\t}\n\n\tpublic setWidth(newWidth: number): void {\n\t\tif (!isFinite(newWidth) || newWidth <= 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._width === newWidth) {\n\t\t\treturn;\n\t\t}\n\n\t\t// when we change the width and we need to correct visible range because of fixing left edge\n\t\t// we need to check the previous visible range rather than the new one\n\t\t// because it might be updated by changing width, bar spacing, etc\n\t\t// but we need to try to keep the same range\n\t\tconst previousVisibleRange = this.visibleLogicalRange();\n\n\t\tconst oldWidth = this._width;\n\t\tthis._width = newWidth;\n\t\tthis._visibleRangeInvalidated = true;\n\n\t\tif (this._options.lockVisibleTimeRangeOnResize && oldWidth !== 0) {\n\t\t\t// recalculate bar spacing\n\t\t\tconst newBarSpacing = this._barSpacing * newWidth / oldWidth;\n\t\t\tthis._barSpacing = newBarSpacing;\n\t\t}\n\n\t\t// if time scale is scrolled to the end of data and we have fixed right edge\n\t\t// keep left edge instead of right\n\t\t// we need it to avoid \"shaking\" if the last bar visibility affects time scale width\n\t\tif (this._options.fixLeftEdge) {\n\t\t\t// note that logical left range means not the middle of a bar (it's the left border)\n\t\t\tif (previousVisibleRange !== null && previousVisibleRange.left() <= 0) {\n\t\t\t\tconst delta = oldWidth - newWidth;\n\t\t\t\t// reduce  _rightOffset means move right\n\t\t\t\t// we could move more than required - this will be fixed by _correctOffset()\n\t\t\t\tthis._rightOffset -= Math.round(delta / this._barSpacing) + 1;\n\t\t\t\tthis._visibleRangeInvalidated = true;\n\t\t\t}\n\t\t}\n\n\t\t// updating bar spacing should be first because right offset depends on it\n\t\tthis._correctBarSpacing();\n\t\tthis._correctOffset();\n\t}\n\n\tpublic indexToCoordinate(index: TimePointIndex): Coordinate {\n\t\tif (this.isEmpty() || !isInteger(index)) {\n\t\t\treturn 0 as Coordinate;\n\t\t}\n\n\t\tconst baseIndex = this.baseIndex();\n\t\tconst deltaFromRight = baseIndex + this._rightOffset - index;\n\t\tconst coordinate = this._width - (deltaFromRight + 0.5) * this._barSpacing - 1;\n\t\treturn coordinate as Coordinate;\n\t}\n\n\tpublic indexesToCoordinates<T extends TimedValue>(points: T[], visibleRange?: SeriesItemsIndexesRange): void {\n\t\tconst baseIndex = this.baseIndex();\n\t\tconst indexFrom = (visibleRange === undefined) ? 0 : visibleRange.from;\n\t\tconst indexTo = (visibleRange === undefined) ? points.length : visibleRange.to;\n\n\t\tfor (let i = indexFrom; i < indexTo; i++) {\n\t\t\tconst index = points[i].time;\n\t\t\tconst deltaFromRight = baseIndex + this._rightOffset - index;\n\t\t\tconst coordinate = this._width - (deltaFromRight + 0.5) * this._barSpacing - 1;\n\t\t\tpoints[i].x = coordinate as Coordinate;\n\t\t}\n\t}\n\n\tpublic coordinateToIndex(x: Coordinate): TimePointIndex {\n\t\treturn Math.ceil(this._coordinateToFloatIndex(x)) as TimePointIndex;\n\t}\n\n\tpublic setRightOffset(offset: number): void {\n\t\tthis._visibleRangeInvalidated = true;\n\t\tthis._rightOffset = offset;\n\t\tthis._correctOffset();\n\t\tthis._model.recalculateAllPanes();\n\t\tthis._model.lightUpdate();\n\t}\n\n\tpublic barSpacing(): number {\n\t\treturn this._barSpacing;\n\t}\n\n\tpublic setBarSpacing(newBarSpacing: number): void {\n\t\tthis._setBarSpacing(newBarSpacing);\n\n\t\t// do not allow scroll out of visible bars\n\t\tthis._correctOffset();\n\n\t\tthis._model.recalculateAllPanes();\n\t\tthis._model.lightUpdate();\n\t}\n\n\tpublic rightOffset(): number {\n\t\treturn this._rightOffset;\n\t}\n\n\t// eslint-disable-next-line complexity\n\tpublic marks(): TimeMark[] | null {\n\t\tif (this.isEmpty()) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this._timeMarksCache !== null) {\n\t\t\treturn this._timeMarksCache;\n\t\t}\n\n\t\tconst spacing = this._barSpacing;\n\t\tconst fontSize = this._model.options().layout.fontSize;\n\n\t\tconst pixelsPer8Characters = (fontSize + 4) * 5;\n\t\tconst pixelsPerCharacter = pixelsPer8Characters / defaultTickMarkMaxCharacterLength;\n\t\tconst maxLabelWidth = pixelsPerCharacter * (this._options.tickMarkMaxCharacterLength || defaultTickMarkMaxCharacterLength);\n\t\tconst indexPerLabel = Math.round(maxLabelWidth / spacing);\n\n\t\tconst visibleBars = ensureNotNull(this.visibleStrictRange());\n\n\t\tconst firstBar = Math.max(visibleBars.left(), visibleBars.left() - indexPerLabel);\n\t\tconst lastBar = Math.max(visibleBars.right(), visibleBars.right() - indexPerLabel);\n\n\t\tconst items = this._tickMarks.build(spacing, maxLabelWidth);\n\n\t\t// according to indexPerLabel value this value means \"earliest index which _might be_ used as the second label on time scale\"\n\t\tconst earliestIndexOfSecondLabel = (this._firstIndex() as number) + indexPerLabel;\n\n\t\t// according to indexPerLabel value this value means \"earliest index which _might be_ used as the second last label on time scale\"\n\t\tconst indexOfSecondLastLabel = (this._lastIndex() as number) - indexPerLabel;\n\n\t\tconst isAllScalingAndScrollingDisabled = this._isAllScalingAndScrollingDisabled();\n\t\tconst isLeftEdgeFixed = this._options.fixLeftEdge || isAllScalingAndScrollingDisabled;\n\t\tconst isRightEdgeFixed = this._options.fixRightEdge || isAllScalingAndScrollingDisabled;\n\n\t\tlet targetIndex = 0;\n\t\tfor (const tm of items) {\n\t\t\tif (!(firstBar <= tm.index && tm.index <= lastBar)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet label: TimeMark;\n\t\t\tif (targetIndex < this._labels.length) {\n\t\t\t\tlabel = this._labels[targetIndex];\n\t\t\t\tlabel.coord = this.indexToCoordinate(tm.index);\n\t\t\t\tlabel.label = this._formatLabel(tm);\n\t\t\t\tlabel.weight = tm.weight;\n\t\t\t} else {\n\t\t\t\tlabel = {\n\t\t\t\t\tneedAlignCoordinate: false,\n\t\t\t\t\tcoord: this.indexToCoordinate(tm.index),\n\t\t\t\t\tlabel: this._formatLabel(tm),\n\t\t\t\t\tweight: tm.weight,\n\t\t\t\t};\n\n\t\t\t\tthis._labels.push(label);\n\t\t\t}\n\n\t\t\tif (this._barSpacing > (maxLabelWidth / 2) && !isAllScalingAndScrollingDisabled) {\n\t\t\t\t// if there is enough space then let's show all tick marks as usual\n\t\t\t\tlabel.needAlignCoordinate = false;\n\t\t\t} else {\n\t\t\t\t// if a user is able to scroll after a tick mark then show it as usual, otherwise the coordinate might be aligned\n\t\t\t\t// if the index is for the second (last) label or later (earlier) then most likely this label might be displayed without correcting the coordinate\n\t\t\t\tlabel.needAlignCoordinate = (isLeftEdgeFixed && tm.index <= earliestIndexOfSecondLabel) || (isRightEdgeFixed && tm.index >= indexOfSecondLastLabel);\n\t\t\t}\n\n\t\t\ttargetIndex++;\n\t\t}\n\t\tthis._labels.length = targetIndex;\n\n\t\tthis._timeMarksCache = this._labels;\n\n\t\treturn this._labels;\n\t}\n\n\tpublic restoreDefault(): void {\n\t\tthis._visibleRangeInvalidated = true;\n\n\t\tthis.setBarSpacing(this._options.barSpacing);\n\t\tthis.setRightOffset(this._options.rightOffset);\n\t}\n\n\tpublic setBaseIndex(baseIndex: TimePointIndex | null): void {\n\t\tthis._visibleRangeInvalidated = true;\n\t\tthis._baseIndexOrNull = baseIndex;\n\t\tthis._correctOffset();\n\n\t\tthis._doFixLeftEdge();\n\t}\n\n\t/**\n\t * Zoom in/out the scale around a `zoomPoint` on `scale` value.\n\t *\n\t * @param zoomPoint - X coordinate of the point to apply the zoom.\n\t * If `rightBarStaysOnScroll` option is disabled, then will be used to restore right offset.\n\t * @param scale - Zoom value (in 1/10 parts of current bar spacing).\n\t * Negative value means zoom out, positive - zoom in.\n\t */\n\tpublic zoom(zoomPoint: Coordinate, scale: number): void {\n\t\tconst floatIndexAtZoomPoint = this._coordinateToFloatIndex(zoomPoint);\n\n\t\tconst barSpacing = this.barSpacing();\n\t\tconst newBarSpacing = barSpacing + scale * (barSpacing / 10);\n\n\t\t// zoom in/out bar spacing\n\t\tthis.setBarSpacing(newBarSpacing);\n\n\t\tif (!this._options.rightBarStaysOnScroll) {\n\t\t\t// and then correct right offset to move index under zoomPoint back to its coordinate\n\t\t\tthis.setRightOffset(this.rightOffset() + (floatIndexAtZoomPoint - this._coordinateToFloatIndex(zoomPoint)));\n\t\t}\n\t}\n\n\tpublic startScale(x: Coordinate): void {\n\t\tif (this._scrollStartPoint) {\n\t\t\tthis.endScroll();\n\t\t}\n\n\t\tif (this._scaleStartPoint !== null || this._commonTransitionStartState !== null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isEmpty()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._scaleStartPoint = x;\n\t\tthis._saveCommonTransitionsStartState();\n\t}\n\n\tpublic scaleTo(x: Coordinate): void {\n\t\tif (this._commonTransitionStartState === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst startLengthFromRight = clamp(this._width - x, 0, this._width);\n\t\tconst currentLengthFromRight = clamp(this._width - ensureNotNull(this._scaleStartPoint), 0, this._width);\n\t\tif (startLengthFromRight === 0 || currentLengthFromRight === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setBarSpacing(\n\t\t\tthis._commonTransitionStartState.barSpacing * startLengthFromRight / currentLengthFromRight\n\t\t);\n\t}\n\n\tpublic endScale(): void {\n\t\tif (this._scaleStartPoint === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._scaleStartPoint = null;\n\t\tthis._clearCommonTransitionsStartState();\n\t}\n\n\tpublic startScroll(x: Coordinate): void {\n\t\tif (this._scrollStartPoint !== null || this._commonTransitionStartState !== null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isEmpty()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._scrollStartPoint = x;\n\t\tthis._saveCommonTransitionsStartState();\n\t}\n\n\tpublic scrollTo(x: Coordinate): void {\n\t\tif (this._scrollStartPoint === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst shiftInLogical = (this._scrollStartPoint - x) / this.barSpacing();\n\t\tthis._rightOffset = ensureNotNull(this._commonTransitionStartState).rightOffset + shiftInLogical;\n\t\tthis._visibleRangeInvalidated = true;\n\n\t\t// do not allow scroll out of visible bars\n\t\tthis._correctOffset();\n\t}\n\n\tpublic endScroll(): void {\n\t\tif (this._scrollStartPoint === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._scrollStartPoint = null;\n\t\tthis._clearCommonTransitionsStartState();\n\t}\n\n\tpublic scrollToRealTime(): void {\n\t\tthis.scrollToOffsetAnimated(this._options.rightOffset);\n\t}\n\n\tpublic scrollToOffsetAnimated(offset: number, animationDuration: number = Constants.DefaultAnimationDuration): void {\n\t\tif (!isFinite(offset)) {\n\t\t\tthrow new RangeError('offset is required and must be finite number');\n\t\t}\n\n\t\tif (!isFinite(animationDuration) || animationDuration <= 0) {\n\t\t\tthrow new RangeError('animationDuration (optional) must be finite positive number');\n\t\t}\n\n\t\tconst source = this._rightOffset;\n\t\tconst animationStart = performance.now();\n\n\t\tthis._model.setTimeScaleAnimation({\n\t\t\tfinished: (time: number) => (time - animationStart) / animationDuration >= 1,\n\t\t\tgetPosition: (time: number) => {\n\t\t\t\tconst animationProgress = (time - animationStart) / animationDuration;\n\t\t\t\tconst finishAnimation = animationProgress >= 1;\n\t\t\t\treturn finishAnimation ? offset : source + (offset - source) * animationProgress;\n\t\t\t},\n\t\t});\n\t}\n\n\tpublic update(newPoints: readonly TimeScalePoint[], firstChangedPointIndex: number): void {\n\t\tthis._visibleRangeInvalidated = true;\n\n\t\tthis._points = newPoints;\n\t\tthis._tickMarks.setTimeScalePoints(newPoints, firstChangedPointIndex);\n\t\tthis._correctOffset();\n\t}\n\n\tpublic visibleBarsChanged(): ISubscription {\n\t\treturn this._visibleBarsChanged;\n\t}\n\n\tpublic logicalRangeChanged(): ISubscription {\n\t\treturn this._logicalRangeChanged;\n\t}\n\n\tpublic optionsApplied(): ISubscription {\n\t\treturn this._optionsApplied;\n\t}\n\n\tpublic baseIndex(): TimePointIndex {\n\t\t// null is used to known that baseIndex is not set yet\n\t\t// so in methods which should known whether it is set or not\n\t\t// we should check field `_baseIndexOrNull` instead of getter `baseIndex()`\n\t\t// see minRightOffset for example\n\t\treturn this._baseIndexOrNull || 0 as TimePointIndex;\n\t}\n\n\tpublic setVisibleRange(range: RangeImpl<TimePointIndex>): void {\n\t\tconst length = range.count();\n\t\tthis._setBarSpacing(this._width / length);\n\t\tthis._rightOffset = range.right() - this.baseIndex();\n\t\tthis._correctOffset();\n\t\tthis._visibleRangeInvalidated = true;\n\t\tthis._model.recalculateAllPanes();\n\t\tthis._model.lightUpdate();\n\t}\n\n\tpublic fitContent(): void {\n\t\tconst first = this._firstIndex();\n\t\tconst last = this._lastIndex();\n\t\tif (first === null || last === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setVisibleRange(new RangeImpl(first, last + this._options.rightOffset as TimePointIndex));\n\t}\n\n\tpublic setLogicalRange(range: LogicalRange): void {\n\t\tconst barRange = new RangeImpl(\n\t\t\trange.from as number as TimePointIndex,\n\t\t\trange.to as number as TimePointIndex\n\t\t);\n\t\tthis.setVisibleRange(barRange);\n\t}\n\n\tpublic formatDateTime(timeScalePoint: TimeScalePoint): string {\n\t\tif (this._localizationOptions.timeFormatter !== undefined) {\n\t\t\treturn this._localizationOptions.timeFormatter(timeScalePoint.originalTime as HorzScaleItem);\n\t\t}\n\n\t\treturn this._horzScaleBehavior.formatHorzItem(timeScalePoint.time);\n\t}\n\n\tprivate _isAllScalingAndScrollingDisabled(): boolean {\n\t\tconst { handleScroll, handleScale } = this._model.options();\n\t\treturn !handleScroll.horzTouchDrag\n\t\t\t&& !handleScroll.mouseWheel\n\t\t\t&& !handleScroll.pressedMouseMove\n\t\t\t&& !handleScroll.vertTouchDrag\n\t\t\t&& !handleScale.axisDoubleClickReset.time\n\t\t\t&& !handleScale.axisPressedMouseMove.time\n\t\t\t&& !handleScale.mouseWheel\n\t\t\t&& !handleScale.pinch;\n\t}\n\n\tprivate _firstIndex(): TimePointIndex | null {\n\t\treturn this._points.length === 0 ? null : 0 as TimePointIndex;\n\t}\n\n\tprivate _lastIndex(): TimePointIndex | null {\n\t\treturn this._points.length === 0 ? null : (this._points.length - 1) as TimePointIndex;\n\t}\n\n\tprivate _rightOffsetForCoordinate(x: Coordinate): number {\n\t\treturn (this._width - 1 - x) / this._barSpacing;\n\t}\n\n\tprivate _coordinateToFloatIndex(x: Coordinate): number {\n\t\tconst deltaFromRight = this._rightOffsetForCoordinate(x);\n\t\tconst baseIndex = this.baseIndex();\n\t\tconst index = baseIndex + this._rightOffset - deltaFromRight;\n\n\t\t// JavaScript uses very strange rounding\n\t\t// we need rounding to avoid problems with calculation errors\n\t\treturn Math.round(index * 1000000) / 1000000;\n\t}\n\n\tprivate _setBarSpacing(newBarSpacing: number): void {\n\t\tconst oldBarSpacing = this._barSpacing;\n\t\tthis._barSpacing = newBarSpacing;\n\t\tthis._correctBarSpacing();\n\n\t\t// this._barSpacing might be changed in _correctBarSpacing\n\t\tif (oldBarSpacing !== this._barSpacing) {\n\t\t\tthis._visibleRangeInvalidated = true;\n\t\t\tthis._resetTimeMarksCache();\n\t\t}\n\t}\n\n\tprivate _updateVisibleRange(): void {\n\t\tif (!this._visibleRangeInvalidated) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._visibleRangeInvalidated = false;\n\n\t\tif (this.isEmpty()) {\n\t\t\tthis._setVisibleRange(TimeScaleVisibleRange.invalid());\n\t\t\treturn;\n\t\t}\n\n\t\tconst baseIndex = this.baseIndex();\n\t\tconst newBarsLength = this._width / this._barSpacing;\n\t\tconst rightBorder = this._rightOffset + baseIndex;\n\t\tconst leftBorder = rightBorder - newBarsLength + 1;\n\n\t\tconst logicalRange = new RangeImpl(leftBorder as Logical, rightBorder as Logical);\n\t\tthis._setVisibleRange(new TimeScaleVisibleRange(logicalRange));\n\t}\n\n\tprivate _correctBarSpacing(): void {\n\t\tconst minBarSpacing = this._minBarSpacing();\n\n\t\tif (this._barSpacing < minBarSpacing) {\n\t\t\tthis._barSpacing = minBarSpacing;\n\t\t\tthis._visibleRangeInvalidated = true;\n\t\t}\n\n\t\tif (this._width !== 0) {\n\t\t\t// make sure that this (1 / Constants.MinVisibleBarsCount) >= coeff in max bar spacing (it's 0.5 here)\n\t\t\tconst maxBarSpacing = this._width * 0.5;\n\t\t\tif (this._barSpacing > maxBarSpacing) {\n\t\t\t\tthis._barSpacing = maxBarSpacing;\n\t\t\t\tthis._visibleRangeInvalidated = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _minBarSpacing(): number {\n\t\t// if both options are enabled then limit bar spacing so that zooming-out is not possible\n\t\t// if it would cause either the first or last points to move too far from an edge\n\t\tif (this._options.fixLeftEdge && this._options.fixRightEdge && this._points.length !== 0) {\n\t\t\treturn this._width / this._points.length;\n\t\t}\n\n\t\treturn this._options.minBarSpacing;\n\t}\n\n\tprivate _correctOffset(): void {\n\t\t// block scrolling of to future\n\t\tconst maxRightOffset = this._maxRightOffset();\n\t\tif (this._rightOffset > maxRightOffset) {\n\t\t\tthis._rightOffset = maxRightOffset;\n\t\t\tthis._visibleRangeInvalidated = true;\n\t\t}\n\n\t\t// block scrolling of to past\n\t\tconst minRightOffset = this._minRightOffset();\n\n\t\tif (minRightOffset !== null && this._rightOffset < minRightOffset) {\n\t\t\tthis._rightOffset = minRightOffset;\n\t\t\tthis._visibleRangeInvalidated = true;\n\t\t}\n\t}\n\n\tprivate _minRightOffset(): number | null {\n\t\tconst firstIndex = this._firstIndex();\n\t\tconst baseIndex = this._baseIndexOrNull;\n\t\tif (firstIndex === null || baseIndex === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst barsEstimation = this._options.fixLeftEdge\n\t\t\t? this._width / this._barSpacing\n\t\t\t: Math.min(Constants.MinVisibleBarsCount, this._points.length);\n\n\t\treturn firstIndex - baseIndex - 1 + barsEstimation;\n\t}\n\n\tprivate _maxRightOffset(): number {\n\t\treturn this._options.fixRightEdge\n\t\t\t? 0\n\t\t\t: (this._width / this._barSpacing) - Math.min(Constants.MinVisibleBarsCount, this._points.length);\n\t}\n\n\tprivate _saveCommonTransitionsStartState(): void {\n\t\tthis._commonTransitionStartState = {\n\t\t\tbarSpacing: this.barSpacing(),\n\t\t\trightOffset: this.rightOffset(),\n\t\t};\n\t}\n\n\tprivate _clearCommonTransitionsStartState(): void {\n\t\tthis._commonTransitionStartState = null;\n\t}\n\n\tprivate _formatLabel(tickMark: TickMark): string {\n\t\tlet formatter = this._formattedByWeight.get(tickMark.weight);\n\t\tif (formatter === undefined) {\n\t\t\tformatter = new FormattedLabelsCache(\n\t\t\t\t(mark: TickMark) => {\n\t\t\t\t\treturn this._formatLabelImpl(mark);\n\t\t\t\t},\n\t\t\t\tthis._horzScaleBehavior);\n\n\t\t\tthis._formattedByWeight.set(tickMark.weight, formatter);\n\t\t}\n\n\t\treturn formatter.format(tickMark);\n\t}\n\n\tprivate _formatLabelImpl(tickMark: TickMark): string {\n\t\treturn this._horzScaleBehavior.formatTickmark(tickMark, this._localizationOptions);\n\t}\n\n\tprivate _setVisibleRange(newVisibleRange: TimeScaleVisibleRange): void {\n\t\tconst oldVisibleRange = this._visibleRange;\n\t\tthis._visibleRange = newVisibleRange;\n\n\t\tif (!areRangesEqual(oldVisibleRange.strictRange(), this._visibleRange.strictRange())) {\n\t\t\tthis._visibleBarsChanged.fire();\n\t\t}\n\n\t\tif (!areRangesEqual(oldVisibleRange.logicalRange(), this._visibleRange.logicalRange())) {\n\t\t\tthis._logicalRangeChanged.fire();\n\t\t}\n\n\t\t// TODO: reset only coords in case when this._visibleBars has not been changed\n\t\tthis._resetTimeMarksCache();\n\t}\n\n\tprivate _resetTimeMarksCache(): void {\n\t\tthis._timeMarksCache = null;\n\t}\n\n\tprivate _invalidateTickMarks(): void {\n\t\tthis._resetTimeMarksCache();\n\t\tthis._formattedByWeight.clear();\n\t}\n\n\tprivate _updateDateTimeFormatter(): void {\n\t\tthis._horzScaleBehavior.updateFormatter(this._localizationOptions);\n\t}\n\n\tprivate _doFixLeftEdge(): void {\n\t\tif (!this._options.fixLeftEdge) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst firstIndex = this._firstIndex();\n\t\tif (firstIndex === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst visibleRange = this.visibleStrictRange();\n\t\tif (visibleRange === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst delta = visibleRange.left() - firstIndex;\n\t\tif (delta < 0) {\n\t\t\tconst leftEdgeOffset = this._rightOffset - delta - 1;\n\t\t\tthis.setRightOffset(leftEdgeOffset);\n\t\t}\n\n\t\tthis._correctBarSpacing();\n\t}\n\n\tprivate _doFixRightEdge(): void {\n\t\tthis._correctOffset();\n\n\t\tthis._correctBarSpacing();\n\t}\n}\n","import { CanvasRenderingTarget2D, MediaCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { IPaneRenderer } from './ipane-renderer';\n\nexport abstract class MediaCoordinatesPaneRenderer implements IPaneRenderer {\n\tpublic draw(target: CanvasRenderingTarget2D, isHovered: boolean, hitTestData?: unknown): void {\n\t\ttarget.useMediaCoordinateSpace(\n\t\t\t(scope: MediaCoordinatesRenderingScope) => this._drawImpl(scope, isHovered, hitTestData)\n\t\t);\n\t}\n\n\tpublic drawBackground(target: CanvasRenderingTarget2D, isHovered: boolean, hitTestData?: unknown): void {\n\t\ttarget.useMediaCoordinateSpace(\n\t\t\t(scope: MediaCoordinatesRenderingScope) => this._drawBackgroundImpl(scope, isHovered, hitTestData)\n\t\t);\n\t}\n\n\tprotected abstract _drawImpl(renderingScope: MediaCoordinatesRenderingScope, isHovered: boolean, hitTestData?: unknown): void;\n\n\tprotected _drawBackgroundImpl(renderingScope: MediaCoordinatesRenderingScope, isHovered: boolean, hitTestData?: unknown): void {}\n}\n","import { MediaCoordinatesRenderingScope } from 'fancy-canvas';\n\nimport { MediaCoordinatesPaneRenderer } from './media-coordinates-pane-renderer';\n\nexport interface WatermarkRendererLineData {\n\ttext: string;\n\tfont: string;\n\tlineHeight: number;\n\tvertOffset: number;\n\tzoom: number;\n}\n\n/**\n * Represents a horizontal alignment.\n */\nexport type HorzAlign = 'left' | 'center' | 'right';\n/**\n * Represents a vertical alignment.\n */\nexport type VertAlign = 'top' | 'center' | 'bottom';\n\nexport interface WatermarkRendererData {\n\tlines: WatermarkRendererLineData[];\n\tcolor: string;\n\tvisible: boolean;\n\thorzAlign: HorzAlign;\n\tvertAlign: VertAlign;\n}\n\nexport class WatermarkRenderer extends MediaCoordinatesPaneRenderer {\n\tprivate readonly _data: WatermarkRendererData;\n\tprivate _metricsCache: Map<string, Map<string, number>> = new Map();\n\n\tpublic constructor(data: WatermarkRendererData) {\n\t\tsuper();\n\t\tthis._data = data;\n\t}\n\n\tprotected _drawImpl(renderingScope: MediaCoordinatesRenderingScope): void {}\n\n\tprotected override _drawBackgroundImpl(renderingScope: MediaCoordinatesRenderingScope): void {\n\t\tif (!this._data.visible) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { context: ctx, mediaSize } = renderingScope;\n\n\t\tlet textHeight = 0;\n\t\tfor (const line of this._data.lines) {\n\t\t\tif (line.text.length === 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tctx.font = line.font;\n\t\t\tconst textWidth = this._metrics(ctx, line.text);\n\t\t\tif (textWidth > mediaSize.width) {\n\t\t\t\tline.zoom = mediaSize.width / textWidth;\n\t\t\t} else {\n\t\t\t\tline.zoom = 1;\n\t\t\t}\n\n\t\t\ttextHeight += line.lineHeight * line.zoom;\n\t\t}\n\n\t\tlet vertOffset = 0;\n\t\tswitch (this._data.vertAlign) {\n\t\t\tcase 'top':\n\t\t\t\tvertOffset = 0;\n\t\t\t\tbreak;\n\n\t\t\tcase 'center':\n\t\t\t\tvertOffset = Math.max((mediaSize.height - textHeight) / 2, 0);\n\t\t\t\tbreak;\n\n\t\t\tcase 'bottom':\n\t\t\t\tvertOffset = Math.max((mediaSize.height - textHeight), 0);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tctx.fillStyle = this._data.color;\n\n\t\tfor (const line of this._data.lines) {\n\t\t\tctx.save();\n\n\t\t\tlet horzOffset = 0;\n\t\t\tswitch (this._data.horzAlign) {\n\t\t\t\tcase 'left':\n\t\t\t\t\tctx.textAlign = 'left';\n\t\t\t\t\thorzOffset = line.lineHeight / 2;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'center':\n\t\t\t\t\tctx.textAlign = 'center';\n\t\t\t\t\thorzOffset = mediaSize.width / 2;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'right':\n\t\t\t\t\tctx.textAlign = 'right';\n\t\t\t\t\thorzOffset = mediaSize.width - 1 - line.lineHeight / 2;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tctx.translate(horzOffset, vertOffset);\n\t\t\tctx.textBaseline = 'top';\n\t\t\tctx.font = line.font;\n\t\t\tctx.scale(line.zoom, line.zoom);\n\t\t\tctx.fillText(line.text, 0, line.vertOffset);\n\t\t\tctx.restore();\n\t\t\tvertOffset += line.lineHeight * line.zoom;\n\t\t}\n\t}\n\n\tprivate _metrics(ctx: CanvasRenderingContext2D, text: string): number {\n\t\tconst fontCache = this._fontCache(ctx.font);\n\t\tlet result = fontCache.get(text);\n\t\tif (result === undefined) {\n\t\t\tresult = ctx.measureText(text).width;\n\t\t\tfontCache.set(text, result);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate _fontCache(font: string): Map<string, number> {\n\t\tlet fontCache = this._metricsCache.get(font);\n\t\tif (fontCache === undefined) {\n\t\t\tfontCache = new Map();\n\t\t\tthis._metricsCache.set(font, fontCache);\n\t\t}\n\n\t\treturn fontCache;\n\t}\n}\n","import { makeFont } from '../../helpers/make-font';\n\nimport { Watermark } from '../../model/watermark';\nimport { IPaneRenderer } from '../../renderers/ipane-renderer';\nimport { WatermarkRenderer, WatermarkRendererData } from '../../renderers/watermark-renderer';\n\nimport { IUpdatablePaneView } from './iupdatable-pane-view';\n\nexport class WatermarkPaneView implements IUpdatablePaneView {\n\tprivate _source: Watermark;\n\tprivate _invalidated: boolean = true;\n\n\tprivate readonly _rendererData: WatermarkRendererData = {\n\t\tvisible: false,\n\t\tcolor: '',\n\t\tlines: [],\n\t\tvertAlign: 'center',\n\t\thorzAlign: 'center',\n\t};\n\tprivate readonly _renderer: WatermarkRenderer = new WatermarkRenderer(this._rendererData);\n\n\tpublic constructor(source: Watermark) {\n\t\tthis._source = source;\n\t}\n\n\tpublic update(): void {\n\t\tthis._invalidated = true;\n\t}\n\n\tpublic renderer(): IPaneRenderer {\n\t\tif (this._invalidated) {\n\t\t\tthis._updateImpl();\n\t\t\tthis._invalidated = false;\n\t\t}\n\n\t\treturn this._renderer;\n\t}\n\n\tprivate _updateImpl(): void {\n\t\tconst options = this._source.options();\n\t\tconst data = this._rendererData;\n\t\tdata.visible = options.visible;\n\n\t\tif (!data.visible) {\n\t\t\treturn;\n\t\t}\n\n\t\tdata.color = options.color;\n\t\tdata.horzAlign = options.horzAlign;\n\t\tdata.vertAlign = options.vertAlign;\n\n\t\tdata.lines = [\n\t\t\t{\n\t\t\t\ttext: options.text,\n\t\t\t\tfont: makeFont(options.fontSize, options.fontFamily, options.fontStyle),\n\t\t\t\tlineHeight: options.fontSize * 1.2,\n\t\t\t\tvertOffset: 0,\n\t\t\t\tzoom: 0,\n\t\t\t},\n\t\t];\n\t}\n}\n","import { HorzAlign, VertAlign } from '../renderers/watermark-renderer';\nimport { IPaneView } from '../views/pane/ipane-view';\nimport { WatermarkPaneView } from '../views/pane/watermark-pane-view';\nimport { IPriceAxisView } from '../views/price-axis/iprice-axis-view';\n\nimport { IChartModelBase } from './chart-model';\nimport { DataSource } from './data-source';\n\n/** Watermark options. */\nexport interface WatermarkOptions {\n\t/**\n\t * Watermark color.\n\t *\n\t * @defaultValue `'rgba(0, 0, 0, 0)'`\n\t */\n\tcolor: string;\n\n\t/**\n\t * Display the watermark.\n\t *\n\t * @defaultValue `false`\n\t */\n\tvisible: boolean;\n\n\t/**\n\t * Text of the watermark. Word wrapping is not supported.\n\t *\n\t * @defaultValue `''`\n\t */\n\ttext: string;\n\n\t/**\n\t * Font size in pixels.\n\t *\n\t * @defaultValue `48`\n\t */\n\tfontSize: number;\n\n\t/**\n\t * Font family.\n\t *\n\t * @defaultValue `-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif`\n\t */\n\tfontFamily: string;\n\n\t/**\n\t * Font style.\n\t *\n\t * @defaultValue `''`\n\t */\n\tfontStyle: string;\n\n\t/**\n\t * Horizontal alignment inside the chart area.\n\t *\n\t * @defaultValue `'center'`\n\t */\n\thorzAlign: HorzAlign;\n\n\t/**\n\t * Vertical alignment inside the chart area.\n\t *\n\t * @defaultValue `'center'`\n\t */\n\tvertAlign: VertAlign;\n}\n\nexport class Watermark extends DataSource {\n\tprivate readonly _paneView: WatermarkPaneView;\n\tprivate readonly _options: WatermarkOptions;\n\n\tpublic constructor(model: IChartModelBase, options: WatermarkOptions) {\n\t\tsuper();\n\t\tthis._options = options;\n\t\tthis._paneView = new WatermarkPaneView(this);\n\t}\n\n\tpublic override priceAxisViews(): readonly IPriceAxisView[] {\n\t\treturn [];\n\t}\n\n\tpublic paneViews(): readonly IPaneView[] {\n\t\treturn [this._paneView];\n\t}\n\n\tpublic options(): Readonly<WatermarkOptions> {\n\t\treturn this._options;\n\t}\n\n\tpublic updateAllViews(): void {\n\t\tthis._paneView.update();\n\t}\n}\n","/// <reference types=\"_build-time-constants\" />\n\nimport { assert, ensureNotNull } from '../helpers/assertions';\nimport { gradientColorAtPercent } from '../helpers/color';\nimport { Delegate } from '../helpers/delegate';\nimport { IDestroyable } from '../helpers/idestroyable';\nimport { ISubscription } from '../helpers/isubscription';\nimport { DeepPartial, merge } from '../helpers/strict-type-checks';\n\nimport { PriceAxisViewRendererOptions } from '../renderers/iprice-axis-view-renderer';\nimport { PriceAxisRendererOptionsProvider } from '../renderers/price-axis-renderer-options-provider';\n\nimport { Coordinate } from './coordinate';\nimport { Crosshair, CrosshairOptions } from './crosshair';\nimport { DefaultPriceScaleId, isDefaultPriceScale } from './default-price-scale';\nimport { GridOptions } from './grid';\nimport { ICustomSeriesPaneView } from './icustom-series';\nimport { IHorzScaleBehavior, InternalHorzScaleItem } from './ihorz-scale-behavior';\nimport { InvalidateMask, InvalidationLevel, ITimeScaleAnimation } from './invalidate-mask';\nimport { IPriceDataSource } from './iprice-data-source';\nimport { ColorType, LayoutOptions } from './layout-options';\nimport { LocalizationOptions, LocalizationOptionsBase } from './localization-options';\nimport { Magnet } from './magnet';\nimport { DEFAULT_STRETCH_FACTOR, Pane } from './pane';\nimport { Point } from './point';\nimport { PriceScale, PriceScaleOptions } from './price-scale';\nimport { ISeries, Series, SeriesOptionsInternal } from './series';\nimport { SeriesOptionsMap, SeriesType } from './series-options';\nimport { LogicalRange, TimePointIndex, TimeScalePoint } from './time-data';\nimport { HorzScaleOptions, ITimeScale, TimeScale } from './time-scale';\nimport { TouchMouseEventData } from './touch-mouse-event-data';\nimport { Watermark, WatermarkOptions } from './watermark';\n\n/**\n * Represents options for how the chart is scrolled by the mouse and touch gestures.\n */\nexport interface HandleScrollOptions {\n\t/**\n\t * Enable scrolling with the mouse wheel.\n\t *\n\t * @defaultValue `true`\n\t */\n\tmouseWheel: boolean;\n\n\t/**\n\t * Enable scrolling by holding down the left mouse button and moving the mouse.\n\t *\n\t * @defaultValue `true`\n\t */\n\tpressedMouseMove: boolean;\n\n\t/**\n\t * Enable horizontal touch scrolling.\n\t *\n\t * When enabled the chart handles touch gestures that would normally scroll the webpage horizontally.\n\t *\n\t * @defaultValue `true`\n\t */\n\thorzTouchDrag: boolean;\n\n\t/**\n\t * Enable vertical touch scrolling.\n\t *\n\t * When enabled the chart handles touch gestures that would normally scroll the webpage vertically.\n\t *\n\t * @defaultValue `true`\n\t */\n\tvertTouchDrag: boolean;\n}\n\n/**\n * Represents options for how the chart is scaled by the mouse and touch gestures.\n */\nexport interface HandleScaleOptions {\n\t/**\n\t * Enable scaling with the mouse wheel.\n\t *\n\t * @defaultValue `true`\n\t */\n\tmouseWheel: boolean;\n\n\t/**\n\t * Enable scaling with pinch/zoom gestures.\n\t *\n\t * @defaultValue `true`\n\t */\n\tpinch: boolean;\n\n\t/**\n\t * Enable scaling the price and/or time scales by holding down the left mouse button and moving the mouse.\n\t */\n\taxisPressedMouseMove: AxisPressedMouseMoveOptions | boolean;\n\n\t/**\n\t * Enable resetting scaling by double-clicking the left mouse button.\n\t */\n\taxisDoubleClickReset: AxisDoubleClickOptions | boolean;\n}\n\n/**\n * Represents options for enabling or disabling kinetic scrolling with mouse and touch gestures.\n */\nexport interface KineticScrollOptions {\n\t/**\n\t * Enable kinetic scroll with touch gestures.\n\t *\n\t * @defaultValue `true`\n\t */\n\ttouch: boolean;\n\n\t/**\n\t * Enable kinetic scroll with the mouse.\n\t *\n\t * @defaultValue `false`\n\t */\n\tmouse: boolean;\n}\n\ntype HandleScaleOptionsInternal =\n\tOmit<HandleScaleOptions, 'axisPressedMouseMove' | 'axisDoubleClickReset'>\n\t& {\n\t\t/** @public */\n\t\taxisPressedMouseMove: AxisPressedMouseMoveOptions;\n\n\t\t/** @public */\n\t\taxisDoubleClickReset: AxisDoubleClickOptions;\n\t};\n\n/**\n * Represents options for how the time and price axes react to mouse movements.\n */\nexport interface AxisPressedMouseMoveOptions {\n\t/**\n\t * Enable scaling the time axis by holding down the left mouse button and moving the mouse.\n\t *\n\t * @defaultValue `true`\n\t */\n\ttime: boolean;\n\n\t/**\n\t * Enable scaling the price axis by holding down the left mouse button and moving the mouse.\n\t *\n\t * @defaultValue `true`\n\t */\n\tprice: boolean;\n}\n\n/**\n * Represents options for how the time and price axes react to mouse double click.\n */\nexport interface AxisDoubleClickOptions {\n\t/**\n\t * Enable resetting scaling the time axis by double-clicking the left mouse button.\n\t *\n\t * @defaultValue `true`\n\t */\n\ttime: boolean;\n\n\t/**\n\t * Enable reseting scaling the price axis by by double-clicking the left mouse button.\n\t *\n\t * @defaultValue `true`\n\t */\n\tprice: boolean;\n}\n\nexport interface HoveredObject {\n\thitTestData?: unknown;\n\texternalId?: string;\n}\n\nexport interface HoveredSource {\n\tsource: IPriceDataSource;\n\tobject?: HoveredObject;\n}\n\nexport interface PriceScaleOnPane {\n\tpriceScale: PriceScale;\n\tpane: Pane;\n}\n\nconst enum BackgroundColorSide {\n\tTop,\n\tBottom,\n}\n\ntype InvalidateHandler = (mask: InvalidateMask) => void;\n\n/**\n * Represents a visible price scale's options.\n *\n * @see {@link PriceScaleOptions}\n */\nexport type VisiblePriceScaleOptions = PriceScaleOptions;\n\n/**\n * Represents overlay price scale options.\n */\nexport type OverlayPriceScaleOptions = Omit<PriceScaleOptions, 'visible' | 'autoScale'>;\n\n/**\n * Determine how to exit the tracking mode.\n *\n * By default, mobile users will long press to deactivate the scroll and have the ability to check values and dates.\n * Another press is required to activate the scroll, be able to move left/right, zoom, etc.\n */\nexport const enum TrackingModeExitMode {\n\t/**\n\t * Tracking Mode will be deactivated on touch end event.\n\t */\n\tOnTouchEnd,\n\t/**\n\t * Tracking Mode will be deactivated on the next tap event.\n\t */\n\tOnNextTap,\n}\n\n/**\n * Represent options for the tracking mode's behavior.\n *\n * Mobile users will not have the ability to see the values/dates like they do on desktop.\n * To see it, they should enter the tracking mode. The tracking mode will deactivate the scrolling\n * and make it possible to check values and dates.\n */\nexport interface TrackingModeOptions {\n\t// eslint-disable-next-line tsdoc/syntax\n\t/** @inheritDoc TrackingModeExitMode\n\t *\n\t * @defaultValue {@link TrackingModeExitMode.OnNextTap}\n\t */\n\texitMode: TrackingModeExitMode;\n}\n\n/**\n * Represents common chart options\n */\nexport interface ChartOptionsBase {\n\t/**\n\t * Width of the chart in pixels\n\t *\n\t * @defaultValue If `0` (default) or none value provided, then a size of the widget will be calculated based its container's size.\n\t */\n\twidth: number;\n\n\t/**\n\t * Height of the chart in pixels\n\t *\n\t * @defaultValue If `0` (default) or none value provided, then a size of the widget will be calculated based its container's size.\n\t */\n\theight: number;\n\n\t/**\n\t * Setting this flag to `true` will make the chart watch the chart container's size and automatically resize the chart to fit its container whenever the size changes.\n\t *\n\t * This feature requires [`ResizeObserver`](https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserver) class to be available in the global scope.\n\t * Note that calling code is responsible for providing a polyfill if required. If the global scope does not have `ResizeObserver`, a warning will appear and the flag will be ignored.\n\t *\n\t * Please pay attention that `autoSize` option and explicit sizes options `width` and `height` don't conflict with one another.\n\t * If you specify `autoSize` flag, then `width` and `height` options will be ignored unless `ResizeObserver` has failed. If it fails then the values will be used as fallback.\n\t *\n\t * The flag `autoSize` could also be set with and unset with `applyOptions` function.\n\t * ```js\n\t * const chart = LightweightCharts.createChart(document.body, {\n\t *     autoSize: true,\n\t * });\n\t * ```\n\t */\n\tautoSize: boolean;\n\n\t/**\n\t * Watermark options.\n\t *\n\t * A watermark is a background label that includes a brief description of the drawn data. Any text can be added to it.\n\t *\n\t * Please make sure you enable it and set an appropriate font color and size to make your watermark visible in the background of the chart.\n\t * We recommend a semi-transparent color and a large font. Also note that watermark position can be aligned vertically and horizontally.\n\t */\n\twatermark: WatermarkOptions;\n\n\t/**\n\t * Layout options\n\t */\n\tlayout: LayoutOptions;\n\n\t/**\n\t * Left price scale options\n\t */\n\tleftPriceScale: VisiblePriceScaleOptions;\n\t/**\n\t * Right price scale options\n\t */\n\trightPriceScale: VisiblePriceScaleOptions;\n\t/**\n\t * Overlay price scale options\n\t */\n\toverlayPriceScales: OverlayPriceScaleOptions;\n\n\t/**\n\t * Time scale options\n\t */\n\ttimeScale: HorzScaleOptions;\n\n\t/**\n\t * The crosshair shows the intersection of the price and time scale values at any point on the chart.\n\t *\n\t */\n\tcrosshair: CrosshairOptions;\n\n\t/**\n\t * A grid is represented in the chart background as a vertical and horizontal lines drawn at the levels of visible marks of price and the time scales.\n\t */\n\tgrid: GridOptions;\n\n\t/**\n\t * Scroll options, or a boolean flag that enables/disables scrolling\n\t */\n\thandleScroll: HandleScrollOptions | boolean;\n\n\t/**\n\t * Scale options, or a boolean flag that enables/disables scaling\n\t */\n\thandleScale: HandleScaleOptions | boolean;\n\n\t/**\n\t * Kinetic scroll options\n\t */\n\tkineticScroll: KineticScrollOptions;\n\n\t// eslint-disable-next-line tsdoc/syntax\n\t/** @inheritDoc TrackingModeOptions\n\t */\n\ttrackingMode: TrackingModeOptions;\n\n\t/**\n\t * Basic localization options\n\t */\n\tlocalization: LocalizationOptionsBase;\n}\n\n/**\n * Structure describing options of the chart. Series options are to be set separately\n */\nexport interface ChartOptionsImpl<HorzScaleItem> extends ChartOptionsBase {\n\n\t/**\n\t * Localization options.\n\t */\n\tlocalization: LocalizationOptions<HorzScaleItem>;\n}\n\nexport type ChartOptionsInternalBase =\n\tOmit<ChartOptionsBase, 'handleScroll' | 'handleScale' | 'layout'>\n\t& {\n\t\t/** @public */\n\t\thandleScroll: HandleScrollOptions;\n\t\t/** @public */\n\t\thandleScale: HandleScaleOptionsInternal;\n\t\t/** @public */\n\t\tlayout: LayoutOptions;\n\t};\n\nexport type ChartOptionsInternal<HorzScaleItem> =\n\tOmit<ChartOptionsImpl<HorzScaleItem>, 'handleScroll' | 'handleScale' | 'layout'>\n\t& {\n\t\t/** @public */\n\t\thandleScroll: HandleScrollOptions;\n\t\t/** @public */\n\t\thandleScale: HandleScaleOptionsInternal;\n\t\t/** @public */\n\t\tlayout: LayoutOptions;\n\t};\n\ninterface GradientColorsCache {\n\ttopColor: string;\n\tbottomColor: string;\n\tcolors: Map<number, string>;\n}\n\nexport interface IChartModelBase {\n\tapplyPriceScaleOptions(priceScaleId: string, options: DeepPartial<PriceScaleOptions>): void;\n\tfindPriceScale(priceScaleId: string): PriceScaleOnPane | null;\n\toptions(): Readonly<ChartOptionsInternalBase>;\n\ttimeScale(): ITimeScale;\n\tserieses(): readonly ISeries<SeriesType>[];\n\n\tupdateSource(source: IPriceDataSource): void;\n\tupdateCrosshair(): void;\n\tcursorUpdate(): void;\n\tclearCurrentPosition(): void;\n\tsetAndSaveCurrentPosition(x: Coordinate, y: Coordinate, event: TouchMouseEventData | null, pane: Pane): void;\n\n\trecalculatePane(pane: Pane | null): void;\n\n\tlightUpdate(): void;\n\tfullUpdate(): void;\n\n\tbackgroundBottomColor(): string;\n\tbackgroundTopColor(): string;\n\tbackgroundColorAtYPercentFromTop(percent: number): string;\n\n\tpaneForSource(source: IPriceDataSource): Pane | null;\n\tmoveSeriesToScale(series: ISeries<SeriesType>, targetScaleId: string): void;\n\n\tpriceAxisRendererOptions(): Readonly<PriceAxisViewRendererOptions>;\n\trendererOptionsProvider(): PriceAxisRendererOptionsProvider;\n\n\tpriceScalesOptionsChanged(): ISubscription;\n\n\thoveredSource(): HoveredSource | null;\n\tsetHoveredSource(source: HoveredSource | null): void;\n\n\tcrosshairSource(): Crosshair;\n\twatermarkSource(): Watermark;\n\n\tstartScrollPrice(pane: Pane, priceScale: PriceScale, x: number): void;\n\tscrollPriceTo(pane: Pane, priceScale: PriceScale, x: number): void;\n\tendScrollPrice(pane: Pane, priceScale: PriceScale): void;\n\tresetPriceScale(pane: Pane, priceScale: PriceScale): void;\n\n\tstartScalePrice(pane: Pane, priceScale: PriceScale, x: number): void;\n\tscalePriceTo(pane: Pane, priceScale: PriceScale, x: number): void;\n\tendScalePrice(pane: Pane, priceScale: PriceScale): void;\n\n\tzoomTime(pointX: Coordinate, scale: number): void;\n\tstartScrollTime(x: Coordinate): void;\n\tscrollTimeTo(x: Coordinate): void;\n\tendScrollTime(): void;\n\n\tsetTimeScaleAnimation(animation: ITimeScaleAnimation): void;\n\n\tstopTimeScaleAnimation(): void;\n}\n\nexport class ChartModel<HorzScaleItem> implements IDestroyable, IChartModelBase {\n\tprivate readonly _options: ChartOptionsInternal<HorzScaleItem>;\n\tprivate readonly _invalidateHandler: InvalidateHandler;\n\n\tprivate readonly _rendererOptionsProvider: PriceAxisRendererOptionsProvider;\n\n\tprivate readonly _timeScale: TimeScale<HorzScaleItem>;\n\tprivate readonly _panes: Pane[] = [];\n\tprivate readonly _crosshair: Crosshair;\n\tprivate readonly _magnet: Magnet;\n\tprivate readonly _watermark: Watermark;\n\n\tprivate _serieses: Series<SeriesType>[] = [];\n\n\tprivate _width: number = 0;\n\tprivate _hoveredSource: HoveredSource | null = null;\n\tprivate readonly _priceScalesOptionsChanged: Delegate = new Delegate();\n\tprivate _crosshairMoved: Delegate<TimePointIndex | null, Point | null, TouchMouseEventData | null> = new Delegate();\n\n\tprivate _backgroundTopColor: string;\n\tprivate _backgroundBottomColor: string;\n\tprivate _gradientColorsCache: GradientColorsCache | null = null;\n\n\tprivate readonly _horzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>;\n\n\tpublic constructor(invalidateHandler: InvalidateHandler, options: ChartOptionsInternal<HorzScaleItem>, horzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>) {\n\t\tthis._invalidateHandler = invalidateHandler;\n\t\tthis._options = options;\n\t\tthis._horzScaleBehavior = horzScaleBehavior;\n\n\t\tthis._rendererOptionsProvider = new PriceAxisRendererOptionsProvider(this);\n\n\t\tthis._timeScale = new TimeScale(this, options.timeScale, this._options.localization, horzScaleBehavior);\n\t\tthis._crosshair = new Crosshair(this, options.crosshair);\n\t\tthis._magnet = new Magnet(options.crosshair);\n\t\tthis._watermark = new Watermark(this, options.watermark);\n\n\t\tthis.createPane();\n\t\tthis._panes[0].setStretchFactor(DEFAULT_STRETCH_FACTOR * 2);\n\n\t\tthis._backgroundTopColor = this._getBackgroundColor(BackgroundColorSide.Top);\n\t\tthis._backgroundBottomColor = this._getBackgroundColor(BackgroundColorSide.Bottom);\n\t}\n\n\tpublic fullUpdate(): void {\n\t\tthis._invalidate(InvalidateMask.full());\n\t}\n\n\tpublic lightUpdate(): void {\n\t\tthis._invalidate(InvalidateMask.light());\n\t}\n\n\tpublic cursorUpdate(): void {\n\t\tthis._invalidate(new InvalidateMask(InvalidationLevel.Cursor));\n\t}\n\n\tpublic updateSource(source: IPriceDataSource): void {\n\t\tconst inv = this._invalidationMaskForSource(source);\n\t\tthis._invalidate(inv);\n\t}\n\n\tpublic hoveredSource(): HoveredSource | null {\n\t\treturn this._hoveredSource;\n\t}\n\n\tpublic setHoveredSource(source: HoveredSource | null): void {\n\t\tconst prevSource = this._hoveredSource;\n\t\tthis._hoveredSource = source;\n\t\tif (prevSource !== null) {\n\t\t\tthis.updateSource(prevSource.source);\n\t\t}\n\t\tif (source !== null) {\n\t\t\tthis.updateSource(source.source);\n\t\t}\n\t}\n\n\tpublic options(): Readonly<ChartOptionsInternal<HorzScaleItem>> {\n\t\treturn this._options;\n\t}\n\n\tpublic applyOptions(options: DeepPartial<ChartOptionsInternal<HorzScaleItem>>): void {\n\t\tmerge(this._options, options);\n\n\t\tthis._panes.forEach((p: Pane) => p.applyScaleOptions(options));\n\n\t\tif (options.timeScale !== undefined) {\n\t\t\tthis._timeScale.applyOptions(options.timeScale);\n\t\t}\n\n\t\tif (options.localization !== undefined) {\n\t\t\tthis._timeScale.applyLocalizationOptions(options.localization);\n\t\t}\n\n\t\tif (options.leftPriceScale || options.rightPriceScale) {\n\t\t\tthis._priceScalesOptionsChanged.fire();\n\t\t}\n\n\t\tthis._backgroundTopColor = this._getBackgroundColor(BackgroundColorSide.Top);\n\t\tthis._backgroundBottomColor = this._getBackgroundColor(BackgroundColorSide.Bottom);\n\n\t\tthis.fullUpdate();\n\t}\n\n\tpublic applyPriceScaleOptions(priceScaleId: string, options: DeepPartial<PriceScaleOptions>): void {\n\t\tif (priceScaleId === DefaultPriceScaleId.Left) {\n\t\t\tthis.applyOptions({\n\t\t\t\tleftPriceScale: options,\n\t\t\t});\n\t\t\treturn;\n\t\t} else if (priceScaleId === DefaultPriceScaleId.Right) {\n\t\t\tthis.applyOptions({\n\t\t\t\trightPriceScale: options,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tconst res = this.findPriceScale(priceScaleId);\n\n\t\tif (res === null) {\n\t\t\tif (process.env.NODE_ENV === 'development') {\n\t\t\t\tthrow new Error(`Trying to apply price scale options with incorrect ID: ${priceScaleId}`);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tres.priceScale.applyOptions(options);\n\t\tthis._priceScalesOptionsChanged.fire();\n\t}\n\n\tpublic findPriceScale(priceScaleId: string): PriceScaleOnPane | null {\n\t\tfor (const pane of this._panes) {\n\t\t\tconst priceScale = pane.priceScaleById(priceScaleId);\n\t\t\tif (priceScale !== null) {\n\t\t\t\treturn {\n\t\t\t\t\tpane,\n\t\t\t\t\tpriceScale,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic timeScale(): TimeScale<HorzScaleItem> {\n\t\treturn this._timeScale;\n\t}\n\n\tpublic panes(): readonly Pane[] {\n\t\treturn this._panes;\n\t}\n\n\tpublic watermarkSource(): Watermark {\n\t\treturn this._watermark;\n\t}\n\n\tpublic crosshairSource(): Crosshair {\n\t\treturn this._crosshair;\n\t}\n\n\tpublic crosshairMoved(): ISubscription<TimePointIndex | null, Point | null, TouchMouseEventData | null> {\n\t\treturn this._crosshairMoved;\n\t}\n\n\tpublic setPaneHeight(pane: Pane, height: number): void {\n\t\tpane.setHeight(height);\n\t\tthis.recalculateAllPanes();\n\t}\n\n\tpublic setWidth(width: number): void {\n\t\tthis._width = width;\n\t\tthis._timeScale.setWidth(this._width);\n\t\tthis._panes.forEach((pane: Pane) => pane.setWidth(width));\n\t\tthis.recalculateAllPanes();\n\t}\n\n\tpublic createPane(index?: number): Pane {\n\t\tconst pane = new Pane(this._timeScale, this);\n\n\t\tif (index !== undefined) {\n\t\t\tthis._panes.splice(index, 0, pane);\n\t\t} else {\n\t\t\t// adding to the end - common case\n\t\t\tthis._panes.push(pane);\n\t\t}\n\n\t\tconst actualIndex = (index === undefined) ? this._panes.length - 1 : index;\n\n\t\t// we always do autoscaling on the creation\n\t\t// if autoscale option is true, it is ok, just recalculate by invalidation mask\n\t\t// if autoscale option is false, autoscale anyway on the first draw\n\t\t// also there is a scenario when autoscale is true in constructor and false later on applyOptions\n\t\tconst mask = InvalidateMask.full();\n\t\tmask.invalidatePane(actualIndex, {\n\t\t\tlevel: InvalidationLevel.None,\n\t\t\tautoScale: true,\n\t\t});\n\t\tthis._invalidate(mask);\n\n\t\treturn pane;\n\t}\n\n\tpublic startScalePrice(pane: Pane, priceScale: PriceScale, x: number): void {\n\t\tpane.startScalePrice(priceScale, x);\n\t}\n\n\tpublic scalePriceTo(pane: Pane, priceScale: PriceScale, x: number): void {\n\t\tpane.scalePriceTo(priceScale, x);\n\t\tthis.updateCrosshair();\n\t\tthis._invalidate(this._paneInvalidationMask(pane, InvalidationLevel.Light));\n\t}\n\n\tpublic endScalePrice(pane: Pane, priceScale: PriceScale): void {\n\t\tpane.endScalePrice(priceScale);\n\t\tthis._invalidate(this._paneInvalidationMask(pane, InvalidationLevel.Light));\n\t}\n\n\tpublic startScrollPrice(pane: Pane, priceScale: PriceScale, x: number): void {\n\t\tif (priceScale.isAutoScale()) {\n\t\t\treturn;\n\t\t}\n\t\tpane.startScrollPrice(priceScale, x);\n\t}\n\n\tpublic scrollPriceTo(pane: Pane, priceScale: PriceScale, x: number): void {\n\t\tif (priceScale.isAutoScale()) {\n\t\t\treturn;\n\t\t}\n\t\tpane.scrollPriceTo(priceScale, x);\n\t\tthis.updateCrosshair();\n\t\tthis._invalidate(this._paneInvalidationMask(pane, InvalidationLevel.Light));\n\t}\n\n\tpublic endScrollPrice(pane: Pane, priceScale: PriceScale): void {\n\t\tif (priceScale.isAutoScale()) {\n\t\t\treturn;\n\t\t}\n\t\tpane.endScrollPrice(priceScale);\n\t\tthis._invalidate(this._paneInvalidationMask(pane, InvalidationLevel.Light));\n\t}\n\n\tpublic resetPriceScale(pane: Pane, priceScale: PriceScale): void {\n\t\tpane.resetPriceScale(priceScale);\n\t\tthis._invalidate(this._paneInvalidationMask(pane, InvalidationLevel.Light));\n\t}\n\n\tpublic startScaleTime(position: Coordinate): void {\n\t\tthis._timeScale.startScale(position);\n\t}\n\n\t/**\n\t * Zoom in/out the chart (depends on scale value).\n\t *\n\t * @param pointX - X coordinate of the point to apply the zoom (the point which should stay on its place)\n\t * @param scale - Zoom value. Negative value means zoom out, positive - zoom in.\n\t */\n\tpublic zoomTime(pointX: Coordinate, scale: number): void {\n\t\tconst timeScale = this.timeScale();\n\t\tif (timeScale.isEmpty() || scale === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeScaleWidth = timeScale.width();\n\t\tpointX = Math.max(1, Math.min(pointX, timeScaleWidth)) as Coordinate;\n\n\t\ttimeScale.zoom(pointX, scale);\n\n\t\tthis.recalculateAllPanes();\n\t}\n\n\tpublic scrollChart(x: Coordinate): void {\n\t\tthis.startScrollTime(0 as Coordinate);\n\t\tthis.scrollTimeTo(x);\n\t\tthis.endScrollTime();\n\t}\n\n\tpublic scaleTimeTo(x: Coordinate): void {\n\t\tthis._timeScale.scaleTo(x);\n\t\tthis.recalculateAllPanes();\n\t}\n\n\tpublic endScaleTime(): void {\n\t\tthis._timeScale.endScale();\n\t\tthis.lightUpdate();\n\t}\n\n\tpublic startScrollTime(x: Coordinate): void {\n\t\tthis._timeScale.startScroll(x);\n\t}\n\n\tpublic scrollTimeTo(x: Coordinate): void {\n\t\tthis._timeScale.scrollTo(x);\n\t\tthis.recalculateAllPanes();\n\t}\n\n\tpublic endScrollTime(): void {\n\t\tthis._timeScale.endScroll();\n\t\tthis.lightUpdate();\n\t}\n\n\tpublic serieses(): readonly Series<SeriesType>[] {\n\t\treturn this._serieses;\n\t}\n\n\tpublic setAndSaveCurrentPosition(x: Coordinate, y: Coordinate, event: TouchMouseEventData | null, pane: Pane, skipEvent?: boolean): void {\n\t\tthis._crosshair.saveOriginCoord(x, y);\n\t\tlet price = NaN;\n\t\tlet index = this._timeScale.coordinateToIndex(x);\n\n\t\tconst visibleBars = this._timeScale.visibleStrictRange();\n\t\tif (visibleBars !== null) {\n\t\t\tindex = Math.min(Math.max(visibleBars.left(), index), visibleBars.right()) as TimePointIndex;\n\t\t}\n\n\t\tconst priceScale = pane.defaultPriceScale();\n\t\tconst firstValue = priceScale.firstValue();\n\t\tif (firstValue !== null) {\n\t\t\tprice = priceScale.coordinateToPrice(y, firstValue);\n\t\t}\n\t\tprice = this._magnet.align(price, index, pane);\n\n\t\tthis._crosshair.setPosition(index, price, pane);\n\n\t\tthis.cursorUpdate();\n\t\tif (!skipEvent) {\n\t\t\tthis._crosshairMoved.fire(this._crosshair.appliedIndex(), { x, y }, event);\n\t\t}\n\t}\n\n\t// A position provided external (not from an internal event listener)\n\tpublic setAndSaveSyntheticPosition(price: number, horizontalPosition: HorzScaleItem, pane: Pane): void {\n\t\tconst priceScale = pane.defaultPriceScale();\n\t\tconst firstValue = priceScale.firstValue();\n\t\tconst y = priceScale.priceToCoordinate(price, ensureNotNull(firstValue));\n\t\tconst index = this._timeScale.timeToIndex(horizontalPosition as InternalHorzScaleItem, true);\n\t\tconst x = this._timeScale.indexToCoordinate(ensureNotNull(index));\n\t\tthis.setAndSaveCurrentPosition(x, y, null, pane, true);\n\t}\n\n\tpublic clearCurrentPosition(skipEvent?: boolean): void {\n\t\tconst crosshair = this.crosshairSource();\n\t\tcrosshair.clearPosition();\n\t\tthis.cursorUpdate();\n\t\tif (!skipEvent) {\n\t\t\tthis._crosshairMoved.fire(null, null, null);\n\t\t}\n\t}\n\n\tpublic updateCrosshair(): void {\n\t\t// apply magnet\n\t\tconst pane = this._crosshair.pane();\n\t\tif (pane !== null) {\n\t\t\tconst x = this._crosshair.originCoordX();\n\t\t\tconst y = this._crosshair.originCoordY();\n\t\t\tthis.setAndSaveCurrentPosition(x, y, null, pane);\n\t\t}\n\n\t\tthis._crosshair.updateAllViews();\n\t}\n\n\tpublic updateTimeScale(newBaseIndex: TimePointIndex | null, newPoints?: readonly TimeScalePoint[], firstChangedPointIndex?: number): void {\n\t\tconst oldFirstTime = this._timeScale.indexToTime(0 as TimePointIndex);\n\n\t\tif (newPoints !== undefined && firstChangedPointIndex !== undefined) {\n\t\t\tthis._timeScale.update(newPoints, firstChangedPointIndex);\n\t\t}\n\n\t\tconst newFirstTime = this._timeScale.indexToTime(0 as TimePointIndex);\n\n\t\tconst currentBaseIndex = this._timeScale.baseIndex();\n\t\tconst visibleBars = this._timeScale.visibleStrictRange();\n\n\t\t// if time scale cannot return current visible bars range (e.g. time scale has zero-width)\n\t\t// then we do not need to update right offset to shift visible bars range to have the same right offset as we have before new bar\n\t\t// (and actually we cannot)\n\t\tif (visibleBars !== null && oldFirstTime !== null && newFirstTime !== null) {\n\t\t\tconst isLastSeriesBarVisible = visibleBars.contains(currentBaseIndex);\n\t\t\tconst isLeftBarShiftToLeft = this._horzScaleBehavior.key(oldFirstTime) > this._horzScaleBehavior.key(newFirstTime);\n\t\t\tconst isSeriesPointsAdded = newBaseIndex !== null && newBaseIndex > currentBaseIndex;\n\t\t\tconst isSeriesPointsAddedToRight = isSeriesPointsAdded && !isLeftBarShiftToLeft;\n\n\t\t\tconst allowShiftWhenReplacingWhitespace = this._timeScale.options().allowShiftVisibleRangeOnWhitespaceReplacement;\n\t\t\tconst replacedExistingWhitespace = firstChangedPointIndex === undefined;\n\t\t\tconst needShiftVisibleRangeOnNewBar = isLastSeriesBarVisible && (!replacedExistingWhitespace || allowShiftWhenReplacingWhitespace) && this._timeScale.options().shiftVisibleRangeOnNewBar;\n\t\t\tif (isSeriesPointsAddedToRight && !needShiftVisibleRangeOnNewBar) {\n\t\t\t\tconst compensationShift = newBaseIndex - currentBaseIndex;\n\t\t\t\tthis._timeScale.setRightOffset(this._timeScale.rightOffset() - compensationShift);\n\t\t\t}\n\t\t}\n\n\t\tthis._timeScale.setBaseIndex(newBaseIndex);\n\t}\n\n\tpublic recalculatePane(pane: Pane | null): void {\n\t\tif (pane !== null) {\n\t\t\tpane.recalculate();\n\t\t}\n\t}\n\n\tpublic paneForSource(source: IPriceDataSource): Pane | null {\n\t\tconst pane = this._panes.find((p: Pane) => p.orderedSources().includes(source));\n\t\treturn pane === undefined ? null : pane;\n\t}\n\n\tpublic recalculateAllPanes(): void {\n\t\tthis._watermark.updateAllViews();\n\t\tthis._panes.forEach((p: Pane) => p.recalculate());\n\t\tthis.updateCrosshair();\n\t}\n\n\tpublic destroy(): void {\n\t\tthis._panes.forEach((p: Pane) => p.destroy());\n\t\tthis._panes.length = 0;\n\n\t\t// to avoid memleaks\n\t\tthis._options.localization.priceFormatter = undefined;\n\t\tthis._options.localization.percentageFormatter = undefined;\n\t\tthis._options.localization.timeFormatter = undefined;\n\t}\n\n\tpublic rendererOptionsProvider(): PriceAxisRendererOptionsProvider {\n\t\treturn this._rendererOptionsProvider;\n\t}\n\n\tpublic priceAxisRendererOptions(): Readonly<PriceAxisViewRendererOptions> {\n\t\treturn this._rendererOptionsProvider.options();\n\t}\n\n\tpublic priceScalesOptionsChanged(): ISubscription {\n\t\treturn this._priceScalesOptionsChanged;\n\t}\n\n\tpublic createSeries<T extends SeriesType>(seriesType: T, options: SeriesOptionsMap[T], customPaneView?: ICustomSeriesPaneView<HorzScaleItem>): Series<T> {\n\t\tconst pane = this._panes[0];\n\t\tconst series = this._createSeries(options, seriesType, pane, customPaneView);\n\t\tthis._serieses.push(series);\n\n\t\tif (this._serieses.length === 1) {\n\t\t\t// call fullUpdate to recalculate chart's parts geometry\n\t\t\tthis.fullUpdate();\n\t\t} else {\n\t\t\tthis.lightUpdate();\n\t\t}\n\n\t\treturn series;\n\t}\n\n\tpublic removeSeries(series: Series<SeriesType>): void {\n\t\tconst pane = this.paneForSource(series);\n\n\t\tconst seriesIndex = this._serieses.indexOf(series);\n\t\tassert(seriesIndex !== -1, 'Series not found');\n\n\t\tthis._serieses.splice(seriesIndex, 1);\n\t\tensureNotNull(pane).removeDataSource(series);\n\t\tif (series.destroy) {\n\t\t\tseries.destroy();\n\t\t}\n\t}\n\n\tpublic moveSeriesToScale(series: Series<SeriesType>, targetScaleId: string): void {\n\t\tconst pane = ensureNotNull(this.paneForSource(series));\n\t\tpane.removeDataSource(series);\n\n\t\t// check if targetScaleId exists\n\t\tconst target = this.findPriceScale(targetScaleId);\n\t\tif (target === null) {\n\t\t\t// new scale on the same pane\n\t\t\tconst zOrder = series.zorder();\n\t\t\tpane.addDataSource(series, targetScaleId, zOrder);\n\t\t} else {\n\t\t\t// if move to the new scale of the same pane, keep zorder\n\t\t\t// if move to new pane\n\t\t\tconst zOrder = (target.pane === pane) ? series.zorder() : undefined;\n\t\t\ttarget.pane.addDataSource(series, targetScaleId, zOrder);\n\t\t}\n\t}\n\n\tpublic fitContent(): void {\n\t\tconst mask = InvalidateMask.light();\n\t\tmask.setFitContent();\n\t\tthis._invalidate(mask);\n\t}\n\n\tpublic setTargetLogicalRange(range: LogicalRange): void {\n\t\tconst mask = InvalidateMask.light();\n\t\tmask.applyRange(range);\n\t\tthis._invalidate(mask);\n\t}\n\n\tpublic resetTimeScale(): void {\n\t\tconst mask = InvalidateMask.light();\n\t\tmask.resetTimeScale();\n\t\tthis._invalidate(mask);\n\t}\n\n\tpublic setBarSpacing(spacing: number): void {\n\t\tconst mask = InvalidateMask.light();\n\t\tmask.setBarSpacing(spacing);\n\t\tthis._invalidate(mask);\n\t}\n\n\tpublic setRightOffset(offset: number): void {\n\t\tconst mask = InvalidateMask.light();\n\t\tmask.setRightOffset(offset);\n\t\tthis._invalidate(mask);\n\t}\n\n\tpublic setTimeScaleAnimation(animation: ITimeScaleAnimation): void {\n\t\tconst mask = InvalidateMask.light();\n\t\tmask.setTimeScaleAnimation(animation);\n\t\tthis._invalidate(mask);\n\t}\n\n\tpublic stopTimeScaleAnimation(): void {\n\t\tconst mask = InvalidateMask.light();\n\t\tmask.stopTimeScaleAnimation();\n\t\tthis._invalidate(mask);\n\t}\n\n\tpublic defaultVisiblePriceScaleId(): string {\n\t\treturn this._options.rightPriceScale.visible ? DefaultPriceScaleId.Right : DefaultPriceScaleId.Left;\n\t}\n\n\tpublic backgroundBottomColor(): string {\n\t\treturn this._backgroundBottomColor;\n\t}\n\n\tpublic backgroundTopColor(): string {\n\t\treturn this._backgroundTopColor;\n\t}\n\n\tpublic backgroundColorAtYPercentFromTop(percent: number): string {\n\t\tconst bottomColor = this._backgroundBottomColor;\n\t\tconst topColor = this._backgroundTopColor;\n\n\t\tif (bottomColor === topColor) {\n\t\t\t// solid background\n\t\t\treturn bottomColor;\n\t\t}\n\n\t\t// gradient background\n\n\t\t// percent should be from 0 to 100 (we're using only integer values to make cache more efficient)\n\t\tpercent = Math.max(0, Math.min(100, Math.round(percent * 100)));\n\n\t\tif (this._gradientColorsCache === null ||\n\t\t\tthis._gradientColorsCache.topColor !== topColor || this._gradientColorsCache.bottomColor !== bottomColor) {\n\t\t\tthis._gradientColorsCache = {\n\t\t\t\ttopColor: topColor,\n\t\t\t\tbottomColor: bottomColor,\n\t\t\t\tcolors: new Map(),\n\t\t\t};\n\t\t} else {\n\t\t\tconst cachedValue = this._gradientColorsCache.colors.get(percent);\n\t\t\tif (cachedValue !== undefined) {\n\t\t\t\treturn cachedValue;\n\t\t\t}\n\t\t}\n\n\t\tconst result = gradientColorAtPercent(topColor, bottomColor, percent / 100);\n\t\tthis._gradientColorsCache.colors.set(percent, result);\n\t\treturn result;\n\t}\n\n\tprivate _paneInvalidationMask(pane: Pane | null, level: InvalidationLevel): InvalidateMask {\n\t\tconst inv = new InvalidateMask(level);\n\t\tif (pane !== null) {\n\t\t\tconst index = this._panes.indexOf(pane);\n\t\t\tinv.invalidatePane(index, {\n\t\t\t\tlevel,\n\t\t\t});\n\t\t}\n\t\treturn inv;\n\t}\n\n\tprivate _invalidationMaskForSource(source: IPriceDataSource, invalidateType?: InvalidationLevel): InvalidateMask {\n\t\tif (invalidateType === undefined) {\n\t\t\tinvalidateType = InvalidationLevel.Light;\n\t\t}\n\n\t\treturn this._paneInvalidationMask(this.paneForSource(source), invalidateType);\n\t}\n\n\tprivate _invalidate(mask: InvalidateMask): void {\n\t\tif (this._invalidateHandler) {\n\t\t\tthis._invalidateHandler(mask);\n\t\t}\n\n\t\tthis._panes.forEach((pane: Pane) => pane.grid().paneView().update());\n\t}\n\n\tprivate _createSeries<T extends SeriesType>(options: SeriesOptionsInternal<T>, seriesType: T, pane: Pane, customPaneView?: ICustomSeriesPaneView<HorzScaleItem>): Series<T> {\n\t\tconst series = new Series<T>(this, options, seriesType, pane, customPaneView);\n\n\t\tconst targetScaleId = options.priceScaleId !== undefined ? options.priceScaleId : this.defaultVisiblePriceScaleId();\n\t\tpane.addDataSource(series, targetScaleId);\n\n\t\tif (!isDefaultPriceScale(targetScaleId)) {\n\t\t\t// let's apply that options again to apply margins\n\t\t\tseries.applyOptions(options);\n\t\t}\n\n\t\treturn series;\n\t}\n\n\tprivate _getBackgroundColor(side: BackgroundColorSide): string {\n\t\tconst layoutOptions = this._options.layout;\n\n\t\tif (layoutOptions.background.type === ColorType.VerticalGradient) {\n\t\t\treturn side === BackgroundColorSide.Top ?\n\t\t\t\tlayoutOptions.background.topColor :\n\t\t\t\tlayoutOptions.background.bottomColor;\n\t\t}\n\n\t\treturn layoutOptions.background.color;\n\t}\n}\n","import { DeepPartial } from '../helpers/strict-type-checks';\n\nimport { LineStyle, LineType, LineWidth } from '../renderers/draw-line';\n\nimport { AutoScaleMargins } from './autoscale-info-impl';\nimport { PriceFormatterFn } from './price-formatter-fn';\n\n/**\n * Represents style options for a candlestick series.\n */\nexport interface CandlestickStyleOptions {\n\t/**\n\t * Color of rising candles.\n\t *\n\t * @defaultValue `'#26a69a'`\n\t */\n\tupColor: string;\n\n\t/**\n\t * Color of falling candles.\n\t *\n\t * @defaultValue `'#ef5350'`\n\t */\n\tdownColor: string;\n\n\t/**\n\t * Enable high and low prices candle wicks.\n\t *\n\t * @defaultValue `true`\n\t */\n\twickVisible: boolean;\n\n\t/**\n\t * Enable candle borders.\n\t *\n\t * @defaultValue `true`\n\t */\n\tborderVisible: boolean;\n\n\t/**\n\t * Border color.\n\t *\n\t * @defaultValue `'#378658'`\n\t */\n\tborderColor: string;\n\n\t/**\n\t * Border color of rising candles.\n\t *\n\t * @defaultValue `'#26a69a'`\n\t */\n\tborderUpColor: string;\n\n\t/**\n\t * Border color of falling candles.\n\t *\n\t * @defaultValue `'#ef5350'`\n\t */\n\tborderDownColor: string;\n\n\t/**\n\t * Wick color.\n\t *\n\t * @defaultValue `'#737375'`\n\t */\n\twickColor: string;\n\n\t/**\n\t * Wick color of rising candles.\n\t *\n\t * @defaultValue `'#26a69a'`\n\t */\n\twickUpColor: string;\n\n\t/**\n\t * Wick color of falling candles.\n\t *\n\t * @defaultValue `'#ef5350'`\n\t */\n\twickDownColor: string;\n}\n\nexport function fillUpDownCandlesticksColors(options: Partial<CandlestickStyleOptions>): void {\n\tif (options.borderColor !== undefined) {\n\t\toptions.borderUpColor = options.borderColor;\n\t\toptions.borderDownColor = options.borderColor;\n\t}\n\tif (options.wickColor !== undefined) {\n\t\toptions.wickUpColor = options.wickColor;\n\t\toptions.wickDownColor = options.wickColor;\n\t}\n}\n\n/**\n * Represents the type of the last price animation for series such as area or line.\n */\nexport const enum LastPriceAnimationMode {\n\t/**\n\t * Animation is always disabled\n\t */\n\tDisabled,\n\t/**\n\t * Animation is always enabled.\n\t */\n\tContinuous,\n\t/**\n\t * Animation is active after new data.\n\t */\n\tOnDataUpdate,\n}\n\n/**\n * Represents style options for a bar series.\n */\nexport interface BarStyleOptions {\n\t/**\n\t * Color of rising bars.\n\t *\n\t * @defaultValue `'#26a69a'`\n\t */\n\tupColor: string;\n\n\t/**\n\t * Color of falling bars.\n\t *\n\t * @defaultValue `'#ef5350'`\n\t */\n\tdownColor: string;\n\n\t/**\n\t * Show open lines on bars.\n\t *\n\t * @defaultValue `true`\n\t */\n\topenVisible: boolean;\n\n\t/**\n\t * Show bars as sticks.\n\t *\n\t * @defaultValue `true`\n\t */\n\tthinBars: boolean;\n}\n\n/**\n * Represents style options for a line series.\n */\nexport interface LineStyleOptions {\n\t/**\n\t * Line color.\n\t *\n\t * @defaultValue `'#2196f3'`\n\t */\n\tcolor: string;\n\n\t/**\n\t * Line style.\n\t *\n\t * @defaultValue {@link LineStyle.Solid}\n\t */\n\tlineStyle: LineStyle;\n\n\t/**\n\t * Line width in pixels.\n\t *\n\t * @defaultValue `3`\n\t */\n\tlineWidth: LineWidth;\n\n\t/**\n\t * Line type.\n\t *\n\t * @defaultValue {@link LineType.Simple}\n\t */\n\tlineType: LineType;\n\n\t/**\n\t * Show series line.\n\t *\n\t * @defaultValue `true`\n\t */\n\tlineVisible: boolean;\n\n\t/**\n\t * Show circle markers on each point.\n\t *\n\t * @defaultValue `false`\n\t */\n\tpointMarkersVisible: boolean;\n\t/**\n\t * Circle markers radius in pixels.\n\t *\n\t * @defaultValue `undefined`\n\t */\n\tpointMarkersRadius?: number;\n\n\t/**\n\t * Show the crosshair marker.\n\t *\n\t * @defaultValue `true`\n\t */\n\tcrosshairMarkerVisible: boolean;\n\t/**\n\t * Crosshair marker radius in pixels.\n\t *\n\t * @defaultValue `4`\n\t */\n\tcrosshairMarkerRadius: number;\n\t/**\n\t * Crosshair marker border color. An empty string falls back to the color of the series under the crosshair.\n\t *\n\t * @defaultValue `''`\n\t */\n\tcrosshairMarkerBorderColor: string;\n\t/**\n\t * The crosshair marker background color. An empty string falls back to the color of the series under the crosshair.\n\t *\n\t * @defaultValue `''`\n\t */\n\tcrosshairMarkerBackgroundColor: string;\n\t/**\n\t * Crosshair marker border width in pixels.\n\t *\n\t * @defaultValue `2`\n\t */\n\tcrosshairMarkerBorderWidth: number;\n\n\t/**\n\t * Last price animation mode.\n\t *\n\t * @defaultValue {@link LastPriceAnimationMode.Disabled}\n\t */\n\tlastPriceAnimation: LastPriceAnimationMode;\n}\n\n/**\n * Represents style options for an area series.\n */\nexport interface AreaStyleOptions {\n\t/**\n\t * Color of the top part of the area.\n\t *\n\t * @defaultValue `'rgba( 46, 220, 135, 0.4)'`\n\t */\n\ttopColor: string;\n\n\t/**\n\t * Color of the bottom part of the area.\n\t *\n\t * @defaultValue `'rgba( 40, 221, 100, 0)'`\n\t */\n\tbottomColor: string;\n\n\t/**\n\t * Invert the filled area. Fills the area above the line if set to true.\n\t *\n\t * @defaultValue `false`\n\t */\n\tinvertFilledArea: boolean;\n\n\t/**\n\t * Line color.\n\t *\n\t * @defaultValue `'#33D778'`\n\t */\n\tlineColor: string;\n\n\t/**\n\t * Line style.\n\t *\n\t * @defaultValue {@link LineStyle.Solid}\n\t */\n\tlineStyle: LineStyle;\n\n\t/**\n\t * Line width in pixels.\n\t *\n\t * @defaultValue `3`\n\t */\n\tlineWidth: LineWidth;\n\n\t/**\n\t * Line type.\n\t *\n\t * @defaultValue {@link LineType.Simple}\n\t */\n\tlineType: LineType;\n\n\t/**\n\t * Show series line.\n\t *\n\t * @defaultValue `true`\n\t */\n\tlineVisible: boolean;\n\n\t/**\n\t * Show circle markers on each point.\n\t *\n\t * @defaultValue `false`\n\t */\n\tpointMarkersVisible: boolean;\n\t/**\n\t * Circle markers radius in pixels.\n\t *\n\t * @defaultValue `undefined`\n\t */\n\tpointMarkersRadius?: number;\n\n\t/**\n\t * Show the crosshair marker.\n\t *\n\t * @defaultValue `true`\n\t */\n\tcrosshairMarkerVisible: boolean;\n\t/**\n\t * Crosshair marker radius in pixels.\n\t *\n\t * @defaultValue `4`\n\t */\n\tcrosshairMarkerRadius: number;\n\t/**\n\t * Crosshair marker border color. An empty string falls back to the color of the series under the crosshair.\n\t *\n\t * @defaultValue `''`\n\t */\n\tcrosshairMarkerBorderColor: string;\n\t/**\n\t * The crosshair marker background color. An empty string falls back to the color of the series under the crosshair.\n\t *\n\t * @defaultValue `''`\n\t */\n\tcrosshairMarkerBackgroundColor: string;\n\t/**\n\t * Crosshair marker border width in pixels.\n\t *\n\t * @defaultValue `2`\n\t */\n\tcrosshairMarkerBorderWidth: number;\n\n\t/**\n\t * Last price animation mode.\n\t *\n\t * @defaultValue {@link LastPriceAnimationMode.Disabled}\n\t */\n\tlastPriceAnimation: LastPriceAnimationMode;\n}\n\n/**\n * Represents a type of priced base value of baseline series type.\n */\nexport interface BaseValuePrice {\n\t/**\n\t * Distinguished type value.\n\t */\n\ttype: 'price';\n\n\t/**\n\t * Price value.\n\t */\n\tprice: number;\n}\n\n/**\n * Represents a type of a base value of baseline series type.\n */\nexport type BaseValueType = BaseValuePrice;\n\n/**\n * Represents style options for a baseline series.\n */\nexport interface BaselineStyleOptions {\n\t/**\n\t * Base value of the series.\n\t *\n\t * @defaultValue `{ type: 'price', price: 0 }`\n\t */\n\tbaseValue: BaseValueType;\n\n\t/**\n\t * The first color of the top area.\n\t *\n\t * @defaultValue `'rgba(38, 166, 154, 0.28)'`\n\t */\n\ttopFillColor1: string;\n\t/**\n\t * The second color of the top area.\n\t *\n\t * @defaultValue `'rgba(38, 166, 154, 0.05)'`\n\t */\n\ttopFillColor2: string;\n\t/**\n\t * The line color of the top area.\n\t *\n\t * @defaultValue `'rgba(38, 166, 154, 1)'`\n\t */\n\ttopLineColor: string;\n\n\t/**\n\t * The first color of the bottom area.\n\t *\n\t * @defaultValue `'rgba(239, 83, 80, 0.05)'`\n\t */\n\tbottomFillColor1: string;\n\t/**\n\t * The second color of the bottom area.\n\t *\n\t * @defaultValue `'rgba(239, 83, 80, 0.28)'`\n\t */\n\tbottomFillColor2: string;\n\t/**\n\t * The line color of the bottom area.\n\t *\n\t * @defaultValue `'rgba(239, 83, 80, 1)'`\n\t */\n\tbottomLineColor: string;\n\n\t/**\n\t * Line width.\n\t *\n\t * @defaultValue `3`\n\t */\n\tlineWidth: LineWidth;\n\t/**\n\t * Line style.\n\t *\n\t * @defaultValue {@link LineStyle.Solid}\n\t */\n\tlineStyle: LineStyle;\n\t/**\n\t * Line type.\n\t *\n\t * @defaultValue {@link LineType.Simple}\n\t */\n\tlineType: LineType;\n\n\t/**\n\t * Show series line.\n\t *\n\t * @defaultValue `true`\n\t */\n\tlineVisible: boolean;\n\n\t/**\n\t * Show circle markers on each point.\n\t *\n\t * @defaultValue `false`\n\t */\n\tpointMarkersVisible: boolean;\n\t/**\n\t * Circle markers radius in pixels.\n\t *\n\t * @defaultValue `undefined`\n\t */\n\tpointMarkersRadius?: number;\n\n\t/**\n\t * Show the crosshair marker.\n\t *\n\t * @defaultValue `true`\n\t */\n\tcrosshairMarkerVisible: boolean;\n\t/**\n\t * Crosshair marker radius in pixels.\n\t *\n\t * @defaultValue `4`\n\t */\n\tcrosshairMarkerRadius: number;\n\t/**\n\t * Crosshair marker border color. An empty string falls back to the color of the series under the crosshair.\n\t *\n\t * @defaultValue `''`\n\t */\n\tcrosshairMarkerBorderColor: string;\n\t/**\n\t * The crosshair marker background color. An empty string falls back to the color of the series under the crosshair.\n\t *\n\t * @defaultValue `''`\n\t */\n\tcrosshairMarkerBackgroundColor: string;\n\t/**\n\t * Crosshair marker border width in pixels.\n\t *\n\t * @defaultValue `2`\n\t */\n\tcrosshairMarkerBorderWidth: number;\n\n\t/**\n\t * Last price animation mode.\n\t *\n\t * @defaultValue {@link LastPriceAnimationMode.Disabled}\n\t */\n\tlastPriceAnimation: LastPriceAnimationMode;\n}\n\n/**\n * Represents style options for a histogram series.\n */\nexport interface HistogramStyleOptions {\n\t/**\n\t * Column color.\n\t *\n\t * @defaultValue `'#26a69a'`\n\t */\n\tcolor: string;\n\n\t/**\n\t * Initial level of histogram columns.\n\t *\n\t * @defaultValue `0`\n\t */\n\tbase: number;\n}\n\n/**\n * Represents style options for a custom series.\n */\nexport interface CustomStyleOptions {\n\t/**\n\t * Color used for the price line and price scale label.\n\t */\n\tcolor: string;\n}\n\n/**\n * Represents series value formatting options.\n * The precision and minMove properties allow wide customization of formatting.\n *\n * @example\n * `minMove=0.01`, `precision` is not specified - prices will change like 1.13, 1.14, 1.15 etc.\n * @example\n * `minMove=0.01`, `precision=3` - prices will change like 1.130, 1.140, 1.150 etc.\n * @example\n * `minMove=0.05`, `precision` is not specified - prices will change like 1.10, 1.15, 1.20 etc.\n */\nexport interface PriceFormatBuiltIn {\n\t/**\n\t * Built-in price formats:\n\t * - `'price'` is the most common choice; it allows customization of precision and rounding of prices.\n\t * - `'volume'` uses abbreviation for formatting prices like `1.2K` or `12.67M`.\n\t * - `'percent'` uses `%` sign at the end of prices.\n\t */\n\ttype: 'price' | 'volume' | 'percent';\n\n\t/**\n\t * Number of digits after the decimal point.\n\t * If it is not set, then its value is calculated automatically based on minMove.\n\t *\n\t * @defaultValue `2` if both {@link minMove} and {@link precision} are not provided, calculated automatically based on {@link minMove} otherwise.\n\t */\n\tprecision: number;\n\n\t/**\n\t * The minimum possible step size for price value movement. This value shouldn't have more decimal digits than the precision.\n\t *\n\t * @defaultValue `0.01`\n\t */\n\tminMove: number;\n}\n\n/**\n * Represents series value formatting options.\n */\nexport interface PriceFormatCustom {\n\t/**\n\t * The custom price format.\n\t */\n\ttype: 'custom';\n\n\t/**\n\t * Override price formatting behaviour. Can be used for cases that can't be covered with built-in price formats.\n\t */\n\tformatter: PriceFormatterFn;\n\n\t/**\n\t * The minimum possible step size for price value movement.\n\t *\n\t * @defaultValue `0.01`\n\t */\n\tminMove: number;\n}\n\n/**\n * Represents information used to format prices.\n */\nexport type PriceFormat = PriceFormatBuiltIn | PriceFormatCustom;\n\nexport function precisionByMinMove(minMove: number): number {\n\tif (minMove >= 1) {\n\t\treturn 0;\n\t}\n\tlet i = 0;\n\tfor (; i < 8; i++) {\n\t\tconst intPart = Math.round(minMove);\n\t\tconst fractPart = Math.abs(intPart - minMove);\n\t\tif (fractPart < 1e-8) {\n\t\t\treturn i;\n\t\t}\n\t\tminMove = minMove * 10;\n\t}\n\treturn i;\n}\n\nexport const enum PriceAxisLastValueMode {\n\tLastPriceAndPercentageValue,\n\tLastValueAccordingToScale,\n}\n\n/**\n * Represents the source of data to be used for the horizontal price line.\n */\nexport const enum PriceLineSource {\n\t/**\n\t * Use the last bar data.\n\t */\n\tLastBar,\n\t/**\n\t * Use the last visible data of the chart viewport.\n\t */\n\tLastVisible,\n}\n\n/**\n * Represents a price range.\n */\nexport interface PriceRange {\n\t/**\n\t * Maximum value in the range.\n\t */\n\tminValue: number;\n\n\t/**\n\t * Minimum value in the range.\n\t */\n\tmaxValue: number;\n}\n\n/**\n * Represents information used to update a price scale.\n */\nexport interface AutoscaleInfo {\n\t/**\n\t * Price range.\n\t */\n\tpriceRange: PriceRange;\n\n\t/**\n\t * Scale margins.\n\t */\n\tmargins?: AutoScaleMargins;\n}\n\n/**\n * A custom function used to get autoscale information.\n *\n * @param baseImplementation - The default implementation of autoscale algorithm, you can use it to adjust the result.\n */\ntype AutoscaleInfoProvider = (baseImplementation: () => AutoscaleInfo | null) => AutoscaleInfo | null;\n\n/**\n * Represents options common for all types of series\n */\nexport interface SeriesOptionsCommon {\n\t/**\n\t * Visibility of the label with the latest visible price on the price scale.\n\t *\n\t * @defaultValue `true`\n\t */\n\tlastValueVisible: boolean;\n\n\t/**\n\t * You can name series when adding it to a chart. This name will be displayed on the label next to the last value label.\n\t *\n\t * @defaultValue `''`\n\t */\n\ttitle: string;\n\n\t/**\n\t * Target price scale to bind new series to.\n\t *\n\t * @defaultValue `'right'` if right scale is visible and `'left'` otherwise\n\t */\n\tpriceScaleId?: string;\n\n\t/**\n\t * @internal\n\t */\n\tseriesLastValueMode?: PriceAxisLastValueMode;\n\n\t/**\n\t * Visibility of the series.\n\t * If the series is hidden, everything including price lines, baseline, price labels and markers, will also be hidden.\n\t * Please note that hiding a series is not equivalent to deleting it, since hiding does not affect the timeline at all, unlike deleting where the timeline can be changed (some points can be deleted).\n\t *\n\t * @defaultValue `true`\n\t */\n\tvisible: boolean;\n\n\t/**\n\t * Show the price line. Price line is a horizontal line indicating the last price of the series.\n\t *\n\t * @defaultValue `true`\n\t */\n\tpriceLineVisible: boolean;\n\n\t/**\n\t * The source to use for the value of the price line.\n\t *\n\t * @defaultValue {@link PriceLineSource.LastBar}\n\t */\n\tpriceLineSource: PriceLineSource;\n\n\t/**\n\t * Width of the price line.\n\t *\n\t * @defaultValue `1`\n\t */\n\tpriceLineWidth: LineWidth;\n\n\t/**\n\t * Color of the price line.\n\t * By default, its color is set by the last bar color (or by line color on Line and Area charts).\n\t *\n\t * @defaultValue `''`\n\t */\n\tpriceLineColor: string;\n\n\t/**\n\t * Price line style.\n\t *\n\t * @defaultValue {@link LineStyle.Dashed}\n\t */\n\tpriceLineStyle: LineStyle;\n\n\t/**\n\t * Price format.\n\t *\n\t * @defaultValue `{ type: 'price', precision: 2, minMove: 0.01 }`\n\t */\n\tpriceFormat: PriceFormat;\n\n\t/**\n\t * Visibility of base line. Suitable for percentage and `IndexedTo100` scales.\n\t *\n\t * @defaultValue `true`\n\t */\n\tbaseLineVisible: boolean;\n\n\t/**\n\t * Color of the base line in `IndexedTo100` mode.\n\t *\n\t * @defaultValue `'#B2B5BE'`\n\t */\n\tbaseLineColor: string;\n\n\t/**\n\t * Base line width. Suitable for percentage and `IndexedTo10` scales.\n\t *\n\t * @defaultValue `1`\n\t */\n\tbaseLineWidth: LineWidth;\n\n\t/**\n\t * Base line style. Suitable for percentage and indexedTo100 scales.\n\t *\n\t * @defaultValue {@link LineStyle.Solid}\n\t */\n\tbaseLineStyle: LineStyle;\n\n\t/**\n\t * Override the default {@link AutoscaleInfo} provider.\n\t * By default, the chart scales data automatically based on visible data range.\n\t * However, for some reasons one could require overriding this behavior.\n\t *\n\t * @defaultValue `undefined`\n\t * @example Use price range from 0 to 100 regardless the current visible range\n\t * ```js\n\t * const firstSeries = chart.addLineSeries({\n\t *     autoscaleInfoProvider: () => ({\n\t *         priceRange: {\n\t *             minValue: 0,\n\t *             maxValue: 100,\n\t *         },\n\t *     }),\n\t * });\n\t * ```\n\t * @example Adding a small pixel margins to the price range\n\t * ```js\n\t * const firstSeries = chart.addLineSeries({\n\t *     autoscaleInfoProvider: () => ({\n\t *         priceRange: {\n\t *             minValue: 0,\n\t *             maxValue: 100,\n\t *         },\n\t *         margins: {\n\t *             above: 10,\n\t *             below: 10,\n\t *         },\n\t *     }),\n\t * });\n\t * ```\n\t * @example Using the default implementation to adjust the result\n\t * ```js\n\t * const firstSeries = chart.addLineSeries({\n\t *     autoscaleInfoProvider: original => {\n\t *         const res = original();\n\t *         if (res !== null) {\n\t *             res.priceRange.minValue -= 10;\n\t *             res.priceRange.maxValue += 10;\n\t *         }\n\t *         return res;\n\t *     },\n\t * });\n\t * ```\n\t */\n\tautoscaleInfoProvider?: AutoscaleInfoProvider;\n}\n\n/**\n * Represents the intersection of a series type `T`'s options and common series options.\n *\n * @see {@link SeriesOptionsCommon} for common options.\n */\nexport type SeriesOptions<T> = T & SeriesOptionsCommon;\n/**\n * Represents a {@link SeriesOptions} where every property is optional.\n */\nexport type SeriesPartialOptions<T> = DeepPartial<T & SeriesOptionsCommon>;\n\n/**\n * Represents area series options.\n */\nexport type AreaSeriesOptions = SeriesOptions<AreaStyleOptions>;\n/**\n * Represents area series options where all properties are optional.\n */\nexport type AreaSeriesPartialOptions = SeriesPartialOptions<AreaStyleOptions>;\n\n/**\n * Structure describing baseline series options.\n */\nexport type BaselineSeriesOptions = SeriesOptions<BaselineStyleOptions>;\n/**\n * Represents baseline series options where all properties are options.\n */\nexport type BaselineSeriesPartialOptions = SeriesPartialOptions<BaselineStyleOptions>;\n\n/**\n * Represents bar series options.\n */\nexport type BarSeriesOptions = SeriesOptions<BarStyleOptions>;\n/**\n * Represents bar series options where all properties are options.\n */\nexport type BarSeriesPartialOptions = SeriesPartialOptions<BarStyleOptions>;\n\n/**\n * Represents candlestick series options.\n */\nexport type CandlestickSeriesOptions = SeriesOptions<CandlestickStyleOptions>;\n/**\n * Represents candlestick series options where all properties are optional.\n */\nexport type CandlestickSeriesPartialOptions = SeriesPartialOptions<CandlestickStyleOptions>;\n\n/**\n * Represents histogram series options.\n */\nexport type HistogramSeriesOptions = SeriesOptions<HistogramStyleOptions>;\n/**\n * Represents histogram series options where all properties are optional.\n */\nexport type HistogramSeriesPartialOptions = SeriesPartialOptions<HistogramStyleOptions>;\n\n/**\n * Represents a custom series options.\n */\nexport type CustomSeriesOptions = SeriesOptions<CustomStyleOptions>;\n/**\n * Represents a custom series options where all properties are optional.\n */\nexport type CustomSeriesPartialOptions = SeriesPartialOptions<CustomStyleOptions>;\n\n/**\n * Represents line series options.\n */\nexport type LineSeriesOptions = SeriesOptions<LineStyleOptions>;\n/**\n * Represents line series options where all properties are optional.\n */\nexport type LineSeriesPartialOptions = SeriesPartialOptions<LineStyleOptions>;\n\n/**\n * Represents the type of style options for each series type.\n *\n * For example a bar series has style options represented by {@link BarStyleOptions}.\n */\nexport interface SeriesStyleOptionsMap {\n\t/**\n\t * The type of bar style options.\n\t */\n\tBar: BarStyleOptions;\n\t/**\n\t * The type of candlestick style options.\n\t */\n\tCandlestick: CandlestickStyleOptions;\n\t/**\n\t * The type of area style options.\n\t */\n\tArea: AreaStyleOptions;\n\t/**\n\t * The type of baseline style options.\n\t */\n\tBaseline: BaselineStyleOptions;\n\t/**\n\t * The type of line style options.\n\t */\n\tLine: LineStyleOptions;\n\t/**\n\t * The type of histogram style options.\n\t */\n\tHistogram: HistogramStyleOptions;\n\t/**\n\t * The type of a custom series' style options.\n\t */\n\tCustom: CustomStyleOptions;\n}\n\n/**\n * Represents the type of options for each series type.\n *\n * For example a bar series has options represented by {@link BarSeriesOptions}.\n */\nexport interface SeriesOptionsMap {\n\t/**\n\t * The type of bar series options.\n\t */\n\tBar: BarSeriesOptions;\n\t/**\n\t * The type of candlestick series options.\n\t */\n\tCandlestick: CandlestickSeriesOptions;\n\t/**\n\t * The type of area series options.\n\t */\n\tArea: AreaSeriesOptions;\n\t/**\n\t * The type of baseline series options.\n\t */\n\tBaseline: BaselineSeriesOptions;\n\t/**\n\t * The type of line series options.\n\t */\n\tLine: LineSeriesOptions;\n\t/**\n\t * The type of histogram series options.\n\t */\n\tHistogram: HistogramSeriesOptions;\n\t/**\n\t * The type of a custom series options.\n\t */\n\tCustom: CustomSeriesOptions;\n}\n\n/**\n * Represents the type of partial options for each series type.\n *\n * For example a bar series has options represented by {@link BarSeriesPartialOptions}.\n */\nexport interface SeriesPartialOptionsMap {\n\t/**\n\t * The type of bar series partial options.\n\t */\n\tBar: BarSeriesPartialOptions;\n\t/**\n\t * The type of candlestick series partial options.\n\t */\n\tCandlestick: CandlestickSeriesPartialOptions;\n\t/**\n\t * The type of area series partial options.\n\t */\n\tArea: AreaSeriesPartialOptions;\n\t/**\n\t * The type of baseline series partial options.\n\t */\n\tBaseline: BaselineSeriesPartialOptions;\n\t/**\n\t * The type of line series partial options.\n\t */\n\tLine: LineSeriesPartialOptions;\n\t/**\n\t * The type of histogram series partial options.\n\t */\n\tHistogram: HistogramSeriesPartialOptions;\n\t/**\n\t * The type of a custom series partial options.\n\t */\n\tCustom: CustomSeriesPartialOptions;\n}\n\n/**\n * Represents a type of series.\n *\n * @see {@link SeriesOptionsMap}\n */\nexport type SeriesType = keyof SeriesOptionsMap;\n","/**\n * Represents a type of color.\n */\nexport const enum ColorType {\n\t/** Solid color */\n\tSolid = 'solid',\n\t/** Vertical gradient color */\n\tVerticalGradient = 'gradient',\n}\n\n/**\n * Represents a solid color.\n */\nexport interface SolidColor {\n\t/**\n\t * Type of color.\n\t */\n\ttype: ColorType.Solid;\n\n\t/**\n\t * Color.\n\t */\n\tcolor: string;\n}\n\n/**\n * Represents a vertical gradient of two colors.\n */\nexport interface VerticalGradientColor {\n\t/**\n\t * Type of color.\n\t */\n\ttype: ColorType.VerticalGradient;\n\n\t/**\n\t * Top color\n\t */\n\ttopColor: string;\n\n\t/**\n\t * Bottom color\n\t */\n\tbottomColor: string;\n}\n\n/**\n * Represents the background color of the chart.\n */\nexport type Background = SolidColor | VerticalGradientColor;\n\n/** Represents layout options */\nexport interface LayoutOptions {\n\t/**\n\t * Chart and scales background color.\n\t *\n\t * @defaultValue `{ type: ColorType.Solid, color: '#FFFFFF' }`\n\t */\n\tbackground: Background;\n\n\t/**\n\t * Color of text on the scales.\n\t *\n\t * @defaultValue `'#191919'`\n\t */\n\ttextColor: string;\n\n\t/**\n\t * Font size of text on scales in pixels.\n\t *\n\t * @defaultValue `12`\n\t */\n\tfontSize: number;\n\n\t/**\n\t * Font family of text on the scales.\n\t *\n\t * @defaultValue `-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif`\n\t */\n\tfontFamily: string;\n}\n","import { Nominal } from '../../helpers/nominal';\nimport { isNumber, isString } from '../../helpers/strict-type-checks';\n\n/**\n * Represents a time as a UNIX timestamp.\n *\n * If your chart displays an intraday interval you should use a UNIX Timestamp.\n *\n * Note that JavaScript Date APIs like `Date.now` return a number of milliseconds but UTCTimestamp expects a number of seconds.\n *\n * Note that to prevent errors, you should cast the numeric type of the time to `UTCTimestamp` type from the package (`value as UTCTimestamp`) in TypeScript code.\n *\n * @example\n * ```ts\n * const timestamp = 1529899200 as UTCTimestamp; // Literal timestamp representing 2018-06-25T04:00:00.000Z\n * const timestamp2 = (Date.now() / 1000) as UTCTimestamp;\n * ```\n */\nexport type UTCTimestamp = Nominal<number, 'UTCTimestamp'>;\n\n/**\n * Represents a time as a day/month/year.\n *\n * @example\n * ```js\n * const day = { year: 2019, month: 6, day: 1 }; // June 1, 2019\n * ```\n */\nexport interface BusinessDay {\n\t/**\n\t * The year.\n\t */\n\tyear: number;\n\t/**\n\t * The month.\n\t */\n\tmonth: number;\n\t/**\n\t * The day.\n\t */\n\tday: number;\n}\n\n/**\n * The Time type is used to represent the time of data items.\n *\n * Values can be a {@link UTCTimestamp}, a {@link BusinessDay}, or a business day string in ISO format.\n *\n * @example\n * ```js\n * const timestamp = 1529899200; // Literal timestamp representing 2018-06-25T04:00:00.000Z\n * const businessDay = { year: 2019, month: 6, day: 1 }; // June 1, 2019\n * const businessDayString = '2021-02-03'; // Business day string literal\n * ```\n */\nexport type Time = UTCTimestamp | BusinessDay | string;\n\nexport interface TimePoint {\n\ttimestamp: UTCTimestamp;\n\tbusinessDay?: BusinessDay;\n}\n\n/**\n * Check if a time value is a business day object.\n *\n * @param time - The time to check.\n * @returns `true` if `time` is a {@link BusinessDay} object, false otherwise.\n */\nexport function isBusinessDay(time: Time): time is BusinessDay {\n\treturn !isNumber(time) && !isString(time);\n}\n\n/**\n * Check if a time value is a UTC timestamp number.\n *\n * @param time - The time to check.\n * @returns `true` if `time` is a {@link UTCTimestamp} number, false otherwise.\n */\nexport function isUTCTimestamp(time: Time): time is UTCTimestamp {\n\treturn isNumber(time);\n}\n\n/**\n * Represents the type of a tick mark on the time axis.\n */\nexport const enum TickMarkType {\n\t/**\n\t * The start of the year (e.g. it's the first tick mark in a year).\n\t */\n\tYear,\n\t/**\n\t * The start of the month (e.g. it's the first tick mark in a month).\n\t */\n\tMonth,\n\t/**\n\t * A day of the month.\n\t */\n\tDayOfMonth,\n\t/**\n\t * A time without seconds.\n\t */\n\tTime,\n\t/**\n\t * A time with seconds.\n\t */\n\tTimeWithSeconds,\n}\n\n/**\n * Describes a weight of tick mark, i.e. a part of a time that changed since previous time.\n * Note that you can use any timezone to calculate this value, it is unnecessary to use UTC.\n *\n * @example Between 2020-01-01 and 2020-01-02 there is a day of difference, i.e. for 2020-01-02 weight would be a day.\n * @example Between 2020-01-01 and 2020-02-02 there is a month of difference, i.e. for 2020-02-02 weight would be a month.\n */\nexport const enum TickMarkWeight {\n\tLessThanSecond = 0,\n\tSecond = 10,\n\tMinute1 = 20,\n\tMinute5 = 21,\n\tMinute30 = 22,\n\tHour1 = 30,\n\tHour3 = 31,\n\tHour6 = 32,\n\tHour12 = 33,\n\tDay = 50,\n\tMonth = 60,\n\tYear = 70,\n}\n","import { numberToStringWithLeadingZero as numToStr } from './price-formatter';\n\nconst getMonth = (date: Date) => date.getUTCMonth() + 1;\nconst getDay = (date: Date) => date.getUTCDate();\nconst getYear = (date: Date) => date.getUTCFullYear();\n\nconst dd = (date: Date) => numToStr(getDay(date), 2);\nconst MMMM = (date: Date, locale: string) => new Date(date.getUTCFullYear(), date.getUTCMonth(), 1)\n\t.toLocaleString(locale, { month: 'long' });\nconst MMM = (date: Date, locale: string) => new Date(date.getUTCFullYear(), date.getUTCMonth(), 1)\n\t.toLocaleString(locale, { month: 'short' });\nconst MM = (date: Date) => numToStr(getMonth(date), 2);\nconst yy = (date: Date) => numToStr(getYear(date) % 100, 2);\nconst yyyy = (date: Date) => numToStr(getYear(date), 4);\n\nexport function formatDate(date: Date, format: string, locale: string): string {\n\treturn format\n\t\t.replace(/yyyy/g, yyyy(date))\n\t\t.replace(/yy/g, yy(date))\n\t\t.replace(/MMMM/g, MMMM(date, locale))\n\t\t.replace(/MMM/g, MMM(date, locale))\n\t\t.replace(/MM/g, MM(date))\n\t\t.replace(/dd/g, dd(date))\n\t;\n}\n","import { formatDate } from './format-date';\n\nexport class DateFormatter {\n\tprivate readonly _locale: string;\n\tprivate readonly _dateFormat: string;\n\n\tpublic constructor(dateFormat: string = 'yyyy-MM-dd', locale: string = 'default') {\n\t\tthis._dateFormat = dateFormat;\n\t\tthis._locale = locale;\n\t}\n\n\tpublic format(date: Date): string {\n\t\treturn formatDate(date, this._dateFormat, this._locale);\n\t}\n}\n","import { numberToStringWithLeadingZero } from './price-formatter';\n\nexport class TimeFormatter {\n\tprivate _formatStr: string;\n\n\tpublic constructor(format?: string) {\n\t\tthis._formatStr = format || '%h:%m:%s';\n\t}\n\n\tpublic format(date: Date): string {\n\t\treturn this._formatStr.replace('%h', numberToStringWithLeadingZero(date.getUTCHours(), 2)).\n\t\t\treplace('%m', numberToStringWithLeadingZero(date.getUTCMinutes(), 2)).\n\t\t\treplace('%s', numberToStringWithLeadingZero(date.getUTCSeconds(), 2));\n\t}\n}\n","import { DateFormatter } from './date-formatter';\nimport { TimeFormatter } from './time-formatter';\n\nexport interface DateTimeFormatterParams {\n\tdateFormat: string;\n\ttimeFormat: string;\n\tdateTimeSeparator: string;\n\tlocale: string;\n}\n\nconst defaultParams: DateTimeFormatterParams = {\n\tdateFormat: 'yyyy-MM-dd',\n\ttimeFormat: '%h:%m:%s',\n\tdateTimeSeparator: ' ',\n\tlocale: 'default',\n};\n\nexport class DateTimeFormatter {\n\tprivate readonly _dateFormatter: DateFormatter;\n\tprivate readonly _timeFormatter: TimeFormatter;\n\tprivate readonly _separator: string;\n\n\tpublic constructor(params: Partial<DateTimeFormatterParams> = {}) {\n\t\tconst formatterParams: DateTimeFormatterParams = { ...defaultParams, ...params };\n\t\tthis._dateFormatter = new DateFormatter(formatterParams.dateFormat, formatterParams.locale);\n\t\tthis._timeFormatter = new TimeFormatter(formatterParams.timeFormat);\n\t\tthis._separator = formatterParams.dateTimeSeparator;\n\t}\n\n\tpublic format(dateTime: Date): string {\n\t\treturn `${this._dateFormatter.format(dateTime)}${this._separator}${this._timeFormatter.format(dateTime)}`;\n\t}\n}\n","import { ensureNever } from '../../helpers/assertions';\n\nimport { TickMarkType, TimePoint } from './types';\n\nexport function defaultTickMarkFormatter(timePoint: TimePoint, tickMarkType: TickMarkType, locale: string): string {\n\tconst formatOptions: Intl.DateTimeFormatOptions = {};\n\n\tswitch (tickMarkType) {\n\t\tcase TickMarkType.Year:\n\t\t\tformatOptions.year = 'numeric';\n\t\t\tbreak;\n\n\t\tcase TickMarkType.Month:\n\t\t\tformatOptions.month = 'short';\n\t\t\tbreak;\n\n\t\tcase TickMarkType.DayOfMonth:\n\t\t\tformatOptions.day = 'numeric';\n\t\t\tbreak;\n\n\t\tcase TickMarkType.Time:\n\t\t\tformatOptions.hour12 = false;\n\t\t\tformatOptions.hour = '2-digit';\n\t\t\tformatOptions.minute = '2-digit';\n\t\t\tbreak;\n\n\t\tcase TickMarkType.TimeWithSeconds:\n\t\t\tformatOptions.hour12 = false;\n\t\t\tformatOptions.hour = '2-digit';\n\t\t\tformatOptions.minute = '2-digit';\n\t\t\tformatOptions.second = '2-digit';\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tensureNever(tickMarkType);\n\t}\n\n\tconst date = timePoint.businessDay === undefined\n\t\t? new Date(timePoint.timestamp * 1000)\n\t\t: new Date(Date.UTC(timePoint.businessDay.year, timePoint.businessDay.month - 1, timePoint.businessDay.day));\n\n\t// from given date we should use only as UTC date or timestamp\n\t// but to format as locale date we can convert UTC date to local date\n\tconst localDateFromUtc = new Date(\n\t\tdate.getUTCFullYear(),\n\t\tdate.getUTCMonth(),\n\t\tdate.getUTCDate(),\n\t\tdate.getUTCHours(),\n\t\tdate.getUTCMinutes(),\n\t\tdate.getUTCSeconds(),\n\t\tdate.getUTCMilliseconds()\n\t);\n\n\treturn localDateFromUtc.toLocaleString(locale, formatOptions);\n}\n","import { Mutable } from '../../helpers/mutable';\n\nimport { InternalHorzScaleItem } from '../ihorz-scale-behavior';\nimport { TickMarkWeightValue, TimeScalePoint } from '../time-data';\nimport { TickMarkWeight, TimePoint } from './types';\n\nfunction hours(count: number): number {\n\treturn count * 60 * 60 * 1000;\n}\n\nfunction minutes(count: number): number {\n\treturn count * 60 * 1000;\n}\n\nfunction seconds(count: number): number {\n\treturn count * 1000;\n}\n\ninterface WeightDivisor {\n\tdivisor: number;\n\tweight: TickMarkWeight;\n}\n\nconst intradayWeightDivisors: WeightDivisor[] = [\n\t{ divisor: seconds(1), weight: TickMarkWeight.Second },\n\t{ divisor: minutes(1), weight: TickMarkWeight.Minute1 },\n\t{ divisor: minutes(5), weight: TickMarkWeight.Minute5 },\n\t{ divisor: minutes(30), weight: TickMarkWeight.Minute30 },\n\t{ divisor: hours(1), weight: TickMarkWeight.Hour1 },\n\t{ divisor: hours(3), weight: TickMarkWeight.Hour3 },\n\t{ divisor: hours(6), weight: TickMarkWeight.Hour6 },\n\t{ divisor: hours(12), weight: TickMarkWeight.Hour12 },\n];\n\nfunction weightByTime(currentDate: Date, prevDate: Date): TickMarkWeight {\n\tif (currentDate.getUTCFullYear() !== prevDate.getUTCFullYear()) {\n\t\treturn TickMarkWeight.Year;\n\t} else if (currentDate.getUTCMonth() !== prevDate.getUTCMonth()) {\n\t\treturn TickMarkWeight.Month;\n\t} else if (currentDate.getUTCDate() !== prevDate.getUTCDate()) {\n\t\treturn TickMarkWeight.Day;\n\t}\n\n\tfor (let i = intradayWeightDivisors.length - 1; i >= 0; --i) {\n\t\tif (Math.floor(prevDate.getTime() / intradayWeightDivisors[i].divisor) !== Math.floor(currentDate.getTime() / intradayWeightDivisors[i].divisor)) {\n\t\t\treturn intradayWeightDivisors[i].weight;\n\t\t}\n\t}\n\n\treturn TickMarkWeight.LessThanSecond;\n}\n\nfunction cast(t: InternalHorzScaleItem): TimePoint {\n\treturn t as unknown as TimePoint;\n}\n\nexport function fillWeightsForPoints(sortedTimePoints: readonly Mutable<TimeScalePoint>[], startIndex: number = 0): void {\n\tif (sortedTimePoints.length === 0) {\n\t\treturn;\n\t}\n\n\tlet prevTime = startIndex === 0 ? null : cast(sortedTimePoints[startIndex - 1].time).timestamp;\n\tlet prevDate = prevTime !== null ? new Date(prevTime * 1000) : null;\n\n\tlet totalTimeDiff = 0;\n\n\tfor (let index = startIndex; index < sortedTimePoints.length; ++index) {\n\t\tconst currentPoint = sortedTimePoints[index];\n\t\tconst currentDate = new Date(cast(currentPoint.time).timestamp * 1000);\n\n\t\tif (prevDate !== null) {\n\t\t\tcurrentPoint.timeWeight = weightByTime(currentDate, prevDate) as TickMarkWeightValue;\n\t\t}\n\n\t\ttotalTimeDiff += cast(currentPoint.time).timestamp - (prevTime || cast(currentPoint.time).timestamp);\n\n\t\tprevTime = cast(currentPoint.time).timestamp;\n\t\tprevDate = currentDate;\n\t}\n\n\tif (startIndex === 0 && sortedTimePoints.length > 1) {\n\t\t// let's guess a weight for the first point\n\t\t// let's say the previous point was average time back in the history\n\t\tconst averageTimeDiff = Math.ceil(totalTimeDiff / (sortedTimePoints.length - 1));\n\t\tconst approxPrevDate = new Date((cast(sortedTimePoints[0].time).timestamp - averageTimeDiff) * 1000);\n\t\tsortedTimePoints[0].timeWeight = weightByTime(new Date(cast(sortedTimePoints[0].time).timestamp * 1000), approxPrevDate) as TickMarkWeightValue;\n\t}\n}\n","import { DateFormatter } from '../../formatters/date-formatter';\nimport { DateTimeFormatter } from '../../formatters/date-time-formatter';\n\nimport { ensureNotNull } from '../../helpers/assertions';\nimport { Mutable } from '../../helpers/mutable';\nimport { DeepPartial, isString, merge } from '../../helpers/strict-type-checks';\n\nimport { SeriesDataItemTypeMap } from '../data-consumer';\nimport { TimedData } from '../data-layer';\nimport { DataItem, HorzScaleItemConverterToInternalObj, IHorzScaleBehavior, InternalHorzScaleItem, InternalHorzScaleItemKey } from '../ihorz-scale-behavior';\nimport { LocalizationOptions } from '../localization-options';\nimport { SeriesType } from '../series-options';\nimport { TickMark } from '../tick-marks';\nimport { TickMarkWeightValue, TimeScalePoint } from '../time-data';\nimport { markWithGreaterWeight, TimeMark } from '../time-scale';\nimport { defaultTickMarkFormatter } from './default-tick-mark-formatter';\nimport { TimeChartOptions } from './time-based-chart-options';\nimport { fillWeightsForPoints } from './time-scale-point-weight-generator';\nimport { BusinessDay, isBusinessDay, isUTCTimestamp, TickMarkType, TickMarkWeight, Time, TimePoint, UTCTimestamp } from './types';\n\ntype TimeConverter = (time: Time) => InternalHorzScaleItem;\n\nfunction businessDayConverter(time: Time): InternalHorzScaleItem {\n\tlet businessDay = time;\n\tif (isString(time)) {\n\t\tbusinessDay = stringToBusinessDay(time);\n\t}\n\tif (!isBusinessDay(businessDay)) {\n\t\tthrow new Error('time must be of type BusinessDay');\n\t}\n\n\tconst date = new Date(Date.UTC(businessDay.year, businessDay.month - 1, businessDay.day, 0, 0, 0, 0));\n\n\treturn {\n\t\ttimestamp: Math.round(date.getTime() / 1000) as UTCTimestamp,\n\t\tbusinessDay,\n\t} as unknown as InternalHorzScaleItem;\n}\n\nfunction timestampConverter(time: Time): InternalHorzScaleItem {\n\tif (!isUTCTimestamp(time)) {\n\t\tthrow new Error('time must be of type isUTCTimestamp');\n\t}\n\treturn {\n\t\ttimestamp: time,\n\t} as unknown as InternalHorzScaleItem;\n}\n\nfunction selectTimeConverter(data: TimedData<Time>[]): TimeConverter | null {\n\tif (data.length === 0) {\n\t\treturn null;\n\t}\n\tif (isBusinessDay(data[0].time) || isString(data[0].time)) {\n\t\treturn businessDayConverter;\n\t}\n\treturn timestampConverter;\n}\n\nconst validDateRegex = /^\\d\\d\\d\\d-\\d\\d-\\d\\d$/;\n\nexport function convertTime(time: Time): InternalHorzScaleItem {\n\tif (isUTCTimestamp(time)) {\n\t\treturn timestampConverter(time);\n\t}\n\n\tif (!isBusinessDay(time)) {\n\t\treturn businessDayConverter(stringToBusinessDay(time));\n\t}\n\n\treturn businessDayConverter(time);\n}\n\nexport function stringToBusinessDay(value: string): BusinessDay {\n\tif (process.env.NODE_ENV === 'development') {\n\t\t// in some browsers (I look at your Chrome) the Date constructor may accept invalid date string\n\t\t// but parses them in 'implementation specific' way\n\t\t// for example 2019-1-1 isn't the same as 2019-01-01 (for Chrome both are 'valid' date strings)\n\t\t// see https://bugs.chromium.org/p/chromium/issues/detail?id=968939\n\t\t// so, we need to be sure that date has valid format to avoid strange behavior and hours of debugging\n\t\t// but let's do this in development build only because of perf\n\t\tif (!validDateRegex.test(value)) {\n\t\t\tthrow new Error(`Invalid date string=${value}, expected format=yyyy-mm-dd`);\n\t\t}\n\t}\n\n\tconst d = new Date(value);\n\tif (isNaN(d.getTime())) {\n\t\tthrow new Error(`Invalid date string=${value}, expected format=yyyy-mm-dd`);\n\t}\n\n\treturn {\n\t\tday: d.getUTCDate(),\n\t\tmonth: d.getUTCMonth() + 1,\n\t\tyear: d.getUTCFullYear(),\n\t};\n}\n\nfunction convertStringToBusinessDay(value: TimedData<Time>): void {\n\tif (isString(value.time)) {\n\t\tvalue.time = stringToBusinessDay(value.time);\n\t}\n}\n\nfunction convertStringsToBusinessDays(data: TimedData<Time>[]): void {\n\treturn data.forEach(convertStringToBusinessDay);\n}\n\ninterface TimeLocalizationOptions extends LocalizationOptions<Time> {\n\tdateFormat: string;\n}\n\n/**\n * The `TickMarkFormatter` is used to customize tick mark labels on the time scale.\n *\n * This function should return `time` as a string formatted according to `tickMarkType` type (year, month, etc) and `locale`.\n *\n * Note that the returned string should be the shortest possible value and should have no more than 8 characters.\n * Otherwise, the tick marks will overlap each other.\n *\n * If the formatter function returns `null` then the default tick mark formatter will be used as a fallback.\n *\n * @example\n * ```js\n * const customFormatter = (time, tickMarkType, locale) => {\n *     // your code here\n * };\n * ```\n */\nexport type TickMarkFormatter = (time: Time, tickMarkType: TickMarkType, locale: string) => string | null;\n\n// eslint-disable-next-line complexity\nfunction weightToTickMarkType(weight: TickMarkWeight, timeVisible: boolean, secondsVisible: boolean): TickMarkType {\n\tswitch (weight) {\n\t\tcase TickMarkWeight.LessThanSecond:\n\t\tcase TickMarkWeight.Second:\n\t\t\treturn timeVisible\n\t\t\t\t? (secondsVisible ? TickMarkType.TimeWithSeconds : TickMarkType.Time)\n\t\t\t\t: TickMarkType.DayOfMonth;\n\n\t\tcase TickMarkWeight.Minute1:\n\t\tcase TickMarkWeight.Minute5:\n\t\tcase TickMarkWeight.Minute30:\n\t\tcase TickMarkWeight.Hour1:\n\t\tcase TickMarkWeight.Hour3:\n\t\tcase TickMarkWeight.Hour6:\n\t\tcase TickMarkWeight.Hour12:\n\t\t\treturn timeVisible ? TickMarkType.Time : TickMarkType.DayOfMonth;\n\n\t\tcase TickMarkWeight.Day:\n\t\t\treturn TickMarkType.DayOfMonth;\n\n\t\tcase TickMarkWeight.Month:\n\t\t\treturn TickMarkType.Month;\n\n\t\tcase TickMarkWeight.Year:\n\t\t\treturn TickMarkType.Year;\n\t}\n}\n\nexport class HorzScaleBehaviorTime implements IHorzScaleBehavior<Time> {\n\tprivate _dateTimeFormatter!: DateFormatter | DateTimeFormatter;\n\tprivate _options!: TimeChartOptions;\n\n\tpublic options(): TimeChartOptions {\n\t\treturn this._options;\n\t}\n\n\tpublic setOptions(options: TimeChartOptions): void {\n\t\tthis._options = options;\n\t\tthis.updateFormatter(options.localization as TimeLocalizationOptions);\n\t}\n\n\tpublic preprocessData(data: DataItem<Time> | DataItem<Time>[]): void {\n\t\tif (Array.isArray(data)) {\n\t\t\tconvertStringsToBusinessDays(data);\n\t\t} else {\n\t\t\tconvertStringToBusinessDay(data);\n\t\t}\n\t}\n\n\tpublic createConverterToInternalObj(data: SeriesDataItemTypeMap<Time>[SeriesType][]): HorzScaleItemConverterToInternalObj<Time> {\n\t\treturn ensureNotNull(selectTimeConverter(data));\n\t}\n\n\tpublic key(item: InternalHorzScaleItem | Time): InternalHorzScaleItemKey {\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tif (typeof item === 'object' && 'timestamp' in item) {\n\t\t\treturn (item as unknown as TimePoint).timestamp as unknown as InternalHorzScaleItemKey;\n\t\t} else {\n\t\t\treturn this.key(this.convertHorzItemToInternal(item as Time));\n\t\t}\n\t}\n\n\tpublic cacheKey(item: InternalHorzScaleItem): number {\n\t\tconst time = item as unknown as TimePoint;\n\t\treturn time.businessDay === undefined\n\t\t\t? new Date(time.timestamp * 1000).getTime()\n\t\t\t: new Date(Date.UTC(time.businessDay.year, time.businessDay.month - 1, time.businessDay.day)).getTime();\n\t}\n\n\tpublic convertHorzItemToInternal(item: Time): InternalHorzScaleItem {\n\t\treturn convertTime(item);\n\t}\n\n\tpublic updateFormatter(options: TimeLocalizationOptions): void {\n\t\tif (!this._options) {\n\t\t\treturn;\n\t\t}\n\t\tconst dateFormat = options.dateFormat;\n\n\t\tif (this._options.timeScale.timeVisible) {\n\t\t\tthis._dateTimeFormatter = new DateTimeFormatter({\n\t\t\t\tdateFormat: dateFormat,\n\t\t\t\ttimeFormat: this._options.timeScale.secondsVisible ? '%h:%m:%s' : '%h:%m',\n\t\t\t\tdateTimeSeparator: '   ',\n\t\t\t\tlocale: options.locale,\n\t\t\t});\n\t\t} else {\n\t\t\tthis._dateTimeFormatter = new DateFormatter(dateFormat, options.locale);\n\t\t}\n\t}\n\n\tpublic formatHorzItem(item: InternalHorzScaleItem): string {\n\t\tconst tp = item as unknown as TimePoint;\n\t\treturn this._dateTimeFormatter.format(new Date(tp.timestamp * 1000));\n\t}\n\n\tpublic formatTickmark(tickMark: TickMark, localizationOptions: LocalizationOptions<Time>): string {\n\t\tconst tickMarkType = weightToTickMarkType(tickMark.weight, this._options.timeScale.timeVisible, this._options.timeScale.secondsVisible);\n\n\t\tconst options = this._options.timeScale;\n\n\t\tif (options.tickMarkFormatter !== undefined) {\n\t\t\tconst tickMarkString = options.tickMarkFormatter(\n\t\t\t\ttickMark.originalTime as Time,\n\t\t\t\ttickMarkType,\n\t\t\t\tlocalizationOptions.locale\n\t\t\t);\n\t\t\tif (tickMarkString !== null) {\n\t\t\t\treturn tickMarkString;\n\t\t\t}\n\t\t}\n\n\t\treturn defaultTickMarkFormatter(tickMark.time as unknown as TimePoint, tickMarkType, localizationOptions.locale);\n\t}\n\n\tpublic maxTickMarkWeight(tickMarks: TimeMark[]): TickMarkWeightValue {\n\t\tlet maxWeight = tickMarks.reduce(markWithGreaterWeight, tickMarks[0]).weight;\n\n\t\t// special case: it looks strange if 15:00 is bold but 14:00 is not\n\t\t// so if maxWeight > TickMarkWeight.Hour1 and < TickMarkWeight.Day reduce it to TickMarkWeight.Hour1\n\t\tif (maxWeight > TickMarkWeight.Hour1 && maxWeight < TickMarkWeight.Day) {\n\t\t\tmaxWeight = TickMarkWeight.Hour1 as TickMarkWeightValue;\n\t\t}\n\t\treturn maxWeight;\n\t}\n\n\tpublic fillWeightsForPoints(sortedTimePoints: readonly Mutable<TimeScalePoint>[], startIndex: number): void {\n\t\tfillWeightsForPoints(sortedTimePoints, startIndex);\n\t}\n\n\tpublic static applyDefaults(options?: DeepPartial<TimeChartOptions>): DeepPartial<TimeChartOptions> {\n\t\treturn merge({ localization: { dateFormat: 'dd MMM \\'yy' } }, options ?? {});\n\t}\n}\n","/**\n * When you're trying to use the library in server-side context (for instance in SSR)\n * you don't have some browser-specific variables like navigator or window\n * and if the library will use them on the top level of the library\n * the import will fail due ReferenceError\n * thus, this allows use the navigator on the top level and being imported in server-side context as well\n * See issue #446\n */\n// eslint-disable-next-line @typescript-eslint/tslint/config\nexport const isRunningOnClientSide = typeof window !== 'undefined';\n","import { isRunningOnClientSide } from './is-running-on-client-side';\n\nexport function isFF(): boolean {\n\tif (!isRunningOnClientSide) {\n\t\treturn false;\n\t}\n\treturn window.navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n}\n\nexport function isIOS(): boolean {\n\tif (!isRunningOnClientSide) {\n\t\treturn false;\n\t}\n\t// eslint-disable-next-line deprecation/deprecation\n\treturn /iPhone|iPad|iPod/.test(window.navigator.platform);\n}\n\nexport function isChrome(): boolean {\n\tif (!isRunningOnClientSide) {\n\t\treturn false;\n\t}\n\treturn window.chrome !== undefined;\n}\n\n// Determine whether the browser is running on windows.\nexport function isWindows(): boolean {\n\tif (!isRunningOnClientSide) {\n\t\treturn false;\n\t}\n\t// more accurate if available\n\tif (\n\t\tnavigator?.userAgentData?.platform\n\t) {\n\t\treturn navigator.userAgentData.platform === 'Windows';\n\t}\n\treturn navigator.userAgent.toLowerCase().indexOf('win') >= 0;\n}\n\n// Determine whether the browser is Chromium based.\nexport function isChromiumBased(): boolean {\n\tif (!isRunningOnClientSide) {\n\t\treturn false;\n\t}\n\tif (!navigator.userAgentData) { return false; }\n\treturn navigator.userAgentData.brands.some(\n\t\t(brand: UADataBrand) => {\n\t\t\treturn brand.brand.includes('Chromium');\n\t\t}\n\t);\n}\n","/// <reference types=\"_build-time-constants\" />\n\nexport function warn(msg: string): void {\n\tif (process.env.NODE_ENV === 'development') {\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.warn(msg);\n\t}\n}\n","import { Size, size } from 'fancy-canvas';\n\n// on Hi-DPI CSS size * Device Pixel Ratio should be integer to avoid smoothing\n// For chart widget we decrease the size because we must be inside container.\n// For time axis this is not important, since it just affects space for pane widgets\nexport function suggestChartSize(originalSize: Size): Size {\n\tconst integerWidth = Math.floor(originalSize.width);\n\tconst integerHeight = Math.floor(originalSize.height);\n\tconst width = integerWidth - (integerWidth % 2);\n\tconst height = integerHeight - (integerHeight % 2);\n\treturn size({ width, height });\n}\n\nexport function suggestTimeScaleHeight(originalHeight: number): number {\n\treturn originalHeight + (originalHeight % 2);\n}\n\nexport function suggestPriceScaleWidth(originalWidth: number): number {\n\treturn originalWidth + (originalWidth % 2);\n}\n","import { ensureNotNull } from '../helpers/assertions';\n\nimport { Coordinate } from '../model/coordinate';\n\ninterface TimeAndPosition {\n\ttime: number;\n\tposition: Coordinate;\n}\n\nconst enum Constants {\n\tMaxStartDelay = 50,\n\tEpsilonDistance = 1, // distance to the end position where we stop animation\n}\n\nfunction distanceBetweenPoints(pos1: TimeAndPosition, pos2: TimeAndPosition): number {\n\treturn pos1.position - pos2.position;\n}\n\nfunction speedPxPerMSec(pos1: TimeAndPosition, pos2: TimeAndPosition, maxSpeed: number): number {\n\tconst speed = (pos1.position - pos2.position) / (pos1.time - pos2.time);\n\treturn Math.sign(speed) * Math.min(Math.abs(speed), maxSpeed);\n}\n\nfunction durationMSec(speed: number, dumpingCoeff: number): number {\n\tconst lnDumpingCoeff = Math.log(dumpingCoeff);\n\treturn Math.log((Constants.EpsilonDistance * lnDumpingCoeff) / -speed) / (lnDumpingCoeff);\n}\n\nexport class KineticAnimation {\n\tprivate _position1: TimeAndPosition | null = null;\n\tprivate _position2: TimeAndPosition | null = null;\n\tprivate _position3: TimeAndPosition | null = null;\n\tprivate _position4: TimeAndPosition | null = null;\n\n\tprivate _animationStartPosition: TimeAndPosition | null = null;\n\tprivate _durationMsecs: number = 0;\n\tprivate _speedPxPerMsec: number = 0;\n\n\tprivate readonly _minMove: number;\n\tprivate readonly _minSpeed: number;\n\tprivate readonly _maxSpeed: number;\n\tprivate readonly _dumpingCoeff: number;\n\n\tpublic constructor(minSpeed: number, maxSpeed: number, dumpingCoeff: number, minMove: number) {\n\t\tthis._minSpeed = minSpeed;\n\t\tthis._maxSpeed = maxSpeed;\n\t\tthis._dumpingCoeff = dumpingCoeff;\n\t\tthis._minMove = minMove;\n\t}\n\n\tpublic addPosition(position: Coordinate, time: number): void {\n\t\tif (this._position1 !== null) {\n\t\t\tif (this._position1.time === time) {\n\t\t\t\tthis._position1.position = position;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (Math.abs(this._position1.position - position) < this._minMove) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis._position4 = this._position3;\n\t\tthis._position3 = this._position2;\n\t\tthis._position2 = this._position1;\n\t\tthis._position1 = { time, position };\n\t}\n\n\tpublic start(position: Coordinate, time: number): void {\n\t\tif (this._position1 === null || this._position2 === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (time - this._position1.time > Constants.MaxStartDelay) {\n\t\t\treturn;\n\t\t}\n\n\t\t// To calculate all the rest parameters we should calculate the speed af first\n\t\tlet totalDistance = 0;\n\n\t\tconst speed1 = speedPxPerMSec(this._position1, this._position2, this._maxSpeed);\n\t\tconst distance1 = distanceBetweenPoints(this._position1, this._position2);\n\n\t\t// We're calculating weighted average speed\n\t\t// Than more distance for a segment, than more its weight\n\t\tconst speedItems = [speed1];\n\t\tconst distanceItems = [distance1];\n\t\ttotalDistance += distance1;\n\n\t\tif (this._position3 !== null) {\n\t\t\tconst speed2 = speedPxPerMSec(this._position2, this._position3, this._maxSpeed);\n\t\t\t// stop at this moment if direction of the segment is opposite\n\t\t\tif (Math.sign(speed2) === Math.sign(speed1)) {\n\t\t\t\tconst distance2 = distanceBetweenPoints(this._position2, this._position3);\n\n\t\t\t\tspeedItems.push(speed2);\n\t\t\t\tdistanceItems.push(distance2);\n\t\t\t\ttotalDistance += distance2;\n\n\t\t\t\tif (this._position4 !== null) {\n\t\t\t\t\tconst speed3 = speedPxPerMSec(this._position3, this._position4, this._maxSpeed);\n\t\t\t\t\tif (Math.sign(speed3) === Math.sign(speed1)) {\n\t\t\t\t\t\tconst distance3 = distanceBetweenPoints(this._position3, this._position4);\n\n\t\t\t\t\t\tspeedItems.push(speed3);\n\t\t\t\t\t\tdistanceItems.push(distance3);\n\t\t\t\t\t\ttotalDistance += distance3;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet resultSpeed = 0;\n\t\tfor (let i = 0; i < speedItems.length; ++i) {\n\t\t\tresultSpeed += distanceItems[i] / totalDistance * speedItems[i];\n\t\t}\n\n\t\tif (Math.abs(resultSpeed) < this._minSpeed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._animationStartPosition = { position, time };\n\t\tthis._speedPxPerMsec = resultSpeed;\n\t\tthis._durationMsecs = durationMSec(Math.abs(resultSpeed), this._dumpingCoeff);\n\t}\n\n\tpublic getPosition(time: number): Coordinate {\n\t\tconst startPosition = ensureNotNull(this._animationStartPosition);\n\t\tconst durationMsecs = time - startPosition.time;\n\t\treturn startPosition.position + this._speedPxPerMsec * (Math.pow(this._dumpingCoeff, durationMsecs) - 1) / (Math.log(this._dumpingCoeff)) as Coordinate;\n\t}\n\n\tpublic finished(time: number): boolean {\n\t\treturn this._animationStartPosition === null || this._progressDuration(time) === this._durationMsecs;\n\t}\n\n\tprivate _progressDuration(time: number): number {\n\t\tconst startPosition = ensureNotNull(this._animationStartPosition);\n\t\tconst progress = time - startPosition.time;\n\t\treturn Math.min(progress, this._durationMsecs);\n\t}\n}\n","import {\n\tbindCanvasElementBitmapSizeTo,\n\tCanvasElementBitmapSizeBinding,\n\tSize,\n} from 'fancy-canvas';\n\nimport { ensureNotNull } from '../helpers/assertions';\n\nexport function createBoundCanvas(parentElement: HTMLElement, size: Size): CanvasElementBitmapSizeBinding {\n\tconst doc = ensureNotNull(parentElement.ownerDocument);\n\tconst canvas = doc.createElement('canvas');\n\tparentElement.appendChild(canvas);\n\n\tconst binding = bindCanvasElementBitmapSizeTo(canvas, {\n\t\ttype: 'device-pixel-content-box',\n\t\toptions: {\n\t\t\tallowResizeObserver: false,\n\t\t},\n\t\ttransform: (bitmapSize: Size, canvasElementClientSize: Size) => ({\n\t\t\twidth: Math.max(bitmapSize.width, canvasElementClientSize.width),\n\t\t\theight: Math.max(bitmapSize.height, canvasElementClientSize.height),\n\t\t}),\n\t});\n\tbinding.resizeCanvasElement(size);\n\treturn binding;\n}\n\nexport function releaseCanvas(canvas: HTMLCanvasElement): void {\n\t// This function fixes the iOS Safari error \"Total canvas memory use exceeds the maximum limit\".\n\t// Seems that iOS Safari stores canvas elements for some additional time internally.\n\t// So if we create/destroy a lot of canvas elements in a short period of time we can get this error.\n\t// We resize the canvas to 1x1 pixels to force it to release memmory resources.\n\tcanvas.width = 1;\n\tcanvas.height = 1;\n\tcanvas.getContext('2d')?.clearRect(0, 0, 1, 1);\n}\n","import { CanvasRenderingTarget2D } from 'fancy-canvas';\n\nimport { IDataSource } from '../model/idata-source';\nimport { Pane } from '../model/pane';\nimport { IPaneRenderer } from '../renderers/ipane-renderer';\n\nimport { IPaneViewsGetter } from './ipane-view-getter';\n\nexport type DrawFunction = (\n\trenderer: IPaneRenderer,\n\ttarget: CanvasRenderingTarget2D,\n\tisHovered: boolean,\n\thitTestData?: unknown\n) => void;\n\nexport function drawBackground(\n\trenderer: IPaneRenderer,\n\ttarget: CanvasRenderingTarget2D,\n\tisHovered: boolean,\n\thitTestData?: unknown\n): void {\n\tif (renderer.drawBackground) {\n\t\trenderer.drawBackground(target, isHovered, hitTestData);\n\t}\n}\n\nexport function drawForeground(\n\trenderer: IPaneRenderer,\n\ttarget: CanvasRenderingTarget2D,\n\tisHovered: boolean,\n\thitTestData?: unknown\n): void {\n\trenderer.draw(target, isHovered, hitTestData);\n}\n\ntype DrawRendererFn = (renderer: IPaneRenderer) => void;\n\nexport function drawSourcePaneViews(\n\tpaneViewsGetter: IPaneViewsGetter,\n\tdrawRendererFn: DrawRendererFn,\n\tsource: IDataSource,\n\tpane: Pane\n): void {\n\tconst paneViews = paneViewsGetter(source, pane);\n\n\tfor (const paneView of paneViews) {\n\t\tconst renderer = paneView.renderer();\n\t\tif (renderer !== null) {\n\t\t\tdrawRendererFn(renderer);\n\t\t}\n\t}\n}\n","import { isChrome } from './browsers';\n\nexport function preventScrollByWheelClick(el: HTMLElement): void {\n\tif (!isChrome()) {\n\t\treturn;\n\t}\n\n\tel.addEventListener('mousedown', (e: MouseEvent) => {\n\t\tif (e.button === MouseEventButton.Middle) {\n\t\t\t// prevent incorrect scrolling event\n\t\t\te.preventDefault();\n\t\t\treturn false;\n\t\t}\n\t\treturn undefined;\n\t});\n}\n\n","import { ensureNotNull } from '../helpers/assertions';\nimport { isFF, isIOS } from '../helpers/browsers';\nimport { preventScrollByWheelClick } from '../helpers/events';\nimport { IDestroyable } from '../helpers/idestroyable';\n\nimport { Coordinate } from '../model/coordinate';\nimport { TouchMouseEventData } from '../model/touch-mouse-event-data';\n\nexport type HandlerMouseEventCallback = (event: MouseEventHandlerMouseEvent) => void;\nexport type HandlerTouchEventCallback = (event: MouseEventHandlerTouchEvent) => void;\nexport type EmptyCallback = () => void;\nexport type PinchEventCallback = (middlePoint: Position, scale: number) => void;\n\nexport interface MouseEventHandlers {\n\tpinchStartEvent?: EmptyCallback;\n\tpinchEvent?: PinchEventCallback;\n\tpinchEndEvent?: EmptyCallback;\n\n\tmouseClickEvent?: HandlerMouseEventCallback;\n\ttapEvent?: HandlerTouchEventCallback;\n\n\tmouseDoubleClickEvent?: HandlerMouseEventCallback;\n\tdoubleTapEvent?: HandlerTouchEventCallback;\n\n\tmouseDownEvent?: HandlerMouseEventCallback;\n\ttouchStartEvent?: HandlerTouchEventCallback;\n\n\tmouseUpEvent?: HandlerMouseEventCallback;\n\ttouchEndEvent?: HandlerTouchEventCallback;\n\n\tmouseDownOutsideEvent?: EmptyCallback;\n\n\tmouseEnterEvent?: HandlerMouseEventCallback;\n\tmouseLeaveEvent?: HandlerMouseEventCallback;\n\n\tmouseMoveEvent?: HandlerMouseEventCallback;\n\n\tpressedMouseMoveEvent?: HandlerMouseEventCallback;\n\ttouchMoveEvent?: HandlerTouchEventCallback;\n\n\tlongTapEvent?: HandlerTouchEventCallback;\n}\n\nexport interface MouseEventHandlerEventBase extends TouchMouseEventData {\n\treadonly srcType: string;\n\n\ttarget: MouseEvent['target'];\n\tview: MouseEvent['view'];\n\n\tpreventDefault(): void;\n}\n\nexport interface MouseEventHandlerMouseEvent extends MouseEventHandlerEventBase {\n\tisTouch: false;\n}\n\nexport interface MouseEventHandlerTouchEvent extends MouseEventHandlerEventBase {\n\tisTouch: true;\n}\n\nexport type TouchMouseEvent = MouseEventHandlerMouseEvent | MouseEventHandlerTouchEvent;\n\nexport interface Position {\n\tx: number;\n\ty: number;\n}\n\n// we can use `const name = 500;` but with `const enum` this values will be inlined into code\n// so we do not need to have it as variables\nconst enum Delay {\n\tResetClick = 500,\n\tLongTap = 240,\n\tPreventFiresTouchEvents= 500,\n}\n\nconst enum Constants {\n\tCancelClickManhattanDistance = 5,\n\tCancelTapManhattanDistance = 5,\n\tDoubleClickManhattanDistance = 5,\n\tDoubleTapManhattanDistance = 30,\n}\n\nexport interface MouseEventHandlerOptions {\n\ttreatVertTouchDragAsPageScroll: () => boolean;\n\ttreatHorzTouchDragAsPageScroll: () => boolean;\n}\n\ninterface TouchMouseMoveWithDownInfo {\n\txOffset: number;\n\tyOffset: number;\n\tmanhattanDistance: number;\n}\n\n// TODO: get rid of a lot of boolean flags, probably we should replace it with some enum\nexport class MouseEventHandler implements IDestroyable {\n\tprivate readonly _target: HTMLElement;\n\tprivate readonly _handler: MouseEventHandlers;\n\n\tprivate readonly _options: MouseEventHandlerOptions;\n\n\tprivate _clickCount: number = 0;\n\tprivate _clickTimeoutId: TimerId | null = null;\n\tprivate _clickPosition: Position = { x: Number.NEGATIVE_INFINITY, y: Number.POSITIVE_INFINITY };\n\n\tprivate _tapCount: number = 0;\n\tprivate _tapTimeoutId: TimerId | null = null;\n\tprivate _tapPosition: Position = { x: Number.NEGATIVE_INFINITY, y: Number.POSITIVE_INFINITY };\n\n\tprivate _longTapTimeoutId: TimerId | null = null;\n\tprivate _longTapActive: boolean = false;\n\n\tprivate _mouseMoveStartPosition: Position | null = null;\n\n\tprivate _touchMoveStartPosition: Position | null = null;\n\tprivate _touchMoveExceededManhattanDistance: boolean = false;\n\n\tprivate _cancelClick: boolean = false;\n\tprivate _cancelTap: boolean = false;\n\n\tprivate _unsubscribeOutsideMouseEvents: (() => void) | null = null;\n\tprivate _unsubscribeOutsideTouchEvents: (() => void) | null = null;\n\tprivate _unsubscribeMobileSafariEvents: (() => void) | null = null;\n\n\tprivate _unsubscribeMousemove: (() => void) | null = null;\n\n\tprivate _unsubscribeRootMouseEvents: (() => void) | null = null;\n\tprivate _unsubscribeRootTouchEvents: (() => void) | null = null;\n\n\tprivate _startPinchMiddlePoint: Position | null = null;\n\tprivate _startPinchDistance: number = 0;\n\tprivate _pinchPrevented: boolean = false;\n\tprivate _preventTouchDragProcess: boolean = false;\n\n\tprivate _mousePressed: boolean = false;\n\n\tprivate _lastTouchEventTimeStamp: number = 0;\n\n\t// for touchstart/touchmove/touchend events we handle only first touch\n\t// i.e. we don't support several active touches at the same time (except pinch event)\n\tprivate _activeTouchId: number | null = null;\n\n\t// accept all mouse leave events if it's not an iOS device\n\t// see _mouseEnterHandler, _mouseMoveHandler, _mouseLeaveHandler\n\tprivate _acceptMouseLeave: boolean = !isIOS();\n\n\tpublic constructor(\n\t\ttarget: HTMLElement,\n\t\thandler: MouseEventHandlers,\n\t\toptions: MouseEventHandlerOptions\n\t) {\n\t\tthis._target = target;\n\t\tthis._handler = handler;\n\t\tthis._options = options;\n\n\t\tthis._init();\n\t}\n\n\tpublic destroy(): void {\n\t\tif (this._unsubscribeOutsideMouseEvents !== null) {\n\t\t\tthis._unsubscribeOutsideMouseEvents();\n\t\t\tthis._unsubscribeOutsideMouseEvents = null;\n\t\t}\n\n\t\tif (this._unsubscribeOutsideTouchEvents !== null) {\n\t\t\tthis._unsubscribeOutsideTouchEvents();\n\t\t\tthis._unsubscribeOutsideTouchEvents = null;\n\t\t}\n\n\t\tif (this._unsubscribeMousemove !== null) {\n\t\t\tthis._unsubscribeMousemove();\n\t\t\tthis._unsubscribeMousemove = null;\n\t\t}\n\n\t\tif (this._unsubscribeRootMouseEvents !== null) {\n\t\t\tthis._unsubscribeRootMouseEvents();\n\t\t\tthis._unsubscribeRootMouseEvents = null;\n\t\t}\n\n\t\tif (this._unsubscribeRootTouchEvents !== null) {\n\t\t\tthis._unsubscribeRootTouchEvents();\n\t\t\tthis._unsubscribeRootTouchEvents = null;\n\t\t}\n\n\t\tif (this._unsubscribeMobileSafariEvents !== null) {\n\t\t\tthis._unsubscribeMobileSafariEvents();\n\t\t\tthis._unsubscribeMobileSafariEvents = null;\n\t\t}\n\n\t\tthis._clearLongTapTimeout();\n\t\tthis._resetClickTimeout();\n\t}\n\n\tprivate _mouseEnterHandler(enterEvent: MouseEvent): void {\n\t\tif (this._unsubscribeMousemove) {\n\t\t\tthis._unsubscribeMousemove();\n\t\t}\n\n\t\tconst boundMouseMoveHandler = this._mouseMoveHandler.bind(this);\n\t\tthis._unsubscribeMousemove = () => {\n\t\t\tthis._target.removeEventListener('mousemove', boundMouseMoveHandler);\n\t\t};\n\t\tthis._target.addEventListener('mousemove', boundMouseMoveHandler);\n\n\t\tif (this._firesTouchEvents(enterEvent)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst compatEvent = this._makeCompatEvent(enterEvent);\n\t\tthis._processMouseEvent(compatEvent, this._handler.mouseEnterEvent);\n\t\tthis._acceptMouseLeave = true;\n\t}\n\n\tprivate _resetClickTimeout(): void {\n\t\tif (this._clickTimeoutId !== null) {\n\t\t\tclearTimeout(this._clickTimeoutId);\n\t\t}\n\n\t\tthis._clickCount = 0;\n\t\tthis._clickTimeoutId = null;\n\t\tthis._clickPosition = { x: Number.NEGATIVE_INFINITY, y: Number.POSITIVE_INFINITY };\n\t}\n\n\tprivate _resetTapTimeout(): void {\n\t\tif (this._tapTimeoutId !== null) {\n\t\t\tclearTimeout(this._tapTimeoutId);\n\t\t}\n\n\t\tthis._tapCount = 0;\n\t\tthis._tapTimeoutId = null;\n\t\tthis._tapPosition = { x: Number.NEGATIVE_INFINITY, y: Number.POSITIVE_INFINITY };\n\t}\n\n\tprivate _mouseMoveHandler(moveEvent: MouseEvent): void {\n\t\tif (this._mousePressed || this._touchMoveStartPosition !== null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._firesTouchEvents(moveEvent)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst compatEvent = this._makeCompatEvent(moveEvent);\n\t\tthis._processMouseEvent(compatEvent, this._handler.mouseMoveEvent);\n\t\tthis._acceptMouseLeave = true;\n\t}\n\n\tprivate _touchMoveHandler(moveEvent: TouchEvent): void {\n\t\tconst touch = touchWithId(moveEvent.changedTouches, ensureNotNull(this._activeTouchId));\n\t\tif (touch === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._lastTouchEventTimeStamp = eventTimeStamp(moveEvent);\n\n\t\tif (this._startPinchMiddlePoint !== null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._preventTouchDragProcess) {\n\t\t\treturn;\n\t\t}\n\n\t\t// prevent pinch if move event comes faster than the second touch\n\t\tthis._pinchPrevented = true;\n\n\t\tconst moveInfo = this._touchMouseMoveWithDownInfo(getPosition(touch), ensureNotNull(this._touchMoveStartPosition));\n\t\tconst { xOffset, yOffset, manhattanDistance } = moveInfo;\n\n\t\tif (!this._touchMoveExceededManhattanDistance && manhattanDistance < Constants.CancelTapManhattanDistance) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._touchMoveExceededManhattanDistance) {\n\t\t\t// first time when current position exceeded manhattan distance\n\n\t\t\t// vertical drag is more important than horizontal drag\n\t\t\t// because we scroll the page vertically often than horizontally\n\t\t\tconst correctedXOffset = xOffset * 0.5;\n\n\t\t\t// a drag can be only if touch page scroll isn't allowed\n\t\t\tconst isVertDrag = yOffset >= correctedXOffset && !this._options.treatVertTouchDragAsPageScroll();\n\t\t\tconst isHorzDrag = correctedXOffset > yOffset && !this._options.treatHorzTouchDragAsPageScroll();\n\n\t\t\t// if drag event happened then we should revert preventDefault state to original one\n\t\t\t// and try to process the drag event\n\t\t\t// else we shouldn't prevent default of the event and ignore processing the drag event\n\t\t\tif (!isVertDrag && !isHorzDrag) {\n\t\t\t\tthis._preventTouchDragProcess = true;\n\t\t\t}\n\n\t\t\tthis._touchMoveExceededManhattanDistance = true;\n\t\t\t// if manhattan distance is more that 5 - we should cancel tap event\n\t\t\tthis._cancelTap = true;\n\t\t\tthis._clearLongTapTimeout();\n\t\t\tthis._resetTapTimeout();\n\t\t}\n\n\t\tif (!this._preventTouchDragProcess) {\n\t\t\tconst compatEvent = this._makeCompatEvent(moveEvent, touch);\n\t\t\tthis._processTouchEvent(compatEvent, this._handler.touchMoveEvent);\n\n\t\t\t// we should prevent default in case of touch only\n\t\t\t// to prevent scroll of the page\n\t\t\tpreventDefault(moveEvent);\n\t\t}\n\t}\n\n\tprivate _mouseMoveWithDownHandler(moveEvent: MouseEvent): void {\n\t\tif (moveEvent.button !== MouseEventButton.Left) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst moveInfo = this._touchMouseMoveWithDownInfo(getPosition(moveEvent), ensureNotNull(this._mouseMoveStartPosition));\n\t\tconst { manhattanDistance } = moveInfo;\n\n\t\tif (manhattanDistance >= Constants.CancelClickManhattanDistance) {\n\t\t\t// if manhattan distance is more that 5 - we should cancel click event\n\t\t\tthis._cancelClick = true;\n\t\t\tthis._resetClickTimeout();\n\t\t}\n\n\t\tif (this._cancelClick) {\n\t\t\t// if this._cancelClick is true, that means that minimum manhattan distance is already exceeded\n\t\t\tconst compatEvent = this._makeCompatEvent(moveEvent);\n\t\t\tthis._processMouseEvent(compatEvent, this._handler.pressedMouseMoveEvent);\n\t\t}\n\t}\n\n\tprivate _touchMouseMoveWithDownInfo(currentPosition: Position, startPosition: Position): TouchMouseMoveWithDownInfo {\n\t\tconst xOffset = Math.abs(startPosition.x - currentPosition.x);\n\t\tconst yOffset = Math.abs(startPosition.y - currentPosition.y);\n\n\t\tconst manhattanDistance = xOffset + yOffset;\n\n\t\treturn {\n\t\t\txOffset: xOffset,\n\t\t\tyOffset: yOffset,\n\t\t\tmanhattanDistance: manhattanDistance,\n\t\t};\n\t}\n\n\t/**\n\t * In Firefox mouse events dont't fire if the mouse position is outside of the browser's border.\n\t * To prevent the mouse from hanging while pressed we're subscribing on the mouseleave event of the document element.\n\t * We're subscribing on mouseleave, but this event is actually fired on mouseup outside of the browser's border.\n\t */\n\tprivate _onFirefoxOutsideMouseUp = (mouseUpEvent: MouseEvent) => {\n\t\tthis._mouseUpHandler(mouseUpEvent);\n\t};\n\n\t/**\n\t * Safari doesn't fire touchstart/mousedown events on double tap since iOS 13.\n\t * There are two possible solutions:\n\t * 1) Call preventDefault in touchEnd handler. But it also prevents click event from firing.\n\t * 2) Add listener on dblclick event that fires with the preceding mousedown/mouseup.\n\t * https://developer.apple.com/forums/thread/125073\n\t */\n\tprivate _onMobileSafariDoubleClick = (dblClickEvent: MouseEvent) => {\n\t\tif (this._firesTouchEvents(dblClickEvent)) {\n\t\t\tconst compatEvent = this._makeCompatEvent(dblClickEvent);\n\t\t\t++this._tapCount;\n\n\t\t\tif (this._tapTimeoutId && this._tapCount > 1) {\n\t\t\t\tconst { manhattanDistance } = this._touchMouseMoveWithDownInfo(getPosition(dblClickEvent), this._tapPosition);\n\t\t\t\tif (manhattanDistance < Constants.DoubleTapManhattanDistance && !this._cancelTap) {\n\t\t\t\t\tthis._processTouchEvent(compatEvent as unknown as MouseEventHandlerTouchEvent, this._handler.doubleTapEvent);\n\t\t\t\t}\n\t\t\t\tthis._resetTapTimeout();\n\t\t\t}\n\t\t} else {\n\t\t\tconst compatEvent = this._makeCompatEvent(dblClickEvent);\n\t\t\t++this._clickCount;\n\n\t\t\tif (this._clickTimeoutId && this._clickCount > 1) {\n\t\t\t\tconst { manhattanDistance } = this._touchMouseMoveWithDownInfo(getPosition(dblClickEvent), this._clickPosition);\n\t\t\t\tif (manhattanDistance < Constants.DoubleClickManhattanDistance && !this._cancelClick) {\n\t\t\t\t\tthis._processMouseEvent(compatEvent, this._handler.mouseDoubleClickEvent);\n\t\t\t\t}\n\t\t\t\tthis._resetClickTimeout();\n\t\t\t}\n\t\t}\n\t};\n\n\t// eslint-disable-next-line complexity\n\tprivate _touchEndHandler(touchEndEvent: TouchEvent): void {\n\t\tlet touch = touchWithId(touchEndEvent.changedTouches, ensureNotNull(this._activeTouchId));\n\t\tif (touch === null && touchEndEvent.touches.length === 0) {\n\t\t\t// something went wrong, somehow we missed the required touchend event\n\t\t\t// probably the browser has not sent this event\n\t\t\ttouch = touchEndEvent.changedTouches[0];\n\t\t}\n\n\t\tif (touch === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._activeTouchId = null;\n\t\tthis._lastTouchEventTimeStamp = eventTimeStamp(touchEndEvent);\n\t\tthis._clearLongTapTimeout();\n\t\tthis._touchMoveStartPosition = null;\n\n\t\tif (this._unsubscribeRootTouchEvents) {\n\t\t\tthis._unsubscribeRootTouchEvents();\n\t\t\tthis._unsubscribeRootTouchEvents = null;\n\t\t}\n\n\t\tconst compatEvent = this._makeCompatEvent(touchEndEvent, touch);\n\t\tthis._processTouchEvent(compatEvent, this._handler.touchEndEvent);\n\t\t++this._tapCount;\n\n\t\tif (this._tapTimeoutId && this._tapCount > 1) {\n\t\t\t// check that both clicks are near enough\n\t\t\tconst { manhattanDistance } = this._touchMouseMoveWithDownInfo(getPosition(touch), this._tapPosition);\n\t\t\tif (manhattanDistance < Constants.DoubleTapManhattanDistance && !this._cancelTap) {\n\t\t\t\tthis._processTouchEvent(compatEvent, this._handler.doubleTapEvent);\n\t\t\t}\n\t\t\tthis._resetTapTimeout();\n\t\t} else {\n\t\t\tif (!this._cancelTap) {\n\t\t\t\tthis._processTouchEvent(compatEvent, this._handler.tapEvent);\n\n\t\t\t\t// do not fire mouse events if tap handler was executed\n\t\t\t\t// prevent click event on new dom element (who appeared after tap)\n\t\t\t\tif (this._handler.tapEvent) {\n\t\t\t\t\tpreventDefault(touchEndEvent);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// prevent, for example, safari's dblclick-to-zoom or fast-click after long-tap\n\t\t// we handle mouseDoubleClickEvent here ourselves\n\t\tif (this._tapCount === 0) {\n\t\t\tpreventDefault(touchEndEvent);\n\t\t}\n\n\t\tif (touchEndEvent.touches.length === 0) {\n\t\t\tif (this._longTapActive) {\n\t\t\t\tthis._longTapActive = false;\n\t\t\t\t// prevent native click event\n\t\t\t\tpreventDefault(touchEndEvent);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _mouseUpHandler(mouseUpEvent: MouseEvent): void {\n\t\tif (mouseUpEvent.button !== MouseEventButton.Left) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst compatEvent = this._makeCompatEvent(mouseUpEvent);\n\n\t\tthis._mouseMoveStartPosition = null;\n\t\tthis._mousePressed = false;\n\n\t\tif (this._unsubscribeRootMouseEvents) {\n\t\t\tthis._unsubscribeRootMouseEvents();\n\t\t\tthis._unsubscribeRootMouseEvents = null;\n\t\t}\n\n\t\tif (isFF()) {\n\t\t\tconst rootElement = this._target.ownerDocument.documentElement;\n\t\t\trootElement.removeEventListener('mouseleave', this._onFirefoxOutsideMouseUp);\n\t\t}\n\n\t\tif (this._firesTouchEvents(mouseUpEvent)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._processMouseEvent(compatEvent, this._handler.mouseUpEvent);\n\t\t++this._clickCount;\n\n\t\tif (this._clickTimeoutId && this._clickCount > 1) {\n\t\t\t// check that both clicks are near enough\n\t\t\tconst { manhattanDistance } = this._touchMouseMoveWithDownInfo(getPosition(mouseUpEvent), this._clickPosition);\n\t\t\tif (manhattanDistance < Constants.DoubleClickManhattanDistance && !this._cancelClick) {\n\t\t\t\tthis._processMouseEvent(compatEvent, this._handler.mouseDoubleClickEvent);\n\t\t\t}\n\t\t\tthis._resetClickTimeout();\n\t\t} else {\n\t\t\tif (!this._cancelClick) {\n\t\t\t\tthis._processMouseEvent(compatEvent, this._handler.mouseClickEvent);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _clearLongTapTimeout(): void {\n\t\tif (this._longTapTimeoutId === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this._longTapTimeoutId);\n\t\tthis._longTapTimeoutId = null;\n\t}\n\n\tprivate _touchStartHandler(downEvent: TouchEvent): void {\n\t\tif (this._activeTouchId !== null) {\n\t\t\treturn;\n\t\t}\n\t\tconst touch = downEvent.changedTouches[0];\n\t\tthis._activeTouchId = touch.identifier;\n\n\t\tthis._lastTouchEventTimeStamp = eventTimeStamp(downEvent);\n\n\t\tconst rootElement = this._target.ownerDocument.documentElement;\n\n\t\tthis._cancelTap = false;\n\t\tthis._touchMoveExceededManhattanDistance = false;\n\t\tthis._preventTouchDragProcess = false;\n\n\t\tthis._touchMoveStartPosition = getPosition(touch);\n\n\t\tif (this._unsubscribeRootTouchEvents) {\n\t\t\tthis._unsubscribeRootTouchEvents();\n\t\t\tthis._unsubscribeRootTouchEvents = null;\n\t\t}\n\n\t\t{\n\t\t\tconst boundTouchMoveWithDownHandler = this._touchMoveHandler.bind(this);\n\t\t\tconst boundTouchEndHandler = this._touchEndHandler.bind(this);\n\n\t\t\tthis._unsubscribeRootTouchEvents = () => {\n\t\t\t\trootElement.removeEventListener('touchmove', boundTouchMoveWithDownHandler);\n\t\t\t\trootElement.removeEventListener('touchend', boundTouchEndHandler);\n\t\t\t};\n\n\t\t\trootElement.addEventListener('touchmove', boundTouchMoveWithDownHandler, { passive: false });\n\t\t\trootElement.addEventListener('touchend', boundTouchEndHandler, { passive: false });\n\n\t\t\tthis._clearLongTapTimeout();\n\t\t\tthis._longTapTimeoutId = setTimeout(this._longTapHandler.bind(this, downEvent), Delay.LongTap);\n\t\t}\n\n\t\tconst compatEvent = this._makeCompatEvent(downEvent, touch);\n\t\tthis._processTouchEvent(compatEvent, this._handler.touchStartEvent);\n\n\t\tif (!this._tapTimeoutId) {\n\t\t\tthis._tapCount = 0;\n\t\t\tthis._tapTimeoutId = setTimeout(this._resetTapTimeout.bind(this), Delay.ResetClick);\n\t\t\tthis._tapPosition = getPosition(touch);\n\t\t}\n\t}\n\n\tprivate _mouseDownHandler(downEvent: MouseEvent): void {\n\t\tif (downEvent.button !== MouseEventButton.Left) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst rootElement = this._target.ownerDocument.documentElement;\n\t\tif (isFF()) {\n\t\t\trootElement.addEventListener('mouseleave', this._onFirefoxOutsideMouseUp);\n\t\t}\n\n\t\tthis._cancelClick = false;\n\n\t\tthis._mouseMoveStartPosition = getPosition(downEvent);\n\n\t\tif (this._unsubscribeRootMouseEvents) {\n\t\t\tthis._unsubscribeRootMouseEvents();\n\t\t\tthis._unsubscribeRootMouseEvents = null;\n\t\t}\n\n\t\t{\n\t\t\tconst boundMouseMoveWithDownHandler = this._mouseMoveWithDownHandler.bind(this);\n\t\t\tconst boundMouseUpHandler = this._mouseUpHandler.bind(this);\n\n\t\t\tthis._unsubscribeRootMouseEvents = () => {\n\t\t\t\trootElement.removeEventListener('mousemove', boundMouseMoveWithDownHandler);\n\t\t\t\trootElement.removeEventListener('mouseup', boundMouseUpHandler);\n\t\t\t};\n\n\t\t\trootElement.addEventListener('mousemove', boundMouseMoveWithDownHandler);\n\t\t\trootElement.addEventListener('mouseup', boundMouseUpHandler);\n\t\t}\n\n\t\tthis._mousePressed = true;\n\n\t\tif (this._firesTouchEvents(downEvent)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst compatEvent = this._makeCompatEvent(downEvent);\n\t\tthis._processMouseEvent(compatEvent, this._handler.mouseDownEvent);\n\n\t\tif (!this._clickTimeoutId) {\n\t\t\tthis._clickCount = 0;\n\t\t\tthis._clickTimeoutId = setTimeout(this._resetClickTimeout.bind(this), Delay.ResetClick);\n\t\t\tthis._clickPosition = getPosition(downEvent);\n\t\t}\n\t}\n\n\tprivate _init(): void {\n\t\tthis._target.addEventListener('mouseenter', this._mouseEnterHandler.bind(this));\n\n\t\t// Do not show context menu when something went wrong\n\t\tthis._target.addEventListener('touchcancel', this._clearLongTapTimeout.bind(this));\n\n\t\t{\n\t\t\tconst doc = this._target.ownerDocument;\n\n\t\t\tconst outsideHandler = (event: MouseEvent | TouchEvent) => {\n\t\t\t\tif (!this._handler.mouseDownOutsideEvent) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (event.composed && this._target.contains(event.composedPath()[0] as Element)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (event.target && this._target.contains(event.target as Element)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis._handler.mouseDownOutsideEvent();\n\t\t\t};\n\n\t\t\tthis._unsubscribeOutsideTouchEvents = () => {\n\t\t\t\tdoc.removeEventListener('touchstart', outsideHandler);\n\t\t\t};\n\n\t\t\tthis._unsubscribeOutsideMouseEvents = () => {\n\t\t\t\tdoc.removeEventListener('mousedown', outsideHandler);\n\t\t\t};\n\n\t\t\tdoc.addEventListener('mousedown', outsideHandler);\n\t\t\tdoc.addEventListener('touchstart', outsideHandler, { passive: true });\n\t\t}\n\n\t\tif (isIOS()) {\n\t\t\tthis._unsubscribeMobileSafariEvents = () => {\n\t\t\t\tthis._target.removeEventListener('dblclick', this._onMobileSafariDoubleClick);\n\t\t\t};\n\t\t\tthis._target.addEventListener('dblclick', this._onMobileSafariDoubleClick);\n\t\t}\n\n\t\tthis._target.addEventListener('mouseleave', this._mouseLeaveHandler.bind(this));\n\n\t\tthis._target.addEventListener('touchstart', this._touchStartHandler.bind(this), { passive: true });\n\t\tpreventScrollByWheelClick(this._target);\n\t\tthis._target.addEventListener('mousedown', this._mouseDownHandler.bind(this));\n\n\t\tthis._initPinch();\n\n\t\t// Hey mobile Safari, what's up?\n\t\t// If mobile Safari doesn't have any touchmove handler with passive=false\n\t\t// it treats a touchstart and the following touchmove events as cancelable=false,\n\t\t// so we can't prevent them (as soon we subscribe on touchmove inside touchstart's handler).\n\t\t// And we'll get scroll of the page along with chart's one instead of only chart's scroll.\n\t\tthis._target.addEventListener('touchmove', () => {}, { passive: false });\n\t}\n\n\tprivate _initPinch(): void {\n\t\tif (this._handler.pinchStartEvent === undefined &&\n\t\t\tthis._handler.pinchEvent === undefined &&\n\t\t\tthis._handler.pinchEndEvent === undefined\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._target.addEventListener(\n\t\t\t'touchstart',\n\t\t\t(event: TouchEvent) => this._checkPinchState(event.touches),\n\t\t\t{ passive: true }\n\t\t);\n\n\t\tthis._target.addEventListener(\n\t\t\t'touchmove',\n\t\t\t(event: TouchEvent) => {\n\t\t\t\tif (event.touches.length !== 2 || this._startPinchMiddlePoint === null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this._handler.pinchEvent !== undefined) {\n\t\t\t\t\tconst currentDistance = getDistance(event.touches[0], event.touches[1]);\n\t\t\t\t\tconst scale = currentDistance / this._startPinchDistance;\n\t\t\t\t\tthis._handler.pinchEvent(this._startPinchMiddlePoint, scale);\n\t\t\t\t\tpreventDefault(event);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{ passive: false }\n\t\t);\n\n\t\tthis._target.addEventListener('touchend', (event: TouchEvent) => {\n\t\t\tthis._checkPinchState(event.touches);\n\t\t});\n\t}\n\n\tprivate _checkPinchState(touches: TouchList): void {\n\t\tif (touches.length === 1) {\n\t\t\tthis._pinchPrevented = false;\n\t\t}\n\n\t\tif (touches.length !== 2 || this._pinchPrevented || this._longTapActive) {\n\t\t\tthis._stopPinch();\n\t\t} else {\n\t\t\tthis._startPinch(touches);\n\t\t}\n\t}\n\n\tprivate _startPinch(touches: TouchList): void {\n\t\tconst box = getBoundingClientRect(this._target);\n\t\tthis._startPinchMiddlePoint = {\n\t\t\tx: ((touches[0].clientX - box.left) + (touches[1].clientX - box.left)) / 2,\n\t\t\ty: ((touches[0].clientY - box.top) + (touches[1].clientY - box.top)) / 2,\n\t\t};\n\n\t\tthis._startPinchDistance = getDistance(touches[0], touches[1]);\n\n\t\tif (this._handler.pinchStartEvent !== undefined) {\n\t\t\tthis._handler.pinchStartEvent();\n\t\t}\n\n\t\tthis._clearLongTapTimeout();\n\t}\n\n\tprivate _stopPinch(): void {\n\t\tif (this._startPinchMiddlePoint === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._startPinchMiddlePoint = null;\n\n\t\tif (this._handler.pinchEndEvent !== undefined) {\n\t\t\tthis._handler.pinchEndEvent();\n\t\t}\n\t}\n\n\tprivate _mouseLeaveHandler(event: MouseEvent): void {\n\t\tif (this._unsubscribeMousemove) {\n\t\t\tthis._unsubscribeMousemove();\n\t\t}\n\n\t\tif (this._firesTouchEvents(event)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._acceptMouseLeave) {\n\t\t\t// mobile Safari sometimes emits mouse leave event for no reason, there is no way to handle it in other way\n\t\t\t// just ignore this event if there was no mouse move or mouse enter events\n\t\t\treturn;\n\t\t}\n\n\t\tconst compatEvent = this._makeCompatEvent(event);\n\t\tthis._processMouseEvent(compatEvent, this._handler.mouseLeaveEvent);\n\n\t\t// accept all mouse leave events if it's not an iOS device\n\t\tthis._acceptMouseLeave = !isIOS();\n\t}\n\n\tprivate _longTapHandler(event: TouchEvent): void {\n\t\tconst touch = touchWithId(event.touches, ensureNotNull(this._activeTouchId));\n\t\tif (touch === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst compatEvent = this._makeCompatEvent(event, touch);\n\t\tthis._processTouchEvent(compatEvent, this._handler.longTapEvent);\n\t\tthis._cancelTap = true;\n\n\t\t// long tap is active until touchend event with 0 touches occurred\n\t\tthis._longTapActive = true;\n\t}\n\n\tprivate _firesTouchEvents(e: MouseEvent): boolean {\n\t\tif (e.sourceCapabilities && e.sourceCapabilities.firesTouchEvents !== undefined) {\n\t\t\treturn e.sourceCapabilities.firesTouchEvents;\n\t\t}\n\n\t\treturn eventTimeStamp(e) < this._lastTouchEventTimeStamp + Delay.PreventFiresTouchEvents;\n\t}\n\n\tprivate _processTouchEvent(event: MouseEventHandlerTouchEvent, callback?: HandlerTouchEventCallback): void {\n\t\tif (callback) {\n\t\t\tcallback.call(this._handler, event);\n\t\t}\n\t}\n\n\tprivate _processMouseEvent(event: MouseEventHandlerMouseEvent, callback?: HandlerMouseEventCallback): void {\n\t\tif (!callback) {\n\t\t\treturn;\n\t\t}\n\n\t\tcallback.call(this._handler, event);\n\t}\n\n\tprivate _makeCompatEvent(event: MouseEvent): MouseEventHandlerMouseEvent;\n\tprivate _makeCompatEvent(event: TouchEvent, touch: Touch): MouseEventHandlerTouchEvent;\n\tprivate _makeCompatEvent(event: MouseEvent | TouchEvent, touch?: Touch): TouchMouseEvent {\n\t\t// TouchEvent has no clientX/Y coordinates:\n\t\t// We have to use the last Touch instead\n\t\tconst eventLike = touch || (event as MouseEvent);\n\t\tconst box = this._target.getBoundingClientRect() || { left: 0, top: 0 };\n\n\t\treturn {\n\t\t\tclientX: eventLike.clientX as Coordinate,\n\t\t\tclientY: eventLike.clientY as Coordinate,\n\t\t\tpageX: eventLike.pageX as Coordinate,\n\t\t\tpageY: eventLike.pageY as Coordinate,\n\t\t\tscreenX: eventLike.screenX as Coordinate,\n\t\t\tscreenY: eventLike.screenY as Coordinate,\n\t\t\tlocalX: (eventLike.clientX - box.left) as Coordinate,\n\t\t\tlocalY: (eventLike.clientY - box.top) as Coordinate,\n\n\t\t\tctrlKey: event.ctrlKey,\n\t\t\taltKey: event.altKey,\n\t\t\tshiftKey: event.shiftKey,\n\t\t\tmetaKey: event.metaKey,\n\n\t\t\tisTouch: !event.type.startsWith('mouse') && event.type !== 'contextmenu' && event.type !== 'click',\n\t\t\tsrcType: event.type,\n\n\t\t\ttarget: eventLike.target,\n\t\t\tview: event.view,\n\n\t\t\tpreventDefault: () => {\n\t\t\t\tif (event.type !== 'touchstart') {\n\t\t\t\t\t// touchstart is passive and cannot be prevented\n\t\t\t\t\tpreventDefault(event);\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n}\n\nfunction getBoundingClientRect(element: HTMLElement): DOMRect {\n\treturn element.getBoundingClientRect() || { left: 0, top: 0 };\n}\n\nfunction getDistance(p1: Touch, p2: Touch): number {\n\tconst xDiff = p1.clientX - p2.clientX;\n\tconst yDiff = p1.clientY - p2.clientY;\n\treturn Math.sqrt(xDiff * xDiff + yDiff * yDiff);\n}\n\nfunction preventDefault(event: Event): void {\n\tif (event.cancelable) {\n\t\tevent.preventDefault();\n\t}\n}\n\nfunction getPosition(eventLike: Touch | MouseEvent): Position {\n\treturn {\n\t\tx: eventLike.pageX,\n\t\ty: eventLike.pageY,\n\t};\n}\n\nfunction eventTimeStamp(e: TouchEvent | MouseEvent): number {\n\t// for some reason e.timestamp is always 0 on iPad with magic mouse, so we use performance.now() as a fallback\n\treturn e.timeStamp || performance.now();\n}\n\nfunction touchWithId(touches: TouchList, id: number): Touch | null {\n\tfor (let i = 0; i < touches.length; ++i) {\n\t\tif (touches[i].identifier === id) {\n\t\t\treturn touches[i];\n\t\t}\n\t}\n\n\treturn null;\n}\n","import { HoveredObject } from '../model/chart-model';\nimport { Coordinate } from '../model/coordinate';\nimport { IPriceDataSource } from '../model/iprice-data-source';\nimport {\n\tPrimitiveHoveredItem,\n\tSeriesPrimitivePaneViewZOrder,\n} from '../model/iseries-primitive';\nimport { Pane } from '../model/pane';\nimport { IPaneView } from '../views/pane/ipane-view';\n\nexport interface HitTestResult {\n\tsource: IPriceDataSource;\n\tobject?: HoveredObject;\n\tview?: IPaneView;\n\tcursorStyle?: string;\n}\n\nexport interface HitTestPaneViewResult {\n\tview: IPaneView;\n\tobject?: HoveredObject;\n}\n\ninterface BestPrimitiveHit {\n\thit: PrimitiveHoveredItem;\n\tsource: IPriceDataSource;\n}\n\n// returns true if item is above reference\nfunction comparePrimitiveZOrder(\n\titem: SeriesPrimitivePaneViewZOrder,\n\treference?: SeriesPrimitivePaneViewZOrder\n): boolean {\n\treturn (\n\t\t!reference ||\n\t\t(item === 'top' && reference !== 'top') ||\n\t\t(item === 'normal' && reference === 'bottom')\n\t);\n}\n\nfunction findBestPrimitiveHitTest(\n\tsources: readonly IPriceDataSource[],\n\tx: Coordinate,\n\ty: Coordinate\n): BestPrimitiveHit | null {\n\tlet bestPrimitiveHit: PrimitiveHoveredItem | undefined;\n\tlet bestHitSource: IPriceDataSource | undefined;\n\tfor (const source of sources) {\n\t\tconst primitiveHitResults = source.primitiveHitTest?.(x, y) ?? [];\n\t\tfor (const hitResult of primitiveHitResults) {\n\t\t\tif (comparePrimitiveZOrder(hitResult.zOrder, bestPrimitiveHit?.zOrder)) {\n\t\t\t\tbestPrimitiveHit = hitResult;\n\t\t\t\tbestHitSource = source;\n\t\t\t}\n\t\t}\n\t}\n\tif (!bestPrimitiveHit || !bestHitSource) {\n\t\treturn null;\n\t}\n\treturn {\n\t\thit: bestPrimitiveHit,\n\t\tsource: bestHitSource,\n\t};\n}\n\nfunction convertPrimitiveHitResult(\n\tprimitiveHit: BestPrimitiveHit\n): HitTestResult {\n\treturn {\n\t\tsource: primitiveHit.source,\n\t\tobject: {\n\t\t\texternalId: primitiveHit.hit.externalId,\n\t\t},\n\t\tcursorStyle: primitiveHit.hit.cursorStyle,\n\t};\n}\n\n/**\n * Performs a hit test on a collection of pane views to determine which view and object\n * is located at a given coordinate (x, y) and returns the matching pane view and\n * hit-tested result object, or null if no match is found.\n */\nfunction hitTestPaneView(\n\tpaneViews: readonly IPaneView[],\n\tx: Coordinate,\n\ty: Coordinate\n): HitTestPaneViewResult | null {\n\tfor (const paneView of paneViews) {\n\t\tconst renderer = paneView.renderer();\n\t\tif (renderer !== null && renderer.hitTest) {\n\t\t\tconst result = renderer.hitTest(x, y);\n\t\t\tif (result !== null) {\n\t\t\t\treturn {\n\t\t\t\t\tview: paneView,\n\t\t\t\t\tobject: result,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n}\n\nexport function hitTestPane(\n\tpane: Pane,\n\tx: Coordinate,\n\ty: Coordinate\n): HitTestResult | null {\n\tconst sources = pane.orderedSources();\n\tconst bestPrimitiveHit = findBestPrimitiveHitTest(sources, x, y);\n\tif (bestPrimitiveHit?.hit.zOrder === 'top') {\n        // a primitive hit on the 'top' layer will always beat the built-in hit tests\n        // (on normal layer) so we can return early here.\n\t\treturn convertPrimitiveHitResult(bestPrimitiveHit);\n\t}\n\tfor (const source of sources) {\n\t\tif (bestPrimitiveHit && bestPrimitiveHit.source === source && bestPrimitiveHit.hit.zOrder !== 'bottom' && !bestPrimitiveHit.hit.isBackground) {\n            // a primitive will be drawn above a built-in item like a series marker\n            // therefore it takes precedence here.\n\t\t\treturn convertPrimitiveHitResult(bestPrimitiveHit);\n\t\t}\n\t\tconst sourceResult = hitTestPaneView(source.paneViews(pane), x, y);\n\t\tif (sourceResult !== null) {\n\t\t\treturn {\n\t\t\t\tsource: source,\n\t\t\t\tview: sourceResult.view,\n\t\t\t\tobject: sourceResult.object,\n\t\t\t};\n\t\t}\n\t\tif (bestPrimitiveHit && bestPrimitiveHit.source === source && bestPrimitiveHit.hit.zOrder !== 'bottom' && bestPrimitiveHit.hit.isBackground) {\n\t\t\treturn convertPrimitiveHitResult(bestPrimitiveHit);\n\t\t}\n\t}\n\tif (bestPrimitiveHit?.hit) {\n        // return primitive hits for the 'bottom' layer\n\t\treturn convertPrimitiveHitResult(bestPrimitiveHit);\n\t}\n\n\treturn null;\n}\n","import {\n\tBitmapCoordinatesRenderingScope,\n\tCanvasElementBitmapSizeBinding,\n\tCanvasRenderingTarget2D,\n\tequalSizes,\n\tMediaCoordinatesRenderingScope,\n\tSize,\n\tsize,\n\ttryCreateCanvasRenderingTarget2D,\n} from 'fancy-canvas';\n\nimport { ensureNotNull } from '../helpers/assertions';\nimport { clearRect, clearRectWithGradient } from '../helpers/canvas-helpers';\nimport { IDestroyable } from '../helpers/idestroyable';\nimport { makeFont } from '../helpers/make-font';\n\nimport { ChartOptionsInternalBase } from '../model/chart-model';\nimport { Coordinate } from '../model/coordinate';\nimport { IDataSource } from '../model/idata-source';\nimport { InvalidationLevel } from '../model/invalidate-mask';\nimport { IPriceDataSource } from '../model/iprice-data-source';\nimport { SeriesPrimitivePaneViewZOrder } from '../model/iseries-primitive';\nimport { LayoutOptions } from '../model/layout-options';\nimport { PriceScalePosition } from '../model/pane';\nimport { PriceMark, PriceScale } from '../model/price-scale';\nimport { TextWidthCache } from '../model/text-width-cache';\nimport { PriceAxisViewRendererOptions } from '../renderers/iprice-axis-view-renderer';\nimport { PriceAxisRendererOptionsProvider } from '../renderers/price-axis-renderer-options-provider';\nimport { IAxisView } from '../views/pane/iaxis-view';\nimport { IPriceAxisView } from '../views/price-axis/iprice-axis-view';\n\nimport { createBoundCanvas, releaseCanvas } from './canvas-utils';\nimport { IPriceAxisViewsGetter } from './iaxis-view-getters';\nimport { suggestPriceScaleWidth } from './internal-layout-sizes-hints';\nimport { MouseEventHandler, MouseEventHandlers, TouchMouseEvent } from './mouse-event-handler';\nimport { PaneWidget } from './pane-widget';\n\nexport type PriceAxisWidgetSide = Exclude<PriceScalePosition, 'overlay'>;\n\nconst enum CursorType {\n\tDefault,\n\tNsResize,\n}\n\nconst enum Constants {\n\tDefaultOptimalWidth = 34,\n}\n\ntype IPriceAxisViewArray = readonly IPriceAxisView[];\n\nconst enum Constants {\n\tLabelOffset = 5,\n}\n\nfunction buildPriceAxisViewsGetter(\n\tzOrder: SeriesPrimitivePaneViewZOrder,\n\tpriceScaleId: PriceAxisWidgetSide\n): IPriceAxisViewsGetter {\n\treturn (source: IDataSource): readonly IAxisView[] => {\n\t\tconst psId = source.priceScale()?.id() ?? '';\n\t\tif (psId !== priceScaleId) {\n\t\t\t// exclude if source is using a different price scale.\n\t\t\treturn [];\n\t\t}\n\t\treturn source.pricePaneViews?.(zOrder) ?? [];\n\t};\n}\n\nexport class PriceAxisWidget implements IDestroyable {\n\tprivate readonly _pane: PaneWidget;\n\tprivate readonly _options: Readonly<ChartOptionsInternalBase>;\n\tprivate readonly _layoutOptions: Readonly<LayoutOptions>;\n\tprivate readonly _rendererOptionsProvider: PriceAxisRendererOptionsProvider;\n\tprivate readonly _isLeft: boolean;\n\n\tprivate _priceScale: PriceScale | null = null;\n\n\tprivate _size: Size | null = null;\n\n\tprivate readonly _cell: HTMLDivElement;\n\tprivate readonly _canvasBinding: CanvasElementBitmapSizeBinding;\n\tprivate readonly _topCanvasBinding: CanvasElementBitmapSizeBinding;\n\n\tprivate _mouseEventHandler: MouseEventHandler;\n\tprivate _mousedown: boolean = false;\n\n\tprivate readonly _widthCache: TextWidthCache = new TextWidthCache(200);\n\n\tprivate _font: string | null = null;\n\tprivate _prevOptimalWidth: number = 0;\n\tprivate _isSettingSize: boolean = false;\n\n\tprivate _sourcePaneViews: IPriceAxisViewsGetter;\n\tprivate _sourceTopPaneViews: IPriceAxisViewsGetter;\n\tprivate _sourceBottomPaneViews: IPriceAxisViewsGetter;\n\n\tpublic constructor(pane: PaneWidget, options: Readonly<ChartOptionsInternalBase>, rendererOptionsProvider: PriceAxisRendererOptionsProvider, side: PriceAxisWidgetSide) {\n\t\tthis._pane = pane;\n\t\tthis._options = options;\n\t\tthis._layoutOptions = options.layout;\n\t\tthis._rendererOptionsProvider = rendererOptionsProvider;\n\t\tthis._isLeft = side === 'left';\n\n\t\tthis._sourcePaneViews = buildPriceAxisViewsGetter('normal', side);\n\t\tthis._sourceTopPaneViews = buildPriceAxisViewsGetter('top', side);\n\t\tthis._sourceBottomPaneViews = buildPriceAxisViewsGetter('bottom', side);\n\n\t\tthis._cell = document.createElement('div');\n\t\tthis._cell.style.height = '100%';\n\t\tthis._cell.style.overflow = 'hidden';\n\t\tthis._cell.style.width = '25px';\n\t\tthis._cell.style.left = '0';\n\t\tthis._cell.style.position = 'relative';\n\n\t\tthis._canvasBinding = createBoundCanvas(this._cell, size({ width: 16, height: 16 }));\n\t\tthis._canvasBinding.subscribeSuggestedBitmapSizeChanged(this._canvasSuggestedBitmapSizeChangedHandler);\n\t\tconst canvas = this._canvasBinding.canvasElement;\n\t\tcanvas.style.position = 'absolute';\n\t\tcanvas.style.zIndex = '1';\n\t\tcanvas.style.left = '0';\n\t\tcanvas.style.top = '0';\n\n\t\tthis._topCanvasBinding = createBoundCanvas(this._cell, size({ width: 16, height: 16 }));\n\t\tthis._topCanvasBinding.subscribeSuggestedBitmapSizeChanged(this._topCanvasSuggestedBitmapSizeChangedHandler);\n\t\tconst topCanvas = this._topCanvasBinding.canvasElement;\n\t\ttopCanvas.style.position = 'absolute';\n\t\ttopCanvas.style.zIndex = '2';\n\t\ttopCanvas.style.left = '0';\n\t\ttopCanvas.style.top = '0';\n\n\t\tconst handler: MouseEventHandlers = {\n\t\t\tmouseDownEvent: this._mouseDownEvent.bind(this),\n\t\t\ttouchStartEvent: this._mouseDownEvent.bind(this),\n\t\t\tpressedMouseMoveEvent: this._pressedMouseMoveEvent.bind(this),\n\t\t\ttouchMoveEvent: this._pressedMouseMoveEvent.bind(this),\n\t\t\tmouseDownOutsideEvent: this._mouseDownOutsideEvent.bind(this),\n\t\t\tmouseUpEvent: this._mouseUpEvent.bind(this),\n\t\t\ttouchEndEvent: this._mouseUpEvent.bind(this),\n\t\t\tmouseDoubleClickEvent: this._mouseDoubleClickEvent.bind(this),\n\t\t\tdoubleTapEvent: this._mouseDoubleClickEvent.bind(this),\n\t\t\tmouseEnterEvent: this._mouseEnterEvent.bind(this),\n\t\t\tmouseLeaveEvent: this._mouseLeaveEvent.bind(this),\n\t\t};\n\t\tthis._mouseEventHandler = new MouseEventHandler(\n\t\t\tthis._topCanvasBinding.canvasElement,\n\t\t\thandler,\n\t\t\t{\n\t\t\t\ttreatVertTouchDragAsPageScroll: () => !this._options.handleScroll.vertTouchDrag,\n\t\t\t\ttreatHorzTouchDragAsPageScroll: () => true,\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic destroy(): void {\n\t\tthis._mouseEventHandler.destroy();\n\n\t\tthis._topCanvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._topCanvasSuggestedBitmapSizeChangedHandler);\n\t\treleaseCanvas(this._topCanvasBinding.canvasElement);\n\t\tthis._topCanvasBinding.dispose();\n\n\t\tthis._canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._canvasSuggestedBitmapSizeChangedHandler);\n\t\treleaseCanvas(this._canvasBinding.canvasElement);\n\t\tthis._canvasBinding.dispose();\n\n\t\tif (this._priceScale !== null) {\n\t\t\tthis._priceScale.onMarksChanged().unsubscribeAll(this);\n\t\t}\n\n\t\tthis._priceScale = null;\n\t}\n\n\tpublic getElement(): HTMLElement {\n\t\treturn this._cell;\n\t}\n\n\tpublic fontSize(): number {\n\t\treturn this._layoutOptions.fontSize;\n\t}\n\n\tpublic rendererOptions(): Readonly<PriceAxisViewRendererOptions> {\n\t\tconst options = this._rendererOptionsProvider.options();\n\t\tconst isFontChanged = this._font !== options.font;\n\n\t\tif (isFontChanged) {\n\t\t\tthis._widthCache.reset();\n\t\t\tthis._font = options.font;\n\t\t}\n\n\t\treturn options;\n\t}\n\n\tpublic optimalWidth(): number {\n\t\tif (this._priceScale === null) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tlet tickMarkMaxWidth = 0;\n\t\tconst rendererOptions = this.rendererOptions();\n\n\t\tconst ctx = ensureNotNull(this._canvasBinding.canvasElement.getContext('2d'));\n\t\tctx.save();\n\n\t\tconst tickMarks = this._priceScale.marks();\n\n\t\tctx.font = this._baseFont();\n\n\t\tif (tickMarks.length > 0) {\n\t\t\ttickMarkMaxWidth = Math.max(\n\t\t\t\tthis._widthCache.measureText(ctx, tickMarks[0].label),\n\t\t\t\tthis._widthCache.measureText(ctx, tickMarks[tickMarks.length - 1].label)\n\t\t\t);\n\t\t}\n\n\t\tconst views = this._backLabels();\n\t\tfor (let j = views.length; j--;) {\n\t\t\tconst width = this._widthCache.measureText(ctx, views[j].text());\n\t\t\tif (width > tickMarkMaxWidth) {\n\t\t\t\ttickMarkMaxWidth = width;\n\t\t\t}\n\t\t}\n\n\t\tconst firstValue = this._priceScale.firstValue();\n\t\tif (firstValue !== null && this._size !== null) {\n\t\t\tconst topValue = this._priceScale.coordinateToPrice(1 as Coordinate, firstValue);\n\t\t\tconst bottomValue = this._priceScale.coordinateToPrice(this._size.height - 2 as Coordinate, firstValue);\n\n\t\t\ttickMarkMaxWidth = Math.max(\n\t\t\t\ttickMarkMaxWidth,\n\t\t\t\tthis._widthCache.measureText(ctx, this._priceScale.formatPrice(Math.floor(Math.min(topValue, bottomValue)) + 0.11111111111111, firstValue)),\n\t\t\t\tthis._widthCache.measureText(ctx, this._priceScale.formatPrice(Math.ceil(Math.max(topValue, bottomValue)) - 0.11111111111111, firstValue))\n\t\t\t);\n\t\t}\n\n\t\tctx.restore();\n\n\t\tconst resultTickMarksMaxWidth = tickMarkMaxWidth || Constants.DefaultOptimalWidth;\n\t\tconst res = Math.ceil(\n\t\t\trendererOptions.borderSize +\n\t\t\trendererOptions.tickLength +\n\t\t\trendererOptions.paddingInner +\n\t\t\trendererOptions.paddingOuter +\n\t\t\tConstants.LabelOffset +\n\t\t\tresultTickMarksMaxWidth\n\t\t);\n\n\t\t// make it even, remove this after migration to perfect fancy canvas\n\t\treturn suggestPriceScaleWidth(res);\n\t}\n\n\tpublic setSize(newSize: Size): void {\n\t\tif (this._size === null || !equalSizes(this._size, newSize)) {\n\t\t\tthis._size = newSize;\n\n\t\t\tthis._isSettingSize = true;\n\t\t\tthis._canvasBinding.resizeCanvasElement(newSize);\n\t\t\tthis._topCanvasBinding.resizeCanvasElement(newSize);\n\t\t\tthis._isSettingSize = false;\n\n\t\t\tthis._cell.style.width = `${newSize.width}px`;\n\t\t\tthis._cell.style.height = `${newSize.height}px`;\n\t\t}\n\t}\n\n\tpublic getWidth(): number {\n\t\treturn ensureNotNull(this._size).width;\n\t}\n\n\tpublic setPriceScale(priceScale: PriceScale): void {\n\t\tif (this._priceScale === priceScale) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._priceScale !== null) {\n\t\t\tthis._priceScale.onMarksChanged().unsubscribeAll(this);\n\t\t}\n\n\t\tthis._priceScale = priceScale;\n\t\tpriceScale.onMarksChanged().subscribe(this._onMarksChanged.bind(this), this);\n\t}\n\n\tpublic priceScale(): PriceScale | null {\n\t\treturn this._priceScale;\n\t}\n\n\tpublic reset(): void {\n\t\tconst pane = this._pane.state();\n\t\tconst model = this._pane.chart().model();\n\t\tmodel.resetPriceScale(pane, ensureNotNull(this.priceScale()));\n\t}\n\n\tpublic paint(type: InvalidationLevel): void {\n\t\tif (this._size === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (type !== InvalidationLevel.Cursor) {\n\t\t\tthis._alignLabels();\n\t\t\tthis._canvasBinding.applySuggestedBitmapSize();\n\t\t\tconst target = tryCreateCanvasRenderingTarget2D(this._canvasBinding);\n\t\t\tif (target !== null) {\n\t\t\t\ttarget.useBitmapCoordinateSpace((scope: BitmapCoordinatesRenderingScope) => {\n\t\t\t\t\tthis._drawBackground(scope);\n\t\t\t\t\tthis._drawBorder(scope);\n\t\t\t\t});\n\t\t\t\tthis._pane.drawAdditionalSources(target, this._sourceBottomPaneViews);\n\t\t\t\tthis._drawTickMarks(target);\n\t\t\t\tthis._pane.drawAdditionalSources(target, this._sourcePaneViews);\n\t\t\t\tthis._drawBackLabels(target);\n\t\t\t}\n\t\t}\n\n\t\tthis._topCanvasBinding.applySuggestedBitmapSize();\n\t\tconst topTarget = tryCreateCanvasRenderingTarget2D(this._topCanvasBinding);\n\t\tif (topTarget !== null) {\n\t\t\ttopTarget.useBitmapCoordinateSpace(({ context: ctx, bitmapSize }: BitmapCoordinatesRenderingScope) => {\n\t\t\t\tctx.clearRect(0, 0, bitmapSize.width, bitmapSize.height);\n\t\t\t});\n\t\t\tthis._drawCrosshairLabel(topTarget);\n\t\t\tthis._pane.drawAdditionalSources(topTarget, this._sourceTopPaneViews);\n\t\t}\n\t}\n\n\tpublic getBitmapSize(): Size {\n\t\treturn this._canvasBinding.bitmapSize;\n\t}\n\n\tpublic drawBitmap(ctx: CanvasRenderingContext2D, x: number, y: number): void {\n\t\tconst bitmapSize = this.getBitmapSize();\n\t\tif (bitmapSize.width > 0 && bitmapSize.height > 0) {\n\t\t\tctx.drawImage(this._canvasBinding.canvasElement, x, y);\n\t\t}\n\t}\n\n\tpublic update(): void {\n\t\t// this call has side-effect - it regenerates marks on the price scale\n\t\tthis._priceScale?.marks();\n\t}\n\n\tprivate _mouseDownEvent(e: TouchMouseEvent): void {\n\t\tif (this._priceScale === null || this._priceScale.isEmpty() || !this._options.handleScale.axisPressedMouseMove.price) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = this._pane.chart().model();\n\t\tconst pane = this._pane.state();\n\t\tthis._mousedown = true;\n\t\tmodel.startScalePrice(pane, this._priceScale, e.localY);\n\t}\n\n\tprivate _pressedMouseMoveEvent(e: TouchMouseEvent): void {\n\t\tif (this._priceScale === null || !this._options.handleScale.axisPressedMouseMove.price) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = this._pane.chart().model();\n\t\tconst pane = this._pane.state();\n\t\tconst priceScale = this._priceScale;\n\t\tmodel.scalePriceTo(pane, priceScale, e.localY);\n\t}\n\n\tprivate _mouseDownOutsideEvent(): void {\n\t\tif (this._priceScale === null || !this._options.handleScale.axisPressedMouseMove.price) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = this._pane.chart().model();\n\t\tconst pane = this._pane.state();\n\n\t\tconst priceScale = this._priceScale;\n\t\tif (this._mousedown) {\n\t\t\tthis._mousedown = false;\n\t\t\tmodel.endScalePrice(pane, priceScale);\n\t\t}\n\t}\n\n\tprivate _mouseUpEvent(e: TouchMouseEvent): void {\n\t\tif (this._priceScale === null || !this._options.handleScale.axisPressedMouseMove.price) {\n\t\t\treturn;\n\t\t}\n\t\tconst model = this._pane.chart().model();\n\t\tconst pane = this._pane.state();\n\t\tthis._mousedown = false;\n\t\tmodel.endScalePrice(pane, this._priceScale);\n\t}\n\n\tprivate _mouseDoubleClickEvent(e: TouchMouseEvent): void {\n\t\tif (this._options.handleScale.axisDoubleClickReset.price) {\n\t\t\tthis.reset();\n\t\t}\n\t}\n\n\tprivate _mouseEnterEvent(e: TouchMouseEvent): void {\n\t\tif (this._priceScale === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = this._pane.chart().model();\n\t\tif (model.options().handleScale.axisPressedMouseMove.price && !this._priceScale.isPercentage() && !this._priceScale.isIndexedTo100()) {\n\t\t\tthis._setCursor(CursorType.NsResize);\n\t\t}\n\t}\n\n\tprivate _mouseLeaveEvent(e: TouchMouseEvent): void {\n\t\tthis._setCursor(CursorType.Default);\n\t}\n\n\tprivate _backLabels(): IPriceAxisView[] {\n\t\tconst res: IPriceAxisView[] = [];\n\n\t\tconst priceScale = (this._priceScale === null) ? undefined : this._priceScale;\n\n\t\tconst addViewsForSources = (sources: readonly IDataSource[]) => {\n\t\t\tfor (let i = 0; i < sources.length; ++i) {\n\t\t\t\tconst source = sources[i];\n\t\t\t\tconst views = source.priceAxisViews(this._pane.state(), priceScale);\n\t\t\t\tfor (let j = 0; j < views.length; j++) {\n\t\t\t\t\tres.push(views[j]);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// calculate max and min coordinates for views on selection\n\t\t// crosshair individually\n\t\taddViewsForSources(this._pane.state().orderedSources());\n\n\t\treturn res;\n\t}\n\n\tprivate _drawBackground({ context: ctx, bitmapSize }: BitmapCoordinatesRenderingScope): void {\n\t\tconst { width, height } = bitmapSize;\n\t\tconst model = this._pane.state().model();\n\t\tconst topColor = model.backgroundTopColor();\n\t\tconst bottomColor = model.backgroundBottomColor();\n\n\t\tif (topColor === bottomColor) {\n\t\t\tclearRect(ctx, 0, 0, width, height, topColor);\n\t\t} else {\n\t\t\tclearRectWithGradient(ctx, 0, 0, width, height, topColor, bottomColor);\n\t\t}\n\t}\n\n\tprivate _drawBorder({ context: ctx, bitmapSize, horizontalPixelRatio }: BitmapCoordinatesRenderingScope): void {\n\t\tif (this._size === null || this._priceScale === null || !this._priceScale.options().borderVisible) {\n\t\t\treturn;\n\t\t}\n\n\t\tctx.fillStyle = this._priceScale.options().borderColor;\n\n\t\tconst borderSize = Math.max(1, Math.floor(this.rendererOptions().borderSize * horizontalPixelRatio));\n\n\t\tlet left: number;\n\t\tif (this._isLeft) {\n\t\t\tleft = bitmapSize.width - borderSize;\n\t\t} else {\n\t\t\tleft = 0;\n\t\t}\n\n\t\tctx.fillRect(left, 0, borderSize, bitmapSize.height);\n\t}\n\n\tprivate _drawTickMarks(target: CanvasRenderingTarget2D): void {\n\t\tif (this._size === null || this._priceScale === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst tickMarks = this._priceScale.marks();\n\t\tconst priceScaleOptions = this._priceScale.options();\n\t\tconst rendererOptions = this.rendererOptions();\n\t\tconst tickMarkLeftX = this._isLeft ?\n\t\t\t(this._size.width - rendererOptions.tickLength) :\n\t\t\t0;\n\n\t\tif (priceScaleOptions.borderVisible && priceScaleOptions.ticksVisible) {\n\t\t\ttarget.useBitmapCoordinateSpace(({ context: ctx, horizontalPixelRatio, verticalPixelRatio }: BitmapCoordinatesRenderingScope) => {\n\t\t\t\tctx.fillStyle = priceScaleOptions.borderColor;\n\n\t\t\t\tconst tickHeight = Math.max(1, Math.floor(verticalPixelRatio));\n\t\t\t\tconst tickOffset = Math.floor(verticalPixelRatio * 0.5);\n\t\t\t\tconst tickLength = Math.round(rendererOptions.tickLength * horizontalPixelRatio);\n\n\t\t\t\tctx.beginPath();\n\t\t\t\tfor (const tickMark of tickMarks) {\n\t\t\t\t\tctx.rect(\n\t\t\t\t\t\tMath.floor(tickMarkLeftX * horizontalPixelRatio),\n\t\t\t\t\t\tMath.round(tickMark.coord * verticalPixelRatio) - tickOffset,\n\t\t\t\t\t\ttickLength,\n\t\t\t\t\t\ttickHeight\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tctx.fill();\n\t\t\t});\n\t\t}\n\n\t\ttarget.useMediaCoordinateSpace(({ context: ctx }: MediaCoordinatesRenderingScope) => {\n\t\t\tctx.font = this._baseFont();\n\t\t\tctx.fillStyle = priceScaleOptions.textColor ?? this._layoutOptions.textColor;\n\t\t\tctx.textAlign = this._isLeft ? 'right' : 'left';\n\t\t\tctx.textBaseline = 'middle';\n\n\t\t\tconst textLeftX = this._isLeft ?\n\t\t\t\tMath.round(tickMarkLeftX - rendererOptions.paddingInner) :\n\t\t\t\tMath.round(tickMarkLeftX + rendererOptions.tickLength + rendererOptions.paddingInner);\n\n\t\t\tconst yMidCorrections = tickMarks.map((mark: PriceMark) => this._widthCache.yMidCorrection(ctx, mark.label));\n\n\t\t\tfor (let i = tickMarks.length; i--;) {\n\t\t\t\tconst tickMark = tickMarks[i];\n\t\t\t\tctx.fillText(tickMark.label, textLeftX, tickMark.coord + yMidCorrections[i]);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _alignLabels(): void {\n\t\tif (this._size === null || this._priceScale === null) {\n\t\t\treturn;\n\t\t}\n\t\tlet center = this._size.height / 2;\n\n\t\tconst views: IPriceAxisView[] = [];\n\t\tconst orderedSources = this._priceScale.orderedSources().slice(); // Copy of array\n\t\tconst pane = this._pane;\n\t\tconst paneState = pane.state();\n\t\tconst rendererOptions = this.rendererOptions();\n\n\t\t// if we are default price scale, append labels from no-scale\n\t\tconst isDefault = this._priceScale === paneState.defaultVisiblePriceScale();\n\n\t\tif (isDefault) {\n\t\t\tthis._pane.state().orderedSources().forEach((source: IPriceDataSource) => {\n\t\t\t\tif (paneState.isOverlay(source)) {\n\t\t\t\t\torderedSources.push(source);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// we can use any, but let's use the first source as \"center\" one\n\t\tconst centerSource = this._priceScale.dataSources()[0];\n\t\tconst priceScale = this._priceScale;\n\n\t\tconst updateForSources = (sources: IDataSource[]) => {\n\t\t\tsources.forEach((source: IDataSource) => {\n\t\t\t\tconst sourceViews = source.priceAxisViews(paneState, priceScale);\n\t\t\t\t// never align selected sources\n\t\t\t\tsourceViews.forEach((view: IPriceAxisView) => {\n\t\t\t\t\tview.setFixedCoordinate(null);\n\t\t\t\t\tif (view.isVisible()) {\n\t\t\t\t\t\tviews.push(view);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (centerSource === source && sourceViews.length > 0) {\n\t\t\t\t\tcenter = sourceViews[0].coordinate();\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t// crosshair individually\n\t\tupdateForSources(orderedSources);\n\n\t\tviews.forEach((view: IPriceAxisView) => view.setFixedCoordinate(view.coordinate()));\n\n\t\tconst options = this._priceScale.options();\n\t\tif (!options.alignLabels) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._fixLabelOverlap(views, rendererOptions, center);\n\t}\n\n\tprivate _fixLabelOverlap(views: IPriceAxisView[], rendererOptions: Readonly<PriceAxisViewRendererOptions>, center: number): void {\n\t\tif (this._size === null) {\n\t\t\treturn;\n\t\t}\n\n\t\t// split into two parts\n\t\tconst top = views.filter((view: IPriceAxisView) => view.coordinate() <= center);\n\t\tconst bottom = views.filter((view: IPriceAxisView) => view.coordinate() > center);\n\n\t\t// sort top from center to top\n\t\ttop.sort((l: IPriceAxisView, r: IPriceAxisView) => r.coordinate() - l.coordinate());\n\n\t\t// share center label\n\t\tif (top.length && bottom.length) {\n\t\t\tbottom.push(top[0]);\n\t\t}\n\n\t\tbottom.sort((l: IPriceAxisView, r: IPriceAxisView) => l.coordinate() - r.coordinate());\n\n\t\tfor (const view of views) {\n\t\t\tconst halfHeight = Math.floor(view.height(rendererOptions) / 2);\n\t\t\tconst coordinate = view.coordinate();\n\t\t\tif (coordinate > -halfHeight && coordinate < halfHeight) {\n\t\t\t\tview.setFixedCoordinate(halfHeight);\n\t\t\t}\n\n\t\t\tif (coordinate > (this._size.height - halfHeight) && coordinate < this._size.height + halfHeight) {\n\t\t\t\tview.setFixedCoordinate(this._size.height - halfHeight);\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 1; i < top.length; i++) {\n\t\t\tconst view = top[i];\n\t\t\tconst prev = top[i - 1];\n\t\t\tconst height = prev.height(rendererOptions, false);\n\t\t\tconst coordinate = view.coordinate();\n\t\t\tconst prevFixedCoordinate = prev.getFixedCoordinate();\n\n\t\t\tif (coordinate > prevFixedCoordinate - height) {\n\t\t\t\tview.setFixedCoordinate(prevFixedCoordinate - height);\n\t\t\t}\n\t\t}\n\n\t\tfor (let j = 1; j < bottom.length; j++) {\n\t\t\tconst view = bottom[j];\n\t\t\tconst prev = bottom[j - 1];\n\t\t\tconst height = prev.height(rendererOptions, true);\n\t\t\tconst coordinate = view.coordinate();\n\t\t\tconst prevFixedCoordinate = prev.getFixedCoordinate();\n\n\t\t\tif (coordinate < prevFixedCoordinate + height) {\n\t\t\t\tview.setFixedCoordinate(prevFixedCoordinate + height);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _drawBackLabels(target: CanvasRenderingTarget2D): void {\n\t\tif (this._size === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst views = this._backLabels();\n\n\t\tconst rendererOptions = this.rendererOptions();\n\t\tconst align = this._isLeft ? 'right' : 'left';\n\n\t\tviews.forEach((view: IPriceAxisView) => {\n\t\t\tif (view.isAxisLabelVisible()) {\n\t\t\t\tconst renderer = view.renderer(ensureNotNull(this._priceScale));\n\t\t\t\trenderer.draw(target, rendererOptions, this._widthCache, align);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _drawCrosshairLabel(target: CanvasRenderingTarget2D): void {\n\t\tif (this._size === null || this._priceScale === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = this._pane.chart().model();\n\n\t\tconst views: IPriceAxisViewArray[] = []; // array of arrays\n\t\tconst pane = this._pane.state();\n\n\t\tconst v = model.crosshairSource().priceAxisViews(pane, this._priceScale);\n\t\tif (v.length) {\n\t\t\tviews.push(v);\n\t\t}\n\n\t\tconst ro = this.rendererOptions();\n\t\tconst align = this._isLeft ? 'right' : 'left';\n\n\t\tviews.forEach((arr: IPriceAxisViewArray) => {\n\t\t\tarr.forEach((view: IPriceAxisView) => {\n\t\t\t\tview.renderer(ensureNotNull(this._priceScale)).draw(target, ro, this._widthCache, align);\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate _setCursor(type: CursorType): void {\n\t\tthis._cell.style.cursor = type === CursorType.NsResize ? 'ns-resize' : 'default';\n\t}\n\n\tprivate _onMarksChanged(): void {\n\t\tconst width = this.optimalWidth();\n\n\t\t// avoid price scale is shrunk\n\t\t// using < instead !== to avoid infinite changes\n\t\tif (this._prevOptimalWidth < width) {\n\t\t\tthis._pane.chart().model().fullUpdate();\n\t\t}\n\n\t\tthis._prevOptimalWidth = width;\n\t}\n\n\tprivate readonly _canvasSuggestedBitmapSizeChangedHandler = () => {\n\t\tif (this._isSettingSize) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._pane.chart().model().lightUpdate();\n\t};\n\n\tprivate readonly _topCanvasSuggestedBitmapSizeChangedHandler = () => {\n\t\tif (this._isSettingSize) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._pane.chart().model().lightUpdate();\n\t};\n\n\tprivate _baseFont(): string {\n\t\treturn makeFont(this._layoutOptions.fontSize, this._layoutOptions.fontFamily);\n\t}\n}\n","import {\n\tBitmapCoordinatesRenderingScope,\n\tCanvasElementBitmapSizeBinding,\n\tCanvasRenderingTarget2D,\n\tequalSizes,\n\tSize,\n\tsize,\n\ttryCreateCanvasRenderingTarget2D,\n} from 'fancy-canvas';\n\nimport { ensureNotNull } from '../helpers/assertions';\nimport { clearRect, clearRectWithGradient } from '../helpers/canvas-helpers';\nimport { Delegate } from '../helpers/delegate';\nimport { IDestroyable } from '../helpers/idestroyable';\nimport { ISubscription } from '../helpers/isubscription';\n\nimport { IChartModelBase, TrackingModeExitMode } from '../model/chart-model';\nimport { Coordinate } from '../model/coordinate';\nimport { IDataSource } from '../model/idata-source';\nimport { InvalidationLevel } from '../model/invalidate-mask';\nimport { KineticAnimation } from '../model/kinetic-animation';\nimport { Pane } from '../model/pane';\nimport { Point } from '../model/point';\nimport { TimePointIndex } from '../model/time-data';\nimport { TouchMouseEventData } from '../model/touch-mouse-event-data';\nimport { IPaneRenderer } from '../renderers/ipane-renderer';\nimport { IPaneView } from '../views/pane/ipane-view';\n\nimport { createBoundCanvas, releaseCanvas } from './canvas-utils';\nimport { IChartWidgetBase } from './chart-widget';\nimport { drawBackground, drawForeground, DrawFunction, drawSourcePaneViews } from './draw-functions';\nimport { IPaneViewsGetter } from './ipane-view-getter';\nimport { MouseEventHandler, MouseEventHandlerEventBase, MouseEventHandlerMouseEvent, MouseEventHandlers, MouseEventHandlerTouchEvent, Position, TouchMouseEvent } from './mouse-event-handler';\nimport { hitTestPane, HitTestResult } from './pane-hit-test';\nimport { PriceAxisWidget, PriceAxisWidgetSide } from './price-axis-widget';\n\nconst enum KineticScrollConstants {\n\tMinScrollSpeed = 0.2,\n\tMaxScrollSpeed = 7,\n\tDumpingCoeff = 0.997,\n\tScrollMinMove = 15,\n}\n\nfunction sourceBottomPaneViews(source: IDataSource, pane: Pane): readonly IPaneView[] {\n\treturn source.bottomPaneViews?.(pane) ?? [];\n}\nfunction sourcePaneViews(source: IDataSource, pane: Pane): readonly IPaneView[] {\n\treturn source.paneViews?.(pane) ?? [];\n}\nfunction sourceLabelPaneViews(source: IDataSource, pane: Pane): readonly IPaneView[] {\n\treturn source.labelPaneViews?.(pane) ?? [];\n}\nfunction sourceTopPaneViews(source: IDataSource, pane: Pane): readonly IPaneView[] {\n\treturn source.topPaneViews?.(pane) ?? [];\n}\n\ninterface StartScrollPosition extends Point {\n\ttimestamp: number;\n\tlocalX: Coordinate;\n\tlocalY: Coordinate;\n}\n\nexport class PaneWidget implements IDestroyable, MouseEventHandlers {\n\tprivate readonly _chart: IChartWidgetBase;\n\tprivate _state: Pane | null;\n\tprivate _size: Size = size({ width: 0, height: 0 });\n\tprivate _leftPriceAxisWidget: PriceAxisWidget | null = null;\n\tprivate _rightPriceAxisWidget: PriceAxisWidget | null = null;\n\tprivate readonly _paneCell: HTMLElement;\n\tprivate readonly _leftAxisCell: HTMLElement;\n\tprivate readonly _rightAxisCell: HTMLElement;\n\tprivate readonly _canvasBinding: CanvasElementBitmapSizeBinding;\n\tprivate readonly _topCanvasBinding: CanvasElementBitmapSizeBinding;\n\tprivate readonly _rowElement: HTMLElement;\n\tprivate readonly _mouseEventHandler: MouseEventHandler;\n\tprivate _startScrollingPos: StartScrollPosition | null = null;\n\tprivate _isScrolling: boolean = false;\n\tprivate _clicked: Delegate<TimePointIndex | null, Point, TouchMouseEventData> = new Delegate();\n\tprivate _dblClicked: Delegate<TimePointIndex | null, Point, TouchMouseEventData> = new Delegate();\n\tprivate _prevPinchScale: number = 0;\n\tprivate _longTap: boolean = false;\n\tprivate _startTrackPoint: Point | null = null;\n\tprivate _exitTrackingModeOnNextTry: boolean = false;\n\tprivate _initCrosshairPosition: Point | null = null;\n\n\tprivate _scrollXAnimation: KineticAnimation | null = null;\n\n\tprivate _isSettingSize: boolean = false;\n\n\tpublic constructor(chart: IChartWidgetBase, state: Pane) {\n\t\tthis._chart = chart;\n\n\t\tthis._state = state;\n\t\tthis._state.onDestroyed().subscribe(this._onStateDestroyed.bind(this), this, true);\n\n\t\tthis._paneCell = document.createElement('td');\n\t\tthis._paneCell.style.padding = '0';\n\t\tthis._paneCell.style.position = 'relative';\n\n\t\tconst paneWrapper = document.createElement('div');\n\t\tpaneWrapper.style.width = '100%';\n\t\tpaneWrapper.style.height = '100%';\n\t\tpaneWrapper.style.position = 'relative';\n\t\tpaneWrapper.style.overflow = 'hidden';\n\n\t\tthis._leftAxisCell = document.createElement('td');\n\t\tthis._leftAxisCell.style.padding = '0';\n\n\t\tthis._rightAxisCell = document.createElement('td');\n\t\tthis._rightAxisCell.style.padding = '0';\n\n\t\tthis._paneCell.appendChild(paneWrapper);\n\n\t\tthis._canvasBinding = createBoundCanvas(paneWrapper, size({ width: 16, height: 16 }));\n\t\tthis._canvasBinding.subscribeSuggestedBitmapSizeChanged(this._canvasSuggestedBitmapSizeChangedHandler);\n\t\tconst canvas = this._canvasBinding.canvasElement;\n\t\tcanvas.style.position = 'absolute';\n\t\tcanvas.style.zIndex = '1';\n\t\tcanvas.style.left = '0';\n\t\tcanvas.style.top = '0';\n\n\t\tthis._topCanvasBinding = createBoundCanvas(paneWrapper, size({ width: 16, height: 16 }));\n\t\tthis._topCanvasBinding.subscribeSuggestedBitmapSizeChanged(this._topCanvasSuggestedBitmapSizeChangedHandler);\n\t\tconst topCanvas = this._topCanvasBinding.canvasElement;\n\t\ttopCanvas.style.position = 'absolute';\n\t\ttopCanvas.style.zIndex = '2';\n\t\ttopCanvas.style.left = '0';\n\t\ttopCanvas.style.top = '0';\n\n\t\tthis._rowElement = document.createElement('tr');\n\t\tthis._rowElement.appendChild(this._leftAxisCell);\n\t\tthis._rowElement.appendChild(this._paneCell);\n\t\tthis._rowElement.appendChild(this._rightAxisCell);\n\t\tthis.updatePriceAxisWidgetsStates();\n\n\t\tthis._mouseEventHandler = new MouseEventHandler(\n\t\t\tthis._topCanvasBinding.canvasElement,\n\t\t\tthis,\n\t\t\t{\n\t\t\t\ttreatVertTouchDragAsPageScroll: () => this._startTrackPoint === null && !this._chart.options().handleScroll.vertTouchDrag,\n\t\t\t\ttreatHorzTouchDragAsPageScroll: () => this._startTrackPoint === null && !this._chart.options().handleScroll.horzTouchDrag,\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic destroy(): void {\n\t\tif (this._leftPriceAxisWidget !== null) {\n\t\t\tthis._leftPriceAxisWidget.destroy();\n\t\t}\n\t\tif (this._rightPriceAxisWidget !== null) {\n\t\t\tthis._rightPriceAxisWidget.destroy();\n\t\t}\n\n\t\tthis._topCanvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._topCanvasSuggestedBitmapSizeChangedHandler);\n\t\treleaseCanvas(this._topCanvasBinding.canvasElement);\n\t\tthis._topCanvasBinding.dispose();\n\n\t\tthis._canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._canvasSuggestedBitmapSizeChangedHandler);\n\t\treleaseCanvas(this._canvasBinding.canvasElement);\n\t\tthis._canvasBinding.dispose();\n\n\t\tif (this._state !== null) {\n\t\t\tthis._state.onDestroyed().unsubscribeAll(this);\n\t\t}\n\n\t\tthis._mouseEventHandler.destroy();\n\t}\n\n\tpublic state(): Pane {\n\t\treturn ensureNotNull(this._state);\n\t}\n\n\tpublic setState(pane: Pane | null): void {\n\t\tif (this._state !== null) {\n\t\t\tthis._state.onDestroyed().unsubscribeAll(this);\n\t\t}\n\n\t\tthis._state = pane;\n\n\t\tif (this._state !== null) {\n\t\t\tthis._state.onDestroyed().subscribe(PaneWidget.prototype._onStateDestroyed.bind(this), this, true);\n\t\t}\n\n\t\tthis.updatePriceAxisWidgetsStates();\n\t}\n\n\tpublic chart(): IChartWidgetBase {\n\t\treturn this._chart;\n\t}\n\n\tpublic getElement(): HTMLElement {\n\t\treturn this._rowElement;\n\t}\n\n\tpublic updatePriceAxisWidgetsStates(): void {\n\t\tif (this._state === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._recreatePriceAxisWidgets();\n\t\tif (this._model().serieses().length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._leftPriceAxisWidget !== null) {\n\t\t\tconst leftPriceScale = this._state.leftPriceScale();\n\t\t\tthis._leftPriceAxisWidget.setPriceScale(ensureNotNull(leftPriceScale));\n\t\t}\n\t\tif (this._rightPriceAxisWidget !== null) {\n\t\t\tconst rightPriceScale = this._state.rightPriceScale();\n\t\t\tthis._rightPriceAxisWidget.setPriceScale(ensureNotNull(rightPriceScale));\n\t\t}\n\t}\n\n\tpublic updatePriceAxisWidgets(): void {\n\t\tif (this._leftPriceAxisWidget !== null) {\n\t\t\tthis._leftPriceAxisWidget.update();\n\t\t}\n\t\tif (this._rightPriceAxisWidget !== null) {\n\t\t\tthis._rightPriceAxisWidget.update();\n\t\t}\n\t}\n\n\tpublic stretchFactor(): number {\n\t\treturn this._state !== null ? this._state.stretchFactor() : 0;\n\t}\n\n\tpublic setStretchFactor(stretchFactor: number): void {\n\t\tif (this._state) {\n\t\t\tthis._state.setStretchFactor(stretchFactor);\n\t\t}\n\t}\n\n\tpublic mouseEnterEvent(event: MouseEventHandlerMouseEvent): void {\n\t\tif (!this._state) {\n\t\t\treturn;\n\t\t}\n\t\tthis._onMouseEvent();\n\t\tconst x = event.localX;\n\t\tconst y = event.localY;\n\t\tthis._setCrosshairPosition(x, y, event);\n\t}\n\n\tpublic mouseDownEvent(event: MouseEventHandlerMouseEvent): void {\n\t\tthis._onMouseEvent();\n\t\tthis._mouseTouchDownEvent();\n\t\tthis._setCrosshairPosition(event.localX, event.localY, event);\n\t}\n\n\tpublic mouseMoveEvent(event: MouseEventHandlerMouseEvent): void {\n\t\tif (!this._state) {\n\t\t\treturn;\n\t\t}\n\t\tthis._onMouseEvent();\n\n\t\tconst x = event.localX;\n\t\tconst y = event.localY;\n\t\tthis._setCrosshairPosition(x, y, event);\n\t\tconst hitTest = this.hitTest(x, y);\n\t\tthis._chart.setCursorStyle(hitTest?.cursorStyle ?? null);\n\t\tthis._model().setHoveredSource(hitTest && { source: hitTest.source, object: hitTest.object });\n\t}\n\n\tpublic mouseClickEvent(event: MouseEventHandlerMouseEvent): void {\n\t\tif (this._state === null) {\n\t\t\treturn;\n\t\t}\n\t\tthis._onMouseEvent();\n\t\tthis._fireClickedDelegate(event);\n\t}\n\n\tpublic mouseDoubleClickEvent(event: MouseEventHandlerMouseEvent | MouseEventHandlerTouchEvent): void {\n\t\tif (this._state === null) {\n\t\t\treturn;\n\t\t}\n\t\tthis._fireMouseClickDelegate(this._dblClicked, event);\n\t}\n\n\tpublic doubleTapEvent(event: MouseEventHandlerTouchEvent): void {\n\t\tthis.mouseDoubleClickEvent(event);\n\t}\n\n\tpublic pressedMouseMoveEvent(event: MouseEventHandlerMouseEvent): void {\n\t\tthis._onMouseEvent();\n\t\tthis._pressedMouseTouchMoveEvent(event);\n\t\tthis._setCrosshairPosition(event.localX, event.localY, event);\n\t}\n\n\tpublic mouseUpEvent(event: MouseEventHandlerMouseEvent): void {\n\t\tif (this._state === null) {\n\t\t\treturn;\n\t\t}\n\t\tthis._onMouseEvent();\n\n\t\tthis._longTap = false;\n\n\t\tthis._endScroll(event);\n\t}\n\n\tpublic tapEvent(event: MouseEventHandlerTouchEvent): void {\n\t\tif (this._state === null) {\n\t\t\treturn;\n\t\t}\n\t\tthis._fireClickedDelegate(event);\n\t}\n\n\tpublic longTapEvent(event: MouseEventHandlerTouchEvent): void {\n\t\tthis._longTap = true;\n\n\t\tif (this._startTrackPoint === null) {\n\t\t\tconst point: Point = { x: event.localX, y: event.localY };\n\t\t\tthis._startTrackingMode(point, point, event);\n\t\t}\n\t}\n\n\tpublic mouseLeaveEvent(event: MouseEventHandlerMouseEvent): void {\n\t\tif (this._state === null) {\n\t\t\treturn;\n\t\t}\n\t\tthis._onMouseEvent();\n\n\t\tthis._state.model().setHoveredSource(null);\n\t\tthis._clearCrosshairPosition();\n\t}\n\n\tpublic clicked(): ISubscription<TimePointIndex | null, Point, TouchMouseEventData> {\n\t\treturn this._clicked;\n\t}\n\n\tpublic dblClicked(): ISubscription<TimePointIndex | null, Point, TouchMouseEventData> {\n\t\treturn this._dblClicked;\n\t}\n\n\tpublic pinchStartEvent(): void {\n\t\tthis._prevPinchScale = 1;\n\t\tthis._model().stopTimeScaleAnimation();\n\t}\n\n\tpublic pinchEvent(middlePoint: Position, scale: number): void {\n\t\tif (!this._chart.options().handleScale.pinch) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst zoomScale = (scale - this._prevPinchScale) * 5;\n\t\tthis._prevPinchScale = scale;\n\n\t\tthis._model().zoomTime(middlePoint.x as Coordinate, zoomScale);\n\t}\n\n\tpublic touchStartEvent(event: MouseEventHandlerTouchEvent): void {\n\t\tthis._longTap = false;\n\t\tthis._exitTrackingModeOnNextTry = this._startTrackPoint !== null;\n\n\t\tthis._mouseTouchDownEvent();\n\n\t\tconst crosshair = this._model().crosshairSource();\n\t\tif (this._startTrackPoint !== null && crosshair.visible()) {\n\t\t\tthis._initCrosshairPosition = { x: crosshair.appliedX(), y: crosshair.appliedY() };\n\t\t\tthis._startTrackPoint = { x: event.localX, y: event.localY };\n\t\t}\n\t}\n\n\tpublic touchMoveEvent(event: MouseEventHandlerTouchEvent): void {\n\t\tif (this._state === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst x = event.localX;\n\t\tconst y = event.localY;\n\t\tif (this._startTrackPoint !== null) {\n\t\t\t// tracking mode: move crosshair\n\t\t\tthis._exitTrackingModeOnNextTry = false;\n\t\t\tconst origPoint = ensureNotNull(this._initCrosshairPosition);\n\t\t\tconst newX = origPoint.x + (x - this._startTrackPoint.x) as Coordinate;\n\t\t\tconst newY = origPoint.y + (y - this._startTrackPoint.y) as Coordinate;\n\t\t\tthis._setCrosshairPosition(newX, newY, event);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._pressedMouseTouchMoveEvent(event);\n\t}\n\n\tpublic touchEndEvent(event: MouseEventHandlerTouchEvent): void {\n\t\tif (this.chart().options().trackingMode.exitMode === TrackingModeExitMode.OnTouchEnd) {\n\t\t\tthis._exitTrackingModeOnNextTry = true;\n\t\t}\n\t\tthis._tryExitTrackingMode();\n\t\tthis._endScroll(event);\n\t}\n\n\tpublic hitTest(x: Coordinate, y: Coordinate): HitTestResult | null {\n\t\tconst state = this._state;\n\t\tif (state === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn hitTestPane(state, x, y);\n\t}\n\n\tpublic setPriceAxisSize(width: number, position: PriceAxisWidgetSide): void {\n\t\tconst priceAxisWidget = position === 'left' ? this._leftPriceAxisWidget : this._rightPriceAxisWidget;\n\t\tensureNotNull(priceAxisWidget).setSize(size({ width, height: this._size.height }));\n\t}\n\n\tpublic getSize(): Size {\n\t\treturn this._size;\n\t}\n\n\tpublic setSize(newSize: Size): void {\n\t\tif (equalSizes(this._size, newSize)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._size = newSize;\n\t\tthis._isSettingSize = true;\n\t\tthis._canvasBinding.resizeCanvasElement(newSize);\n\t\tthis._topCanvasBinding.resizeCanvasElement(newSize);\n\t\tthis._isSettingSize = false;\n\t\tthis._paneCell.style.width = newSize.width + 'px';\n\t\tthis._paneCell.style.height = newSize.height + 'px';\n\t}\n\n\tpublic recalculatePriceScales(): void {\n\t\tconst pane = ensureNotNull(this._state);\n\t\tpane.recalculatePriceScale(pane.leftPriceScale());\n\t\tpane.recalculatePriceScale(pane.rightPriceScale());\n\n\t\tfor (const source of pane.dataSources()) {\n\t\t\tif (pane.isOverlay(source)) {\n\t\t\t\tconst priceScale = source.priceScale();\n\t\t\t\tif (priceScale !== null) {\n\t\t\t\t\tpane.recalculatePriceScale(priceScale);\n\t\t\t\t}\n\n\t\t\t\t// for overlay drawings price scale is owner's price scale\n\t\t\t\t// however owner's price scale could not contain ds\n\t\t\t\tsource.updateAllViews();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic getBitmapSize(): Size {\n\t\treturn this._canvasBinding.bitmapSize;\n\t}\n\n\tpublic drawBitmap(ctx: CanvasRenderingContext2D, x: number, y: number): void {\n\t\tconst bitmapSize = this.getBitmapSize();\n\t\tif (bitmapSize.width > 0 && bitmapSize.height > 0) {\n\t\t\tctx.drawImage(this._canvasBinding.canvasElement, x, y);\n\t\t}\n\t}\n\n\tpublic paint(type: InvalidationLevel): void {\n\t\tif (type === InvalidationLevel.None) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._state === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (type > InvalidationLevel.Cursor) {\n\t\t\tthis.recalculatePriceScales();\n\t\t}\n\n\t\tif (this._leftPriceAxisWidget !== null) {\n\t\t\tthis._leftPriceAxisWidget.paint(type);\n\t\t}\n\t\tif (this._rightPriceAxisWidget !== null) {\n\t\t\tthis._rightPriceAxisWidget.paint(type);\n\t\t}\n\n\t\tif (type !== InvalidationLevel.Cursor) {\n\t\t\tthis._canvasBinding.applySuggestedBitmapSize();\n\t\t\tconst target = tryCreateCanvasRenderingTarget2D(this._canvasBinding);\n\t\t\tif (target !== null) {\n\t\t\t\ttarget.useBitmapCoordinateSpace((scope: BitmapCoordinatesRenderingScope) => {\n\t\t\t\t\tthis._drawBackground(scope);\n\t\t\t\t});\n\t\t\t\tif (this._state) {\n\t\t\t\t\tthis._drawSources(target, sourceBottomPaneViews);\n\t\t\t\t\tthis._drawGrid(target);\n\t\t\t\t\tthis._drawWatermark(target);\n\t\t\t\t\tthis._drawSources(target, sourcePaneViews);\n\t\t\t\t\tthis._drawSources(target, sourceLabelPaneViews);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._topCanvasBinding.applySuggestedBitmapSize();\n\t\tconst topTarget = tryCreateCanvasRenderingTarget2D(this._topCanvasBinding);\n\t\tif (topTarget !== null) {\n\t\t\ttopTarget.useBitmapCoordinateSpace(({ context: ctx, bitmapSize }: BitmapCoordinatesRenderingScope) => {\n\t\t\t\tctx.clearRect(0, 0, bitmapSize.width, bitmapSize.height);\n\t\t\t});\n\t\t\tthis._drawCrosshair(topTarget);\n\t\t\tthis._drawSources(topTarget, sourceTopPaneViews);\n\t\t}\n\t}\n\n\tpublic leftPriceAxisWidget(): PriceAxisWidget | null {\n\t\treturn this._leftPriceAxisWidget;\n\t}\n\n\tpublic rightPriceAxisWidget(): PriceAxisWidget | null {\n\t\treturn this._rightPriceAxisWidget;\n\t}\n\n\tpublic drawAdditionalSources(target: CanvasRenderingTarget2D, paneViewsGetter: IPaneViewsGetter): void {\n\t\tthis._drawSources(target, paneViewsGetter);\n\t}\n\n\tprivate _onStateDestroyed(): void {\n\t\tif (this._state !== null) {\n\t\t\tthis._state.onDestroyed().unsubscribeAll(this);\n\t\t}\n\n\t\tthis._state = null;\n\t}\n\n\tprivate _fireClickedDelegate(event: MouseEventHandlerEventBase): void {\n\t\tthis._fireMouseClickDelegate(this._clicked, event);\n\t}\n\n\tprivate _fireMouseClickDelegate(delegate: Delegate<TimePointIndex | null, Point, TouchMouseEventData>, event: MouseEventHandlerEventBase): void {\n\t\tconst x = event.localX;\n\t\tconst y = event.localY;\n\t\tif (delegate.hasListeners()) {\n\t\t\tdelegate.fire(this._model().timeScale().coordinateToIndex(x), { x, y }, event);\n\t\t}\n\t}\n\n\tprivate _drawBackground({ context: ctx, bitmapSize }: BitmapCoordinatesRenderingScope): void {\n\t\tconst { width, height } = bitmapSize;\n\t\tconst model = this._model();\n\t\tconst topColor = model.backgroundTopColor();\n\t\tconst bottomColor = model.backgroundBottomColor();\n\n\t\tif (topColor === bottomColor) {\n\t\t\tclearRect(ctx, 0, 0, width, height, bottomColor);\n\t\t} else {\n\t\t\tclearRectWithGradient(ctx, 0, 0, width, height, topColor, bottomColor);\n\t\t}\n\t}\n\n\tprivate _drawGrid(target: CanvasRenderingTarget2D): void {\n\t\tconst state = ensureNotNull(this._state);\n\t\tconst paneView = state.grid().paneView();\n\t\tconst renderer = paneView.renderer();\n\n\t\tif (renderer !== null) {\n\t\t\trenderer.draw(target, false);\n\t\t}\n\t}\n\n\tprivate _drawWatermark(target: CanvasRenderingTarget2D): void {\n\t\tconst source = this._model().watermarkSource();\n\t\tthis._drawSourceImpl(target, sourcePaneViews, drawBackground, source);\n\t\tthis._drawSourceImpl(target, sourcePaneViews, drawForeground, source);\n\t}\n\n\tprivate _drawCrosshair(target: CanvasRenderingTarget2D): void {\n\t\tthis._drawSourceImpl(target, sourcePaneViews, drawForeground, this._model().crosshairSource());\n\t}\n\n\tprivate _drawSources(target: CanvasRenderingTarget2D, paneViewsGetter: IPaneViewsGetter): void {\n\t\tconst state = ensureNotNull(this._state);\n\t\tconst sources = state.orderedSources();\n\n\t\tfor (const source of sources) {\n\t\t\tthis._drawSourceImpl(target, paneViewsGetter, drawBackground, source);\n\t\t}\n\n\t\tfor (const source of sources) {\n\t\t\tthis._drawSourceImpl(target, paneViewsGetter, drawForeground, source);\n\t\t}\n\t}\n\n\tprivate _drawSourceImpl(\n\t\ttarget: CanvasRenderingTarget2D,\n\t\tpaneViewsGetter: IPaneViewsGetter,\n\t\tdrawFn: DrawFunction,\n\t\tsource: IDataSource\n\t): void {\n\t\tconst state = ensureNotNull(this._state);\n\t\tconst hoveredSource = state.model().hoveredSource();\n\t\tconst isHovered = hoveredSource !== null && hoveredSource.source === source;\n\t\tconst objecId = hoveredSource !== null && isHovered && hoveredSource.object !== undefined\n\t\t\t? hoveredSource.object.hitTestData\n\t\t\t: undefined;\n\n\t\tconst drawRendererFn = (renderer: IPaneRenderer) => drawFn(renderer, target, isHovered, objecId);\n\t\tdrawSourcePaneViews(paneViewsGetter, drawRendererFn, source, state);\n\t}\n\n\tprivate _recreatePriceAxisWidgets(): void {\n\t\tif (this._state === null) {\n\t\t\treturn;\n\t\t}\n\t\tconst chart = this._chart;\n\t\tconst leftAxisVisible = this._state.leftPriceScale().options().visible;\n\t\tconst rightAxisVisible = this._state.rightPriceScale().options().visible;\n\t\tif (!leftAxisVisible && this._leftPriceAxisWidget !== null) {\n\t\t\tthis._leftAxisCell.removeChild(this._leftPriceAxisWidget.getElement());\n\t\t\tthis._leftPriceAxisWidget.destroy();\n\t\t\tthis._leftPriceAxisWidget = null;\n\t\t}\n\t\tif (!rightAxisVisible && this._rightPriceAxisWidget !== null) {\n\t\t\tthis._rightAxisCell.removeChild(this._rightPriceAxisWidget.getElement());\n\t\t\tthis._rightPriceAxisWidget.destroy();\n\t\t\tthis._rightPriceAxisWidget = null;\n\t\t}\n\t\tconst rendererOptionsProvider = chart.model().rendererOptionsProvider();\n\t\tif (leftAxisVisible && this._leftPriceAxisWidget === null) {\n\t\t\tthis._leftPriceAxisWidget = new PriceAxisWidget(this, chart.options(), rendererOptionsProvider, 'left');\n\t\t\tthis._leftAxisCell.appendChild(this._leftPriceAxisWidget.getElement());\n\t\t}\n\t\tif (rightAxisVisible && this._rightPriceAxisWidget === null) {\n\t\t\tthis._rightPriceAxisWidget = new PriceAxisWidget(this, chart.options(), rendererOptionsProvider, 'right');\n\t\t\tthis._rightAxisCell.appendChild(this._rightPriceAxisWidget.getElement());\n\t\t}\n\t}\n\n\tprivate _preventScroll(event: TouchMouseEvent): boolean {\n\t\treturn event.isTouch && this._longTap || this._startTrackPoint !== null;\n\t}\n\n\tprivate _correctXCoord(x: Coordinate): Coordinate {\n\t\treturn Math.max(0, Math.min(x, this._size.width - 1)) as Coordinate;\n\t}\n\n\tprivate _correctYCoord(y: Coordinate): Coordinate {\n\t\treturn Math.max(0, Math.min(y, this._size.height - 1)) as Coordinate;\n\t}\n\n\tprivate _setCrosshairPosition(x: Coordinate, y: Coordinate, event: MouseEventHandlerEventBase): void {\n\t\tthis._model().setAndSaveCurrentPosition(this._correctXCoord(x), this._correctYCoord(y), event, ensureNotNull(this._state));\n\t}\n\n\tprivate _clearCrosshairPosition(): void {\n\t\tthis._model().clearCurrentPosition();\n\t}\n\n\tprivate _tryExitTrackingMode(): void {\n\t\tif (this._exitTrackingModeOnNextTry) {\n\t\t\tthis._startTrackPoint = null;\n\t\t\tthis._clearCrosshairPosition();\n\t\t}\n\t}\n\n\tprivate _startTrackingMode(startTrackPoint: Point, crossHairPosition: Point, event: MouseEventHandlerEventBase): void {\n\t\tthis._startTrackPoint = startTrackPoint;\n\t\tthis._exitTrackingModeOnNextTry = false;\n\t\tthis._setCrosshairPosition(crossHairPosition.x, crossHairPosition.y, event);\n\t\tconst crosshair = this._model().crosshairSource();\n\t\tthis._initCrosshairPosition = { x: crosshair.appliedX(), y: crosshair.appliedY() };\n\t}\n\n\tprivate _model(): IChartModelBase {\n\t\treturn this._chart.model();\n\t}\n\n\tprivate _endScroll(event: TouchMouseEvent): void {\n\t\tif (!this._isScrolling) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = this._model();\n\t\tconst state = this.state();\n\n\t\tmodel.endScrollPrice(state, state.defaultPriceScale());\n\n\t\tthis._startScrollingPos = null;\n\t\tthis._isScrolling = false;\n\t\tmodel.endScrollTime();\n\n\t\tif (this._scrollXAnimation !== null) {\n\t\t\tconst startAnimationTime = performance.now();\n\t\t\tconst timeScale = model.timeScale();\n\n\t\t\tthis._scrollXAnimation.start(timeScale.rightOffset() as Coordinate, startAnimationTime);\n\n\t\t\tif (!this._scrollXAnimation.finished(startAnimationTime)) {\n\t\t\t\tmodel.setTimeScaleAnimation(this._scrollXAnimation);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _onMouseEvent(): void {\n\t\tthis._startTrackPoint = null;\n\t}\n\n\tprivate _mouseTouchDownEvent(): void {\n\t\tif (!this._state) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._model().stopTimeScaleAnimation();\n\n\t\tif (document.activeElement !== document.body && document.activeElement !== document.documentElement) {\n\t\t\t// If any focusable element except the page itself is focused, remove the focus\n\t\t\t(ensureNotNull(document.activeElement) as HTMLElement).blur();\n\t\t} else {\n\t\t\t// Clear selection\n\t\t\tconst selection = document.getSelection();\n\t\t\tif (selection !== null) {\n\t\t\t\tselection.removeAllRanges();\n\t\t\t}\n\t\t}\n\n\t\tconst priceScale = this._state.defaultPriceScale();\n\n\t\tif (priceScale.isEmpty() || this._model().timeScale().isEmpty()) {\n\t\t\treturn;\n\t\t}\n\t}\n\n\t// eslint-disable-next-line complexity\n\tprivate _pressedMouseTouchMoveEvent(event: TouchMouseEvent): void {\n\t\tif (this._state === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = this._model();\n\t\tconst timeScale = model.timeScale();\n\n\t\tif (timeScale.isEmpty()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst chartOptions = this._chart.options();\n\t\tconst scrollOptions = chartOptions.handleScroll;\n\t\tconst kineticScrollOptions = chartOptions.kineticScroll;\n\t\tif (\n\t\t\t(!scrollOptions.pressedMouseMove || event.isTouch) &&\n\t\t\t(!scrollOptions.horzTouchDrag && !scrollOptions.vertTouchDrag || !event.isTouch)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst priceScale = this._state.defaultPriceScale();\n\n\t\tconst now = performance.now();\n\n\t\tif (this._startScrollingPos === null && !this._preventScroll(event)) {\n\t\t\tthis._startScrollingPos = {\n\t\t\t\tx: event.clientX,\n\t\t\t\ty: event.clientY,\n\t\t\t\ttimestamp: now,\n\t\t\t\tlocalX: event.localX,\n\t\t\t\tlocalY: event.localY,\n\t\t\t};\n\t\t}\n\n\t\tif (\n\t\t\tthis._startScrollingPos !== null &&\n\t\t\t!this._isScrolling &&\n\t\t\t(this._startScrollingPos.x !== event.clientX || this._startScrollingPos.y !== event.clientY)\n\t\t) {\n\t\t\tif (event.isTouch && kineticScrollOptions.touch || !event.isTouch && kineticScrollOptions.mouse) {\n\t\t\t\tconst barSpacing = timeScale.barSpacing();\n\t\t\t\tthis._scrollXAnimation = new KineticAnimation(\n\t\t\t\t\tKineticScrollConstants.MinScrollSpeed / barSpacing,\n\t\t\t\t\tKineticScrollConstants.MaxScrollSpeed / barSpacing,\n\t\t\t\t\tKineticScrollConstants.DumpingCoeff,\n\t\t\t\t\tKineticScrollConstants.ScrollMinMove / barSpacing\n\t\t\t\t);\n\t\t\t\tthis._scrollXAnimation.addPosition(timeScale.rightOffset() as Coordinate, this._startScrollingPos.timestamp);\n\t\t\t} else {\n\t\t\t\tthis._scrollXAnimation = null;\n\t\t\t}\n\n\t\t\tif (!priceScale.isEmpty()) {\n\t\t\t\tmodel.startScrollPrice(this._state, priceScale, event.localY);\n\t\t\t}\n\n\t\t\tmodel.startScrollTime(event.localX);\n\t\t\tthis._isScrolling = true;\n\t\t}\n\n\t\tif (this._isScrolling) {\n\t\t\t// this allows scrolling not default price scales\n\t\t\tif (!priceScale.isEmpty()) {\n\t\t\t\tmodel.scrollPriceTo(this._state, priceScale, event.localY);\n\t\t\t}\n\n\t\t\tmodel.scrollTimeTo(event.localX);\n\t\t\tif (this._scrollXAnimation !== null) {\n\t\t\t\tthis._scrollXAnimation.addPosition(timeScale.rightOffset() as Coordinate, now);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate readonly _canvasSuggestedBitmapSizeChangedHandler = () => {\n\t\tif (this._isSettingSize || this._state === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._model().lightUpdate();\n\t};\n\n\tprivate readonly _topCanvasSuggestedBitmapSizeChangedHandler = () => {\n\t\tif (this._isSettingSize || this._state === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._model().lightUpdate();\n\t};\n}\n","import {\n\tBitmapCoordinatesRenderingScope,\n\tCanvasElementBitmapSizeBinding,\n\tequalSizes,\n\tSize,\n\tsize,\n\ttryCreateCanvasRenderingTarget2D,\n} from 'fancy-canvas';\n\nimport { clearRect } from '../helpers/canvas-helpers';\nimport { IDestroyable } from '../helpers/idestroyable';\n\nimport { ChartOptionsBase } from '../model/chart-model';\nimport { InvalidationLevel } from '../model/invalidate-mask';\nimport { PriceAxisRendererOptionsProvider } from '../renderers/price-axis-renderer-options-provider';\n\nimport { createBoundCanvas, releaseCanvas } from './canvas-utils';\nimport { PriceAxisWidgetSide } from './price-axis-widget';\n\nexport interface PriceAxisStubParams {\n\trendererOptionsProvider: PriceAxisRendererOptionsProvider;\n}\n\nexport type BorderVisibleGetter = () => boolean;\nexport type ColorGetter = () => string;\n\nexport class PriceAxisStub implements IDestroyable {\n\tprivate readonly _cell: HTMLDivElement;\n\tprivate readonly _canvasBinding: CanvasElementBitmapSizeBinding;\n\n\tprivate readonly _rendererOptionsProvider: PriceAxisRendererOptionsProvider;\n\n\tprivate _options: ChartOptionsBase;\n\n\tprivate _invalidated: boolean = true;\n\n\tprivate readonly _isLeft: boolean;\n\tprivate _size: Size = size({ width: 0, height: 0 });\n\tprivate readonly _borderVisible: BorderVisibleGetter;\n\tprivate readonly _bottomColor: ColorGetter;\n\n\tpublic constructor(\n\t\tside: PriceAxisWidgetSide,\n\t\toptions: ChartOptionsBase,\n\t\tparams: PriceAxisStubParams,\n\t\tborderVisible: BorderVisibleGetter,\n\t\tbottomColor: ColorGetter\n\t) {\n\t\tthis._isLeft = side === 'left';\n\t\tthis._rendererOptionsProvider = params.rendererOptionsProvider;\n\n\t\tthis._options = options;\n\t\tthis._borderVisible = borderVisible;\n\t\tthis._bottomColor = bottomColor;\n\n\t\tthis._cell = document.createElement('div');\n\t\tthis._cell.style.width = '25px';\n\t\tthis._cell.style.height = '100%';\n\t\tthis._cell.style.overflow = 'hidden';\n\n\t\tthis._canvasBinding = createBoundCanvas(this._cell, size({ width: 16, height: 16 }));\n\t\tthis._canvasBinding.subscribeSuggestedBitmapSizeChanged(this._canvasSuggestedBitmapSizeChangedHandler);\n\t}\n\n\tpublic destroy(): void {\n\t\tthis._canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._canvasSuggestedBitmapSizeChangedHandler);\n\t\treleaseCanvas(this._canvasBinding.canvasElement);\n\t\tthis._canvasBinding.dispose();\n\t}\n\n\tpublic getElement(): HTMLElement {\n\t\treturn this._cell;\n\t}\n\n\tpublic getSize(): Size {\n\t\treturn this._size;\n\t}\n\n\tpublic setSize(newSize: Size): void {\n\t\tif (!equalSizes(this._size, newSize)) {\n\t\t\tthis._size = newSize;\n\n\t\t\tthis._canvasBinding.resizeCanvasElement(newSize);\n\n\t\t\tthis._cell.style.width = `${newSize.width}px`;\n\t\t\tthis._cell.style.height = `${newSize.height}px`;\n\n\t\t\tthis._invalidated = true;\n\t\t}\n\t}\n\n\tpublic paint(type: InvalidationLevel): void {\n\t\tif (type < InvalidationLevel.Full && !this._invalidated) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._size.width === 0 || this._size.height === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._invalidated = false;\n\n\t\tthis._canvasBinding.applySuggestedBitmapSize();\n\t\tconst target = tryCreateCanvasRenderingTarget2D(this._canvasBinding);\n\t\tif (target !== null) {\n\t\t\ttarget.useBitmapCoordinateSpace((scope: BitmapCoordinatesRenderingScope) => {\n\t\t\t\tthis._drawBackground(scope);\n\t\t\t\tthis._drawBorder(scope);\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic getBitmapSize(): Size {\n\t\treturn this._canvasBinding.bitmapSize;\n\t}\n\n\tpublic drawBitmap(ctx: CanvasRenderingContext2D, x: number, y: number): void {\n\t\tconst bitmapSize = this.getBitmapSize();\n\t\tif (bitmapSize.width > 0 && bitmapSize.height > 0) {\n\t\t\tctx.drawImage(this._canvasBinding.canvasElement, x, y);\n\t\t}\n\t}\n\n\tprivate _drawBorder({ context: ctx, bitmapSize, horizontalPixelRatio, verticalPixelRatio }: BitmapCoordinatesRenderingScope): void {\n\t\tif (!this._borderVisible()) {\n\t\t\treturn;\n\t\t}\n\n\t\tctx.fillStyle = this._options.timeScale.borderColor;\n\n\t\tconst horzBorderSize = Math.floor(this._rendererOptionsProvider.options().borderSize * horizontalPixelRatio);\n\t\tconst vertBorderSize = Math.floor(this._rendererOptionsProvider.options().borderSize * verticalPixelRatio);\n\t\tconst left = (this._isLeft) ? bitmapSize.width - horzBorderSize : 0;\n\n\t\tctx.fillRect(left, 0, horzBorderSize, vertBorderSize);\n\t}\n\n\tprivate _drawBackground({ context: ctx, bitmapSize }: BitmapCoordinatesRenderingScope): void {\n\t\tclearRect(ctx, 0, 0, bitmapSize.width, bitmapSize.height, this._bottomColor());\n\t}\n\n\tprivate readonly _canvasSuggestedBitmapSizeChangedHandler = () => this.paint(InvalidationLevel.Full);\n}\n","import {\n\tBitmapCoordinatesRenderingScope,\n\tCanvasElementBitmapSizeBinding,\n\tCanvasRenderingTarget2D,\n\tequalSizes,\n\tMediaCoordinatesRenderingScope,\n\tSize,\n\tsize,\n\ttryCreateCanvasRenderingTarget2D,\n} from 'fancy-canvas';\n\nimport { clearRect } from '../helpers/canvas-helpers';\nimport { Delegate } from '../helpers/delegate';\nimport { IDestroyable } from '../helpers/idestroyable';\nimport { ISubscription } from '../helpers/isubscription';\nimport { makeFont } from '../helpers/make-font';\n\nimport { IDataSource } from '../model/idata-source';\nimport { IHorzScaleBehavior } from '../model/ihorz-scale-behavior';\nimport { InvalidationLevel } from '../model/invalidate-mask';\nimport { SeriesPrimitivePaneViewZOrder } from '../model/iseries-primitive';\nimport { LayoutOptions } from '../model/layout-options';\nimport { Pane } from '../model/pane';\nimport { TextWidthCache } from '../model/text-width-cache';\nimport { IPaneRenderer } from '../renderers/ipane-renderer';\nimport { TimeAxisViewRendererOptions } from '../renderers/itime-axis-view-renderer';\nimport { IAxisView } from '../views/pane/iaxis-view';\n\nimport { createBoundCanvas, releaseCanvas } from './canvas-utils';\nimport { ChartWidget } from './chart-widget';\nimport { drawBackground, drawForeground, drawSourcePaneViews } from './draw-functions';\nimport { ITimeAxisViewsGetter } from './iaxis-view-getters';\nimport { MouseEventHandler, MouseEventHandlers, MouseEventHandlerTouchEvent, TouchMouseEvent } from './mouse-event-handler';\nimport { PriceAxisStub, PriceAxisStubParams } from './price-axis-stub';\n\nconst enum Constants {\n\tBorderSize = 1,\n\tTickLength = 5,\n}\n\nconst enum CursorType {\n\tDefault,\n\tEwResize,\n}\n\nfunction buildTimeAxisViewsGetter(zOrder: SeriesPrimitivePaneViewZOrder): ITimeAxisViewsGetter {\n\treturn (source: IDataSource): readonly IAxisView[] => source.timePaneViews?.(zOrder) ?? [];\n}\nconst sourcePaneViews = buildTimeAxisViewsGetter('normal');\nconst sourceTopPaneViews = buildTimeAxisViewsGetter('top');\nconst sourceBottomPaneViews = buildTimeAxisViewsGetter('bottom');\n\nexport class TimeAxisWidget<HorzScaleItem> implements MouseEventHandlers, IDestroyable {\n\tprivate readonly _chart: ChartWidget<HorzScaleItem>;\n\tprivate readonly _options: LayoutOptions;\n\tprivate readonly _element: HTMLElement;\n\tprivate readonly _leftStubCell: HTMLElement;\n\tprivate readonly _rightStubCell: HTMLElement;\n\tprivate readonly _cell: HTMLElement;\n\tprivate readonly _dv: HTMLElement;\n\tprivate readonly _canvasBinding: CanvasElementBitmapSizeBinding;\n\tprivate readonly _topCanvasBinding: CanvasElementBitmapSizeBinding;\n\tprivate _leftStub: PriceAxisStub | null = null;\n\tprivate _rightStub: PriceAxisStub | null = null;\n\tprivate readonly _mouseEventHandler: MouseEventHandler;\n\tprivate _rendererOptions: TimeAxisViewRendererOptions | null = null;\n\tprivate _mouseDown: boolean = false;\n\tprivate _size: Size = size({ width: 0, height: 0 });\n\tprivate readonly _sizeChanged: Delegate<Size> = new Delegate();\n\tprivate readonly _widthCache: TextWidthCache = new TextWidthCache(5);\n\tprivate _isSettingSize: boolean = false;\n\n\tprivate readonly _horzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>;\n\n\tpublic constructor(chartWidget: ChartWidget<HorzScaleItem>, horzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>) {\n\t\tthis._chart = chartWidget;\n\t\tthis._horzScaleBehavior = horzScaleBehavior;\n\t\tthis._options = chartWidget.options().layout;\n\n\t\tthis._element = document.createElement('tr');\n\n\t\tthis._leftStubCell = document.createElement('td');\n\t\tthis._leftStubCell.style.padding = '0';\n\n\t\tthis._rightStubCell = document.createElement('td');\n\t\tthis._rightStubCell.style.padding = '0';\n\n\t\tthis._cell = document.createElement('td');\n\t\tthis._cell.style.height = '25px';\n\t\tthis._cell.style.padding = '0';\n\n\t\tthis._dv = document.createElement('div');\n\t\tthis._dv.style.width = '100%';\n\t\tthis._dv.style.height = '100%';\n\t\tthis._dv.style.position = 'relative';\n\t\tthis._dv.style.overflow = 'hidden';\n\t\tthis._cell.appendChild(this._dv);\n\n\t\tthis._canvasBinding = createBoundCanvas(this._dv, size({ width: 16, height: 16 }));\n\t\tthis._canvasBinding.subscribeSuggestedBitmapSizeChanged(this._canvasSuggestedBitmapSizeChangedHandler);\n\t\tconst canvas = this._canvasBinding.canvasElement;\n\t\tcanvas.style.position = 'absolute';\n\t\tcanvas.style.zIndex = '1';\n\t\tcanvas.style.left = '0';\n\t\tcanvas.style.top = '0';\n\n\t\tthis._topCanvasBinding = createBoundCanvas(this._dv, size({ width: 16, height: 16 }));\n\t\tthis._topCanvasBinding.subscribeSuggestedBitmapSizeChanged(this._topCanvasSuggestedBitmapSizeChangedHandler);\n\t\tconst topCanvas = this._topCanvasBinding.canvasElement;\n\t\ttopCanvas.style.position = 'absolute';\n\t\ttopCanvas.style.zIndex = '2';\n\t\ttopCanvas.style.left = '0';\n\t\ttopCanvas.style.top = '0';\n\n\t\tthis._element.appendChild(this._leftStubCell);\n\t\tthis._element.appendChild(this._cell);\n\t\tthis._element.appendChild(this._rightStubCell);\n\n\t\tthis._recreateStubs();\n\t\tthis._chart.model().priceScalesOptionsChanged().subscribe(this._recreateStubs.bind(this), this);\n\n\t\tthis._mouseEventHandler = new MouseEventHandler(\n\t\t\tthis._topCanvasBinding.canvasElement,\n\t\t\tthis,\n\t\t\t{\n\t\t\t\ttreatVertTouchDragAsPageScroll: () => true,\n\t\t\t\ttreatHorzTouchDragAsPageScroll: () => !this._chart.options().handleScroll.horzTouchDrag,\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic destroy(): void {\n\t\tthis._mouseEventHandler.destroy();\n\t\tif (this._leftStub !== null) {\n\t\t\tthis._leftStub.destroy();\n\t\t}\n\t\tif (this._rightStub !== null) {\n\t\t\tthis._rightStub.destroy();\n\t\t}\n\n\t\tthis._topCanvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._topCanvasSuggestedBitmapSizeChangedHandler);\n\t\treleaseCanvas(this._topCanvasBinding.canvasElement);\n\t\tthis._topCanvasBinding.dispose();\n\n\t\tthis._canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._canvasSuggestedBitmapSizeChangedHandler);\n\t\treleaseCanvas(this._canvasBinding.canvasElement);\n\t\tthis._canvasBinding.dispose();\n\t}\n\n\tpublic getElement(): HTMLElement {\n\t\treturn this._element;\n\t}\n\n\tpublic leftStub(): PriceAxisStub | null {\n\t\treturn this._leftStub;\n\t}\n\n\tpublic rightStub(): PriceAxisStub | null {\n\t\treturn this._rightStub;\n\t}\n\n\tpublic mouseDownEvent(event: TouchMouseEvent): void {\n\t\tif (this._mouseDown) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._mouseDown = true;\n\t\tconst model = this._chart.model();\n\t\tif (model.timeScale().isEmpty() || !this._chart.options().handleScale.axisPressedMouseMove.time) {\n\t\t\treturn;\n\t\t}\n\n\t\tmodel.startScaleTime(event.localX);\n\t}\n\n\tpublic touchStartEvent(event: MouseEventHandlerTouchEvent): void {\n\t\tthis.mouseDownEvent(event);\n\t}\n\n\tpublic mouseDownOutsideEvent(): void {\n\t\tconst model = this._chart.model();\n\t\tif (!model.timeScale().isEmpty() && this._mouseDown) {\n\t\t\tthis._mouseDown = false;\n\t\t\tif (this._chart.options().handleScale.axisPressedMouseMove.time) {\n\t\t\t\tmodel.endScaleTime();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic pressedMouseMoveEvent(event: TouchMouseEvent): void {\n\t\tconst model = this._chart.model();\n\t\tif (model.timeScale().isEmpty() || !this._chart.options().handleScale.axisPressedMouseMove.time) {\n\t\t\treturn;\n\t\t}\n\n\t\tmodel.scaleTimeTo(event.localX);\n\t}\n\n\tpublic touchMoveEvent(event: MouseEventHandlerTouchEvent): void {\n\t\tthis.pressedMouseMoveEvent(event);\n\t}\n\n\tpublic mouseUpEvent(): void {\n\t\tthis._mouseDown = false;\n\t\tconst model = this._chart.model();\n\t\tif (model.timeScale().isEmpty() && !this._chart.options().handleScale.axisPressedMouseMove.time) {\n\t\t\treturn;\n\t\t}\n\n\t\tmodel.endScaleTime();\n\t}\n\n\tpublic touchEndEvent(): void {\n\t\tthis.mouseUpEvent();\n\t}\n\n\tpublic mouseDoubleClickEvent(): void {\n\t\tif (this._chart.options().handleScale.axisDoubleClickReset.time) {\n\t\t\tthis._chart.model().resetTimeScale();\n\t\t}\n\t}\n\n\tpublic doubleTapEvent(): void {\n\t\tthis.mouseDoubleClickEvent();\n\t}\n\n\tpublic mouseEnterEvent(): void {\n\t\tif (this._chart.model().options().handleScale.axisPressedMouseMove.time) {\n\t\t\tthis._setCursor(CursorType.EwResize);\n\t\t}\n\t}\n\n\tpublic mouseLeaveEvent(): void {\n\t\tthis._setCursor(CursorType.Default);\n\t}\n\n\tpublic getSize(): Size {\n\t\treturn this._size;\n\t}\n\n\tpublic sizeChanged(): ISubscription<Size> {\n\t\treturn this._sizeChanged;\n\t}\n\n\tpublic setSizes(timeAxisSize: Size, leftStubWidth: number, rightStubWidth: number): void {\n\t\tif (!equalSizes(this._size, timeAxisSize)) {\n\t\t\tthis._size = timeAxisSize;\n\n\t\t\tthis._isSettingSize = true;\n\t\t\tthis._canvasBinding.resizeCanvasElement(timeAxisSize);\n\t\t\tthis._topCanvasBinding.resizeCanvasElement(timeAxisSize);\n\t\t\tthis._isSettingSize = false;\n\n\t\t\tthis._cell.style.width = `${timeAxisSize.width}px`;\n\t\t\tthis._cell.style.height = `${timeAxisSize.height}px`;\n\n\t\t\tthis._sizeChanged.fire(timeAxisSize);\n\t\t}\n\n\t\tif (this._leftStub !== null) {\n\t\t\tthis._leftStub.setSize(size({ width: leftStubWidth, height: timeAxisSize.height }));\n\t\t}\n\t\tif (this._rightStub !== null) {\n\t\t\tthis._rightStub.setSize(size({ width: rightStubWidth, height: timeAxisSize.height }));\n\t\t}\n\t}\n\n\tpublic optimalHeight(): number {\n\t\tconst rendererOptions = this._getRendererOptions();\n\t\treturn Math.ceil(\n\t\t\t// rendererOptions.offsetSize +\n\t\t\trendererOptions.borderSize +\n\t\t\trendererOptions.tickLength +\n\t\t\trendererOptions.fontSize +\n\t\t\trendererOptions.paddingTop +\n\t\t\trendererOptions.paddingBottom +\n\t\t\trendererOptions.labelBottomOffset\n\t\t);\n\t}\n\n\tpublic update(): void {\n\t\t// this call has side-effect - it regenerates marks on the time scale\n\t\tthis._chart.model().timeScale().marks();\n\t}\n\n\tpublic getBitmapSize(): Size {\n\t\treturn this._canvasBinding.bitmapSize;\n\t}\n\n\tpublic drawBitmap(ctx: CanvasRenderingContext2D, x: number, y: number): void {\n\t\tconst bitmapSize = this.getBitmapSize();\n\t\tif (bitmapSize.width > 0 && bitmapSize.height > 0) {\n\t\t\tctx.drawImage(this._canvasBinding.canvasElement, x, y);\n\t\t}\n\t}\n\n\tpublic paint(type: InvalidationLevel): void {\n\t\tif (type === InvalidationLevel.None) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (type !== InvalidationLevel.Cursor) {\n\t\t\tthis._canvasBinding.applySuggestedBitmapSize();\n\t\t\tconst target = tryCreateCanvasRenderingTarget2D(this._canvasBinding);\n\t\t\tif (target !== null) {\n\t\t\t\ttarget.useBitmapCoordinateSpace((scope: BitmapCoordinatesRenderingScope) => {\n\t\t\t\t\tthis._drawBackground(scope);\n\t\t\t\t\tthis._drawBorder(scope);\n\t\t\t\t\tthis._drawAdditionalSources(target, sourceBottomPaneViews);\n\t\t\t\t});\n\t\t\t\tthis._drawTickMarks(target);\n\t\t\t\tthis._drawAdditionalSources(target, sourcePaneViews);\n\t\t\t\t// atm we don't have sources to be drawn on time axis except crosshair which is rendered on top level canvas\n\t\t\t\t// so let's don't call this code at all for now\n\t\t\t\t// this._drawLabels(this._chart.model().dataSources(), target);\n\t\t\t}\n\n\t\t\tif (this._leftStub !== null) {\n\t\t\t\tthis._leftStub.paint(type);\n\t\t\t}\n\t\t\tif (this._rightStub !== null) {\n\t\t\t\tthis._rightStub.paint(type);\n\t\t\t}\n\t\t}\n\n\t\tthis._topCanvasBinding.applySuggestedBitmapSize();\n\t\tconst topTarget = tryCreateCanvasRenderingTarget2D(this._topCanvasBinding);\n\t\tif (topTarget !== null) {\n\t\t\ttopTarget.useBitmapCoordinateSpace(({ context: ctx, bitmapSize }: BitmapCoordinatesRenderingScope) => {\n\t\t\t\tctx.clearRect(0, 0, bitmapSize.width, bitmapSize.height);\n\t\t\t});\n\t\t\tthis._drawLabels([...this._chart.model().serieses(), this._chart.model().crosshairSource()], topTarget);\n\t\t\tthis._drawAdditionalSources(topTarget, sourceTopPaneViews);\n\t\t}\n\t}\n\n\tprivate _drawAdditionalSources(target: CanvasRenderingTarget2D, axisViewsGetter: ITimeAxisViewsGetter): void {\n\t\tconst sources = this._chart.model().serieses();\n\n\t\tfor (const source of sources) {\n\t\t\tdrawSourcePaneViews(\n\t\t\t\taxisViewsGetter,\n\t\t\t\t(renderer: IPaneRenderer) => drawBackground(renderer, target, false, undefined),\n\t\t\t\tsource,\n\t\t\t\tundefined as unknown as Pane\n\t\t\t);\n\t\t}\n\n\t\tfor (const source of sources) {\n\t\t\tdrawSourcePaneViews(\n\t\t\t\taxisViewsGetter,\n\t\t\t\t(renderer: IPaneRenderer) => drawForeground(renderer, target, false, undefined),\n\t\t\t\tsource,\n\t\t\t\tundefined as unknown as Pane\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate _drawBackground({ context: ctx, bitmapSize }: BitmapCoordinatesRenderingScope): void {\n\t\tclearRect(ctx, 0, 0, bitmapSize.width, bitmapSize.height, this._chart.model().backgroundBottomColor());\n\t}\n\n\tprivate _drawBorder({ context: ctx, bitmapSize, verticalPixelRatio }: BitmapCoordinatesRenderingScope): void {\n\t\tif (this._chart.options().timeScale.borderVisible) {\n\t\t\tctx.fillStyle = this._lineColor();\n\n\t\t\tconst borderSize = Math.max(1, Math.floor(this._getRendererOptions().borderSize * verticalPixelRatio));\n\n\t\t\tctx.fillRect(0, 0, bitmapSize.width, borderSize);\n\t\t}\n\t}\n\n\tprivate _drawTickMarks(target: CanvasRenderingTarget2D): void {\n\t\tconst timeScale = this._chart.model().timeScale();\n\t\tconst tickMarks = timeScale.marks();\n\n\t\tif (!tickMarks || tickMarks.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst maxWeight = this._horzScaleBehavior.maxTickMarkWeight(tickMarks);\n\n\t\tconst rendererOptions = this._getRendererOptions();\n\n\t\tconst options = timeScale.options();\n\t\tif (options.borderVisible && options.ticksVisible) {\n\t\t\ttarget.useBitmapCoordinateSpace(({ context: ctx, horizontalPixelRatio, verticalPixelRatio }: BitmapCoordinatesRenderingScope) => {\n\t\t\t\tctx.strokeStyle = this._lineColor();\n\t\t\t\tctx.fillStyle = this._lineColor();\n\n\t\t\t\tconst tickWidth = Math.max(1, Math.floor(horizontalPixelRatio));\n\t\t\t\tconst tickOffset = Math.floor(horizontalPixelRatio * 0.5);\n\n\t\t\t\tctx.beginPath();\n\t\t\t\tconst tickLen = Math.round(rendererOptions.tickLength * verticalPixelRatio);\n\t\t\t\tfor (let index = tickMarks.length; index--;) {\n\t\t\t\t\tconst x = Math.round(tickMarks[index].coord * horizontalPixelRatio);\n\t\t\t\t\tctx.rect(x - tickOffset, 0, tickWidth, tickLen);\n\t\t\t\t}\n\n\t\t\t\tctx.fill();\n\t\t\t});\n\t\t}\n\n\t\ttarget.useMediaCoordinateSpace(({ context: ctx }: MediaCoordinatesRenderingScope) => {\n\t\t\tconst yText = (\n\t\t\t\trendererOptions.borderSize +\n\t\t\t\trendererOptions.tickLength +\n\t\t\t\trendererOptions.paddingTop +\n\t\t\t\trendererOptions.fontSize / 2\n\t\t\t);\n\n\t\t\tctx.textAlign = 'center';\n\t\t\tctx.textBaseline = 'middle';\n\t\t\tctx.fillStyle = this._textColor();\n\n\t\t\t// draw base marks\n\t\t\tctx.font = this._baseFont();\n\t\t\tfor (const tickMark of tickMarks) {\n\t\t\t\tif (tickMark.weight < maxWeight) {\n\t\t\t\t\tconst coordinate = tickMark.needAlignCoordinate ? this._alignTickMarkLabelCoordinate(ctx, tickMark.coord, tickMark.label) : tickMark.coord;\n\t\t\t\t\tctx.fillText(tickMark.label, coordinate, yText);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this._chart.options().timeScale.allowBoldLabels) {\n\t\t\t\tctx.font = this._baseBoldFont();\n\t\t\t}\n\t\t\tfor (const tickMark of tickMarks) {\n\t\t\t\tif (tickMark.weight >= maxWeight) {\n\t\t\t\t\tconst coordinate = tickMark.needAlignCoordinate ? this._alignTickMarkLabelCoordinate(ctx, tickMark.coord, tickMark.label) : tickMark.coord;\n\t\t\t\t\tctx.fillText(tickMark.label, coordinate, yText);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _alignTickMarkLabelCoordinate(ctx: CanvasRenderingContext2D, coordinate: number, labelText: string): number {\n\t\tconst labelWidth = this._widthCache.measureText(ctx, labelText);\n\t\tconst labelWidthHalf = labelWidth / 2;\n\t\tconst leftTextCoordinate = Math.floor(coordinate - labelWidthHalf) + 0.5;\n\n\t\tif (leftTextCoordinate < 0) {\n\t\t\tcoordinate = coordinate + Math.abs(0 - leftTextCoordinate);\n\t\t} else if (leftTextCoordinate + labelWidth > this._size.width) {\n\t\t\tcoordinate = coordinate - Math.abs(this._size.width - (leftTextCoordinate + labelWidth));\n\t\t}\n\n\t\treturn coordinate;\n\t}\n\n\tprivate _drawLabels(sources: readonly IDataSource[], target: CanvasRenderingTarget2D): void {\n\t\tconst rendererOptions = this._getRendererOptions();\n\t\tfor (const source of sources) {\n\t\t\tfor (const view of source.timeAxisViews()) {\n\t\t\t\tview.renderer().draw(target, rendererOptions);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _lineColor(): string {\n\t\treturn this._chart.options().timeScale.borderColor;\n\t}\n\n\tprivate _textColor(): string {\n\t\treturn this._options.textColor;\n\t}\n\n\tprivate _fontSize(): number {\n\t\treturn this._options.fontSize;\n\t}\n\n\tprivate _baseFont(): string {\n\t\treturn makeFont(this._fontSize(), this._options.fontFamily);\n\t}\n\n\tprivate _baseBoldFont(): string {\n\t\treturn makeFont(this._fontSize(), this._options.fontFamily, 'bold');\n\t}\n\n\tprivate _getRendererOptions(): Readonly<TimeAxisViewRendererOptions> {\n\t\tif (this._rendererOptions === null) {\n\t\t\tthis._rendererOptions = {\n\t\t\t\tborderSize: Constants.BorderSize,\n\t\t\t\tbaselineOffset: NaN,\n\t\t\t\tpaddingTop: NaN,\n\t\t\t\tpaddingBottom: NaN,\n\t\t\t\tpaddingHorizontal: NaN,\n\t\t\t\ttickLength: Constants.TickLength,\n\t\t\t\tfontSize: NaN,\n\t\t\t\tfont: '',\n\t\t\t\twidthCache: new TextWidthCache(),\n\t\t\t\tlabelBottomOffset: 0,\n\t\t\t};\n\t\t}\n\n\t\tconst rendererOptions = this._rendererOptions;\n\t\tconst newFont = this._baseFont();\n\n\t\tif (rendererOptions.font !== newFont) {\n\t\t\tconst fontSize = this._fontSize();\n\t\t\trendererOptions.fontSize = fontSize;\n\t\t\trendererOptions.font = newFont;\n\t\t\trendererOptions.paddingTop = 3 * fontSize / 12;\n\t\t\trendererOptions.paddingBottom = 3 * fontSize / 12;\n\t\t\trendererOptions.paddingHorizontal = 9 * fontSize / 12;\n\t\t\trendererOptions.baselineOffset = 0;\n\t\t\trendererOptions.labelBottomOffset = 4 * fontSize / 12;\n\t\t\trendererOptions.widthCache.reset();\n\t\t}\n\n\t\treturn this._rendererOptions;\n\t}\n\n\tprivate _setCursor(type: CursorType): void {\n\t\tthis._cell.style.cursor = type === CursorType.EwResize ? 'ew-resize' : 'default';\n\t}\n\n\tprivate _recreateStubs(): void {\n\t\tconst model = this._chart.model();\n\t\tconst options = model.options();\n\t\tif (!options.leftPriceScale.visible && this._leftStub !== null) {\n\t\t\tthis._leftStubCell.removeChild(this._leftStub.getElement());\n\t\t\tthis._leftStub.destroy();\n\t\t\tthis._leftStub = null;\n\t\t}\n\t\tif (!options.rightPriceScale.visible && this._rightStub !== null) {\n\t\t\tthis._rightStubCell.removeChild(this._rightStub.getElement());\n\t\t\tthis._rightStub.destroy();\n\t\t\tthis._rightStub = null;\n\t\t}\n\t\tconst rendererOptionsProvider = this._chart.model().rendererOptionsProvider();\n\t\tconst params: PriceAxisStubParams = {\n\t\t\trendererOptionsProvider: rendererOptionsProvider,\n\t\t};\n\n\t\tconst borderVisibleGetter = () => {\n\t\t\treturn options.leftPriceScale.borderVisible && model.timeScale().options().borderVisible;\n\t\t};\n\n\t\tconst bottomColorGetter = () => model.backgroundBottomColor();\n\n\t\tif (options.leftPriceScale.visible && this._leftStub === null) {\n\t\t\tthis._leftStub = new PriceAxisStub('left', options, params, borderVisibleGetter, bottomColorGetter);\n\t\t\tthis._leftStubCell.appendChild(this._leftStub.getElement());\n\t\t}\n\t\tif (options.rightPriceScale.visible && this._rightStub === null) {\n\t\t\tthis._rightStub = new PriceAxisStub('right', options, params, borderVisibleGetter, bottomColorGetter);\n\t\t\tthis._rightStubCell.appendChild(this._rightStub.getElement());\n\t\t}\n\t}\n\n\tprivate readonly _canvasSuggestedBitmapSizeChangedHandler = () => {\n\t\tif (!this._isSettingSize) {\n\t\t\tthis._chart.model().lightUpdate();\n\t\t}\n\t};\n\n\tprivate readonly _topCanvasSuggestedBitmapSizeChangedHandler = () => {\n\t\tif (!this._isSettingSize) {\n\t\t\tthis._chart.model().lightUpdate();\n\t\t}\n\t};\n}\n","import { Size, size } from 'fancy-canvas';\n\nimport { ensureDefined, ensureNotNull } from '../helpers/assertions';\nimport { isChromiumBased, isWindows } from '../helpers/browsers';\nimport { Delegate } from '../helpers/delegate';\nimport { IDestroyable } from '../helpers/idestroyable';\nimport { ISubscription } from '../helpers/isubscription';\nimport { warn } from '../helpers/logger';\nimport { DeepPartial } from '../helpers/strict-type-checks';\n\nimport { ChartModel, ChartOptionsInternal, ChartOptionsInternalBase, IChartModelBase } from '../model/chart-model';\nimport { Coordinate } from '../model/coordinate';\nimport { DefaultPriceScaleId } from '../model/default-price-scale';\nimport { IHorzScaleBehavior } from '../model/ihorz-scale-behavior';\nimport {\n\tInvalidateMask,\n\tInvalidationLevel,\n\tTimeScaleInvalidation,\n\tTimeScaleInvalidationType,\n} from '../model/invalidate-mask';\nimport { Point } from '../model/point';\nimport { Series } from '../model/series';\nimport { SeriesPlotRow } from '../model/series-data';\nimport { SeriesType } from '../model/series-options';\nimport { TimePointIndex } from '../model/time-data';\nimport { TouchMouseEventData } from '../model/touch-mouse-event-data';\n\nimport { suggestChartSize, suggestPriceScaleWidth, suggestTimeScaleHeight } from './internal-layout-sizes-hints';\nimport { PaneWidget } from './pane-widget';\nimport { TimeAxisWidget } from './time-axis-widget';\n\nexport interface MouseEventParamsImpl {\n\toriginalTime?: unknown;\n\tindex?: TimePointIndex;\n\tpoint?: Point;\n\tseriesData: Map<Series<SeriesType>, SeriesPlotRow<SeriesType>>;\n\thoveredSeries?: Series<SeriesType>;\n\thoveredObject?: string;\n\ttouchMouseEventData?: TouchMouseEventData;\n}\n\nexport type MouseEventParamsImplSupplier = () => MouseEventParamsImpl;\n\nconst windowsChrome = isChromiumBased() && isWindows();\n\nexport interface IChartWidgetBase {\n\tgetPriceAxisWidth(position: DefaultPriceScaleId): number;\n\tmodel(): IChartModelBase;\n\tpaneWidgets(): PaneWidget[];\n\toptions(): ChartOptionsInternalBase;\n\tsetCursorStyle(style: string | null): void;\n}\n\nexport class ChartWidget<HorzScaleItem> implements IDestroyable, IChartWidgetBase {\n\tprivate readonly _options: ChartOptionsInternal<HorzScaleItem>;\n\tprivate _paneWidgets: PaneWidget[] = [];\n\t// private _paneSeparators: PaneSeparator[] = [];\n\tprivate readonly _model: ChartModel<HorzScaleItem>;\n\tprivate _drawRafId: number = 0;\n\tprivate _height: number = 0;\n\tprivate _width: number = 0;\n\tprivate _leftPriceAxisWidth: number = 0;\n\tprivate _rightPriceAxisWidth: number = 0;\n\tprivate _element: HTMLDivElement;\n\tprivate readonly _tableElement: HTMLElement;\n\tprivate _timeAxisWidget: TimeAxisWidget<HorzScaleItem>;\n\tprivate _invalidateMask: InvalidateMask | null = null;\n\tprivate _drawPlanned: boolean = false;\n\tprivate _clicked: Delegate<MouseEventParamsImplSupplier> = new Delegate();\n\tprivate _dblClicked: Delegate<MouseEventParamsImplSupplier> = new Delegate();\n\tprivate _crosshairMoved: Delegate<MouseEventParamsImplSupplier> = new Delegate();\n\tprivate _onWheelBound: (event: WheelEvent) => void;\n\tprivate _observer: ResizeObserver | null = null;\n\n\tprivate _container: HTMLElement;\n\tprivate _cursorStyleOverride: string | null = null;\n\n\tprivate readonly _horzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>;\n\n\tpublic constructor(container: HTMLElement, options: ChartOptionsInternal<HorzScaleItem>, horzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>) {\n\t\tthis._container = container;\n\t\tthis._options = options;\n\t\tthis._horzScaleBehavior = horzScaleBehavior;\n\n\t\tthis._element = document.createElement('div');\n\t\tthis._element.classList.add('tv-lightweight-charts');\n\t\tthis._element.style.overflow = 'hidden';\n\t\tthis._element.style.direction = 'ltr';\n\t\tthis._element.style.width = '100%';\n\t\tthis._element.style.height = '100%';\n\t\tdisableSelection(this._element);\n\n\t\tthis._tableElement = document.createElement('table');\n\t\tthis._tableElement.setAttribute('cellspacing', '0');\n\t\tthis._element.appendChild(this._tableElement);\n\n\t\tthis._onWheelBound = this._onMousewheel.bind(this);\n\t\tif (shouldSubscribeMouseWheel(this._options)) {\n\t\t\tthis._setMouseWheelEventListener(true);\n\t\t}\n\t\tthis._model = new ChartModel(\n\t\t\tthis._invalidateHandler.bind(this),\n\t\t\tthis._options,\n\t\t\thorzScaleBehavior\n\t\t);\n\t\tthis.model().crosshairMoved().subscribe(this._onPaneWidgetCrosshairMoved.bind(this), this);\n\n\t\tthis._timeAxisWidget = new TimeAxisWidget(this, this._horzScaleBehavior);\n\t\tthis._tableElement.appendChild(this._timeAxisWidget.getElement());\n\n\t\tconst usedObserver = options.autoSize && this._installObserver();\n\n\t\t// observer could not fire event immediately for some cases\n\t\t// so we have to set initial size manually\n\t\tlet width = this._options.width;\n\t\tlet height = this._options.height;\n\t\t// ignore width/height options if observer has actually been used\n\t\t// however respect options if installing resize observer failed\n\t\tif (usedObserver || width === 0 || height === 0) {\n\t\t\tconst containerRect = container.getBoundingClientRect();\n\t\t\twidth = width || containerRect.width;\n\t\t\theight = height || containerRect.height;\n\t\t}\n\n\t\t// BEWARE: resize must be called BEFORE _syncGuiWithModel (in constructor only)\n\t\t// or after but with adjustSize to properly update time scale\n\t\tthis.resize(width, height);\n\n\t\tthis._syncGuiWithModel();\n\n\t\tcontainer.appendChild(this._element);\n\t\tthis._updateTimeAxisVisibility();\n\t\tthis._model.timeScale().optionsApplied().subscribe(this._model.fullUpdate.bind(this._model), this);\n\t\tthis._model.priceScalesOptionsChanged().subscribe(this._model.fullUpdate.bind(this._model), this);\n\t}\n\n\tpublic model(): ChartModel<HorzScaleItem> {\n\t\treturn this._model;\n\t}\n\n\tpublic options(): Readonly<ChartOptionsInternal<HorzScaleItem>> {\n\t\treturn this._options;\n\t}\n\n\tpublic paneWidgets(): PaneWidget[] {\n\t\treturn this._paneWidgets;\n\t}\n\n\tpublic timeAxisWidget(): TimeAxisWidget<HorzScaleItem> {\n\t\treturn this._timeAxisWidget;\n\t}\n\n\tpublic destroy(): void {\n\t\tthis._setMouseWheelEventListener(false);\n\t\tif (this._drawRafId !== 0) {\n\t\t\twindow.cancelAnimationFrame(this._drawRafId);\n\t\t}\n\n\t\tthis._model.crosshairMoved().unsubscribeAll(this);\n\t\tthis._model.timeScale().optionsApplied().unsubscribeAll(this);\n\t\tthis._model.priceScalesOptionsChanged().unsubscribeAll(this);\n\t\tthis._model.destroy();\n\n\t\tfor (const paneWidget of this._paneWidgets) {\n\t\t\tthis._tableElement.removeChild(paneWidget.getElement());\n\t\t\tpaneWidget.clicked().unsubscribeAll(this);\n\t\t\tpaneWidget.dblClicked().unsubscribeAll(this);\n\t\t\tpaneWidget.destroy();\n\t\t}\n\t\tthis._paneWidgets = [];\n\n\t\t// for (const paneSeparator of this._paneSeparators) {\n\t\t// \tthis._destroySeparator(paneSeparator);\n\t\t// }\n\t\t// this._paneSeparators = [];\n\n\t\tensureNotNull(this._timeAxisWidget).destroy();\n\n\t\tif (this._element.parentElement !== null) {\n\t\t\tthis._element.parentElement.removeChild(this._element);\n\t\t}\n\n\t\tthis._crosshairMoved.destroy();\n\t\tthis._clicked.destroy();\n\t\tthis._dblClicked.destroy();\n\n\t\tthis._uninstallObserver();\n\t}\n\n\tpublic resize(width: number, height: number, forceRepaint: boolean = false): void {\n\t\tif (this._height === height && this._width === width) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sizeHint = suggestChartSize(size({ width, height }));\n\n\t\tthis._height = sizeHint.height;\n\t\tthis._width = sizeHint.width;\n\n\t\tconst heightStr = this._height + 'px';\n\t\tconst widthStr = this._width + 'px';\n\n\t\tensureNotNull(this._element).style.height = heightStr;\n\t\tensureNotNull(this._element).style.width = widthStr;\n\n\t\tthis._tableElement.style.height = heightStr;\n\t\tthis._tableElement.style.width = widthStr;\n\n\t\tif (forceRepaint) {\n\t\t\tthis._drawImpl(InvalidateMask.full(), performance.now());\n\t\t} else {\n\t\t\tthis._model.fullUpdate();\n\t\t}\n\t}\n\n\tpublic paint(invalidateMask?: InvalidateMask): void {\n\t\tif (invalidateMask === undefined) {\n\t\t\tinvalidateMask = InvalidateMask.full();\n\t\t}\n\n\t\tfor (let i = 0; i < this._paneWidgets.length; i++) {\n\t\t\tthis._paneWidgets[i].paint(invalidateMask.invalidateForPane(i).level);\n\t\t}\n\n\t\tif (this._options.timeScale.visible) {\n\t\t\tthis._timeAxisWidget.paint(invalidateMask.fullInvalidation());\n\t\t}\n\t}\n\n\tpublic applyOptions(options: DeepPartial<ChartOptionsInternal<HorzScaleItem>>): void {\n\t\tconst currentlyHasMouseWheelListener = shouldSubscribeMouseWheel(this._options);\n\n\t\t// we don't need to merge options here because it's done in chart model\n\t\t// and since both model and widget share the same object it will be done automatically for widget as well\n\t\t// not ideal solution for sure, but it work's for now \\_()_/\n\t\tthis._model.applyOptions(options);\n\n\t\tconst shouldHaveMouseWheelListener = shouldSubscribeMouseWheel(this._options);\n\t\tif (shouldHaveMouseWheelListener !== currentlyHasMouseWheelListener) {\n\t\t\tthis._setMouseWheelEventListener(shouldHaveMouseWheelListener);\n\t\t}\n\n\t\tthis._updateTimeAxisVisibility();\n\n\t\tthis._applyAutoSizeOptions(options);\n\t}\n\n\tpublic clicked(): ISubscription<MouseEventParamsImplSupplier> {\n\t\treturn this._clicked;\n\t}\n\n\tpublic dblClicked(): ISubscription<MouseEventParamsImplSupplier> {\n\t\treturn this._dblClicked;\n\t}\n\n\tpublic crosshairMoved(): ISubscription<MouseEventParamsImplSupplier> {\n\t\treturn this._crosshairMoved;\n\t}\n\n\tpublic takeScreenshot(): HTMLCanvasElement {\n\t\tif (this._invalidateMask !== null) {\n\t\t\tthis._drawImpl(this._invalidateMask, performance.now());\n\t\t\tthis._invalidateMask = null;\n\t\t}\n\n\t\tconst screeshotBitmapSize = this._traverseLayout(null);\n\t\tconst screenshotCanvas = document.createElement('canvas');\n\t\tscreenshotCanvas.width = screeshotBitmapSize.width;\n\t\tscreenshotCanvas.height = screeshotBitmapSize.height;\n\n\t\tconst ctx = ensureNotNull(screenshotCanvas.getContext('2d'));\n\t\tthis._traverseLayout(ctx);\n\n\t\treturn screenshotCanvas;\n\t}\n\n\tpublic getPriceAxisWidth(position: DefaultPriceScaleId): number {\n\t\tif (position === 'left' && !this._isLeftAxisVisible()) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (position === 'right' && !this._isRightAxisVisible()) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (this._paneWidgets.length === 0) {\n\t\t\treturn 0;\n\t\t}\n\n\t\t// we don't need to worry about exactly pane widget here\n\t\t// because all pane widgets have the same width of price axis widget\n\t\t// see _adjustSizeImpl\n\t\tconst priceAxisWidget = position === 'left'\n\t\t\t? this._paneWidgets[0].leftPriceAxisWidget()\n\t\t\t: this._paneWidgets[0].rightPriceAxisWidget();\n\t\treturn ensureNotNull(priceAxisWidget).getWidth();\n\t}\n\n\tpublic autoSizeActive(): boolean {\n\t\treturn this._options.autoSize && this._observer !== null;\n\t}\n\n\tpublic element(): HTMLDivElement {\n\t\treturn this._element;\n\t}\n\n\tpublic setCursorStyle(style: string | null): void {\n\t\tthis._cursorStyleOverride = style;\n\t\tif (this._cursorStyleOverride) {\n\t\t\tthis.element().style.setProperty('cursor', style);\n\t\t} else {\n\t\t\tthis.element().style.removeProperty('cursor');\n\t\t}\n\t}\n\n\tpublic getCursorOverrideStyle(): string | null {\n\t\treturn this._cursorStyleOverride;\n\t}\n\n\tpublic paneSize(): Size {\n\t\t// we currently only support a single pane.\n\t\treturn ensureDefined(this._paneWidgets[0]).getSize();\n\t}\n\n\t// eslint-disable-next-line complexity\n\tprivate _applyAutoSizeOptions(options: DeepPartial<ChartOptionsInternal<HorzScaleItem>>): void {\n\t\tif (options.autoSize === undefined && this._observer && (options.width !== undefined || options.height !== undefined)) {\n\t\t\twarn(`You should turn autoSize off explicitly before specifying sizes; try adding options.autoSize: false to new options`);\n\t\t\treturn;\n\t\t}\n\t\tif (options.autoSize && !this._observer) {\n\t\t\t// installing observer will override resize if successful\n\t\t\tthis._installObserver();\n\t\t}\n\n\t\tif (options.autoSize === false && this._observer !== null) {\n\t\t\tthis._uninstallObserver();\n\t\t}\n\n\t\tif (!options.autoSize && (options.width !== undefined || options.height !== undefined)) {\n\t\t\tthis.resize(options.width || this._width, options.height || this._height);\n\t\t}\n\t}\n\n\t/**\n\t * Traverses the widget's layout (pane and axis child widgets),\n\t * draws the screenshot (if rendering context is passed) and returns the screenshot bitmap size\n\t *\n\t * @param ctx - if passed, used to draw the screenshot of widget\n\t * @returns screenshot bitmap size\n\t */\n\tprivate _traverseLayout(ctx: CanvasRenderingContext2D | null): Size {\n\t\tlet totalWidth = 0;\n\t\tlet totalHeight = 0;\n\n\t\tconst firstPane = this._paneWidgets[0];\n\n\t\tconst drawPriceAxises = (position: 'left' | 'right', targetX: number) => {\n\t\t\tlet targetY = 0;\n\t\t\tfor (let paneIndex = 0; paneIndex < this._paneWidgets.length; paneIndex++) {\n\t\t\t\tconst paneWidget = this._paneWidgets[paneIndex];\n\t\t\t\tconst priceAxisWidget = ensureNotNull(position === 'left' ? paneWidget.leftPriceAxisWidget() : paneWidget.rightPriceAxisWidget());\n\t\t\t\tconst bitmapSize = priceAxisWidget.getBitmapSize();\n\t\t\t\tif (ctx !== null) {\n\t\t\t\t\tpriceAxisWidget.drawBitmap(ctx, targetX, targetY);\n\t\t\t\t}\n\t\t\t\ttargetY += bitmapSize.height;\n\t\t\t\t// if (paneIndex < this._paneWidgets.length - 1) {\n\t\t\t\t// \tconst separator = this._paneSeparators[paneIndex];\n\t\t\t\t// \tconst separatorBitmapSize = separator.getBitmapSize();\n\t\t\t\t// \tif (ctx !== null) {\n\t\t\t\t// \t\tseparator.drawBitmap(ctx, targetX, targetY);\n\t\t\t\t// \t}\n\t\t\t\t// \ttargetY += separatorBitmapSize.height;\n\t\t\t\t// }\n\t\t\t}\n\t\t};\n\n\t\t// draw left price scale if exists\n\t\tif (this._isLeftAxisVisible()) {\n\t\t\tdrawPriceAxises('left', 0);\n\t\t\tconst leftAxisBitmapWidth = ensureNotNull(firstPane.leftPriceAxisWidget()).getBitmapSize().width;\n\t\t\ttotalWidth += leftAxisBitmapWidth;\n\t\t}\n\t\tfor (let paneIndex = 0; paneIndex < this._paneWidgets.length; paneIndex++) {\n\t\t\tconst paneWidget = this._paneWidgets[paneIndex];\n\t\t\tconst bitmapSize = paneWidget.getBitmapSize();\n\t\t\tif (ctx !== null) {\n\t\t\t\tpaneWidget.drawBitmap(ctx, totalWidth, totalHeight);\n\t\t\t}\n\t\t\ttotalHeight += bitmapSize.height;\n\t\t\t// if (paneIndex < this._paneWidgets.length - 1) {\n\t\t\t// \tconst separator = this._paneSeparators[paneIndex];\n\t\t\t// \tconst separatorBitmapSize = separator.getBitmapSize();\n\t\t\t// \tif (ctx !== null) {\n\t\t\t// \t\tseparator.drawBitmap(ctx, totalWidth, totalHeight);\n\t\t\t// \t}\n\t\t\t// \ttotalHeight += separatorBitmapSize.height;\n\t\t\t// }\n\t\t}\n\t\tconst firstPaneBitmapWidth = firstPane.getBitmapSize().width;\n\t\ttotalWidth += firstPaneBitmapWidth;\n\n\t\t// draw right price scale if exists\n\t\tif (this._isRightAxisVisible()) {\n\t\t\tdrawPriceAxises('right', totalWidth);\n\t\t\tconst rightAxisBitmapWidth = ensureNotNull(firstPane.rightPriceAxisWidget()).getBitmapSize().width;\n\t\t\ttotalWidth += rightAxisBitmapWidth;\n\t\t}\n\n\t\tconst drawStub = (position: 'left' | 'right', targetX: number, targetY: number) => {\n\t\t\tconst stub = ensureNotNull(position === 'left' ? this._timeAxisWidget.leftStub() : this._timeAxisWidget.rightStub());\n\t\t\tstub.drawBitmap(ensureNotNull(ctx), targetX, targetY);\n\t\t};\n\n\t\t// draw time scale and stubs\n\t\tif (this._options.timeScale.visible) {\n\t\t\tconst timeAxisBitmapSize = this._timeAxisWidget.getBitmapSize();\n\n\t\t\tif (ctx !== null) {\n\t\t\t\tlet targetX = 0;\n\t\t\t\tif (this._isLeftAxisVisible()) {\n\t\t\t\t\tdrawStub('left', targetX, totalHeight);\n\t\t\t\t\ttargetX = ensureNotNull(firstPane.leftPriceAxisWidget()).getBitmapSize().width;\n\t\t\t\t}\n\n\t\t\t\tthis._timeAxisWidget.drawBitmap(ctx, targetX, totalHeight);\n\t\t\t\ttargetX += timeAxisBitmapSize.width;\n\n\t\t\t\tif (this._isRightAxisVisible()) {\n\t\t\t\t\tdrawStub('right', targetX, totalHeight);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttotalHeight += timeAxisBitmapSize.height;\n\t\t}\n\n\t\treturn size({\n\t\t\twidth: totalWidth,\n\t\t\theight: totalHeight,\n\t\t});\n\t}\n\n\t// eslint-disable-next-line complexity\n\tprivate _adjustSizeImpl(): void {\n\t\tlet totalStretch = 0;\n\t\tlet leftPriceAxisWidth = 0;\n\t\tlet rightPriceAxisWidth = 0;\n\n\t\tfor (const paneWidget of this._paneWidgets) {\n\t\t\tif (this._isLeftAxisVisible()) {\n\t\t\t\tleftPriceAxisWidth = Math.max(\n\t\t\t\t\tleftPriceAxisWidth,\n\t\t\t\t\tensureNotNull(paneWidget.leftPriceAxisWidget()).optimalWidth(),\n\t\t\t\t\tthis._options.leftPriceScale.minimumWidth\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (this._isRightAxisVisible()) {\n\t\t\t\trightPriceAxisWidth = Math.max(\n\t\t\t\t\trightPriceAxisWidth,\n\t\t\t\t\tensureNotNull(paneWidget.rightPriceAxisWidget()).optimalWidth(),\n\t\t\t\t\tthis._options.rightPriceScale.minimumWidth\n\t\t\t\t);\n\t\t\t}\n\t\t\ttotalStretch += paneWidget.stretchFactor();\n\t\t}\n\n\t\tleftPriceAxisWidth = suggestPriceScaleWidth(leftPriceAxisWidth);\n\t\trightPriceAxisWidth = suggestPriceScaleWidth(rightPriceAxisWidth);\n\n\t\tconst width = this._width;\n\t\tconst height = this._height;\n\n\t\tconst paneWidth = Math.max(width - leftPriceAxisWidth - rightPriceAxisWidth, 0);\n\n\t\t// const separatorCount = this._paneSeparators.length;\n\t\t// const separatorHeight = SEPARATOR_HEIGHT;\n\t\tconst separatorsHeight = 0; // separatorHeight * separatorCount;\n\t\tconst timeAxisVisible = this._options.timeScale.visible;\n\t\tlet timeAxisHeight = timeAxisVisible ? Math.max(this._timeAxisWidget.optimalHeight(), this._options.timeScale.minimumHeight) : 0;\n\t\ttimeAxisHeight = suggestTimeScaleHeight(timeAxisHeight);\n\n\t\tconst otherWidgetHeight = separatorsHeight + timeAxisHeight;\n\t\tconst totalPaneHeight = height < otherWidgetHeight ? 0 : height - otherWidgetHeight;\n\t\tconst stretchPixels = totalPaneHeight / totalStretch;\n\n\t\tlet accumulatedHeight = 0;\n\t\tfor (let paneIndex = 0; paneIndex < this._paneWidgets.length; ++paneIndex) {\n\t\t\tconst paneWidget = this._paneWidgets[paneIndex];\n\t\t\tpaneWidget.setState(this._model.panes()[paneIndex]);\n\n\t\t\tlet paneHeight = 0;\n\t\t\tlet calculatePaneHeight = 0;\n\n\t\t\tif (paneIndex === this._paneWidgets.length - 1) {\n\t\t\t\tcalculatePaneHeight = totalPaneHeight - accumulatedHeight;\n\t\t\t} else {\n\t\t\t\tcalculatePaneHeight = Math.round(paneWidget.stretchFactor() * stretchPixels);\n\t\t\t}\n\n\t\t\tpaneHeight = Math.max(calculatePaneHeight, 2);\n\n\t\t\taccumulatedHeight += paneHeight;\n\n\t\t\tpaneWidget.setSize(size({ width: paneWidth, height: paneHeight }));\n\t\t\tif (this._isLeftAxisVisible()) {\n\t\t\t\tpaneWidget.setPriceAxisSize(leftPriceAxisWidth, 'left');\n\t\t\t}\n\t\t\tif (this._isRightAxisVisible()) {\n\t\t\t\tpaneWidget.setPriceAxisSize(rightPriceAxisWidth, 'right');\n\t\t\t}\n\n\t\t\tif (paneWidget.state()) {\n\t\t\t\tthis._model.setPaneHeight(paneWidget.state(), paneHeight);\n\t\t\t}\n\t\t}\n\n\t\tthis._timeAxisWidget.setSizes(\n\t\t\tsize({ width: timeAxisVisible ? paneWidth : 0, height: timeAxisHeight }),\n\t\t\ttimeAxisVisible ? leftPriceAxisWidth : 0,\n\t\t\ttimeAxisVisible ? rightPriceAxisWidth : 0\n\t\t);\n\n\t\tthis._model.setWidth(paneWidth);\n\t\tif (this._leftPriceAxisWidth !== leftPriceAxisWidth) {\n\t\t\tthis._leftPriceAxisWidth = leftPriceAxisWidth;\n\t\t}\n\t\tif (this._rightPriceAxisWidth !== rightPriceAxisWidth) {\n\t\t\tthis._rightPriceAxisWidth = rightPriceAxisWidth;\n\t\t}\n\t}\n\n\tprivate _setMouseWheelEventListener(add: boolean): void {\n\t\tif (add) {\n\t\t\tthis._element.addEventListener('wheel', this._onWheelBound, { passive: false });\n\t\t\treturn;\n\t\t}\n\t\tthis._element.removeEventListener('wheel', this._onWheelBound);\n\t}\n\n\tprivate _determineWheelSpeedAdjustment(event: WheelEvent): number {\n\t\tswitch (event.deltaMode) {\n\t\t\tcase event.DOM_DELTA_PAGE:\n\t\t\t\t// one screen at time scroll mode\n\t\t\t\treturn 120;\n\t\t\tcase event.DOM_DELTA_LINE:\n\t\t\t\t// one line at time scroll mode\n\t\t\t\treturn 32;\n\t\t}\n\n\t\tif (!windowsChrome) {\n\t\t\treturn 1;\n\t\t}\n\n\t\t// Chromium on Windows has a bug where the scroll speed isn't correctly\n\t\t// adjusted for high density displays. We need to correct for this so that\n\t\t// scroll speed is consistent between browsers.\n\t\t// https://bugs.chromium.org/p/chromium/issues/detail?id=1001735\n\t\t// https://bugs.chromium.org/p/chromium/issues/detail?id=1207308\n\t\treturn (1 / window.devicePixelRatio);\n\t}\n\n\tprivate _onMousewheel(event: WheelEvent): void {\n\t\tif ((event.deltaX === 0 || !this._options.handleScroll.mouseWheel) &&\n\t\t\t(event.deltaY === 0 || !this._options.handleScale.mouseWheel)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst scrollSpeedAdjustment = this._determineWheelSpeedAdjustment(event);\n\n\t\tconst deltaX = scrollSpeedAdjustment * event.deltaX / 100;\n\t\tconst deltaY = -(scrollSpeedAdjustment * event.deltaY / 100);\n\n\t\tif (event.cancelable) {\n\t\t\tevent.preventDefault();\n\t\t}\n\n\t\tif (deltaY !== 0 && this._options.handleScale.mouseWheel) {\n\t\t\tconst zoomScale = Math.sign(deltaY) * Math.min(1, Math.abs(deltaY));\n\t\t\tconst scrollPosition = event.clientX - this._element.getBoundingClientRect().left;\n\t\t\tthis.model().zoomTime(scrollPosition as Coordinate, zoomScale);\n\t\t}\n\n\t\tif (deltaX !== 0 && this._options.handleScroll.mouseWheel) {\n\t\t\tthis.model().scrollChart(deltaX * -80 as Coordinate); // 80 is a made up coefficient, and minus is for the \"natural\" scroll\n\t\t}\n\t}\n\n\tprivate _drawImpl(invalidateMask: InvalidateMask, time: number): void {\n\t\tconst invalidationType = invalidateMask.fullInvalidation();\n\n\t\t// actions for full invalidation ONLY (not shared with light)\n\t\tif (invalidationType === InvalidationLevel.Full) {\n\t\t\tthis._updateGui();\n\t\t}\n\n\t\t// light or full invalidate actions\n\t\tif (\n\t\t\tinvalidationType === InvalidationLevel.Full ||\n\t\t\tinvalidationType === InvalidationLevel.Light\n\t\t) {\n\t\t\tthis._applyMomentaryAutoScale(invalidateMask);\n\t\t\tthis._applyTimeScaleInvalidations(invalidateMask, time);\n\n\t\t\tthis._timeAxisWidget.update();\n\t\t\tthis._paneWidgets.forEach((pane: PaneWidget) => {\n\t\t\t\tpane.updatePriceAxisWidgets();\n\t\t\t});\n\n\t\t\t// In the case a full invalidation has been postponed during the draw, reapply\n\t\t\t// the timescale invalidations. A full invalidation would mean there is a change\n\t\t\t// in the timescale width (caused by price scale changes) that needs to be drawn\n\t\t\t// right away to avoid flickering.\n\t\t\tif (this._invalidateMask?.fullInvalidation() === InvalidationLevel.Full) {\n\t\t\t\tthis._invalidateMask.merge(invalidateMask);\n\n\t\t\t\tthis._updateGui();\n\n\t\t\t\tthis._applyMomentaryAutoScale(this._invalidateMask);\n\t\t\t\tthis._applyTimeScaleInvalidations(this._invalidateMask, time);\n\n\t\t\t\tinvalidateMask = this._invalidateMask;\n\t\t\t\tthis._invalidateMask = null;\n\t\t\t}\n\t\t}\n\n\t\tthis.paint(invalidateMask);\n\t}\n\n\tprivate _applyTimeScaleInvalidations(invalidateMask: InvalidateMask, time: number): void {\n\t\tfor (const tsInvalidation of invalidateMask.timeScaleInvalidations()) {\n\t\t\tthis._applyTimeScaleInvalidation(tsInvalidation, time);\n\t\t}\n\t}\n\n\tprivate _applyMomentaryAutoScale(invalidateMask: InvalidateMask): void {\n\t\tconst panes = this._model.panes();\n\t\tfor (let i = 0; i < panes.length; i++) {\n\t\t\tif (invalidateMask.invalidateForPane(i).autoScale) {\n\t\t\t\tpanes[i].momentaryAutoScale();\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _applyTimeScaleInvalidation(invalidation: TimeScaleInvalidation, time: number): void {\n\t\tconst timeScale = this._model.timeScale();\n\t\tswitch (invalidation.type) {\n\t\t\tcase TimeScaleInvalidationType.FitContent:\n\t\t\t\ttimeScale.fitContent();\n\t\t\t\tbreak;\n\t\t\tcase TimeScaleInvalidationType.ApplyRange:\n\t\t\t\ttimeScale.setLogicalRange(invalidation.value);\n\t\t\t\tbreak;\n\t\t\tcase TimeScaleInvalidationType.ApplyBarSpacing:\n\t\t\t\ttimeScale.setBarSpacing(invalidation.value);\n\t\t\t\tbreak;\n\t\t\tcase TimeScaleInvalidationType.ApplyRightOffset:\n\t\t\t\ttimeScale.setRightOffset(invalidation.value);\n\t\t\t\tbreak;\n\t\t\tcase TimeScaleInvalidationType.Reset:\n\t\t\t\ttimeScale.restoreDefault();\n\t\t\t\tbreak;\n\t\t\tcase TimeScaleInvalidationType.Animation:\n\t\t\t\tif (!invalidation.value.finished(time)) {\n\t\t\t\t\ttimeScale.setRightOffset(invalidation.value.getPosition(time));\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate _invalidateHandler(invalidateMask: InvalidateMask): void {\n\t\tif (this._invalidateMask !== null) {\n\t\t\tthis._invalidateMask.merge(invalidateMask);\n\t\t} else {\n\t\t\tthis._invalidateMask = invalidateMask;\n\t\t}\n\n\t\tif (!this._drawPlanned) {\n\t\t\tthis._drawPlanned = true;\n\t\t\tthis._drawRafId = window.requestAnimationFrame((time: number) => {\n\t\t\t\tthis._drawPlanned = false;\n\t\t\t\tthis._drawRafId = 0;\n\n\t\t\t\tif (this._invalidateMask !== null) {\n\t\t\t\t\tconst mask = this._invalidateMask;\n\t\t\t\t\tthis._invalidateMask = null;\n\t\t\t\t\tthis._drawImpl(mask, time);\n\n\t\t\t\t\tfor (const tsInvalidation of mask.timeScaleInvalidations()) {\n\t\t\t\t\t\tif (tsInvalidation.type === TimeScaleInvalidationType.Animation && !tsInvalidation.value.finished(time)) {\n\t\t\t\t\t\t\tthis.model().setTimeScaleAnimation(tsInvalidation.value);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate _updateGui(): void {\n\t\tthis._syncGuiWithModel();\n\t}\n\n\t// private _destroySeparator(separator: PaneSeparator): void {\n\t// \tthis._tableElement.removeChild(separator.getElement());\n\t// \tseparator.destroy();\n\t// }\n\n\tprivate _syncGuiWithModel(): void {\n\t\tconst panes = this._model.panes();\n\t\tconst targetPaneWidgetsCount = panes.length;\n\t\tconst actualPaneWidgetsCount = this._paneWidgets.length;\n\n\t\t// Remove (if needed) pane widgets and separators\n\t\tfor (let i = targetPaneWidgetsCount; i < actualPaneWidgetsCount; i++) {\n\t\t\tconst paneWidget = ensureDefined(this._paneWidgets.pop());\n\t\t\tthis._tableElement.removeChild(paneWidget.getElement());\n\t\t\tpaneWidget.clicked().unsubscribeAll(this);\n\t\t\tpaneWidget.dblClicked().unsubscribeAll(this);\n\t\t\tpaneWidget.destroy();\n\n\t\t\t// const paneSeparator = this._paneSeparators.pop();\n\t\t\t// if (paneSeparator !== undefined) {\n\t\t\t// \tthis._destroySeparator(paneSeparator);\n\t\t\t// }\n\t\t}\n\n\t\t// Create (if needed) new pane widgets and separators\n\t\tfor (let i = actualPaneWidgetsCount; i < targetPaneWidgetsCount; i++) {\n\t\t\tconst paneWidget = new PaneWidget(this, panes[i]);\n\t\t\tpaneWidget.clicked().subscribe(this._onPaneWidgetClicked.bind(this), this);\n\t\t\tpaneWidget.dblClicked().subscribe(this._onPaneWidgetDblClicked.bind(this), this);\n\n\t\t\tthis._paneWidgets.push(paneWidget);\n\n\t\t\t// create and insert separator\n\t\t\t// if (i > 1) {\n\t\t\t// \tconst paneSeparator = new PaneSeparator(this, i - 1, i, true);\n\t\t\t// \tthis._paneSeparators.push(paneSeparator);\n\t\t\t// \tthis._tableElement.insertBefore(paneSeparator.getElement(), this._timeAxisWidget.getElement());\n\t\t\t// }\n\n\t\t\t// insert paneWidget\n\t\t\tthis._tableElement.insertBefore(paneWidget.getElement(), this._timeAxisWidget.getElement());\n\t\t}\n\n\t\tfor (let i = 0; i < targetPaneWidgetsCount; i++) {\n\t\t\tconst state = panes[i];\n\t\t\tconst paneWidget = this._paneWidgets[i];\n\t\t\tif (paneWidget.state() !== state) {\n\t\t\t\tpaneWidget.setState(state);\n\t\t\t} else {\n\t\t\t\tpaneWidget.updatePriceAxisWidgetsStates();\n\t\t\t}\n\t\t}\n\n\t\tthis._updateTimeAxisVisibility();\n\t\tthis._adjustSizeImpl();\n\t}\n\n\tprivate _getMouseEventParamsImpl(\n\t\tindex: TimePointIndex | null,\n\t\tpoint: Point | null,\n\t\tevent: TouchMouseEventData | null\n\t): MouseEventParamsImpl {\n\t\tconst seriesData = new Map<Series<SeriesType>, SeriesPlotRow<SeriesType>>();\n\t\tif (index !== null) {\n\t\t\tconst serieses = this._model.serieses();\n\t\t\tserieses.forEach((s: Series<SeriesType>) => {\n\t\t\t\t// TODO: replace with search left\n\t\t\t\tconst data = s.bars().search(index);\n\t\t\t\tif (data !== null) {\n\t\t\t\t\tseriesData.set(s, data);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tlet clientTime: unknown | undefined;\n\t\tif (index !== null) {\n\t\t\tconst timePoint = this._model.timeScale().indexToTimeScalePoint(index)?.originalTime;\n\t\t\tif (timePoint !== undefined) {\n\t\t\t\tclientTime = timePoint;\n\t\t\t}\n\t\t}\n\n\t\tconst hoveredSource = this.model().hoveredSource();\n\n\t\tconst hoveredSeries = hoveredSource !== null && hoveredSource.source instanceof Series\n\t\t\t? hoveredSource.source\n\t\t\t: undefined;\n\n\t\tconst hoveredObject = hoveredSource !== null && hoveredSource.object !== undefined\n\t\t\t? hoveredSource.object.externalId\n\t\t\t: undefined;\n\n\t\treturn {\n\t\t\toriginalTime: clientTime,\n\t\t\tindex: index ?? undefined,\n\t\t\tpoint: point ?? undefined,\n\t\t\thoveredSeries,\n\t\t\tseriesData,\n\t\t\thoveredObject,\n\t\t\ttouchMouseEventData: event ?? undefined,\n\t\t};\n\t}\n\n\tprivate _onPaneWidgetClicked(\n\t\ttime: TimePointIndex | null,\n\t\tpoint: Point | null,\n\t\tevent: TouchMouseEventData\n\t): void {\n\t\tthis._clicked.fire(() => this._getMouseEventParamsImpl(time, point, event));\n\t}\n\n\tprivate _onPaneWidgetDblClicked(\n\t\ttime: TimePointIndex | null,\n\t\tpoint: Point | null,\n\t\tevent: TouchMouseEventData\n\t): void {\n\t\tthis._dblClicked.fire(() => this._getMouseEventParamsImpl(time, point, event));\n\t}\n\n\tprivate _onPaneWidgetCrosshairMoved(\n\t\ttime: TimePointIndex | null,\n\t\tpoint: Point | null,\n\t\tevent: TouchMouseEventData | null\n\t): void {\n\t\tthis._crosshairMoved.fire(() => this._getMouseEventParamsImpl(time, point, event));\n\t}\n\n\tprivate _updateTimeAxisVisibility(): void {\n\t\tconst display = this._options.timeScale.visible ? '' : 'none';\n\t\tthis._timeAxisWidget.getElement().style.display = display;\n\t}\n\n\tprivate _isLeftAxisVisible(): boolean {\n\t\treturn this._paneWidgets[0].state().leftPriceScale().options().visible;\n\t}\n\n\tprivate _isRightAxisVisible(): boolean {\n\t\treturn this._paneWidgets[0].state().rightPriceScale().options().visible;\n\t}\n\n\tprivate _installObserver(): boolean {\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tif (!('ResizeObserver' in window)) {\n\t\t\twarn('Options contains \"autoSize\" flag, but the browser does not support ResizeObserver feature. Please provide polyfill.');\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthis._observer = new ResizeObserver((entries: ResizeObserverEntry[]) => {\n\t\t\t\tconst containerEntry = entries.find((entry: ResizeObserverEntry) => entry.target === this._container);\n\t\t\t\tif (!containerEntry) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.resize(containerEntry.contentRect.width, containerEntry.contentRect.height);\n\t\t\t});\n\t\t\tthis._observer.observe(this._container, { box: 'border-box' });\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tprivate _uninstallObserver(): void {\n\t\tif (this._observer !== null) {\n\t\t\tthis._observer.disconnect();\n\t\t}\n\t\tthis._observer = null;\n\t}\n}\n\nfunction disableSelection(element: HTMLElement): void {\n\telement.style.userSelect = 'none';\n\t// eslint-disable-next-line deprecation/deprecation\n\telement.style.webkitUserSelect = 'none';\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any,@typescript-eslint/no-unsafe-member-access\n\t(element.style as any).msUserSelect = 'none';\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any,@typescript-eslint/no-unsafe-member-access\n\t(element.style as any).MozUserSelect = 'none';\n\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any,@typescript-eslint/no-unsafe-member-access\n\t(element.style as any).webkitTapHighlightColor = 'transparent';\n}\n\nfunction shouldSubscribeMouseWheel<HorzScaleItem>(options: ChartOptionsInternal<HorzScaleItem>): boolean {\n\treturn Boolean(options.handleScroll.mouseWheel || options.handleScale.mouseWheel);\n}\n","import { Time } from './horz-scale-behavior-time/types';\nimport { CustomData, CustomSeriesWhitespaceData } from './icustom-series';\nimport { Series } from './series';\nimport { SeriesType } from './series-options';\n\n/**\n * Represents a whitespace data item, which is a data point without a value.\n *\n * @example\n * ```js\n * const data = [\n *     { time: '2018-12-03', value: 27.02 },\n *     { time: '2018-12-04' }, // whitespace\n *     { time: '2018-12-05' }, // whitespace\n *     { time: '2018-12-06' }, // whitespace\n *     { time: '2018-12-07' }, // whitespace\n *     { time: '2018-12-08', value: 23.92 },\n *     { time: '2018-12-13', value: 30.74 },\n * ];\n * ```\n */\nexport interface WhitespaceData<HorzScaleItem = Time> {\n\t/**\n\t * The time of the data.\n\t */\n\ttime: HorzScaleItem;\n\n\t/**\n\t * Additional custom values which will be ignored by the library, but\n\t * could be used by plugins.\n\t */\n\tcustomValues?: Record<string, unknown>;\n}\n\n/**\n * A base interface for a data point of single-value series.\n */\nexport interface SingleValueData<HorzScaleItem = Time> extends WhitespaceData<HorzScaleItem> {\n\t/**\n\t * The time of the data.\n\t */\n\ttime: HorzScaleItem;\n\n\t/**\n\t * Price value of the data.\n\t */\n\tvalue: number;\n}\n\n/**\n * Structure describing a single item of data for line series\n */\nexport interface LineData<HorzScaleItem = Time> extends SingleValueData<HorzScaleItem> {\n\t/**\n\t * Optional color value for certain data item. If missed, color from options is used\n\t */\n\tcolor?: string;\n}\n\n/**\n * Structure describing a single item of data for histogram series\n */\nexport interface HistogramData<HorzScaleItem = Time> extends SingleValueData<HorzScaleItem> {\n\t/**\n\t * Optional color value for certain data item. If missed, color from options is used\n\t */\n\tcolor?: string;\n}\n\n/**\n * Structure describing a single item of data for area series\n */\nexport interface AreaData<HorzScaleItem = Time> extends SingleValueData<HorzScaleItem> {\n\t/**\n\t * Optional line color value for certain data item. If missed, color from options is used\n\t */\n\tlineColor?: string;\n\n\t/**\n\t * Optional top color value for certain data item. If missed, color from options is used\n\t */\n\ttopColor?: string;\n\n\t/**\n\t * Optional bottom color value for certain data item. If missed, color from options is used\n\t */\n\tbottomColor?: string;\n}\n\n/**\n * Structure describing a single item of data for baseline series\n */\nexport interface BaselineData<HorzScaleItem = Time> extends SingleValueData<HorzScaleItem> {\n\t/**\n\t * Optional top area top fill color value for certain data item. If missed, color from options is used\n\t */\n\ttopFillColor1?: string;\n\n\t/**\n\t * Optional top area bottom fill color value for certain data item. If missed, color from options is used\n\t */\n\ttopFillColor2?: string;\n\n\t/**\n\t * Optional top area line color value for certain data item. If missed, color from options is used\n\t */\n\ttopLineColor?: string;\n\n\t/**\n\t * Optional bottom area top fill color value for certain data item. If missed, color from options is used\n\t */\n\tbottomFillColor1?: string;\n\n\t/**\n\t * Optional bottom area bottom fill color value for certain data item. If missed, color from options is used\n\t */\n\tbottomFillColor2?: string;\n\n\t/**\n\t * Optional bottom area line color value for certain data item. If missed, color from options is used\n\t */\n\tbottomLineColor?: string;\n}\n\n/**\n * Represents a bar with a {@link Time} and open, high, low, and close prices.\n */\nexport interface OhlcData<HorzScaleItem = Time> extends WhitespaceData<HorzScaleItem> {\n\t/**\n\t * The bar time.\n\t */\n\ttime: HorzScaleItem;\n\n\t/**\n\t * The open price.\n\t */\n\topen: number;\n\t/**\n\t * The high price.\n\t */\n\thigh: number;\n\t/**\n\t * The low price.\n\t */\n\tlow: number;\n\t/**\n\t * The close price.\n\t */\n\tclose: number;\n}\n\n/**\n * Structure describing a single item of data for bar series\n */\nexport interface BarData<HorzScaleItem = Time> extends OhlcData<HorzScaleItem> {\n\t/**\n\t * Optional color value for certain data item. If missed, color from options is used\n\t */\n\tcolor?: string;\n}\n\n/**\n * Structure describing a single item of data for candlestick series\n */\nexport interface CandlestickData<HorzScaleItem = Time> extends OhlcData<HorzScaleItem> {\n\t/**\n\t * Optional color value for certain data item. If missed, color from options is used\n\t */\n\tcolor?: string;\n\t/**\n\t * Optional border color value for certain data item. If missed, color from options is used\n\t */\n\tborderColor?: string;\n\t/**\n\t * Optional wick color value for certain data item. If missed, color from options is used\n\t */\n\twickColor?: string;\n}\n\nexport function isWhitespaceData<HorzScaleItem = Time>(data: SeriesDataItemTypeMap<HorzScaleItem>[SeriesType]): data is WhitespaceData<HorzScaleItem> {\n\treturn (data as Partial<BarData<HorzScaleItem>>).open === undefined && (data as Partial<LineData<HorzScaleItem>>).value === undefined;\n}\n\nexport function isFulfilledData<HorzScaleItem, T extends SeriesDataItemTypeMap<HorzScaleItem>[SeriesType]>(\n\tdata: T\n): data is Extract<T, BarData<HorzScaleItem> | LineData<HorzScaleItem> | HistogramData<HorzScaleItem>> {\n\treturn (\n\t\t(data as Partial<BarData<HorzScaleItem>>).open !== undefined ||\n\t\t(data as Partial<LineData<HorzScaleItem>>).value !== undefined\n\t);\n}\n\n/**\n * Represents the type of data that a series contains.\n *\n * For example a bar series contains {@link BarData} or {@link WhitespaceData}.\n */\nexport interface SeriesDataItemTypeMap<HorzScaleItem = Time> {\n\t/**\n\t * The types of bar series data.\n\t */\n\tBar: BarData<HorzScaleItem> | WhitespaceData<HorzScaleItem>;\n\t/**\n\t * The types of candlestick series data.\n\t */\n\tCandlestick: CandlestickData<HorzScaleItem> | WhitespaceData<HorzScaleItem>;\n\t/**\n\t * The types of area series data.\n\t */\n\tArea: AreaData<HorzScaleItem> | WhitespaceData<HorzScaleItem>;\n\t/**\n\t * The types of baseline series data.\n\t */\n\tBaseline: BaselineData<HorzScaleItem> | WhitespaceData<HorzScaleItem>;\n\t/**\n\t * The types of line series data.\n\t */\n\tLine: LineData<HorzScaleItem> | WhitespaceData<HorzScaleItem>;\n\t/**\n\t * The types of histogram series data.\n\t */\n\tHistogram: HistogramData<HorzScaleItem> | WhitespaceData<HorzScaleItem>;\n\t/**\n\t * The base types of an custom series data.\n\t */\n\tCustom: CustomData<HorzScaleItem> | CustomSeriesWhitespaceData<HorzScaleItem>;\n}\n\nexport interface DataUpdatesConsumer<TSeriesType extends SeriesType, HorzScaleItem = Time> {\n\tapplyNewData(series: Series<TSeriesType>, data: SeriesDataItemTypeMap<HorzScaleItem>[TSeriesType][]): void;\n\tupdateData(series: Series<TSeriesType>, data: SeriesDataItemTypeMap<HorzScaleItem>[TSeriesType]): void;\n}\n","import { ensureDefined } from '../helpers/assertions';\nimport { Mutable } from '../helpers/mutable';\n\nimport { CustomData } from '../model/icustom-series';\nimport { PlotRow, PlotRowValue } from '../model/plot-data';\nimport { SeriesPlotRow } from '../model/series-data';\nimport { SeriesType } from '../model/series-options';\nimport { TimePointIndex } from '../model/time-data';\n\nimport { AreaData, BarData, BaselineData, CandlestickData, HistogramData, isWhitespaceData, LineData, SeriesDataItemTypeMap, WhitespaceData } from './data-consumer';\nimport { InternalHorzScaleItem } from './ihorz-scale-behavior';\n\nfunction getColoredLineBasedSeriesPlotRow<HorzScaleItem>(time: InternalHorzScaleItem, index: TimePointIndex, item: LineData | HistogramData, originalTime: HorzScaleItem): Mutable<SeriesPlotRow<'Line' | 'Histogram'>> {\n\tconst val = item.value;\n\n\tconst res: Mutable<SeriesPlotRow<'Line' | 'Histogram'>> = { index, time, value: [val, val, val, val], originalTime };\n\n\tif (item.color !== undefined) {\n\t\tres.color = item.color;\n\t}\n\n\treturn res;\n}\n\nfunction getAreaSeriesPlotRow<HorzScaleItem>(time: InternalHorzScaleItem, index: TimePointIndex, item: AreaData, originalTime: HorzScaleItem): Mutable<SeriesPlotRow<'Area'>> {\n\tconst val = item.value;\n\n\tconst res: Mutable<SeriesPlotRow<'Area'>> = { index, time, value: [val, val, val, val], originalTime };\n\n\tif (item.lineColor !== undefined) {\n\t\tres.lineColor = item.lineColor;\n\t}\n\n\tif (item.topColor !== undefined) {\n\t\tres.topColor = item.topColor;\n\t}\n\n\tif (item.bottomColor !== undefined) {\n\t\tres.bottomColor = item.bottomColor;\n\t}\n\n\treturn res;\n}\n\nfunction getBaselineSeriesPlotRow<HorzScaleItem>(time: InternalHorzScaleItem, index: TimePointIndex, item: BaselineData, originalTime: HorzScaleItem): Mutable<SeriesPlotRow<'Baseline'>> {\n\tconst val = item.value;\n\n\tconst res: Mutable<SeriesPlotRow<'Baseline'>> = { index, time, value: [val, val, val, val], originalTime };\n\n\tif (item.topLineColor !== undefined) {\n\t\tres.topLineColor = item.topLineColor;\n\t}\n\n\tif (item.bottomLineColor !== undefined) {\n\t\tres.bottomLineColor = item.bottomLineColor;\n\t}\n\n\tif (item.topFillColor1 !== undefined) {\n\t\tres.topFillColor1 = item.topFillColor1;\n\t}\n\n\tif (item.topFillColor2 !== undefined) {\n\t\tres.topFillColor2 = item.topFillColor2;\n\t}\n\n\tif (item.bottomFillColor1 !== undefined) {\n\t\tres.bottomFillColor1 = item.bottomFillColor1;\n\t}\n\n\tif (item.bottomFillColor2 !== undefined) {\n\t\tres.bottomFillColor2 = item.bottomFillColor2;\n\t}\n\n\treturn res;\n}\n\nfunction getBarSeriesPlotRow<HorzScaleItem>(time: InternalHorzScaleItem, index: TimePointIndex, item: BarData, originalTime: HorzScaleItem): Mutable<SeriesPlotRow<'Bar'>> {\n\tconst res: Mutable<SeriesPlotRow<'Bar'>> = { index, time, value: [item.open, item.high, item.low, item.close], originalTime };\n\n\tif (item.color !== undefined) {\n\t\tres.color = item.color;\n\t}\n\n\treturn res;\n}\n\nfunction getCandlestickSeriesPlotRow<HorzScaleItem>(time: InternalHorzScaleItem, index: TimePointIndex, item: CandlestickData, originalTime: HorzScaleItem): Mutable<SeriesPlotRow<'Candlestick'>> {\n\tconst res: Mutable<SeriesPlotRow<'Candlestick'>> = { index, time, value: [item.open, item.high, item.low, item.close], originalTime };\n\tif (item.color !== undefined) {\n\t\tres.color = item.color;\n\t}\n\n\tif (item.borderColor !== undefined) {\n\t\tres.borderColor = item.borderColor;\n\t}\n\n\tif (item.wickColor !== undefined) {\n\t\tres.wickColor = item.wickColor;\n\t}\n\n\treturn res;\n}\n\n// The returned data is used for scaling the series, and providing the current value for the price scale\nexport type CustomDataToPlotRowValueConverter<HorzScaleItem> = (item: CustomData<HorzScaleItem> | WhitespaceData) => number[];\n\nfunction getCustomSeriesPlotRow<HorzScaleItem>(time: InternalHorzScaleItem, index: TimePointIndex, item: CustomData<HorzScaleItem> | WhitespaceData, originalTime: HorzScaleItem, dataToPlotRow?: CustomDataToPlotRowValueConverter<HorzScaleItem>): Mutable<SeriesPlotRow<'Custom'>> {\n\tconst values = ensureDefined(dataToPlotRow)(item);\n\tconst max = Math.max(...values);\n\tconst min = Math.min(...values);\n\tconst last = values[values.length - 1];\n\tconst value: PlotRowValue = [last, max, min, last];\n\tconst { time: excludedTime, color, ...data } = item as CustomData<HorzScaleItem>;\n\treturn { index, time, value, originalTime, data, color };\n}\n\nexport type WhitespacePlotRow = Omit<PlotRow, 'value'>;\n\nexport function isSeriesPlotRow(row: SeriesPlotRow | WhitespacePlotRow): row is SeriesPlotRow {\n\treturn (row as Partial<SeriesPlotRow>).value !== undefined;\n}\n\ntype SeriesItemValueFnMap<HorzScaleItem> = {\n\t[T in keyof SeriesDataItemTypeMap]: (time: InternalHorzScaleItem, index: TimePointIndex, item: SeriesDataItemTypeMap<HorzScaleItem>[T], originalTime: HorzScaleItem, dataToPlotRow?: CustomDataToPlotRowValueConverter<HorzScaleItem>, customIsWhitespace?: WhitespaceCheck<HorzScaleItem>) => Mutable<SeriesPlotRow<T> | WhitespacePlotRow>;\n};\n\nfunction wrapCustomValues<T extends SeriesPlotRow | WhitespacePlotRow, HorzScaleItem>(plotRow: Mutable<T>, bar: SeriesDataItemTypeMap<HorzScaleItem>[SeriesType]): Mutable<T> {\n\tif (bar.customValues !== undefined) {\n\t\tplotRow.customValues = bar.customValues;\n\t}\n\treturn plotRow;\n}\n\nexport type WhitespaceCheck<HorzScaleItem> = (bar: SeriesDataItemTypeMap<HorzScaleItem>[SeriesType]) => bar is WhitespaceData<HorzScaleItem>;\n\nfunction isWhitespaceDataWithCustomCheck<HorzScaleItem>(bar: SeriesDataItemTypeMap<HorzScaleItem>[SeriesType], customIsWhitespace?: WhitespaceCheck<HorzScaleItem>): bar is WhitespaceData<HorzScaleItem> {\n\tif (customIsWhitespace) {\n\t\treturn customIsWhitespace(bar);\n\t}\n\treturn isWhitespaceData(bar);\n}\n\ntype GetPlotRowType = (typeof getBaselineSeriesPlotRow) | (typeof getBarSeriesPlotRow) | (typeof getCandlestickSeriesPlotRow) | (typeof getCustomSeriesPlotRow);\n\nfunction wrapWhitespaceData<TSeriesType extends SeriesType, HorzScaleItem>(createPlotRowFn: GetPlotRowType): SeriesItemValueFnMap<HorzScaleItem>[TSeriesType] {\n\treturn (time: InternalHorzScaleItem, index: TimePointIndex, bar: SeriesDataItemTypeMap<HorzScaleItem>[SeriesType], originalTime: HorzScaleItem, dataToPlotRow?: CustomDataToPlotRowValueConverter<HorzScaleItem>, customIsWhitespace?: WhitespaceCheck<HorzScaleItem>) => {\n\t\tif (isWhitespaceDataWithCustomCheck(bar, customIsWhitespace)) {\n\t\t\treturn wrapCustomValues({ time, index, originalTime }, bar);\n\t\t}\n\n\t\treturn wrapCustomValues<ReturnType<GetPlotRowType>, HorzScaleItem>(createPlotRowFn(time, index, bar, originalTime, dataToPlotRow), bar);\n\t};\n}\n\nexport function getSeriesPlotRowCreator<TSeriesType extends SeriesType, HorzScaleItem>(seriesType: TSeriesType): SeriesItemValueFnMap<HorzScaleItem>[TSeriesType] {\n\tconst seriesPlotRowFnMap: SeriesItemValueFnMap<HorzScaleItem> = {\n\t\tCandlestick: wrapWhitespaceData(getCandlestickSeriesPlotRow),\n\t\tBar: wrapWhitespaceData(getBarSeriesPlotRow),\n\t\tArea: wrapWhitespaceData(getAreaSeriesPlotRow),\n\t\tBaseline: wrapWhitespaceData(getBaselineSeriesPlotRow),\n\t\tHistogram: wrapWhitespaceData(getColoredLineBasedSeriesPlotRow),\n\t\tLine: wrapWhitespaceData(getColoredLineBasedSeriesPlotRow),\n\t\tCustom: wrapWhitespaceData(getCustomSeriesPlotRow),\n\t};\n\treturn seriesPlotRowFnMap[seriesType];\n}\n","/// <reference types=\"_build-time-constants\" />\n\nimport { lowerBound } from '../helpers/algorithms';\nimport { ensureDefined } from '../helpers/assertions';\nimport { Mutable } from '../helpers/mutable';\n\nimport { SeriesDataItemTypeMap } from './data-consumer';\nimport { getSeriesPlotRowCreator, isSeriesPlotRow, WhitespacePlotRow } from './get-series-plot-row-creator';\nimport { IHorzScaleBehavior, InternalHorzScaleItem, InternalHorzScaleItemKey } from './ihorz-scale-behavior';\nimport { Series, SeriesUpdateInfo } from './series';\nimport { SeriesPlotRow } from './series-data';\nimport { SeriesType } from './series-options';\nimport {\n\tTickMarkWeightValue,\n\tTimePointIndex,\n\tTimeScalePoint,\n} from './time-data';\n\nexport type TimedData<HorzScaleItem> = Pick<SeriesDataItemTypeMap<HorzScaleItem>[SeriesType], 'time'>;\n\nexport interface TimeScaleChanges {\n\t/**\n\t * An index of the first changed time scale point by any type of change (time, weight, etc)\n\t */\n\tfirstChangedPointIndex?: TimePointIndex;\n\n\t/**\n\t * An array of the new time scale points\n\t */\n\tpoints?: readonly TimeScalePoint[];\n\n\t/**\n\t * In terms of time scale \"base index\" means the latest time scale point with data (there might be whitespaces)\n\t */\n\tbaseIndex: TimePointIndex | null;\n}\n\nexport interface SeriesChanges {\n\t/**\n\t * Data to be merged into series' plot list\n\t */\n\tdata: readonly SeriesPlotRow<SeriesType>[];\n\t/**\n\t * Additional info about this change\n\t */\n\tinfo?: SeriesUpdateInfo;\n}\n\nexport interface DataUpdateResponse {\n\t/**\n\t * Contains updates for all _changed_ series (if series data doesn't changed then it will not be here)\n\t */\n\tseries: Map<Series<SeriesType>, SeriesChanges>;\n\n\t/**\n\t * Contains optional time scale points\n\t */\n\ttimeScale: TimeScaleChanges;\n}\n\ninterface TimePointData {\n\tindex: TimePointIndex;\n\ttimePoint: InternalHorzScaleItem;\n\n\t// actually the type of the value should be related to the series' type (generic type)\n\t// here, in data layer all data for us is \"mutable\" by default, but to the chart we provide \"readonly\" data, to avoid modifying it\n\tmapping: Map<Series<SeriesType>, Mutable<SeriesPlotRow<SeriesType> | WhitespacePlotRow>>;\n}\n\nexport interface InternalTimeScalePoint extends Mutable<TimeScalePoint> {\n\tpointData: TimePointData;\n}\n\nfunction createEmptyTimePointData(timePoint: InternalHorzScaleItem): TimePointData {\n\treturn { index: 0 as TimePointIndex, mapping: new Map(), timePoint };\n}\n\ninterface SeriesRowsFirstAndLastTime {\n\tfirstTime: InternalHorzScaleItemKey;\n\tlastTime: InternalHorzScaleItemKey;\n}\n\nfunction seriesRowsFirstAndLastTime<TSeriesType extends SeriesType, HorzScaleItem>(seriesRows: SeriesPlotRow<TSeriesType>[] | undefined, bh: IHorzScaleBehavior<HorzScaleItem>): SeriesRowsFirstAndLastTime | undefined {\n\tif (seriesRows === undefined || seriesRows.length === 0) {\n\t\treturn undefined;\n\t}\n\n\treturn {\n\t\tfirstTime: bh.key(seriesRows[0].time),\n\t\tlastTime: bh.key(seriesRows[seriesRows.length - 1].time),\n\t};\n}\n\nfunction seriesUpdateInfo<TSeriesType extends SeriesType, HorzScaleItem>(seriesRows: SeriesPlotRow<TSeriesType>[] | undefined, prevSeriesRows: SeriesPlotRow<TSeriesType>[] | undefined, bh: IHorzScaleBehavior<HorzScaleItem>): SeriesUpdateInfo | undefined {\n\tconst firstAndLastTime = seriesRowsFirstAndLastTime(seriesRows, bh);\n\tconst prevFirstAndLastTime = seriesRowsFirstAndLastTime(prevSeriesRows, bh);\n\tif (firstAndLastTime !== undefined && prevFirstAndLastTime !== undefined) {\n\t\treturn {\n\t\t\tlastBarUpdatedOrNewBarsAddedToTheRight:\n\t\t\t\tfirstAndLastTime.lastTime >= prevFirstAndLastTime.lastTime &&\n\t\t\t\tfirstAndLastTime.firstTime >= prevFirstAndLastTime.firstTime,\n\t\t};\n\t}\n\n\treturn undefined;\n}\n\nfunction timeScalePointTime<TSeriesType extends SeriesType, HorzScaleItem>(mergedPointData: Map<Series<TSeriesType>, SeriesPlotRow<TSeriesType> | WhitespacePlotRow>): HorzScaleItem {\n\tlet result: HorzScaleItem | undefined;\n\tmergedPointData.forEach((v: SeriesPlotRow<TSeriesType> | WhitespacePlotRow) => {\n\t\tif (result === undefined) {\n\t\t\tresult = v.originalTime as HorzScaleItem;\n\t\t}\n\t});\n\n\treturn ensureDefined(result);\n}\n\nfunction saveOriginalTime<TSeriesType extends SeriesType, HorzScaleItem>(data: SeriesDataItemWithOriginalTime<TSeriesType, HorzScaleItem>): void {\n\tif (data.originalTime === undefined) {\n\t\tdata.originalTime = data.time;\n\t}\n}\n\ntype SeriesDataItemWithOriginalTime<TSeriesType extends SeriesType, HorzScaleItem> = SeriesDataItemTypeMap<HorzScaleItem>[TSeriesType] & {\n\toriginalTime: HorzScaleItem;\n};\n\nexport class DataLayer<HorzScaleItem> {\n\t// note that _pointDataByTimePoint and _seriesRowsBySeries shares THE SAME objects in their values between each other\n\t// it's just different kind of maps to make usages/perf better\n\tprivate _pointDataByTimePoint: Map<InternalHorzScaleItemKey, TimePointData> = new Map();\n\tprivate _seriesRowsBySeries: Map<Series<SeriesType>, SeriesPlotRow<SeriesType>[]> = new Map();\n\tprivate _seriesLastTimePoint: Map<Series<SeriesType>, InternalHorzScaleItem> = new Map();\n\n\t// this is kind of \"dest\" values (in opposite to \"source\" ones) - we don't need to modify it manually, the only by calling _updateTimeScalePoints or updateSeriesData methods\n\tprivate _sortedTimePoints: readonly InternalTimeScalePoint[] = [];\n\n\tprivate readonly _horzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>;\n\n\tpublic constructor(horzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>) {\n\t\tthis._horzScaleBehavior = horzScaleBehavior;\n\t}\n\n\tpublic destroy(): void {\n\t\tthis._pointDataByTimePoint.clear();\n\t\tthis._seriesRowsBySeries.clear();\n\t\tthis._seriesLastTimePoint.clear();\n\t\tthis._sortedTimePoints = [];\n\t}\n\n\tpublic setSeriesData<TSeriesType extends SeriesType>(series: Series<TSeriesType>, data: SeriesDataItemTypeMap<HorzScaleItem>[TSeriesType][]): DataUpdateResponse {\n\t\tlet needCleanupPoints = this._pointDataByTimePoint.size !== 0;\n\n\t\tlet isTimeScaleAffected = false;\n\n\t\t// save previous series rows data before it's replaced inside this._setRowsToSeries\n\t\tconst prevSeriesRows = this._seriesRowsBySeries.get(series);\n\t\tif (prevSeriesRows !== undefined) {\n\t\t\tif (this._seriesRowsBySeries.size === 1) {\n\t\t\t\tneedCleanupPoints = false;\n\t\t\t\tisTimeScaleAffected = true;\n\n\t\t\t\t// perf optimization - if there is only 1 series, then we can just clear and fill everything from scratch\n\t\t\t\tthis._pointDataByTimePoint.clear();\n\t\t\t} else {\n\t\t\t\t// perf optimization - actually we have to use this._pointDataByTimePoint for going through here\n\t\t\t\t// but as soon as this._sortedTimePoints is just a different form of _pointDataByTimePoint we can use it as well\n\t\t\t\tfor (const point of this._sortedTimePoints) {\n\t\t\t\t\tif (point.pointData.mapping.delete(series)) {\n\t\t\t\t\t\tisTimeScaleAffected = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet seriesRows: (SeriesPlotRow<TSeriesType> | WhitespacePlotRow)[] = [];\n\n\t\tif (data.length !== 0) {\n\t\t\tconst originalTimes = data.map((d: SeriesDataItemTypeMap<HorzScaleItem>[TSeriesType]) => d.time);\n\n\t\t\tconst timeConverter = this._horzScaleBehavior.createConverterToInternalObj(data);\n\n\t\t\tconst createPlotRow = getSeriesPlotRowCreator<TSeriesType, HorzScaleItem>(series.seriesType());\n\t\t\tconst dataToPlotRow = series.customSeriesPlotValuesBuilder();\n\t\t\tconst customWhitespaceChecker = series.customSeriesWhitespaceCheck<HorzScaleItem>();\n\n\t\t\tseriesRows = data.map((item: SeriesDataItemTypeMap<HorzScaleItem>[TSeriesType], index: number) => {\n\t\t\t\tconst time = timeConverter(item.time);\n\n\t\t\t\tconst horzItemKey = this._horzScaleBehavior.key(time);\n\n\t\t\t\tlet timePointData = this._pointDataByTimePoint.get(horzItemKey);\n\t\t\t\tif (timePointData === undefined) {\n\t\t\t\t\t// the indexes will be sync later\n\t\t\t\t\ttimePointData = createEmptyTimePointData(time);\n\t\t\t\t\tthis._pointDataByTimePoint.set(horzItemKey, timePointData);\n\t\t\t\t\tisTimeScaleAffected = true;\n\t\t\t\t}\n\n\t\t\t\tconst row = createPlotRow(time, timePointData.index, item, originalTimes[index], dataToPlotRow, customWhitespaceChecker);\n\t\t\t\ttimePointData.mapping.set(series, row);\n\t\t\t\treturn row;\n\t\t\t});\n\t\t}\n\n\t\tif (needCleanupPoints) {\n\t\t\t// we deleted the old data from mapping and added the new ones\n\t\t\t// so there might be empty points now, let's remove them first\n\t\t\tthis._cleanupPointsData();\n\t\t}\n\n\t\tthis._setRowsToSeries(series, seriesRows);\n\n\t\tlet firstChangedPointIndex = -1;\n\t\tif (isTimeScaleAffected) {\n\t\t\t// then generate the time scale points\n\t\t\t// timeWeight will be updates in _updateTimeScalePoints later\n\t\t\tconst newTimeScalePoints: InternalTimeScalePoint[] = [];\n\t\t\tthis._pointDataByTimePoint.forEach((pointData: TimePointData) => {\n\t\t\t\tnewTimeScalePoints.push({\n\t\t\t\t\ttimeWeight: 0 as TickMarkWeightValue,\n\t\t\t\t\ttime: pointData.timePoint,\n\t\t\t\t\tpointData,\n\t\t\t\t\toriginalTime: timeScalePointTime(pointData.mapping),\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tnewTimeScalePoints.sort((t1: InternalTimeScalePoint, t2: InternalTimeScalePoint) => this._horzScaleBehavior.key(t1.time) - this._horzScaleBehavior.key(t2.time));\n\n\t\t\tfirstChangedPointIndex = this._replaceTimeScalePoints(newTimeScalePoints);\n\t\t}\n\n\t\treturn this._getUpdateResponse(\n\t\t\tseries,\n\t\t\tfirstChangedPointIndex,\n\t\t\tseriesUpdateInfo(this._seriesRowsBySeries.get(series), prevSeriesRows, this._horzScaleBehavior)\n\t\t);\n\t}\n\n\tpublic removeSeries(series: Series<SeriesType>): DataUpdateResponse {\n\t\treturn this.setSeriesData(series, []);\n\t}\n\n\tpublic updateSeriesData<TSeriesType extends SeriesType>(series: Series<TSeriesType>, data: SeriesDataItemTypeMap<HorzScaleItem>[TSeriesType]): DataUpdateResponse {\n\t\tconst extendedData = data as SeriesDataItemWithOriginalTime<TSeriesType, HorzScaleItem>;\n\t\tsaveOriginalTime(extendedData);\n\t\t// convertStringToBusinessDay(data);\n\t\tthis._horzScaleBehavior.preprocessData(data);\n\t\tconst timeConverter = this._horzScaleBehavior.createConverterToInternalObj([data]);\n\n\t\tconst time = timeConverter(data.time);\n\n\t\tconst lastSeriesTime = this._seriesLastTimePoint.get(series);\n\t\tif (lastSeriesTime !== undefined && this._horzScaleBehavior.key(time) < this._horzScaleBehavior.key(lastSeriesTime)) {\n\t\t\tthrow new Error(`Cannot update oldest data, last time=${lastSeriesTime}, new time=${time}`);\n\t\t}\n\n\t\tlet pointDataAtTime = this._pointDataByTimePoint.get(this._horzScaleBehavior.key(time));\n\n\t\t// if no point data found for the new data item\n\t\t// that means that we need to update scale\n\t\tconst affectsTimeScale = pointDataAtTime === undefined;\n\n\t\tif (pointDataAtTime === undefined) {\n\t\t\t// the indexes will be sync later\n\t\t\tpointDataAtTime = createEmptyTimePointData(time);\n\t\t\tthis._pointDataByTimePoint.set(this._horzScaleBehavior.key(time), pointDataAtTime);\n\t\t}\n\n\t\tconst createPlotRow = getSeriesPlotRowCreator<SeriesType, HorzScaleItem>(series.seriesType());\n\t\tconst dataToPlotRow = series.customSeriesPlotValuesBuilder();\n\t\tconst customWhitespaceChecker = series.customSeriesWhitespaceCheck<HorzScaleItem>();\n\t\tconst plotRow = createPlotRow(time, pointDataAtTime.index, data, extendedData.originalTime, dataToPlotRow, customWhitespaceChecker);\n\n\t\tpointDataAtTime.mapping.set(series, plotRow);\n\n\t\tthis._updateLastSeriesRow(series, plotRow);\n\n\t\tconst info: SeriesUpdateInfo = { lastBarUpdatedOrNewBarsAddedToTheRight: isSeriesPlotRow(plotRow) };\n\n\t\t// if point already exist on the time scale - we don't need to make a full update and just make an incremental one\n\t\tif (!affectsTimeScale) {\n\t\t\treturn this._getUpdateResponse(series, -1, info);\n\t\t}\n\n\t\tconst newPoint: InternalTimeScalePoint = {\n\t\t\ttimeWeight: 0 as TickMarkWeightValue,\n\t\t\ttime: pointDataAtTime.timePoint,\n\t\t\tpointData: pointDataAtTime,\n\t\t\toriginalTime: timeScalePointTime(pointDataAtTime.mapping),\n\t\t};\n\n\t\tconst insertIndex = lowerBound(this._sortedTimePoints, this._horzScaleBehavior.key(newPoint.time), (a: InternalTimeScalePoint, b: number) => this._horzScaleBehavior.key(a.time) < b);\n\n\t\t// yes, I know that this array is readonly and this change is intended to make it performative\n\t\t// we marked _sortedTimePoints array as readonly to avoid modifying this array anywhere else\n\t\t// but this place is exceptional case due performance reasons, sorry\n\t\t(this._sortedTimePoints as InternalTimeScalePoint[]).splice(insertIndex, 0, newPoint);\n\n\t\tfor (let index = insertIndex; index < this._sortedTimePoints.length; ++index) {\n\t\t\tassignIndexToPointData(this._sortedTimePoints[index].pointData, index as TimePointIndex);\n\t\t}\n\n\t\tthis._horzScaleBehavior.fillWeightsForPoints(this._sortedTimePoints, insertIndex);\n\n\t\treturn this._getUpdateResponse(series, insertIndex, info);\n\t}\n\n\tprivate _updateLastSeriesRow(series: Series<SeriesType>, plotRow: SeriesPlotRow<SeriesType> | WhitespacePlotRow): void {\n\t\tlet seriesData = this._seriesRowsBySeries.get(series);\n\t\tif (seriesData === undefined) {\n\t\t\tseriesData = [];\n\t\t\tthis._seriesRowsBySeries.set(series, seriesData);\n\t\t}\n\n\t\tconst lastSeriesRow = seriesData.length !== 0 ? seriesData[seriesData.length - 1] : null;\n\n\t\tif (lastSeriesRow === null || this._horzScaleBehavior.key(plotRow.time) > this._horzScaleBehavior.key(lastSeriesRow.time)) {\n\t\t\tif (isSeriesPlotRow(plotRow)) {\n\t\t\t\tseriesData.push(plotRow);\n\t\t\t}\n\t\t} else {\n\t\t\tif (isSeriesPlotRow(plotRow)) {\n\t\t\t\tseriesData[seriesData.length - 1] = plotRow;\n\t\t\t} else {\n\t\t\t\tseriesData.splice(-1, 1);\n\t\t\t}\n\t\t}\n\n\t\tthis._seriesLastTimePoint.set(series, plotRow.time);\n\t}\n\n\tprivate _setRowsToSeries(series: Series<SeriesType>, seriesRows: (SeriesPlotRow<SeriesType> | WhitespacePlotRow)[]): void {\n\t\tif (seriesRows.length !== 0) {\n\t\t\tthis._seriesRowsBySeries.set(series, seriesRows.filter(isSeriesPlotRow));\n\t\t\tthis._seriesLastTimePoint.set(series, seriesRows[seriesRows.length - 1].time);\n\t\t} else {\n\t\t\tthis._seriesRowsBySeries.delete(series);\n\t\t\tthis._seriesLastTimePoint.delete(series);\n\t\t}\n\t}\n\n\tprivate _cleanupPointsData(): void {\n\t\t// let's treat all current points as \"potentially removed\"\n\t\t// we could create an array with actually potentially removed points\n\t\t// but most likely this array will be similar to _sortedTimePoints so let's avoid using additional memory\n\t\t// note that we can use _sortedTimePoints here since a point might be removed only it was here previously\n\t\tfor (const point of this._sortedTimePoints) {\n\t\t\tif (point.pointData.mapping.size === 0) {\n\t\t\t\tthis._pointDataByTimePoint.delete(this._horzScaleBehavior.key(point.time));\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Sets new time scale and make indexes valid for all series\n\t *\n\t * @returns The index of the first changed point or `-1` if there is no change.\n\t */\n\tprivate _replaceTimeScalePoints(newTimePoints: InternalTimeScalePoint[]): number {\n\t\tlet firstChangedPointIndex = -1;\n\n\t\t// search the first different point and \"syncing\" time weight by the way\n\t\tfor (let index = 0; index < this._sortedTimePoints.length && index < newTimePoints.length; ++index) {\n\t\t\tconst oldPoint = this._sortedTimePoints[index];\n\t\t\tconst newPoint = newTimePoints[index];\n\t\t\tif (this._horzScaleBehavior.key(oldPoint.time) !== this._horzScaleBehavior.key(newPoint.time)) {\n\t\t\t\tfirstChangedPointIndex = index;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// re-assign point's time weight for points if time is the same (and all prior times was the same)\n\t\t\tnewPoint.timeWeight = oldPoint.timeWeight;\n\n\t\t\tassignIndexToPointData(newPoint.pointData, index as TimePointIndex);\n\t\t}\n\n\t\tif (firstChangedPointIndex === -1 && this._sortedTimePoints.length !== newTimePoints.length) {\n\t\t\t// the common part of the prev and the new points are the same\n\t\t\t// so the first changed point is the next after the common part\n\t\t\tfirstChangedPointIndex = Math.min(this._sortedTimePoints.length, newTimePoints.length);\n\t\t}\n\n\t\tif (firstChangedPointIndex === -1) {\n\t\t\t// if no time scale changed, then do nothing\n\t\t\treturn -1;\n\t\t}\n\n\t\t// if time scale points are changed that means that we need to make full update to all series (with clearing points)\n\t\t// but first we need to synchronize indexes and re-fill time weights\n\t\tfor (let index = firstChangedPointIndex; index < newTimePoints.length; ++index) {\n\t\t\tassignIndexToPointData(newTimePoints[index].pointData, index as TimePointIndex);\n\t\t}\n\n\t\t// re-fill time weights for point after the first changed one\n\t\tthis._horzScaleBehavior.fillWeightsForPoints(newTimePoints, firstChangedPointIndex);\n\n\t\tthis._sortedTimePoints = newTimePoints;\n\n\t\treturn firstChangedPointIndex;\n\t}\n\n\tprivate _getBaseIndex(): TimePointIndex | null {\n\t\tif (this._seriesRowsBySeries.size === 0) {\n\t\t\t// if we have no data then 'reset' the base index to null\n\t\t\treturn null;\n\t\t}\n\n\t\tlet baseIndex = 0 as TimePointIndex;\n\n\t\tthis._seriesRowsBySeries.forEach((data: SeriesPlotRow<SeriesType>[]) => {\n\t\t\tif (data.length !== 0) {\n\t\t\t\tbaseIndex = Math.max(baseIndex, data[data.length - 1].index) as TimePointIndex;\n\t\t\t}\n\t\t});\n\n\t\treturn baseIndex;\n\t}\n\n\tprivate _getUpdateResponse(updatedSeries: Series<SeriesType>, firstChangedPointIndex: number, info?: SeriesUpdateInfo): DataUpdateResponse {\n\t\tconst dataUpdateResponse: DataUpdateResponse = {\n\t\t\tseries: new Map(),\n\t\t\ttimeScale: {\n\t\t\t\tbaseIndex: this._getBaseIndex(),\n\t\t\t},\n\t\t};\n\n\t\tif (firstChangedPointIndex !== -1) {\n\t\t\t// TODO: it's possible to make perf improvements by checking what series has data after firstChangedPointIndex\n\t\t\t// but let's skip for now\n\t\t\tthis._seriesRowsBySeries.forEach((data: SeriesPlotRow<SeriesType>[], s: Series<SeriesType>) => {\n\t\t\t\tdataUpdateResponse.series.set(\n\t\t\t\t\ts,\n\t\t\t\t\t{\n\t\t\t\t\t\tdata,\n\t\t\t\t\t\tinfo: s === updatedSeries ? info : undefined,\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\n\t\t\t// if the series data was set to [] it will have already been removed from _seriesRowBySeries\n\t\t\t// meaning the forEach above won't add the series to the data update response\n\t\t\t// so we handle that case here\n\t\t\tif (!this._seriesRowsBySeries.has(updatedSeries)) {\n\t\t\t\tdataUpdateResponse.series.set(updatedSeries, { data: [], info });\n\t\t\t}\n\n\t\t\tdataUpdateResponse.timeScale.points = this._sortedTimePoints;\n\t\t\tdataUpdateResponse.timeScale.firstChangedPointIndex = firstChangedPointIndex as TimePointIndex;\n\t\t} else {\n\t\t\tconst seriesData = this._seriesRowsBySeries.get(updatedSeries);\n\t\t\t// if no seriesData found that means that we just removed the series\n\t\t\tdataUpdateResponse.series.set(updatedSeries, { data: seriesData || [], info });\n\t\t}\n\n\t\treturn dataUpdateResponse;\n\t}\n}\n\nfunction assignIndexToPointData<HorzScaleItem>(pointData: TimePointData, index: TimePointIndex): void {\n\t// first, nevertheless update index of point data (\"make it valid\")\n\tpointData.index = index;\n\n\t// and then we need to sync indexes for all series\n\tpointData.mapping.forEach((seriesRow: Mutable<SeriesPlotRow<SeriesType> | WhitespacePlotRow>) => {\n\t\tseriesRow.index = index;\n\t});\n}\n","import {\n\tAreaData,\n\tBarData,\n\tBaselineData,\n\tCandlestickData,\n\tLineData,\n\tOhlcData,\n\tSeriesDataItemTypeMap,\n\tSingleValueData,\n} from '../model/data-consumer';\nimport { CustomData } from '../model/icustom-series';\nimport { PlotRow, PlotRowValueIndex } from '../model/plot-data';\nimport {\n\tAreaPlotRow,\n\tBarPlotRow,\n\tBaselinePlotRow,\n\tCandlestickPlotRow,\n\tCustomPlotRow,\n\tLinePlotRow,\n\tSeriesPlotRow,\n} from '../model/series-data';\nimport { SeriesType } from '../model/series-options';\n\ntype SeriesPlotRowToDataMap<HorzScaleItem> = {\n\t[T in keyof SeriesDataItemTypeMap]: (plotRow: SeriesPlotRow<T>) => SeriesDataItemTypeMap<HorzScaleItem>[T];\n};\n\nfunction singleValueData<HorzScaleItem>(plotRow: PlotRow): SingleValueData<HorzScaleItem> {\n\tconst data: SingleValueData<HorzScaleItem> = {\n\t\tvalue: plotRow.value[PlotRowValueIndex.Close],\n\t\ttime: plotRow.originalTime as HorzScaleItem,\n\t};\n\tif (plotRow.customValues !== undefined) {\n\t\tdata.customValues = plotRow.customValues;\n\t}\n\treturn data;\n}\n\nfunction lineData<HorzScaleItem>(plotRow: LinePlotRow): LineData<HorzScaleItem> {\n\tconst result: LineData<HorzScaleItem> = singleValueData(plotRow);\n\n\tif (plotRow.color !== undefined) {\n\t\tresult.color = plotRow.color;\n\t}\n\n\treturn result;\n}\n\nfunction areaData<HorzScaleItem>(plotRow: AreaPlotRow): AreaData<HorzScaleItem> {\n\tconst result: AreaData<HorzScaleItem> = singleValueData(plotRow);\n\n\tif (plotRow.lineColor !== undefined) {\n\t\tresult.lineColor = plotRow.lineColor;\n\t}\n\n\tif (plotRow.topColor !== undefined) {\n\t\tresult.topColor = plotRow.topColor;\n\t}\n\n\tif (plotRow.bottomColor !== undefined) {\n\t\tresult.bottomColor = plotRow.bottomColor;\n\t}\n\n\treturn result;\n}\n\nfunction baselineData<HorzScaleItem>(plotRow: BaselinePlotRow): BaselineData<HorzScaleItem> {\n\tconst result: BaselineData<HorzScaleItem> = singleValueData(plotRow);\n\n\tif (plotRow.topLineColor !== undefined) {\n\t\tresult.topLineColor = plotRow.topLineColor;\n\t}\n\n\tif (plotRow.bottomLineColor !== undefined) {\n\t\tresult.bottomLineColor = plotRow.bottomLineColor;\n\t}\n\n\tif (plotRow.topFillColor1 !== undefined) {\n\t\tresult.topFillColor1 = plotRow.topFillColor1;\n\t}\n\n\tif (plotRow.topFillColor2 !== undefined) {\n\t\tresult.topFillColor2 = plotRow.topFillColor2;\n\t}\n\n\tif (plotRow.bottomFillColor1 !== undefined) {\n\t\tresult.bottomFillColor1 = plotRow.bottomFillColor1;\n\t}\n\n\tif (plotRow.bottomFillColor2 !== undefined) {\n\t\tresult.bottomFillColor2 = plotRow.bottomFillColor2;\n\t}\n\n\treturn result;\n}\n\nfunction ohlcData<HorzScaleItem>(plotRow: PlotRow): OhlcData<HorzScaleItem> {\n\tconst data: OhlcData<HorzScaleItem> = {\n\t\topen: plotRow.value[PlotRowValueIndex.Open],\n\t\thigh: plotRow.value[PlotRowValueIndex.High],\n\t\tlow: plotRow.value[PlotRowValueIndex.Low],\n\t\tclose: plotRow.value[PlotRowValueIndex.Close],\n\t\ttime: plotRow.originalTime as HorzScaleItem,\n\t};\n\tif (plotRow.customValues !== undefined) {\n\t\tdata.customValues = plotRow.customValues;\n\t}\n\treturn data;\n}\n\nfunction barData<HorzScaleItem>(plotRow: BarPlotRow): BarData<HorzScaleItem> {\n\tconst result: BarData<HorzScaleItem> = ohlcData<HorzScaleItem>(plotRow);\n\n\tif (plotRow.color !== undefined) {\n\t\tresult.color = plotRow.color;\n\t}\n\n\treturn result;\n}\n\nfunction candlestickData<HorzScaleItem>(plotRow: CandlestickPlotRow): CandlestickData<HorzScaleItem> {\n\tconst result: CandlestickData<HorzScaleItem> = ohlcData(plotRow);\n\tconst { color, borderColor, wickColor } = plotRow;\n\n\tif (color !== undefined) {\n\t\tresult.color = color;\n\t}\n\n\tif (borderColor !== undefined) {\n\t\tresult.borderColor = borderColor;\n\t}\n\n\tif (wickColor !== undefined) {\n\t\tresult.wickColor = wickColor;\n\t}\n\n\treturn result;\n}\n\nexport function getSeriesDataCreator<TSeriesType extends SeriesType, HorzScaleItem>(seriesType: TSeriesType): (plotRow: SeriesPlotRow<TSeriesType>) => SeriesDataItemTypeMap<HorzScaleItem>[TSeriesType] {\n\tconst seriesPlotRowToDataMap: SeriesPlotRowToDataMap<HorzScaleItem> = {\n\t\tArea: areaData<HorzScaleItem>,\n\t\tLine: lineData<HorzScaleItem>,\n\t\tBaseline: baselineData<HorzScaleItem>,\n\t\tHistogram: lineData<HorzScaleItem>,\n\t\tBar: barData<HorzScaleItem>,\n\t\tCandlestick: candlestickData<HorzScaleItem>,\n\t\tCustom: customData<HorzScaleItem>,\n\t};\n\treturn seriesPlotRowToDataMap[seriesType];\n}\n\nfunction customData<HorzScaleItem>(plotRow: CustomPlotRow): CustomData<HorzScaleItem> {\n\tconst time = plotRow.originalTime as HorzScaleItem;\n\treturn {\n\t\t...plotRow.data,\n\t\ttime,\n\t};\n}\n","import { CrosshairMode, CrosshairOptions } from '../../model/crosshair';\nimport { LineStyle } from '../../renderers/draw-line';\n\nexport const crosshairOptionsDefaults: CrosshairOptions = {\n\tvertLine: {\n\t\tcolor: '#9598A1',\n\t\twidth: 1,\n\t\tstyle: LineStyle.LargeDashed,\n\t\tvisible: true,\n\t\tlabelVisible: true,\n\t\tlabelBackgroundColor: '#131722',\n\t},\n\thorzLine: {\n\t\tcolor: '#9598A1',\n\t\twidth: 1,\n\t\tstyle: LineStyle.LargeDashed,\n\t\tvisible: true,\n\t\tlabelVisible: true,\n\t\tlabelBackgroundColor: '#131722',\n\t},\n\tmode: CrosshairMode.Magnet,\n};\n","import { GridOptions } from '../../model/grid';\nimport { LineStyle } from '../../renderers/draw-line';\n\nexport const gridOptionsDefaults: GridOptions = {\n\tvertLines: {\n\t\tcolor: '#D6DCDE',\n\t\tstyle: LineStyle.Solid,\n\t\tvisible: true,\n\t},\n\thorzLines: {\n\t\tcolor: '#D6DCDE',\n\t\tstyle: LineStyle.Solid,\n\t\tvisible: true,\n\t},\n};\n","import { defaultFontFamily } from '../../helpers/make-font';\n\nimport { ColorType, LayoutOptions } from '../../model/layout-options';\n\nexport const layoutOptionsDefaults: LayoutOptions = {\n\tbackground: {\n\t\ttype: ColorType.Solid,\n\t\tcolor: '#FFFFFF',\n\t},\n\ttextColor: '#191919',\n\tfontSize: 12,\n\tfontFamily: defaultFontFamily,\n};\n","import { PriceScaleMode, PriceScaleOptions } from '../../model/price-scale';\n\nexport const priceScaleOptionsDefaults: PriceScaleOptions = {\n\tautoScale: true,\n\tmode: PriceScaleMode.Normal,\n\tinvertScale: false,\n\talignLabels: true,\n\tborderVisible: true,\n\tborderColor: '#2B2B43',\n\tentireTextOnly: false,\n\tvisible: false,\n\tticksVisible: false,\n\tscaleMargins: {\n\t\tbottom: 0.1,\n\t\ttop: 0.2,\n\t},\n\tminimumWidth: 0,\n};\n","import { HorzScaleOptions } from '../../model/time-scale';\n\nexport const timeScaleOptionsDefaults: HorzScaleOptions = {\n\trightOffset: 0,\n\tbarSpacing: 6,\n\tminBarSpacing: 0.5,\n\tfixLeftEdge: false,\n\tfixRightEdge: false,\n\tlockVisibleTimeRangeOnResize: false,\n\trightBarStaysOnScroll: false,\n\tborderVisible: true,\n\tborderColor: '#2B2B43',\n\tvisible: true,\n\ttimeVisible: false,\n\tsecondsVisible: true,\n\tshiftVisibleRangeOnNewBar: true,\n\tallowShiftVisibleRangeOnWhitespaceReplacement: false,\n\tticksVisible: false,\n\tuniformDistribution: false,\n\tminimumHeight: 0,\n\tallowBoldLabels: true,\n};\n","import { defaultFontFamily } from '../../helpers/make-font';\n\nimport { WatermarkOptions } from '../../model/watermark';\n\nexport const watermarkOptionsDefaults: WatermarkOptions = {\n\tcolor: 'rgba(0, 0, 0, 0)',\n\tvisible: false,\n\tfontSize: 48,\n\tfontFamily: defaultFontFamily,\n\tfontStyle: '',\n\ttext: '',\n\thorzAlign: 'center',\n\tvertAlign: 'center',\n};\n","import { isRunningOnClientSide } from '../../helpers/is-running-on-client-side';\n\nimport { ChartOptionsInternal, TrackingModeExitMode } from '../../model/chart-model';\n\nimport { crosshairOptionsDefaults } from './crosshair-options-defaults';\nimport { gridOptionsDefaults } from './grid-options-defaults';\nimport { layoutOptionsDefaults } from './layout-options-defaults';\nimport { priceScaleOptionsDefaults } from './price-scale-options-defaults';\nimport { timeScaleOptionsDefaults } from './time-scale-options-defaults';\nimport { watermarkOptionsDefaults } from './watermark-options-defaults';\n\nexport function chartOptionsDefaults<HorzScaleItem>(): ChartOptionsInternal<HorzScaleItem> {\n\treturn {\n\t\twidth: 0,\n\t\theight: 0,\n\t\tautoSize: false,\n\t\tlayout: layoutOptionsDefaults,\n\t\tcrosshair: crosshairOptionsDefaults,\n\t\tgrid: gridOptionsDefaults,\n\t\toverlayPriceScales: {\n\t\t\t...priceScaleOptionsDefaults,\n\t\t},\n\t\tleftPriceScale: {\n\t\t\t...priceScaleOptionsDefaults,\n\t\t\tvisible: false,\n\t\t},\n\t\trightPriceScale: {\n\t\t\t...priceScaleOptionsDefaults,\n\t\t\tvisible: true,\n\t\t},\n\t\ttimeScale: timeScaleOptionsDefaults,\n\t\twatermark: watermarkOptionsDefaults,\n\t\tlocalization: {\n\t\t\tlocale: isRunningOnClientSide ? navigator.language : '',\n\t\t\tdateFormat: 'dd MMM \\'yy',\n\t\t},\n\t\thandleScroll: {\n\t\t\tmouseWheel: true,\n\t\t\tpressedMouseMove: true,\n\t\t\thorzTouchDrag: true,\n\t\t\tvertTouchDrag: true,\n\t\t},\n\t\thandleScale: {\n\t\t\taxisPressedMouseMove: {\n\t\t\t\ttime: true,\n\t\t\t\tprice: true,\n\t\t\t},\n\t\t\taxisDoubleClickReset: {\n\t\t\t\ttime: true,\n\t\t\t\tprice: true,\n\t\t\t},\n\t\t\tmouseWheel: true,\n\t\t\tpinch: true,\n\t\t},\n\t\tkineticScroll: {\n\t\t\tmouse: false,\n\t\t\ttouch: true,\n\t\t},\n\t\ttrackingMode: {\n\t\t\texitMode: TrackingModeExitMode.OnNextTap,\n\t\t},\n\t};\n}\n","import { IChartWidgetBase } from '../gui/chart-widget';\n\nimport { ensureNotNull } from '../helpers/assertions';\nimport { DeepPartial } from '../helpers/strict-type-checks';\n\nimport { isDefaultPriceScale } from '../model/default-price-scale';\nimport { PriceScale, PriceScaleOptions } from '../model/price-scale';\n\nimport { IPriceScaleApi } from './iprice-scale-api';\n\nexport class PriceScaleApi implements IPriceScaleApi {\n\tprivate _chartWidget: IChartWidgetBase;\n\tprivate readonly _priceScaleId: string;\n\n\tpublic constructor(chartWidget: IChartWidgetBase, priceScaleId: string) {\n\t\tthis._chartWidget = chartWidget;\n\t\tthis._priceScaleId = priceScaleId;\n\t}\n\n\tpublic applyOptions(options: DeepPartial<PriceScaleOptions>): void {\n\t\tthis._chartWidget.model().applyPriceScaleOptions(this._priceScaleId, options);\n\t}\n\n\tpublic options(): Readonly<PriceScaleOptions> {\n\t\treturn this._priceScale().options();\n\t}\n\n\tpublic width(): number {\n\t\tif (!isDefaultPriceScale(this._priceScaleId)) {\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn this._chartWidget.getPriceAxisWidth(this._priceScaleId);\n\t}\n\n\tprivate _priceScale(): PriceScale {\n\t\treturn ensureNotNull(this._chartWidget.model().findPriceScale(this._priceScaleId)).priceScale;\n\t}\n}\n","/// <reference types=\"_build-time-constants\" />\n\nimport { assert } from '../helpers/assertions';\n\nimport { isFulfilledData, SeriesDataItemTypeMap } from './data-consumer';\nimport { IHorzScaleBehavior } from './ihorz-scale-behavior';\nimport { CreatePriceLineOptions } from './price-line-options';\nimport { SeriesMarker } from './series-markers';\nimport { SeriesType } from './series-options';\n\nexport function checkPriceLineOptions(options: CreatePriceLineOptions): void {\n\tif (process.env.NODE_ENV === 'production') {\n\t\treturn;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/tslint/config\n\tassert(typeof options.price === 'number', `the type of 'price' price line's property must be a number, got '${typeof options.price}'`);\n}\n\nexport function checkItemsAreOrdered<HorzScaleItem>(data: readonly (SeriesMarker<HorzScaleItem> | SeriesDataItemTypeMap<HorzScaleItem>[SeriesType])[], bh: IHorzScaleBehavior<HorzScaleItem>, allowDuplicates: boolean = false): void {\n\tif (process.env.NODE_ENV === 'production') {\n\t\treturn;\n\t}\n\n\tif (data.length === 0) {\n\t\treturn;\n\t}\n\n\tlet prevTime = bh.key(data[0].time);\n\tfor (let i = 1; i < data.length; ++i) {\n\t\tconst currentTime = bh.key(data[i].time);\n\t\tconst checkResult = allowDuplicates ? prevTime <= currentTime : prevTime < currentTime;\n\t\tassert(checkResult, `data must be asc ordered by time, index=${i}, time=${currentTime}, prev time=${prevTime}`);\n\t\tprevTime = currentTime;\n\t}\n}\n\nexport function checkSeriesValuesType<HorzScaleItem>(type: SeriesType, data: readonly SeriesDataItemTypeMap<HorzScaleItem>[SeriesType][]): void {\n\tif (process.env.NODE_ENV === 'production') {\n\t\treturn;\n\t}\n\n\tdata.forEach(getChecker<HorzScaleItem>(type));\n}\n\ntype Checker<HorzScaleItem> = (item: SeriesDataItemTypeMap<HorzScaleItem>[SeriesType]) => void;\n\nexport function getChecker<HorzScaleItem>(type: SeriesType): Checker<HorzScaleItem> {\n\tswitch (type) {\n\t\tcase 'Bar':\n\t\tcase 'Candlestick':\n\t\t\treturn checkBarItem.bind(null, type);\n\n\t\tcase 'Area':\n\t\tcase 'Baseline':\n\t\tcase 'Line':\n\t\tcase 'Histogram':\n\t\t\treturn checkLineItem.bind(null, type);\n\n\t\tcase 'Custom':\n\t\t\treturn checkCustomItem.bind(null, type);\n\t}\n}\n\nfunction checkBarItem<HorzScaleItem>(\n\ttype: 'Bar' | 'Candlestick',\n\tbarItem: SeriesDataItemTypeMap<HorzScaleItem>[typeof type]\n): void {\n\tif (!isFulfilledData(barItem)) {\n\t\treturn;\n\t}\n\n\tassert(\n\t\t// eslint-disable-next-line @typescript-eslint/tslint/config\n\t\ttypeof barItem.open === 'number',\n\t\t`${type} series item data value of open must be a number, got=${typeof barItem.open}, value=${\n\t\t\tbarItem.open\n\t\t}`\n\t);\n\tassert(\n\t\t// eslint-disable-next-line @typescript-eslint/tslint/config\n\t\ttypeof barItem.high === 'number',\n\t\t`${type} series item data value of high must be a number, got=${typeof barItem.high}, value=${\n\t\t\tbarItem.high\n\t\t}`\n\t);\n\tassert(\n\t\t// eslint-disable-next-line @typescript-eslint/tslint/config\n\t\ttypeof barItem.low === 'number',\n\t\t`${type} series item data value of low must be a number, got=${typeof barItem.low}, value=${\n\t\t\tbarItem.low\n\t\t}`\n\t);\n\tassert(\n\t\t// eslint-disable-next-line @typescript-eslint/tslint/config\n\t\ttypeof barItem.close === 'number',\n\t\t`${type} series item data value of close must be a number, got=${typeof barItem.close}, value=${\n\t\t\tbarItem.close\n\t\t}`\n\t);\n}\n\nfunction checkLineItem<HorzScaleItem>(\n\ttype: 'Area' | 'Baseline' | 'Line' | 'Histogram',\n\tlineItem: SeriesDataItemTypeMap<HorzScaleItem>[typeof type]\n): void {\n\tif (!isFulfilledData(lineItem)) {\n\t\treturn;\n\t}\n\n\tassert(\n\t\t// eslint-disable-next-line @typescript-eslint/tslint/config\n\t\ttypeof lineItem.value === 'number',\n\t\t`${type} series item data value must be a number, got=${typeof lineItem.value}, value=${\n\t\t\tlineItem.value\n\t\t}`\n\t);\n}\n\nfunction checkCustomItem(\n\t// type: 'Custom',\n\t// customItem: SeriesDataItemTypeMap[typeof type]\n): void {\n\t// Nothing to check yet...\n\treturn;\n}\n","/**\n * Represents the position of a series marker relative to a bar.\n */\nexport type SeriesMarkerPosition = 'aboveBar' | 'belowBar' | 'inBar';\n\n/**\n * Represents the shape of a series marker.\n */\nexport type SeriesMarkerShape = 'circle' | 'square' | 'arrowUp' | 'arrowDown';\n\n/**\n * Represents a series marker.\n */\nexport interface SeriesMarker<TimeType> {\n\t/**\n\t * The time of the marker.\n\t */\n\ttime: TimeType;\n\t/**\n\t * The position of the marker.\n\t */\n\tposition: SeriesMarkerPosition;\n\t/**\n\t * The shape of the marker.\n\t */\n\tshape: SeriesMarkerShape;\n\t/**\n\t * The color of the marker.\n\t */\n\tcolor: string;\n\t/**\n\t * The ID of the marker.\n\t */\n\tid?: string;\n\t/**\n\t * The optional text of the marker.\n\t */\n\ttext?: string;\n\t/**\n\t * The optional size of the marker.\n\t *\n\t * @defaultValue `1`\n\t */\n\tsize?: number;\n\n\t/**\n\t * @internal\n\t */\n\toriginalTime: unknown;\n}\n\nexport interface InternalSeriesMarker<TimeType> extends SeriesMarker<TimeType> {\n\tinternalId: number;\n}\n\nexport function convertSeriesMarker<InTimeType, OutTimeType>(sm: SeriesMarker<InTimeType>, newTime: OutTimeType, originalTime?: unknown): SeriesMarker<OutTimeType> {\n\tconst { time: inTime, originalTime: inOriginalTime, ...values } = sm;\n\t/* eslint-disable @typescript-eslint/consistent-type-assertions */\n\tconst res = {\n\t\ttime: newTime,\n\t\t...values,\n\t} as SeriesMarker<OutTimeType>;\n\t/* eslint-enable @typescript-eslint/consistent-type-assertions */\n\tif (originalTime !== undefined) {\n\t\tres.originalTime = originalTime;\n\t}\n\treturn res;\n}\n","import { PriceLineOptions } from '../../model/price-line-options';\nimport { LineStyle } from '../../renderers/draw-line';\n\nexport const priceLineOptionsDefaults: PriceLineOptions = {\n\tcolor: '#FF0000',\n\tprice: 0,\n\tlineStyle: LineStyle.Dashed,\n\tlineWidth: 1,\n\tlineVisible: true,\n\taxisLabelVisible: true,\n\ttitle: '',\n\taxisLabelColor: '',\n\taxisLabelTextColor: '',\n};\n","import { CustomPriceLine } from '../model/custom-price-line';\nimport { PriceLineOptions } from '../model/price-line-options';\n\nimport { IPriceLine } from './iprice-line';\n\nexport class PriceLine implements IPriceLine {\n\tprivate readonly _priceLine: CustomPriceLine;\n\n\tpublic constructor(priceLine: CustomPriceLine) {\n\t\tthis._priceLine = priceLine;\n\t}\n\n\tpublic applyOptions(options: Partial<PriceLineOptions>): void {\n\t\tthis._priceLine.applyOptions(options);\n\t}\n\tpublic options(): Readonly<PriceLineOptions> {\n\t\treturn this._priceLine.options();\n\t}\n\n\tpublic priceLine(): CustomPriceLine {\n\t\treturn this._priceLine;\n\t}\n}\n","import { IPriceFormatter } from '../formatters/iprice-formatter';\n\nimport { ensureNotNull } from '../helpers/assertions';\nimport { Delegate } from '../helpers/delegate';\nimport { IDestroyable } from '../helpers/idestroyable';\nimport { clone, merge } from '../helpers/strict-type-checks';\n\nimport { BarPrice } from '../model/bar';\nimport { Coordinate } from '../model/coordinate';\nimport { DataUpdatesConsumer, SeriesDataItemTypeMap, WhitespaceData } from '../model/data-consumer';\nimport { checkItemsAreOrdered, checkPriceLineOptions, checkSeriesValuesType } from '../model/data-validators';\nimport { IHorzScaleBehavior, InternalHorzScaleItem } from '../model/ihorz-scale-behavior';\nimport { ISeriesPrimitiveBase } from '../model/iseries-primitive';\nimport { MismatchDirection } from '../model/plot-list';\nimport { CreatePriceLineOptions, PriceLineOptions } from '../model/price-line-options';\nimport { RangeImpl } from '../model/range-impl';\nimport { Series } from '../model/series';\nimport { SeriesPlotRow } from '../model/series-data';\nimport { convertSeriesMarker, SeriesMarker } from '../model/series-markers';\nimport {\n\tSeriesOptionsMap,\n\tSeriesPartialOptionsMap,\n\tSeriesType,\n} from '../model/series-options';\nimport { Logical, Range, TimePointIndex } from '../model/time-data';\nimport { TimeScaleVisibleRange } from '../model/time-scale-visible-range';\n\nimport { IPriceScaleApiProvider } from './chart-api';\nimport { getSeriesDataCreator } from './get-series-data-creator';\nimport { type IChartApiBase } from './ichart-api';\nimport { IPriceLine } from './iprice-line';\nimport { IPriceScaleApi } from './iprice-scale-api';\nimport { BarsInfo, DataChangedHandler, DataChangedScope, ISeriesApi } from './iseries-api';\nimport { ISeriesPrimitive } from './iseries-primitive-api';\nimport { priceLineOptionsDefaults } from './options/price-line-options-defaults';\nimport { PriceLine } from './price-line-api';\n\nexport class SeriesApi<\n\tTSeriesType extends SeriesType,\n\tHorzScaleItem,\n\tTData extends WhitespaceData<HorzScaleItem> = SeriesDataItemTypeMap<HorzScaleItem>[TSeriesType],\n\tTOptions extends SeriesOptionsMap[TSeriesType] = SeriesOptionsMap[TSeriesType],\n\tTPartialOptions extends SeriesPartialOptionsMap[TSeriesType] = SeriesPartialOptionsMap[TSeriesType]\n> implements\n\t\tISeriesApi<TSeriesType, HorzScaleItem, TData, TOptions, TPartialOptions>,\n\t\tIDestroyable {\n\tprotected _series: Series<TSeriesType>;\n\tprotected _dataUpdatesConsumer: DataUpdatesConsumer<TSeriesType, HorzScaleItem>;\n\tprotected readonly _chartApi: IChartApiBase<HorzScaleItem>;\n\n\tprivate readonly _priceScaleApiProvider: IPriceScaleApiProvider<HorzScaleItem>;\n\tprivate readonly _horzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>;\n\tprivate readonly _dataChangedDelegate: Delegate<DataChangedScope> = new Delegate();\n\n\tpublic constructor(\n\t\tseries: Series<TSeriesType>,\n\t\tdataUpdatesConsumer: DataUpdatesConsumer<TSeriesType, HorzScaleItem>,\n\t\tpriceScaleApiProvider: IPriceScaleApiProvider<HorzScaleItem>,\n\t\tchartApi: IChartApiBase<HorzScaleItem>,\n\t\thorzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>\n\t) {\n\t\tthis._series = series;\n\t\tthis._dataUpdatesConsumer = dataUpdatesConsumer;\n\t\tthis._priceScaleApiProvider = priceScaleApiProvider;\n\t\tthis._horzScaleBehavior = horzScaleBehavior;\n\t\tthis._chartApi = chartApi;\n\t}\n\n\tpublic destroy(): void {\n\t\tthis._dataChangedDelegate.destroy();\n\t}\n\n\tpublic priceFormatter(): IPriceFormatter {\n\t\treturn this._series.formatter();\n\t}\n\n\tpublic priceToCoordinate(price: number): Coordinate | null {\n\t\tconst firstValue = this._series.firstValue();\n\t\tif (firstValue === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this._series.priceScale().priceToCoordinate(price, firstValue.value);\n\t}\n\n\tpublic coordinateToPrice(coordinate: number): BarPrice | null {\n\t\tconst firstValue = this._series.firstValue();\n\t\tif (firstValue === null) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this._series.priceScale().coordinateToPrice(coordinate as Coordinate, firstValue.value);\n\t}\n\n\tpublic barsInLogicalRange(range: Range<number> | null): BarsInfo<HorzScaleItem> | null {\n\t\tif (range === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// we use TimeScaleVisibleRange here to convert LogicalRange to strict range properly\n\t\tconst correctedRange = new TimeScaleVisibleRange(\n\t\t\tnew RangeImpl(range.from as Logical, range.to as Logical)\n\t\t).strictRange() as RangeImpl<TimePointIndex>;\n\n\t\tconst bars = this._series.bars();\n\t\tif (bars.isEmpty()) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst dataFirstBarInRange = bars.search(correctedRange.left(), MismatchDirection.NearestRight);\n\t\tconst dataLastBarInRange = bars.search(correctedRange.right(), MismatchDirection.NearestLeft);\n\n\t\tconst dataFirstIndex = ensureNotNull(bars.firstIndex());\n\t\tconst dataLastIndex = ensureNotNull(bars.lastIndex());\n\n\t\t// this means that we request data in the data gap\n\t\t// e.g. let's say we have series with data [0..10, 30..60]\n\t\t// and we request bars info in range [15, 25]\n\t\t// thus, dataFirstBarInRange will be with index 30 and dataLastBarInRange with 10\n\t\tif (dataFirstBarInRange !== null && dataLastBarInRange !== null && dataFirstBarInRange.index > dataLastBarInRange.index) {\n\t\t\treturn {\n\t\t\t\tbarsBefore: range.from - dataFirstIndex,\n\t\t\t\tbarsAfter: dataLastIndex - range.to,\n\t\t\t};\n\t\t}\n\n\t\tconst barsBefore = (dataFirstBarInRange === null || dataFirstBarInRange.index === dataFirstIndex)\n\t\t\t? range.from - dataFirstIndex\n\t\t\t: dataFirstBarInRange.index - dataFirstIndex;\n\n\t\tconst barsAfter = (dataLastBarInRange === null || dataLastBarInRange.index === dataLastIndex)\n\t\t\t? dataLastIndex - range.to\n\t\t\t: dataLastIndex - dataLastBarInRange.index;\n\n\t\tconst result: BarsInfo<HorzScaleItem> = { barsBefore, barsAfter };\n\n\t\t// actually they can't exist separately\n\t\tif (dataFirstBarInRange !== null && dataLastBarInRange !== null) {\n\t\t\tresult.from = dataFirstBarInRange.originalTime as HorzScaleItem;\n\t\t\tresult.to = dataLastBarInRange.originalTime as HorzScaleItem;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tpublic setData(data: TData[]): void {\n\t\tcheckItemsAreOrdered(data, this._horzScaleBehavior);\n\t\tcheckSeriesValuesType(this._series.seriesType(), data);\n\n\t\tthis._dataUpdatesConsumer.applyNewData(this._series, data);\n\t\tthis._onDataChanged('full');\n\t}\n\n\tpublic update(bar: TData): void {\n\t\tcheckSeriesValuesType(this._series.seriesType(), [bar]);\n\n\t\tthis._dataUpdatesConsumer.updateData(this._series, bar);\n\t\tthis._onDataChanged('update');\n\t}\n\n\tpublic dataByIndex(logicalIndex: number, mismatchDirection?: MismatchDirection): TData | null {\n\t\tconst data = this._series.bars().search(logicalIndex as unknown as TimePointIndex, mismatchDirection);\n\t\tif (data === null) {\n\t\t\t// actually it can be a whitespace\n\t\t\treturn null;\n\t\t}\n\n\t\tconst creator = getSeriesDataCreator<TSeriesType, HorzScaleItem>(this.seriesType());\n\t\treturn creator(data) as TData | null;\n\t}\n\n\tpublic data(): readonly TData[] {\n\t\tconst seriesCreator = getSeriesDataCreator(this.seriesType());\n\t\tconst rows = this._series.bars().rows();\n\t\treturn rows.map((row: SeriesPlotRow<TSeriesType>) => seriesCreator(row) as TData);\n\t}\n\n\tpublic subscribeDataChanged(handler: DataChangedHandler): void {\n\t\tthis._dataChangedDelegate.subscribe(handler);\n\t}\n\n\tpublic unsubscribeDataChanged(handler: DataChangedHandler): void {\n\t\tthis._dataChangedDelegate.unsubscribe(handler);\n\t}\n\n\tpublic setMarkers(data: SeriesMarker<HorzScaleItem>[]): void {\n\t\tcheckItemsAreOrdered(data, this._horzScaleBehavior, true);\n\n\t\tconst convertedMarkers = data.map((marker: SeriesMarker<HorzScaleItem>) =>\n\t\t\tconvertSeriesMarker<HorzScaleItem, InternalHorzScaleItem>(marker, this._horzScaleBehavior.convertHorzItemToInternal(marker.time), marker.time)\n\t\t);\n\t\tthis._series.setMarkers(convertedMarkers);\n\t}\n\n\tpublic markers(): SeriesMarker<HorzScaleItem>[] {\n\t\treturn this._series.markers().map<SeriesMarker<HorzScaleItem>>((internalItem: SeriesMarker<InternalHorzScaleItem>) => {\n\t\t\treturn convertSeriesMarker<InternalHorzScaleItem, HorzScaleItem>(internalItem, internalItem.originalTime as HorzScaleItem, undefined);\n\t\t});\n\t}\n\n\tpublic applyOptions(options: TPartialOptions): void {\n\t\tthis._series.applyOptions(options);\n\t}\n\n\tpublic options(): Readonly<TOptions> {\n\t\treturn clone(this._series.options() as TOptions);\n\t}\n\n\tpublic priceScale(): IPriceScaleApi {\n\t\treturn this._priceScaleApiProvider.priceScale(this._series.priceScale().id());\n\t}\n\n\tpublic createPriceLine(options: CreatePriceLineOptions): IPriceLine {\n\t\tcheckPriceLineOptions(options);\n\n\t\tconst strictOptions = merge(clone(priceLineOptionsDefaults), options) as PriceLineOptions;\n\t\tconst priceLine = this._series.createPriceLine(strictOptions);\n\t\treturn new PriceLine(priceLine);\n\t}\n\n\tpublic removePriceLine(line: IPriceLine): void {\n\t\tthis._series.removePriceLine((line as PriceLine).priceLine());\n\t}\n\n\tpublic seriesType(): TSeriesType {\n\t\treturn this._series.seriesType();\n\t}\n\n\tpublic attachPrimitive(primitive: ISeriesPrimitive<HorzScaleItem>): void {\n\t\t// at this point we cast the generic to unknown because we\n\t\t// don't want the model to know the types of the API (_)\n\t\tthis._series.attachPrimitive(primitive as ISeriesPrimitiveBase<unknown>);\n\t\tif (primitive.attached) {\n\t\t\tprimitive.attached({\n\t\t\t\tchart: this._chartApi,\n\t\t\t\tseries: this,\n\t\t\t\trequestUpdate: () => this._series.model().fullUpdate(),\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic detachPrimitive(primitive: ISeriesPrimitive<HorzScaleItem>): void {\n\t\tthis._series.detachPrimitive(primitive as ISeriesPrimitiveBase<unknown>);\n\t\tif (primitive.detached) {\n\t\t\tprimitive.detached();\n\t\t}\n\t}\n\n\tprivate _onDataChanged(scope: DataChangedScope): void {\n\t\tif (this._dataChangedDelegate.hasListeners()) {\n\t\t\tthis._dataChangedDelegate.fire(scope);\n\t\t}\n\t}\n}\n","import { Size } from 'fancy-canvas';\n\nimport { TimeAxisWidget } from '../gui/time-axis-widget';\n\nimport { assert } from '../helpers/assertions';\nimport { Delegate } from '../helpers/delegate';\nimport { IDestroyable } from '../helpers/idestroyable';\nimport { clone, DeepPartial } from '../helpers/strict-type-checks';\n\nimport { ChartModel } from '../model/chart-model';\nimport { Coordinate } from '../model/coordinate';\nimport { IHorzScaleBehavior, InternalHorzScaleItem } from '../model/ihorz-scale-behavior';\nimport { Logical, LogicalRange, Range, TimePointIndex } from '../model/time-data';\nimport { HorzScaleOptions, TimeScale } from '../model/time-scale';\n\nimport {\n\tITimeScaleApi,\n\tLogicalRangeChangeEventHandler,\n\tSizeChangeEventHandler,\n\tTimeRangeChangeEventHandler,\n} from './itime-scale-api';\nconst enum Constants {\n\tAnimationDurationMs = 1000,\n}\n\nexport class TimeScaleApi<HorzScaleItem> implements ITimeScaleApi<HorzScaleItem>, IDestroyable {\n\tprivate _model: ChartModel<HorzScaleItem>;\n\tprivate _timeScale: TimeScale<HorzScaleItem>;\n\tprivate readonly _timeAxisWidget: TimeAxisWidget<HorzScaleItem>;\n\tprivate readonly _timeRangeChanged: Delegate<Range<HorzScaleItem> | null> = new Delegate();\n\tprivate readonly _logicalRangeChanged: Delegate<LogicalRange | null> = new Delegate();\n\tprivate readonly _sizeChanged: Delegate<number, number> = new Delegate();\n\n\tprivate readonly _horzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>;\n\n\tpublic constructor(model: ChartModel<HorzScaleItem>, timeAxisWidget: TimeAxisWidget<HorzScaleItem>, horzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>) {\n\t\tthis._model = model;\n\t\tthis._timeScale = model.timeScale();\n\t\tthis._timeAxisWidget = timeAxisWidget;\n\t\tthis._timeScale.visibleBarsChanged().subscribe(this._onVisibleBarsChanged.bind(this));\n\t\tthis._timeScale.logicalRangeChanged().subscribe(this._onVisibleLogicalRangeChanged.bind(this));\n\t\tthis._timeAxisWidget.sizeChanged().subscribe(this._onSizeChanged.bind(this));\n\n\t\tthis._horzScaleBehavior = horzScaleBehavior;\n\t}\n\n\tpublic destroy(): void {\n\t\tthis._timeScale.visibleBarsChanged().unsubscribeAll(this);\n\t\tthis._timeScale.logicalRangeChanged().unsubscribeAll(this);\n\t\tthis._timeAxisWidget.sizeChanged().unsubscribeAll(this);\n\t\tthis._timeRangeChanged.destroy();\n\t\tthis._logicalRangeChanged.destroy();\n\t\tthis._sizeChanged.destroy();\n\t}\n\n\tpublic scrollPosition(): number {\n\t\treturn this._timeScale.rightOffset();\n\t}\n\n\tpublic scrollToPosition(position: number, animated: boolean): void {\n\t\tif (!animated) {\n\t\t\tthis._model.setRightOffset(position);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._timeScale.scrollToOffsetAnimated(position, Constants.AnimationDurationMs);\n\t}\n\n\tpublic scrollToRealTime(): void {\n\t\tthis._timeScale.scrollToRealTime();\n\t}\n\n\tpublic getVisibleRange(): Range<HorzScaleItem> | null {\n\t\tconst timeRange = this._timeScale.visibleTimeRange();\n\n\t\tif (timeRange === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tfrom: timeRange.from.originalTime as HorzScaleItem,\n\t\t\tto: timeRange.to.originalTime as HorzScaleItem,\n\t\t};\n\t}\n\n\tpublic setVisibleRange(range: Range<HorzScaleItem>): void {\n\t\tconst convertedRange: Range<InternalHorzScaleItem> = {\n\t\t\tfrom: this._horzScaleBehavior.convertHorzItemToInternal(range.from),\n\t\t\tto: this._horzScaleBehavior.convertHorzItemToInternal(range.to),\n\t\t};\n\t\tconst logicalRange = this._timeScale.logicalRangeForTimeRange(convertedRange);\n\n\t\tthis._model.setTargetLogicalRange(logicalRange);\n\t}\n\n\tpublic getVisibleLogicalRange(): LogicalRange | null {\n\t\tconst logicalRange = this._timeScale.visibleLogicalRange();\n\t\tif (logicalRange === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tfrom: logicalRange.left(),\n\t\t\tto: logicalRange.right(),\n\t\t};\n\t}\n\n\tpublic setVisibleLogicalRange(range: Range<number>): void {\n\t\tassert(range.from <= range.to, 'The from index cannot be after the to index.');\n\t\tthis._model.setTargetLogicalRange(range as LogicalRange);\n\t}\n\n\tpublic resetTimeScale(): void {\n\t\tthis._model.resetTimeScale();\n\t}\n\n\tpublic fitContent(): void {\n\t\tthis._model.fitContent();\n\t}\n\n\tpublic logicalToCoordinate(logical: Logical): Coordinate | null {\n\t\tconst timeScale = this._model.timeScale();\n\n\t\tif (timeScale.isEmpty()) {\n\t\t\treturn null;\n\t\t} else {\n\t\t\treturn timeScale.indexToCoordinate(logical as unknown as TimePointIndex);\n\t\t}\n\t}\n\n\tpublic coordinateToLogical(x: number): Logical | null {\n\t\tif (this._timeScale.isEmpty()) {\n\t\t\treturn null;\n\t\t} else {\n\t\t\treturn this._timeScale.coordinateToIndex(x as Coordinate) as unknown as Logical;\n\t\t}\n\t}\n\n\tpublic timeToCoordinate(time: HorzScaleItem): Coordinate | null {\n\t\tconst timePoint = this._horzScaleBehavior.convertHorzItemToInternal(time);\n\t\tconst timePointIndex = this._timeScale.timeToIndex(timePoint, false);\n\t\tif (timePointIndex === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this._timeScale.indexToCoordinate(timePointIndex);\n\t}\n\n\tpublic coordinateToTime(x: number): HorzScaleItem | null {\n\t\tconst timeScale = this._model.timeScale();\n\t\tconst timePointIndex = timeScale.coordinateToIndex(x as Coordinate);\n\t\tconst timePoint = timeScale.indexToTimeScalePoint(timePointIndex);\n\t\tif (timePoint === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn timePoint.originalTime as HorzScaleItem;\n\t}\n\n\tpublic width(): number {\n\t\treturn this._timeAxisWidget.getSize().width;\n\t}\n\n\tpublic height(): number {\n\t\treturn this._timeAxisWidget.getSize().height;\n\t}\n\n\tpublic subscribeVisibleTimeRangeChange(handler: TimeRangeChangeEventHandler<HorzScaleItem>): void {\n\t\tthis._timeRangeChanged.subscribe(handler);\n\t}\n\n\tpublic unsubscribeVisibleTimeRangeChange(handler: TimeRangeChangeEventHandler<HorzScaleItem>): void {\n\t\tthis._timeRangeChanged.unsubscribe(handler);\n\t}\n\n\tpublic subscribeVisibleLogicalRangeChange(handler: LogicalRangeChangeEventHandler): void {\n\t\tthis._logicalRangeChanged.subscribe(handler);\n\t}\n\n\tpublic unsubscribeVisibleLogicalRangeChange(handler: LogicalRangeChangeEventHandler): void {\n\t\tthis._logicalRangeChanged.unsubscribe(handler);\n\t}\n\n\tpublic subscribeSizeChange(handler: SizeChangeEventHandler): void {\n\t\tthis._sizeChanged.subscribe(handler);\n\t}\n\n\tpublic unsubscribeSizeChange(handler: SizeChangeEventHandler): void {\n\t\tthis._sizeChanged.unsubscribe(handler);\n\t}\n\n\tpublic applyOptions(options: DeepPartial<HorzScaleOptions>): void {\n\t\tthis._timeScale.applyOptions(options);\n\t}\n\n\tpublic options(): Readonly<HorzScaleOptions> {\n\t\treturn {\n\t\t\t...clone(this._timeScale.options()),\n\t\t\tbarSpacing: this._timeScale.barSpacing(),\n\t\t};\n\t}\n\n\tprivate _onVisibleBarsChanged(): void {\n\t\tif (this._timeRangeChanged.hasListeners()) {\n\t\t\tthis._timeRangeChanged.fire(this.getVisibleRange());\n\t\t}\n\t}\n\n\tprivate _onVisibleLogicalRangeChanged(): void {\n\t\tif (this._logicalRangeChanged.hasListeners()) {\n\t\t\tthis._logicalRangeChanged.fire(this.getVisibleLogicalRange());\n\t\t}\n\t}\n\n\tprivate _onSizeChanged(size: Size): void {\n\t\tthis._sizeChanged.fire(size.width, size.height);\n\t}\n}\n","import { ChartWidget, MouseEventParamsImpl, MouseEventParamsImplSupplier } from '../gui/chart-widget';\n\nimport { assert, ensure, ensureDefined } from '../helpers/assertions';\nimport { Delegate } from '../helpers/delegate';\nimport { warn } from '../helpers/logger';\nimport { clone, DeepPartial, isBoolean, merge } from '../helpers/strict-type-checks';\n\nimport { ChartOptionsImpl, ChartOptionsInternal } from '../model/chart-model';\nimport { DataUpdatesConsumer, isFulfilledData, SeriesDataItemTypeMap, WhitespaceData } from '../model/data-consumer';\nimport { DataLayer, DataUpdateResponse, SeriesChanges } from '../model/data-layer';\nimport { CustomData, ICustomSeriesPaneView } from '../model/icustom-series';\nimport { IHorzScaleBehavior } from '../model/ihorz-scale-behavior';\nimport { Series } from '../model/series';\nimport { SeriesPlotRow } from '../model/series-data';\nimport {\n\tAreaSeriesPartialOptions,\n\tBarSeriesPartialOptions,\n\tBaselineSeriesPartialOptions,\n\tCandlestickSeriesPartialOptions,\n\tCustomSeriesOptions,\n\tCustomSeriesPartialOptions,\n\tfillUpDownCandlesticksColors,\n\tHistogramSeriesPartialOptions,\n\tLineSeriesPartialOptions,\n\tprecisionByMinMove,\n\tPriceFormat,\n\tPriceFormatBuiltIn,\n\tSeriesOptionsMap,\n\tSeriesPartialOptions,\n\tSeriesPartialOptionsMap,\n\tSeriesStyleOptionsMap,\n\tSeriesType,\n} from '../model/series-options';\nimport { Logical } from '../model/time-data';\n\nimport { getSeriesDataCreator } from './get-series-data-creator';\nimport { IChartApiBase, MouseEventHandler, MouseEventParams, PaneSize } from './ichart-api';\nimport { IPriceScaleApi } from './iprice-scale-api';\nimport { ISeriesApi } from './iseries-api';\nimport { ITimeScaleApi } from './itime-scale-api';\nimport { chartOptionsDefaults } from './options/chart-options-defaults';\nimport {\n\tareaStyleDefaults,\n\tbarStyleDefaults,\n\tbaselineStyleDefaults,\n\tcandlestickStyleDefaults,\n\tcustomStyleDefaults,\n\thistogramStyleDefaults,\n\tlineStyleDefaults,\n\tseriesOptionsDefaults,\n} from './options/series-options-defaults';\nimport { PriceScaleApi } from './price-scale-api';\nimport { SeriesApi } from './series-api';\nimport { TimeScaleApi } from './time-scale-api';\n\nfunction patchPriceFormat(priceFormat?: DeepPartial<PriceFormat>): void {\n\tif (priceFormat === undefined || priceFormat.type === 'custom') {\n\t\treturn;\n\t}\n\tconst priceFormatBuiltIn = priceFormat as DeepPartial<PriceFormatBuiltIn>;\n\tif (priceFormatBuiltIn.minMove !== undefined && priceFormatBuiltIn.precision === undefined) {\n\t\tpriceFormatBuiltIn.precision = precisionByMinMove(priceFormatBuiltIn.minMove);\n\t}\n}\n\nfunction migrateHandleScaleScrollOptions<HorzScaleItem>(options: DeepPartial<ChartOptionsImpl<HorzScaleItem>>): void {\n\tif (isBoolean(options.handleScale)) {\n\t\tconst handleScale = options.handleScale;\n\t\toptions.handleScale = {\n\t\t\taxisDoubleClickReset: {\n\t\t\t\ttime: handleScale,\n\t\t\t\tprice: handleScale,\n\t\t\t},\n\t\t\taxisPressedMouseMove: {\n\t\t\t\ttime: handleScale,\n\t\t\t\tprice: handleScale,\n\t\t\t},\n\t\t\tmouseWheel: handleScale,\n\t\t\tpinch: handleScale,\n\t\t};\n\t} else if (options.handleScale !== undefined) {\n\t\tconst { axisPressedMouseMove, axisDoubleClickReset } = options.handleScale;\n\t\tif (isBoolean(axisPressedMouseMove)) {\n\t\t\toptions.handleScale.axisPressedMouseMove = {\n\t\t\t\ttime: axisPressedMouseMove,\n\t\t\t\tprice: axisPressedMouseMove,\n\t\t\t};\n\t\t}\n\t\tif (isBoolean(axisDoubleClickReset)) {\n\t\t\toptions.handleScale.axisDoubleClickReset = {\n\t\t\t\ttime: axisDoubleClickReset,\n\t\t\t\tprice: axisDoubleClickReset,\n\t\t\t};\n\t\t}\n\t}\n\n\tconst handleScroll = options.handleScroll;\n\tif (isBoolean(handleScroll)) {\n\t\toptions.handleScroll = {\n\t\t\thorzTouchDrag: handleScroll,\n\t\t\tvertTouchDrag: handleScroll,\n\t\t\tmouseWheel: handleScroll,\n\t\t\tpressedMouseMove: handleScroll,\n\t\t};\n\t}\n}\n\nfunction toInternalOptions<HorzScaleItem>(options: DeepPartial<ChartOptionsImpl<HorzScaleItem>>): DeepPartial<ChartOptionsInternal<HorzScaleItem>> {\n\tmigrateHandleScaleScrollOptions(options);\n\n\treturn options as DeepPartial<ChartOptionsInternal<HorzScaleItem>>;\n}\n\nexport type IPriceScaleApiProvider<HorzScaleItem> = Pick<IChartApiBase<HorzScaleItem>, 'priceScale'>;\n\nexport class ChartApi<HorzScaleItem> implements IChartApiBase<HorzScaleItem>, DataUpdatesConsumer<SeriesType, HorzScaleItem> {\n\tprivate _chartWidget: ChartWidget<HorzScaleItem>;\n\tprivate _dataLayer: DataLayer<HorzScaleItem>;\n\tprivate readonly _seriesMap: Map<SeriesApi<SeriesType, HorzScaleItem>, Series<SeriesType>> = new Map();\n\tprivate readonly _seriesMapReversed: Map<Series<SeriesType>, SeriesApi<SeriesType, HorzScaleItem>> = new Map();\n\n\tprivate readonly _clickedDelegate: Delegate<MouseEventParams<HorzScaleItem>> = new Delegate();\n\tprivate readonly _dblClickedDelegate: Delegate<MouseEventParams<HorzScaleItem>> = new Delegate();\n\tprivate readonly _crosshairMovedDelegate: Delegate<MouseEventParams<HorzScaleItem>> = new Delegate();\n\n\tprivate readonly _timeScaleApi: TimeScaleApi<HorzScaleItem>;\n\n\tprivate readonly _horzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>;\n\n\tpublic constructor(container: HTMLElement, horzScaleBehavior: IHorzScaleBehavior<HorzScaleItem>, options?: DeepPartial<ChartOptionsImpl<HorzScaleItem>>) {\n\t\tthis._dataLayer = new DataLayer<HorzScaleItem>(horzScaleBehavior);\n\t\tconst internalOptions = (options === undefined) ?\n\t\t\tclone(chartOptionsDefaults<HorzScaleItem>()) :\n\t\t\tmerge(clone(chartOptionsDefaults()), toInternalOptions(options)) as ChartOptionsInternal<HorzScaleItem>;\n\n\t\tthis._horzScaleBehavior = horzScaleBehavior;\n\t\tthis._chartWidget = new ChartWidget(container, internalOptions, horzScaleBehavior);\n\n\t\tthis._chartWidget.clicked().subscribe(\n\t\t\t(paramSupplier: MouseEventParamsImplSupplier) => {\n\t\t\t\tif (this._clickedDelegate.hasListeners()) {\n\t\t\t\t\tthis._clickedDelegate.fire(this._convertMouseParams(paramSupplier()));\n\t\t\t\t}\n\t\t\t},\n\t\t\tthis\n\t\t);\n\t\tthis._chartWidget.dblClicked().subscribe(\n\t\t\t(paramSupplier: MouseEventParamsImplSupplier) => {\n\t\t\t\tif (this._dblClickedDelegate.hasListeners()) {\n\t\t\t\t\tthis._dblClickedDelegate.fire(this._convertMouseParams(paramSupplier()));\n\t\t\t\t}\n\t\t\t},\n\t\t\tthis\n\t\t);\n\t\tthis._chartWidget.crosshairMoved().subscribe(\n\t\t\t(paramSupplier: MouseEventParamsImplSupplier) => {\n\t\t\t\tif (this._crosshairMovedDelegate.hasListeners()) {\n\t\t\t\t\tthis._crosshairMovedDelegate.fire(this._convertMouseParams(paramSupplier()));\n\t\t\t\t}\n\t\t\t},\n\t\t\tthis\n\t\t);\n\n\t\tconst model = this._chartWidget.model();\n\t\tthis._timeScaleApi = new TimeScaleApi(model, this._chartWidget.timeAxisWidget(), this._horzScaleBehavior);\n\t}\n\n\tpublic remove(): void {\n\t\tthis._chartWidget.clicked().unsubscribeAll(this);\n\t\tthis._chartWidget.dblClicked().unsubscribeAll(this);\n\t\tthis._chartWidget.crosshairMoved().unsubscribeAll(this);\n\n\t\tthis._timeScaleApi.destroy();\n\t\tthis._chartWidget.destroy();\n\n\t\tthis._seriesMap.clear();\n\t\tthis._seriesMapReversed.clear();\n\n\t\tthis._clickedDelegate.destroy();\n\t\tthis._dblClickedDelegate.destroy();\n\t\tthis._crosshairMovedDelegate.destroy();\n\t\tthis._dataLayer.destroy();\n\t}\n\n\tpublic resize(width: number, height: number, forceRepaint?: boolean): void {\n\t\tif (this.autoSizeActive()) {\n\t\t\t// We return early here instead of checking this within the actual _chartWidget.resize method\n\t\t\t// because this should only apply to external resize requests.\n\t\t\twarn(`Height and width values ignored because 'autoSize' option is enabled.`);\n\t\t\treturn;\n\t\t}\n\t\tthis._chartWidget.resize(width, height, forceRepaint);\n\t}\n\n\tpublic addCustomSeries<\n\t\tTData extends CustomData<HorzScaleItem>,\n\t\tTOptions extends CustomSeriesOptions,\n\t\tTPartialOptions extends CustomSeriesPartialOptions = SeriesPartialOptions<TOptions>\n\t>(\n\t\tcustomPaneView: ICustomSeriesPaneView<HorzScaleItem, TData, TOptions>,\n\t\toptions?: SeriesPartialOptions<TOptions>\n\t): ISeriesApi<'Custom', HorzScaleItem, TData, TOptions, TPartialOptions> {\n\t\tconst paneView = ensure(customPaneView);\n\t\tconst defaults = {\n\t\t\t...customStyleDefaults,\n\t\t\t...paneView.defaultOptions(),\n\t\t};\n\t\treturn this._addSeriesImpl<'Custom', TData, TOptions, TPartialOptions>(\n\t\t\t'Custom',\n\t\t\tdefaults,\n\t\t\toptions,\n\t\t\tpaneView\n\t\t);\n\t}\n\n\tpublic addAreaSeries(options?: AreaSeriesPartialOptions): ISeriesApi<'Area', HorzScaleItem> {\n\t\treturn this._addSeriesImpl('Area', areaStyleDefaults, options);\n\t}\n\n\tpublic addBaselineSeries(options?: BaselineSeriesPartialOptions): ISeriesApi<'Baseline', HorzScaleItem> {\n\t\treturn this._addSeriesImpl('Baseline', baselineStyleDefaults, options);\n\t}\n\n\tpublic addBarSeries(options?: BarSeriesPartialOptions): ISeriesApi<'Bar', HorzScaleItem> {\n\t\treturn this._addSeriesImpl('Bar', barStyleDefaults, options);\n\t}\n\n\tpublic addCandlestickSeries(options: CandlestickSeriesPartialOptions = {}): ISeriesApi<'Candlestick', HorzScaleItem> {\n\t\tfillUpDownCandlesticksColors(options);\n\n\t\treturn this._addSeriesImpl('Candlestick', candlestickStyleDefaults, options);\n\t}\n\n\tpublic addHistogramSeries(options?: HistogramSeriesPartialOptions): ISeriesApi<'Histogram', HorzScaleItem> {\n\t\treturn this._addSeriesImpl('Histogram', histogramStyleDefaults, options);\n\t}\n\n\tpublic addLineSeries(options?: LineSeriesPartialOptions): ISeriesApi<'Line', HorzScaleItem> {\n\t\treturn this._addSeriesImpl('Line', lineStyleDefaults, options);\n\t}\n\n\tpublic removeSeries(seriesApi: SeriesApi<SeriesType, HorzScaleItem>): void {\n\t\tconst series = ensureDefined(this._seriesMap.get(seriesApi));\n\n\t\tconst update = this._dataLayer.removeSeries(series);\n\t\tconst model = this._chartWidget.model();\n\t\tmodel.removeSeries(series);\n\n\t\tthis._sendUpdateToChart(update);\n\n\t\tthis._seriesMap.delete(seriesApi);\n\t\tthis._seriesMapReversed.delete(series);\n\t}\n\n\tpublic applyNewData<TSeriesType extends SeriesType>(series: Series<TSeriesType>, data: SeriesDataItemTypeMap<HorzScaleItem>[TSeriesType][]): void {\n\t\tthis._sendUpdateToChart(this._dataLayer.setSeriesData(series, data));\n\t}\n\n\tpublic updateData<TSeriesType extends SeriesType>(series: Series<TSeriesType>, data: SeriesDataItemTypeMap<HorzScaleItem>[TSeriesType]): void {\n\t\tthis._sendUpdateToChart(this._dataLayer.updateSeriesData(series, data));\n\t}\n\n\tpublic subscribeClick(handler: MouseEventHandler<HorzScaleItem>): void {\n\t\tthis._clickedDelegate.subscribe(handler);\n\t}\n\n\tpublic unsubscribeClick(handler: MouseEventHandler<HorzScaleItem>): void {\n\t\tthis._clickedDelegate.unsubscribe(handler);\n\t}\n\n\tpublic subscribeCrosshairMove(handler: MouseEventHandler<HorzScaleItem>): void {\n\t\tthis._crosshairMovedDelegate.subscribe(handler);\n\t}\n\n\tpublic unsubscribeCrosshairMove(handler: MouseEventHandler<HorzScaleItem>): void {\n\t\tthis._crosshairMovedDelegate.unsubscribe(handler);\n\t}\n\n\tpublic subscribeDblClick(handler: MouseEventHandler<HorzScaleItem>): void {\n\t\tthis._dblClickedDelegate.subscribe(handler);\n\t}\n\n\tpublic unsubscribeDblClick(handler: MouseEventHandler<HorzScaleItem>): void {\n\t\tthis._dblClickedDelegate.unsubscribe(handler);\n\t}\n\n\tpublic priceScale(priceScaleId: string): IPriceScaleApi {\n\t\treturn new PriceScaleApi(this._chartWidget, priceScaleId);\n\t}\n\n\tpublic timeScale(): ITimeScaleApi<HorzScaleItem> {\n\t\treturn this._timeScaleApi;\n\t}\n\n\tpublic applyOptions(options: DeepPartial<ChartOptionsImpl<HorzScaleItem>>): void {\n\t\tthis._chartWidget.applyOptions(toInternalOptions(options));\n\t}\n\n\tpublic options(): Readonly<ChartOptionsImpl<HorzScaleItem>> {\n\t\treturn this._chartWidget.options() as Readonly<ChartOptionsImpl<HorzScaleItem>>;\n\t}\n\n\tpublic takeScreenshot(): HTMLCanvasElement {\n\t\treturn this._chartWidget.takeScreenshot();\n\t}\n\n\tpublic autoSizeActive(): boolean {\n\t\treturn this._chartWidget.autoSizeActive();\n\t}\n\n\tpublic chartElement(): HTMLDivElement {\n\t\treturn this._chartWidget.element();\n\t}\n\n\tpublic paneSize(): PaneSize {\n\t\tconst size = this._chartWidget.paneSize();\n\t\treturn {\n\t\t\theight: size.height,\n\t\t\twidth: size.width,\n\t\t};\n\t}\n\n\tpublic setCrosshairPosition(price: number, horizontalPosition: HorzScaleItem, seriesApi: ISeriesApi<SeriesType, HorzScaleItem>): void {\n\t\tconst series = this._seriesMap.get(seriesApi as SeriesApi<SeriesType, HorzScaleItem>);\n\n\t\tif (series === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst pane = this._chartWidget.model().paneForSource(series);\n\n\t\tif (pane === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._chartWidget.model().setAndSaveSyntheticPosition(price, horizontalPosition, pane);\n\t}\n\n\tpublic clearCrosshairPosition(): void {\n\t\tthis._chartWidget.model().clearCurrentPosition(true);\n\t}\n\n\tprivate _addSeriesImpl<\n\t\tTSeries extends SeriesType,\n\t\tTData extends WhitespaceData<HorzScaleItem> = SeriesDataItemTypeMap<HorzScaleItem>[TSeries],\n\t\tTOptions extends SeriesOptionsMap[TSeries] = SeriesOptionsMap[TSeries],\n\t\tTPartialOptions extends SeriesPartialOptionsMap[TSeries] = SeriesPartialOptionsMap[TSeries]\n\t>(\n\t\ttype: TSeries,\n\t\tstyleDefaults: SeriesStyleOptionsMap[TSeries],\n\t\toptions: SeriesPartialOptionsMap[TSeries] = {},\n\t\tcustomPaneView?: ICustomSeriesPaneView<HorzScaleItem>\n\t): ISeriesApi<TSeries, HorzScaleItem, TData, TOptions, TPartialOptions> {\n\t\tpatchPriceFormat(options.priceFormat);\n\n\t\tconst strictOptions = merge(clone(seriesOptionsDefaults), clone(styleDefaults), options) as SeriesOptionsMap[TSeries];\n\t\tconst series = this._chartWidget.model().createSeries(type, strictOptions, customPaneView);\n\n\t\tconst res = new SeriesApi<TSeries, HorzScaleItem, TData, TOptions, TPartialOptions>(series, this, this, this, this._horzScaleBehavior);\n\t\tthis._seriesMap.set(res, series);\n\t\tthis._seriesMapReversed.set(series, res);\n\n\t\treturn res;\n\t}\n\n\tprivate _sendUpdateToChart(update: DataUpdateResponse): void {\n\t\tconst model = this._chartWidget.model();\n\n\t\tmodel.updateTimeScale(update.timeScale.baseIndex, update.timeScale.points, update.timeScale.firstChangedPointIndex);\n\t\tupdate.series.forEach((value: SeriesChanges, series: Series<SeriesType>) => series.setData(value.data, value.info));\n\n\t\tmodel.recalculateAllPanes();\n\t}\n\n\tprivate _mapSeriesToApi(series: Series<SeriesType>): ISeriesApi<SeriesType, HorzScaleItem> {\n\t\treturn ensureDefined(this._seriesMapReversed.get(series));\n\t}\n\n\tprivate _convertMouseParams(param: MouseEventParamsImpl): MouseEventParams<HorzScaleItem> {\n\t\tconst seriesData: MouseEventParams<HorzScaleItem>['seriesData'] = new Map();\n\t\tparam.seriesData.forEach((plotRow: SeriesPlotRow<SeriesType>, series: Series<SeriesType>) => {\n\t\t\tconst seriesType = series.seriesType();\n\t\t\tconst data = getSeriesDataCreator<SeriesType, HorzScaleItem>(seriesType)(plotRow);\n\t\t\tif (seriesType !== 'Custom') {\n\t\t\t\tassert(isFulfilledData(data));\n\t\t\t} else {\n\t\t\t\tconst customWhitespaceChecker = series.customSeriesWhitespaceCheck();\n\t\t\t\tassert(!customWhitespaceChecker || customWhitespaceChecker(data) === false);\n\t\t\t}\n\t\t\tseriesData.set(this._mapSeriesToApi(series), data);\n\t\t});\n\n\t\tconst hoveredSeries =\n\t\t\tparam.hoveredSeries === undefined ||\n\t\t\t!this._seriesMapReversed.has(param.hoveredSeries)\n\t\t\t\t? undefined\n\t\t\t\t: this._mapSeriesToApi(param.hoveredSeries);\n\n\t\treturn {\n\t\t\ttime: param.originalTime as HorzScaleItem,\n\t\t\tlogical: param.index as Logical | undefined,\n\t\t\tpoint: param.point,\n\t\t\thoveredSeries,\n\t\t\thoveredObjectId: param.hoveredObject,\n\t\t\tseriesData,\n\t\t\tsourceEvent: param.touchMouseEventData,\n\t\t};\n\t}\n}\n","import { assert } from '../helpers/assertions';\nimport { DeepPartial, isString } from '../helpers/strict-type-checks';\n\nimport { HorzScaleBehaviorTime } from '../model/horz-scale-behavior-time/horz-scale-behavior-time';\nimport { TimeChartOptions } from '../model/horz-scale-behavior-time/time-based-chart-options';\nimport { Time } from '../model/horz-scale-behavior-time/types';\nimport { IHorzScaleBehavior } from '../model/ihorz-scale-behavior';\n\nimport { ChartApi } from './chart-api';\nimport { IChartApiBase } from './ichart-api';\n\n/**\n * This function is the main entry point of the Lightweight Charting Library. If you are using time values\n * for the horizontal scale then it is recommended that you rather use the {@link createChart} function.\n *\n * @template HorzScaleItem - type of points on the horizontal scale\n * @template THorzScaleBehavior - type of horizontal axis strategy that encapsulate all the specific behaviors of the horizontal scale type\n *\n * @param container - ID of HTML element or element itself\n * @param horzScaleBehavior - Horizontal scale behavior\n * @param options - Any subset of options to be applied at start.\n * @returns An interface to the created chart\n */\nexport function createChartEx<HorzScaleItem, THorzScaleBehavior extends IHorzScaleBehavior<HorzScaleItem>>(\n\tcontainer: string | HTMLElement,\n\thorzScaleBehavior: THorzScaleBehavior,\n\toptions?: DeepPartial<ReturnType<THorzScaleBehavior['options']>>\n): IChartApiBase<HorzScaleItem> {\n\tlet htmlElement: HTMLElement;\n\tif (isString(container)) {\n\t\tconst element = document.getElementById(container);\n\t\tassert(element !== null, `Cannot find element in DOM with id=${container}`);\n\t\thtmlElement = element;\n\t} else {\n\t\thtmlElement = container;\n\t}\n\n\tconst res = new ChartApi<HorzScaleItem>(htmlElement, horzScaleBehavior, options);\n\thorzScaleBehavior.setOptions(res.options());\n\treturn res;\n}\n\n/**\n * Structure describing options of the chart with time points at the horizontal scale. Series options are to be set separately\n */\nexport type ChartOptions = TimeChartOptions;\n\n/**\n * The main interface of a single chart using time for horizontal scale.\n */\nexport interface IChartApi extends IChartApiBase<Time> {\n\t/**\n\t * Applies new options to the chart\n\t *\n\t * @param options - Any subset of options.\n\t */\n\tapplyOptions(options: DeepPartial<ChartOptions>): void;\n}\n\n/**\n * This function is the simplified main entry point of the Lightweight Charting Library with time points for the horizontal scale.\n *\n * @param container - ID of HTML element or element itself\n * @param options - Any subset of options to be applied at start.\n * @returns An interface to the created chart\n */\nexport function createChart(container: string | HTMLElement, options?: DeepPartial<ChartOptions>): IChartApi {\n\treturn createChartEx<Time, HorzScaleBehaviorTime>(\n\t\tcontainer,\n\t\tnew HorzScaleBehaviorTime(),\n\t\tHorzScaleBehaviorTime.applyDefaults(options)\n\t);\n}\n","/// <reference types=\"_build-time-constants\" />\n\nimport { customStyleDefaults, seriesOptionsDefaults } from './api/options/series-options-defaults';\nimport { CustomSeriesOptions } from './model/series-options';\n\nexport { LineStyle, LineType } from './renderers/draw-line';\n\nexport { TrackingModeExitMode } from './model/chart-model';\nexport { CrosshairMode } from './model/crosshair';\nexport { MismatchDirection } from './model/plot-list';\nexport { PriceScaleMode } from './model/price-scale';\nexport { PriceLineSource, LastPriceAnimationMode } from './model/series-options';\nexport { ColorType } from './model/layout-options';\n\nexport { isBusinessDay, isUTCTimestamp } from './model/horz-scale-behavior-time/types';\nexport { TickMarkType } from './model/horz-scale-behavior-time/types';\nexport const customSeriesDefaultOptions: CustomSeriesOptions = {\n\t...seriesOptionsDefaults,\n\t...customStyleDefaults,\n};\n\nexport { createChart, createChartEx } from './api/create-chart';\n\n/**\n * Returns the current version as a string. For example `'3.3.0'`.\n */\nexport function version(): string {\n\treturn process.env.BUILD_VERSION;\n}\n"],"names":["radius","finishStyledArea","Constants","shapeMargin","calculateShapeMargin","numToStr","size","CursorType","sourceBottomPaneViews","sourcePaneViews","sourceTopPaneViews"],"mappings":"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"}