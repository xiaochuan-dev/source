{"version":3,"file":"utc.js","sources":["../src/constant.js","../src/plugin/utc/index.js"],"sourcesContent":["export const SECONDS_A_MINUTE = 60\nexport const SECONDS_A_HOUR = SECONDS_A_MINUTE * 60\nexport const SECONDS_A_DAY = SECONDS_A_HOUR * 24\nexport const SECONDS_A_WEEK = SECONDS_A_DAY * 7\n\nexport const MILLISECONDS_A_SECOND = 1e3\nexport const MILLISECONDS_A_MINUTE = SECONDS_A_MINUTE * MILLISECONDS_A_SECOND\nexport const MILLISECONDS_A_HOUR = SECONDS_A_HOUR * MILLISECONDS_A_SECOND\nexport const MILLISECONDS_A_DAY = SECONDS_A_DAY * MILLISECONDS_A_SECOND\nexport const MILLISECONDS_A_WEEK = SECONDS_A_WEEK * MILLISECONDS_A_SECOND\n\n// English locales\nexport const MS = 'millisecond'\nexport const S = 'second'\nexport const MIN = 'minute'\nexport const H = 'hour'\nexport const D = 'day'\nexport const W = 'week'\nexport const M = 'month'\nexport const Q = 'quarter'\nexport const Y = 'year'\nexport const DATE = 'date'\n\nexport const FORMAT_DEFAULT = 'YYYY-MM-DDTHH:mm:ssZ'\n\nexport const INVALID_DATE_STRING = 'Invalid Date'\n\n// regex\nexport const REGEX_PARSE = /^(\\d{4})[-/]?(\\d{1,2})?[-/]?(\\d{0,2})[Tt\\s]*(\\d{1,2})?:?(\\d{1,2})?:?(\\d{1,2})?[.:]?(\\d+)?$/\nexport const REGEX_FORMAT = /\\[([^\\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g\n","import { MILLISECONDS_A_MINUTE, MIN } from '../../constant'\n\nconst REGEX_VALID_OFFSET_FORMAT = /[+-]\\d\\d(?::?\\d\\d)?/g\nconst REGEX_OFFSET_HOURS_MINUTES_FORMAT = /([+-]|\\d\\d)/g\n\nfunction offsetFromString(value = '') {\n  const offset = value.match(REGEX_VALID_OFFSET_FORMAT)\n\n  if (!offset) {\n    return null\n  }\n\n  const [indicator, hoursOffset, minutesOffset] = `${offset[0]}`.match(REGEX_OFFSET_HOURS_MINUTES_FORMAT) || ['-', 0, 0]\n  const totalOffsetInMinutes = (+hoursOffset * 60) + (+minutesOffset)\n\n  if (totalOffsetInMinutes === 0) {\n    return 0\n  }\n\n  return indicator === '+' ? totalOffsetInMinutes : -totalOffsetInMinutes\n}\n\n\nexport default (option, Dayjs, dayjs) => {\n  const proto = Dayjs.prototype\n  dayjs.utc = function (date) {\n    const cfg = { date, utc: true, args: arguments } // eslint-disable-line prefer-rest-params\n    return new Dayjs(cfg) // eslint-disable-line no-use-before-define\n  }\n\n  proto.utc = function (keepLocalTime) {\n    const ins = dayjs(this.toDate(), { locale: this.$L, utc: true })\n    if (keepLocalTime) {\n      return ins.add(this.utcOffset(), MIN)\n    }\n    return ins\n  }\n\n  proto.local = function () {\n    return dayjs(this.toDate(), { locale: this.$L, utc: false })\n  }\n\n  const oldParse = proto.parse\n  proto.parse = function (cfg) {\n    if (cfg.utc) {\n      this.$u = true\n    }\n    if (!this.$utils().u(cfg.$offset)) {\n      this.$offset = cfg.$offset\n    }\n    oldParse.call(this, cfg)\n  }\n\n  const oldInit = proto.init\n  proto.init = function () {\n    if (this.$u) {\n      const { $d } = this\n      this.$y = $d.getUTCFullYear()\n      this.$M = $d.getUTCMonth()\n      this.$D = $d.getUTCDate()\n      this.$W = $d.getUTCDay()\n      this.$H = $d.getUTCHours()\n      this.$m = $d.getUTCMinutes()\n      this.$s = $d.getUTCSeconds()\n      this.$ms = $d.getUTCMilliseconds()\n    } else {\n      oldInit.call(this)\n    }\n  }\n\n  const oldUtcOffset = proto.utcOffset\n  proto.utcOffset = function (input, keepLocalTime) {\n    const { u } = this.$utils()\n    if (u(input)) {\n      if (this.$u) {\n        return 0\n      }\n      if (!u(this.$offset)) {\n        return this.$offset\n      }\n      return oldUtcOffset.call(this)\n    }\n    if (typeof input === 'string') {\n      input = offsetFromString(input)\n      if (input === null) {\n        return this\n      }\n    }\n    const offset = Math.abs(input) <= 16 ? input * 60 : input\n    let ins = this\n    if (keepLocalTime) {\n      ins.$offset = offset\n      ins.$u = input === 0\n      return ins\n    }\n    if (input !== 0) {\n      const localTimezoneOffset = this.$u\n        ? this.toDate().getTimezoneOffset() : -1 * this.utcOffset()\n      ins = this.local().add(offset + localTimezoneOffset, MIN)\n      ins.$offset = offset\n      ins.$x.$localOffset = localTimezoneOffset\n    } else {\n      ins = this.utc()\n    }\n    return ins\n  }\n\n  const oldFormat = proto.format\n  const UTC_FORMAT_DEFAULT = 'YYYY-MM-DDTHH:mm:ss[Z]'\n  proto.format = function (formatStr) {\n    const str = formatStr || (this.$u ? UTC_FORMAT_DEFAULT : '')\n    return oldFormat.call(this, str)\n  }\n\n  proto.valueOf = function () {\n    const addedOffset = !this.$utils().u(this.$offset)\n      ? this.$offset + (this.$x.$localOffset || this.$d.getTimezoneOffset()) : 0\n    return this.$d.valueOf() - (addedOffset * MILLISECONDS_A_MINUTE)\n  }\n\n  proto.isUTC = function () {\n    return !!this.$u\n  }\n\n  proto.toISOString = function () {\n    return this.toDate().toISOString()\n  }\n\n  proto.toString = function () {\n    return this.toDate().toUTCString()\n  }\n\n  const oldToDate = proto.toDate\n  proto.toDate = function (type) {\n    if (type === 's' && this.$offset) {\n      return dayjs(this.format('YYYY-MM-DD HH:mm:ss:SSS')).toDate()\n    }\n    return oldToDate.call(this)\n  }\n  const oldDiff = proto.diff\n  proto.diff = function (input, units, float) {\n    if (input && this.$u === input.$u) {\n      return oldDiff.call(this, input, units, float)\n    }\n    const localThis = this.local()\n    const localInput = dayjs(input).local()\n    return oldDiff.call(localThis, localInput, units, float)\n  }\n}\n"],"names":[],"mappings":"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"}